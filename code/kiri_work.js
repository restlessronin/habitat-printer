"use strict";"undefined"==typeof self&&(this.self=this),function(){self.module||(self.module={exports:{}});let e=Date.now(),n=()=>((Date.now()-e)/1e3).toFixed(2).padStart(9,0),u=self.dbug=self.dbug||{level:1,set:e=>{0<=e&&(u.level=Math.min(e,3))},debug:function(){if(u.level<=0)return console.log(n(),"[DBG]",...arguments)},log:function(){if(u.level<=1)return console.log(n(),"|",...arguments)},warn:function(){if(u.level<=2)return console.log(n(),"[WRN]",...arguments)},error:function(){if(u.level<=3)return console.trace(n(),"[ERR]",...arguments)},since:n};self.noop=()=>{};let t=self.gapp=self.gapp||{},l=[];function o(e){return{funcs:e.filter(e=>"function"==typeof e),arrays:e.filter(e=>Array.isArray(e)),strings:e.filter(e=>"string"==typeof e),objects:e.filter(e=>"object"==typeof e&&!Array.isArray(e))}}t.overlay=Object.assign,t.register=function(){var e=o([...arguments]),n=e.strings[0],t,n={fn:e.funcs[0],name:n};l.push(n)},t.main=function(){var e=o([...arguments]),n=e.strings[0];const t=e.funcs[0],r=e.funcs[1];var s=self,f;r&&r(s);for(f of l){let{fn:l,name:o}=f;if(o&&u.debug(n+" | load | "+o),l){let e=o.split("."),n=e.pop(),t=s;for(var i of e)t=t[i]||(u.debug({creating_root:i,for:o}),t[i]={});let r=t[n]||{};l(s,e=>{if(e)return t[n]=Object.assign(r,e)})}else u.debug(`${n} | ${f.name} | missing fn()`)}l=null,t&&t(s)}}();"use strict";gapp.register("add.array",[],(t,n)=>{let r={};for(var e in r.flat||(r.flat=function(){try{return[].concat.apply([],this)}catch(t){let n=[];for(var r of this.slice())n.push(...r);return n}}),r.findWith=function(r){for(let t=0,n=this.length;t<n;t++)if(r(this[t]))return t;return-1},r.equals=function(n){if(!n)return!1;if(n.length!==this.length)return!1;for(let t=0;t<this.length;t++)if(n[t]!==this[t])return!1;return!0},r.peek=function(t=1){return this[this.length-t]},r.drop=function(t=0,n=0){for(;0<t--;)this.shift();for(;0<n--;)this.pop();return this},r.append=function(t,n){return n?this.appendAll(t):(this.push(t),this)},r.appendAll=function(r){if(r&&0<r.length)if(1e4<r.length)for(let t=0,n=r.length;t<n;t++)this.push(r[t]);else this.push(...r);return this},r.addOnce=function(t){return this.contains(t)||this.push(t),this},r.clone=function(t){let n=this.slice(),r=n.length,e=0;for(;e<r;)n[e]=n[e++].clone(t);return n},r.xray=function(n){const r=[],e=this.length;for(let t=0;t<e;t++)r.push(this[t].xray(n));return r},r.xout=function(t,r){t&&console.log(`${t} [${this.length}]`),r=r||"  ",this.forEach((t,n)=>{var t;t.xout?t.xout(null,r+n+r):t.xray&&(t=t.xray(),console.log(r,t),Object.values(t).forEach(t=>{t.xout&&t.xout(null,r+r)}))})},r.remove=function(t){var t=this.indexOf(t);return 0<=t?this.splice(t,1):null},r.removeAll=function(r){for(let t=0,n=r.length;t<n;t++)this.remove(r[t])},r.last=function(){return 0===this.length?null:this[this.length-1]},r.contains=function(t){return 0<=this.indexOf(t)},r.toFloat32=function(){return new Float32Array(this)},r.toUint32=function(){return Uint32Array.from(this)},r.forEachPair=function(t,n){let r=this,e=0,i=n||2,o=r.length;for(;e<o;)t(r[e],r[(e+1)%o],e),e+=i},r.show=function(n,r){r=r||function(t){console.log(t)},this.forEach(function(t){r(t[n]())})},r.uniq=function(){return this.slice().sort().filter((t,n,r)=>!n||t!=r[n-1])},r.hasNaN=function(){return 0<this.filter(t=>isNaN(t)).length},r.group=function(e){let t=new Array(Math.ceil(this.length/e)),i=0;for(let r=0;r<this.length;r+=e){let n=new Array(e);for(let t=0;t<e;t++)n[t]=this[r+t];t[i++]=n}return t},Array.handle=function(i){return function(){let n=[...arguments],r=n.shift();if(Array.isArray(r)){let t=[];for(var e of r.slice())t.push(i(e,...n));return t}return i(r,...n)}},r)Object.defineProperty(Array.prototype,e,{value:r[e],enumerable:!1});Float32Array.prototype.toShared=function(){const t=new Float32Array(new SharedArrayBuffer(this.buffer.byteLength));return t.set(this),t},String.prototype.reverse=function(){return this.split("").reverse().join("")},Object.clone=function(t){return t&&JSON.parse(JSON.stringify(t))},Object.toArray=function(t){let n=[];for(var[r,e]of Object.entries(t))n.push({key:r,value:e});return n},Math.bound=function(t,n,r){return Math.max(n,Math.min(r,t))},Number.prototype.round=function(t){if(0===t)return 0|this.valueOf();var t=Math.pow(10,t||3);return Math.round(this.valueOf()*t)/t}});"use strict";gapp.register("add.class",[],(t,s)=>{self.ArrayWriter=class i{constructor(){this.pos=0,this.array=[]}seek(t){var s=this.pos;return this.pos=t,s}skip(t){return this.writeBytes(new Array(t).fill(0),t),this.pos}writeU8(t){this.array[this.pos++]=255&t}writeU16(t){this.array[this.pos++]=t>>8&255,this.array[this.pos++]=255&t}writeU32(t){this.array[this.pos++]=t>>24&255,this.array[this.pos++]=t>>16&255,this.array[this.pos++]=t>>8&255,this.array[this.pos++]=255&t}writeBytes(t){this.array.appendAll(t),this.pos+=t.length}toBuffer(){return new Uint8ClampedArray(this.array).buffer}},self.DataWriter=class r{constructor(t,s){this.view=t,this.pos=s||0}skip(t){var s=this.pos;return this.pos+=t,s}writeU8(t){try{return this.view.setUint8(this.pos,t),this.skip(1)}catch(t){throw console.log({pos:this.pos,err:t}),t}}writeU16(t,s){return this.view.setUint16(this.pos,t,s),this.skip(2)}writeU32(t,s){return this.view.setUint32(this.pos,t,s),this.skip(4)}writeI32(t,s){return this.view.setInt32(this.pos,t,s),this.skip(4)}writeUB64(t,s){return this.view.setBigUint64(this.pos,t,s),this.skip(8)}writeB64(t,s){return this.view.setBigInt64(this.pos,t,s),this.skip(8)}writeF32(t,s){return this.view.setFloat32(this.pos,t,s),this.skip(4)}writeF64(t,s){return this.view.setFloat64(this.pos,t,s),this.skip(8)}},self.DataReader=class e{constructor(t,s){this.view=t,this.pos=s||0}skip(t){var s=this.pos;return this.pos+=t,s}readBytes(t){var s=this.view.buffer.slice(this.pos,this.pos+t);return this.pos+=t,s}readU8(){return this.view.getUint8(this.pos++)}readU16(t){var t=this.view.getUint16(this.pos,t);return this.pos+=2,t}readU32(t){var t=this.view.getUint32(this.pos,t);return this.pos+=4,t}readI32(t){var t=this.view.getInt32(this.pos,t);return this.pos+=4,t}readB64(t){var t=this.view.getBigInt64(this.pos,t);return this.pos+=8,t}readUB64(t){var t=this.view.getBigUint64(this.pos,t);return this.pos+=8,t}readF32(t){var t=this.view.getFloat32(this.pos,t);return this.pos+=4,t}readF64(t){var t=this.view.getFloat64(this.pos,t);return this.pos+=8,t}}});/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE={})}(this,(function(t){"use strict";const e="144",i=100,n=300,r=301,s=302,a=303,o=304,l=306,c=1e3,h=1001,u=1002,d=1003,p=1004,m=1005,f=1006,g=1007,v=1008,x=1009,_=1012,y=1014,M=1015,b=1016,S=1020,w=1023,T=1026,A=1027,E=33776,C=33777,L=33778,R=33779,P=35840,I=35841,D=35842,N=35843,O=37492,z=37496,U=37808,B=37809,F=37810,k=37811,G=37812,V=37813,H=37814,W=37815,j=37816,q=37817,X=37818,Y=37819,Z=37820,J=37821,K=36492,$=2300,Q=2301,tt=2302,et=2400,it=2401,nt=2402,rt=2500,st=2501,at=3e3,ot=3001,lt="srgb",ct="srgb-linear",ht=7680,ut=35044,dt="300 es",pt=1035;class mt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const ft=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let gt=1234567;const vt=Math.PI/180,xt=180/Math.PI;function _t(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(ft[255&t]+ft[t>>8&255]+ft[t>>16&255]+ft[t>>24&255]+"-"+ft[255&e]+ft[e>>8&255]+"-"+ft[e>>16&15|64]+ft[e>>24&255]+"-"+ft[63&i|128]+ft[i>>8&255]+"-"+ft[i>>16&255]+ft[i>>24&255]+ft[255&n]+ft[n>>8&255]+ft[n>>16&255]+ft[n>>24&255]).toLowerCase()}function yt(t,e,i){return Math.max(e,Math.min(i,t))}function Mt(t,e){return(t%e+e)%e}function bt(t,e,i){return(1-i)*t+i*e}function St(t){return 0==(t&t-1)&&0!==t}function wt(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Tt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function At(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function Et(t,e){switch(e.constructor){case Float32Array:return t;case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}var Ct=Object.freeze({__proto__:null,DEG2RAD:vt,RAD2DEG:xt,generateUUID:_t,clamp:yt,euclideanModulo:Mt,mapLinear:function(t,e,i,n,r){return n+(t-e)*(r-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:bt,damp:function(t,e,i,n){return bt(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(Mt(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&(gt=t);let e=gt+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*vt},radToDeg:function(t){return t*xt},isPowerOfTwo:St,ceilPowerOfTwo:wt,floorPowerOfTwo:Tt,setQuaternionFromProperEuler:function(t,e,i,n,r){const s=Math.cos,a=Math.sin,o=s(i/2),l=a(i/2),c=s((e+n)/2),h=a((e+n)/2),u=s((e-n)/2),d=a((e-n)/2),p=s((n-e)/2),m=a((n-e)/2);switch(r){case"XYX":t.set(o*h,l*u,l*d,o*c);break;case"YZY":t.set(l*d,o*h,l*u,o*c);break;case"ZXZ":t.set(l*u,l*d,o*h,o*c);break;case"XZX":t.set(o*h,l*m,l*p,o*c);break;case"YXY":t.set(l*p,o*h,l*m,o*c);break;case"ZYZ":t.set(l*m,l*p,o*h,o*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}},normalize:Et,denormalize:At});class Lt{constructor(t=0,e=0){Lt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),r=this.x-t.x,s=this.y-t.y;return this.x=r*i-s*n+t.x,this.y=r*n+s*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Rt{constructor(){Rt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(t,e,i,n,r,s,a,o,l){const c=this.elements;return c[0]=t,c[1]=n,c[2]=a,c[3]=e,c[4]=r,c[5]=o,c[6]=i,c[7]=s,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[3],o=i[6],l=i[1],c=i[4],h=i[7],u=i[2],d=i[5],p=i[8],m=n[0],f=n[3],g=n[6],v=n[1],x=n[4],_=n[7],y=n[2],M=n[5],b=n[8];return r[0]=s*m+a*v+o*y,r[3]=s*f+a*x+o*M,r[6]=s*g+a*_+o*b,r[1]=l*m+c*v+h*y,r[4]=l*f+c*x+h*M,r[7]=l*g+c*_+h*b,r[2]=u*m+d*v+p*y,r[5]=u*f+d*x+p*M,r[8]=u*g+d*_+p*b,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8];return e*s*c-e*a*l-i*r*c+i*a*o+n*r*l-n*s*o}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=c*s-a*l,u=a*o-c*r,d=l*r-s*o,p=e*h+i*u+n*d;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return t[0]=h*m,t[1]=(n*l-c*i)*m,t[2]=(a*i-n*s)*m,t[3]=u*m,t[4]=(c*e-n*o)*m,t[5]=(n*r-a*e)*m,t[6]=d*m,t[7]=(i*o-l*e)*m,t[8]=(s*e-i*r)*m,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,r,s,a){const o=Math.cos(r),l=Math.sin(r);return this.set(i*o,i*l,-i*(o*s+l*a)+s+t,-n*l,n*o,-n*(-l*s+o*a)+a+e,0,0,1),this}scale(t,e){const i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=e,i[4]*=e,i[7]*=e,this}rotate(t){const e=Math.cos(t),i=Math.sin(t),n=this.elements,r=n[0],s=n[3],a=n[6],o=n[1],l=n[4],c=n[7];return n[0]=e*r+i*o,n[3]=e*s+i*l,n[6]=e*a+i*c,n[1]=-i*r+e*o,n[4]=-i*s+e*l,n[7]=-i*a+e*c,this}translate(t,e){const i=this.elements;return i[0]+=t*i[2],i[3]+=t*i[5],i[6]+=t*i[8],i[1]+=e*i[2],i[4]+=e*i[5],i[7]+=e*i[8],this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}function Pt(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}const It={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Dt(t,e){return new It[t](e)}function Nt(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Ot(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function zt(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}const Ut={[lt]:{[ct]:Ot},[ct]:{[lt]:zt}},Bt={legacyMode:!0,get workingColorSpace(){return ct},set workingColorSpace(t){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(t,e,i){if(this.legacyMode||e===i||!e||!i)return t;if(Ut[e]&&void 0!==Ut[e][i]){const n=Ut[e][i];return t.r=n(t.r),t.g=n(t.g),t.b=n(t.b),t}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(t,e){return this.convert(t,this.workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this.workingColorSpace)}},Ft={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},kt={r:0,g:0,b:0},Gt={h:0,s:0,l:0},Vt={h:0,s:0,l:0};function Ht(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}function Wt(t,e){return e.r=t.r,e.g=t.g,e.b=t.b,e}class jt{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===e&&void 0===i?this.set(t):this.setRGB(t,e,i)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e="srgb"){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Bt.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n="srgb-linear"){return this.r=t,this.g=e,this.b=i,Bt.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n="srgb-linear"){if(t=Mt(t,1),e=yt(e,0,1),i=yt(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,r=2*i-n;this.r=Ht(r,n,t+1/3),this.g=Ht(r,n,t),this.b=Ht(r,n,t-1/3)}return Bt.toWorkingColorSpace(this,n),this}setStyle(t,e="srgb"){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let t;const r=n[1],s=n[2];switch(r){case"rgb":case"rgba":if(t=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,Bt.toWorkingColorSpace(this,e),i(t[4]),this;if(t=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,Bt.toWorkingColorSpace(this,e),i(t[4]),this;break;case"hsl":case"hsla":if(t=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const n=parseFloat(t[1])/360,r=parseFloat(t[2])/100,s=parseFloat(t[3])/100;return i(t[4]),this.setHSL(n,r,s,e)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const t=n[1],i=t.length;if(3===i)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,Bt.toWorkingColorSpace(this,e),this;if(6===i)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,Bt.toWorkingColorSpace(this,e),this}return t&&t.length>0?this.setColorName(t,e):this}setColorName(t,e="srgb"){const i=Ft[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ot(t.r),this.g=Ot(t.g),this.b=Ot(t.b),this}copyLinearToSRGB(t){return this.r=zt(t.r),this.g=zt(t.g),this.b=zt(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t="srgb"){return Bt.fromWorkingColorSpace(Wt(this,kt),t),yt(255*kt.r,0,255)<<16^yt(255*kt.g,0,255)<<8^yt(255*kt.b,0,255)<<0}getHexString(t="srgb"){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e="srgb-linear"){Bt.fromWorkingColorSpace(Wt(this,kt),e);const i=kt.r,n=kt.g,r=kt.b,s=Math.max(i,n,r),a=Math.min(i,n,r);let o,l;const c=(a+s)/2;if(a===s)o=0,l=0;else{const t=s-a;switch(l=c<=.5?t/(s+a):t/(2-s-a),s){case i:o=(n-r)/t+(n<r?6:0);break;case n:o=(r-i)/t+2;break;case r:o=(i-n)/t+4}o/=6}return t.h=o,t.s=l,t.l=c,t}getRGB(t,e="srgb-linear"){return Bt.fromWorkingColorSpace(Wt(this,kt),e),t.r=kt.r,t.g=kt.g,t.b=kt.b,t}getStyle(t="srgb"){return Bt.fromWorkingColorSpace(Wt(this,kt),t),t!==lt?`color(${t} ${kt.r} ${kt.g} ${kt.b})`:`rgb(${255*kt.r|0},${255*kt.g|0},${255*kt.b|0})`}offsetHSL(t,e,i){return this.getHSL(Gt),Gt.h+=t,Gt.s+=e,Gt.l+=i,this.setHSL(Gt.h,Gt.s,Gt.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Gt),t.getHSL(Vt);const i=bt(Gt.h,Vt.h,e),n=bt(Gt.s,Vt.s,e),r=bt(Gt.l,Vt.l,e);return this.setHSL(i,n,r),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let qt;jt.NAMES=Ft;class Xt{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===qt&&(qt=Nt("canvas")),qt.width=t.width,qt.height=t.height;const i=qt.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=qt}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=Nt("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),r=n.data;for(let t=0;t<r.length;t++)r[t]=255*Ot(r[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Ot(e[t]/255)):e[t]=Ot(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}class Yt{constructor(t=null){this.isSource=!0,this.uuid=_t(),this.data=t,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(Zt(n[e].image)):t.push(Zt(n[e]))}else t=Zt(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function Zt(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Xt.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Jt=0;class Kt extends mt{constructor(t=Kt.DEFAULT_IMAGE,e=Kt.DEFAULT_MAPPING,i=1001,n=1001,r=1006,s=1008,a=1023,o=1009,l=1,c=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Jt++}),this.uuid=_t(),this.name="",this.source=new Yt(t),this.mipmaps=[],this.mapping=e,this.wrapS=i,this.wrapT=n,this.magFilter=r,this.minFilter=s,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=o,this.offset=new Lt(0,0),this.repeat=new Lt(1,1),this.center=new Lt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Rt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==n)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case c:t.x=t.x-Math.floor(t.x);break;case h:t.x=t.x<0?0:1;break;case u:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case c:t.y=t.y-Math.floor(t.y);break;case h:t.y=t.y<0?0:1;break;case u:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}Kt.DEFAULT_IMAGE=null,Kt.DEFAULT_MAPPING=n;class $t{constructor(t=0,e=0,i=0,n=1){$t.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=this.w,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n+s[12]*r,this.y=s[1]*e+s[5]*i+s[9]*n+s[13]*r,this.z=s[2]*e+s[6]*i+s[10]*n+s[14]*r,this.w=s[3]*e+s[7]*i+s[11]*n+s[15]*r,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,r;const s=.01,a=.1,o=t.elements,l=o[0],c=o[4],h=o[8],u=o[1],d=o[5],p=o[9],m=o[2],f=o[6],g=o[10];if(Math.abs(c-u)<s&&Math.abs(h-m)<s&&Math.abs(p-f)<s){if(Math.abs(c+u)<a&&Math.abs(h+m)<a&&Math.abs(p+f)<a&&Math.abs(l+d+g-3)<a)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,o=(d+1)/2,v=(g+1)/2,x=(c+u)/4,_=(h+m)/4,y=(p+f)/4;return t>o&&t>v?t<s?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(t),n=x/i,r=_/i):o>v?o<s?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(o),i=x/n,r=y/n):v<s?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(v),i=_/r,n=y/r),this.set(i,n,r,e),this}let v=Math.sqrt((f-p)*(f-p)+(h-m)*(h-m)+(u-c)*(u-c));return Math.abs(v)<.001&&(v=1),this.x=(f-p)/v,this.y=(h-m)/v,this.z=(u-c)/v,this.w=Math.acos((l+d+g-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Qt extends mt{constructor(t,e,i={}){super(),this.isWebGLRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new $t(0,0,t,e),this.scissorTest=!1,this.viewport=new $t(0,0,t,e);const n={width:t,height:e,depth:1};this.texture=new Kt(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:f,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(t,e,i=1){this.width===t&&this.height===e&&this.depth===i||(this.width=t,this.height=e,this.depth=i,this.texture.image.width=t,this.texture.image.height=e,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.copy(t.viewport),this.texture=t.texture.clone(),this.texture.isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Yt(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class te extends Kt{constructor(t=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=d,this.minFilter=d,this.wrapR=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ee extends Kt{constructor(t=null,e=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=d,this.minFilter=d,this.wrapR=h,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ie{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,r,s,a){let o=i[n+0],l=i[n+1],c=i[n+2],h=i[n+3];const u=r[s+0],d=r[s+1],p=r[s+2],m=r[s+3];if(0===a)return t[e+0]=o,t[e+1]=l,t[e+2]=c,void(t[e+3]=h);if(1===a)return t[e+0]=u,t[e+1]=d,t[e+2]=p,void(t[e+3]=m);if(h!==m||o!==u||l!==d||c!==p){let t=1-a;const e=o*u+l*d+c*p+h*m,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const r=Math.sqrt(n),s=Math.atan2(r,e*i);t=Math.sin(t*s)/r,a=Math.sin(a*s)/r}const r=a*i;if(o=o*t+u*r,l=l*t+d*r,c=c*t+p*r,h=h*t+m*r,t===1-a){const t=1/Math.sqrt(o*o+l*l+c*c+h*h);o*=t,l*=t,c*=t,h*=t}}t[e]=o,t[e+1]=l,t[e+2]=c,t[e+3]=h}static multiplyQuaternionsFlat(t,e,i,n,r,s){const a=i[n],o=i[n+1],l=i[n+2],c=i[n+3],h=r[s],u=r[s+1],d=r[s+2],p=r[s+3];return t[e]=a*p+c*h+o*d-l*u,t[e+1]=o*p+c*u+l*h-a*d,t[e+2]=l*p+c*d+a*u-o*h,t[e+3]=c*p-a*h-o*u-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e){const i=t._x,n=t._y,r=t._z,s=t._order,a=Math.cos,o=Math.sin,l=a(i/2),c=a(n/2),h=a(r/2),u=o(i/2),d=o(n/2),p=o(r/2);switch(s){case"XYZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"YXZ":this._x=u*c*h+l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"ZXY":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h-u*d*p;break;case"ZYX":this._x=u*c*h-l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h+u*d*p;break;case"YZX":this._x=u*c*h+l*d*p,this._y=l*d*h+u*c*p,this._z=l*c*p-u*d*h,this._w=l*c*h-u*d*p;break;case"XZY":this._x=u*c*h-l*d*p,this._y=l*d*h-u*c*p,this._z=l*c*p+u*d*h,this._w=l*c*h+u*d*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return!1!==e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],r=e[8],s=e[1],a=e[5],o=e[9],l=e[2],c=e[6],h=e[10],u=i+a+h;if(u>0){const t=.5/Math.sqrt(u+1);this._w=.25/t,this._x=(c-o)*t,this._y=(r-l)*t,this._z=(s-n)*t}else if(i>a&&i>h){const t=2*Math.sqrt(1+i-a-h);this._w=(c-o)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(r+l)/t}else if(a>h){const t=2*Math.sqrt(1+a-i-h);this._w=(r-l)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(o+c)/t}else{const t=2*Math.sqrt(1+h-i-a);this._w=(s-n)/t,this._x=(r+l)/t,this._y=(o+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(yt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,r=t._z,s=t._w,a=e._x,o=e._y,l=e._z,c=e._w;return this._x=i*c+s*a+n*l-r*o,this._y=n*c+s*o+r*a-i*l,this._z=r*c+s*l+i*o-n*a,this._w=s*c-i*a-n*o-r*l,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,r=this._z,s=this._w;let a=s*t._w+i*t._x+n*t._y+r*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=s,this._x=i,this._y=n,this._z=r,this;const o=1-a*a;if(o<=Number.EPSILON){const t=1-e;return this._w=t*s+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*r+e*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(o),c=Math.atan2(l,a),h=Math.sin((1-e)*c)/l,u=Math.sin(e*c)/l;return this._w=s*h+this._w*u,this._x=i*h+this._x*u,this._y=n*h+this._y*u,this._z=r*h+this._z*u,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=Math.random(),e=Math.sqrt(1-t),i=Math.sqrt(t),n=2*Math.PI*Math.random(),r=2*Math.PI*Math.random();return this.set(e*Math.cos(n),i*Math.sin(r),i*Math.cos(r),e*Math.sin(n))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class ne{constructor(t=0,e=0,i=0){ne.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(se.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(se.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[3]*i+r[6]*n,this.y=r[1]*e+r[4]*i+r[7]*n,this.z=r[2]*e+r[5]*i+r[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,r=t.elements,s=1/(r[3]*e+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*e+r[4]*i+r[8]*n+r[12])*s,this.y=(r[1]*e+r[5]*i+r[9]*n+r[13])*s,this.z=(r[2]*e+r[6]*i+r[10]*n+r[14])*s,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,r=t.x,s=t.y,a=t.z,o=t.w,l=o*e+s*n-a*i,c=o*i+a*e-r*n,h=o*n+r*i-s*e,u=-r*e-s*i-a*n;return this.x=l*o+u*-r+c*-a-h*-s,this.y=c*o+u*-s+h*-r-l*-a,this.z=h*o+u*-a+l*-s-c*-r,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n,this.y=r[1]*e+r[5]*i+r[9]*n,this.z=r[2]*e+r[6]*i+r[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,r=t.z,s=e.x,a=e.y,o=e.z;return this.x=n*o-r*a,this.y=r*s-i*o,this.z=i*a-n*s,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return re.copy(this).projectOnVector(t),this.sub(re)}reflect(t){return this.sub(re.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(yt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=2*(Math.random()-.5),e=Math.random()*Math.PI*2,i=Math.sqrt(1-t**2);return this.x=i*Math.cos(e),this.y=i*Math.sin(e),this.z=t,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const re=new ne,se=new ie;class ae{constructor(t=new ne(1/0,1/0,1/0),e=new ne(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.length;o<l;o+=3){const l=t[o],c=t[o+1],h=t[o+2];l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromBufferAttribute(t){let e=1/0,i=1/0,n=1/0,r=-1/0,s=-1/0,a=-1/0;for(let o=0,l=t.count;o<l;o++){const l=t.getX(o),c=t.getY(o),h=t.getZ(o);l<e&&(e=l),c<i&&(i=c),h<n&&(n=h),l>r&&(r=l),c>s&&(s=c),h>a&&(a=h)}return this.min.set(e,i,n),this.max.set(r,s,a),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=le.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i)if(e&&null!=i.attributes&&void 0!==i.attributes.position){const e=i.attributes.position;for(let i=0,n=e.count;i<n;i++)le.fromBufferAttribute(e,i).applyMatrix4(t.matrixWorld),this.expandByPoint(le)}else null===i.boundingBox&&i.computeBoundingBox(),ce.copy(i.boundingBox),ce.applyMatrix4(t.matrixWorld),this.union(ce);const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,le),le.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ge),ve.subVectors(this.max,ge),he.subVectors(t.a,ge),ue.subVectors(t.b,ge),de.subVectors(t.c,ge),pe.subVectors(ue,he),me.subVectors(de,ue),fe.subVectors(he,de);let e=[0,-pe.z,pe.y,0,-me.z,me.y,0,-fe.z,fe.y,pe.z,0,-pe.x,me.z,0,-me.x,fe.z,0,-fe.x,-pe.y,pe.x,0,-me.y,me.x,0,-fe.y,fe.x,0];return!!ye(e,he,ue,de,ve)&&(e=[1,0,0,0,1,0,0,0,1],!!ye(e,he,ue,de,ve)&&(xe.crossVectors(pe,me),e=[xe.x,xe.y,xe.z],ye(e,he,ue,de,ve)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return le.copy(t).clamp(this.min,this.max).sub(t).length()}getBoundingSphere(t){return this.getCenter(t.center),t.radius=.5*this.getSize(le).length(),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(oe[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),oe[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),oe[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),oe[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),oe[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),oe[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),oe[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),oe[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(oe)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const oe=[new ne,new ne,new ne,new ne,new ne,new ne,new ne,new ne],le=new ne,ce=new ae,he=new ne,ue=new ne,de=new ne,pe=new ne,me=new ne,fe=new ne,ge=new ne,ve=new ne,xe=new ne,_e=new ne;function ye(t,e,i,n,r){for(let s=0,a=t.length-3;s<=a;s+=3){_e.fromArray(t,s);const a=r.x*Math.abs(_e.x)+r.y*Math.abs(_e.y)+r.z*Math.abs(_e.z),o=e.dot(_e),l=i.dot(_e),c=n.dot(_e);if(Math.max(-Math.max(o,l,c),Math.min(o,l,c))>a)return!1}return!0}const Me=new ae,be=new ne,Se=new ne,we=new ne;class Te{constructor(t=new ne,e=-1){this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):Me.setFromPoints(t).getCenter(i);let n=0;for(let e=0,r=t.length;e<r;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){we.subVectors(t,this.center);const e=we.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.add(we.multiplyScalar(i/t)),this.radius+=i}return this}union(t){return!0===this.center.equals(t.center)?Se.set(0,0,1).multiplyScalar(t.radius):Se.subVectors(t.center,this.center).normalize().multiplyScalar(t.radius),this.expandByPoint(be.copy(t.center).add(Se)),this.expandByPoint(be.copy(t.center).sub(Se)),this}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const Ae=new ne,Ee=new ne,Ce=new ne,Le=new ne,Re=new ne,Pe=new ne,Ie=new ne;class De{constructor(t=new ne,e=new ne(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.direction).multiplyScalar(t).add(this.origin)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Ae)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Ae.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ae.copy(this.direction).multiplyScalar(e).add(this.origin),Ae.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){Ee.copy(t).add(e).multiplyScalar(.5),Ce.copy(e).sub(t).normalize(),Le.copy(this.origin).sub(Ee);const r=.5*t.distanceTo(e),s=-this.direction.dot(Ce),a=Le.dot(this.direction),o=-Le.dot(Ce),l=Le.lengthSq(),c=Math.abs(1-s*s);let h,u,d,p;if(c>0)if(h=s*o-a,u=s*a-o,p=r*c,h>=0)if(u>=-p)if(u<=p){const t=1/c;h*=t,u*=t,d=h*(h+s*u+2*a)+u*(s*h+u+2*o)+l}else u=r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u=-r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;else u<=-p?(h=Math.max(0,-(-s*r+a)),u=h>0?-r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l):u<=p?(h=0,u=Math.min(Math.max(-r,-o),r),d=u*(u+2*o)+l):(h=Math.max(0,-(s*r+a)),u=h>0?r:Math.min(Math.max(-r,-o),r),d=-h*h+u*(u+2*o)+l);else u=s>0?-r:r,h=Math.max(0,-(s*u+a)),d=-h*h+u*(u+2*o)+l;return i&&i.copy(this.direction).multiplyScalar(h).add(this.origin),n&&n.copy(Ce).multiplyScalar(u).add(Ee),d}intersectSphere(t,e){Ae.subVectors(t.center,this.origin);const i=Ae.dot(this.direction),n=Ae.dot(Ae)-i*i,r=t.radius*t.radius;if(n>r)return null;const s=Math.sqrt(r-n),a=i-s,o=i+s;return a<0&&o<0?null:a<0?this.at(o,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,r,s,a,o;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,u=this.origin;return l>=0?(i=(t.min.x-u.x)*l,n=(t.max.x-u.x)*l):(i=(t.max.x-u.x)*l,n=(t.min.x-u.x)*l),c>=0?(r=(t.min.y-u.y)*c,s=(t.max.y-u.y)*c):(r=(t.max.y-u.y)*c,s=(t.min.y-u.y)*c),i>s||r>n?null:((r>i||i!=i)&&(i=r),(s<n||n!=n)&&(n=s),h>=0?(a=(t.min.z-u.z)*h,o=(t.max.z-u.z)*h):(a=(t.max.z-u.z)*h,o=(t.min.z-u.z)*h),i>o||a>n?null:((a>i||i!=i)&&(i=a),(o<n||n!=n)&&(n=o),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,Ae)}intersectTriangle(t,e,i,n,r){Re.subVectors(e,t),Pe.subVectors(i,t),Ie.crossVectors(Re,Pe);let s,a=this.direction.dot(Ie);if(a>0){if(n)return null;s=1}else{if(!(a<0))return null;s=-1,a=-a}Le.subVectors(this.origin,t);const o=s*this.direction.dot(Pe.crossVectors(Le,Pe));if(o<0)return null;const l=s*this.direction.dot(Re.cross(Le));if(l<0)return null;if(o+l>a)return null;const c=-s*Le.dot(Ie);return c<0?null:this.at(c/a,r)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ne{constructor(){Ne.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(t,e,i,n,r,s,a,o,l,c,h,u,d,p,m,f){const g=this.elements;return g[0]=t,g[4]=e,g[8]=i,g[12]=n,g[1]=r,g[5]=s,g[9]=a,g[13]=o,g[2]=l,g[6]=c,g[10]=h,g[14]=u,g[3]=d,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ne).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/Oe.setFromMatrixColumn(t,0).length(),r=1/Oe.setFromMatrixColumn(t,1).length(),s=1/Oe.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*r,e[5]=i[5]*r,e[6]=i[6]*r,e[7]=0,e[8]=i[8]*s,e[9]=i[9]*s,e[10]=i[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,n=t.y,r=t.z,s=Math.cos(i),a=Math.sin(i),o=Math.cos(n),l=Math.sin(n),c=Math.cos(r),h=Math.sin(r);if("XYZ"===t.order){const t=s*c,i=s*h,n=a*c,r=a*h;e[0]=o*c,e[4]=-o*h,e[8]=l,e[1]=i+n*l,e[5]=t-r*l,e[9]=-a*o,e[2]=r-t*l,e[6]=n+i*l,e[10]=s*o}else if("YXZ"===t.order){const t=o*c,i=o*h,n=l*c,r=l*h;e[0]=t+r*a,e[4]=n*a-i,e[8]=s*l,e[1]=s*h,e[5]=s*c,e[9]=-a,e[2]=i*a-n,e[6]=r+t*a,e[10]=s*o}else if("ZXY"===t.order){const t=o*c,i=o*h,n=l*c,r=l*h;e[0]=t-r*a,e[4]=-s*h,e[8]=n+i*a,e[1]=i+n*a,e[5]=s*c,e[9]=r-t*a,e[2]=-s*l,e[6]=a,e[10]=s*o}else if("ZYX"===t.order){const t=s*c,i=s*h,n=a*c,r=a*h;e[0]=o*c,e[4]=n*l-i,e[8]=t*l+r,e[1]=o*h,e[5]=r*l+t,e[9]=i*l-n,e[2]=-l,e[6]=a*o,e[10]=s*o}else if("YZX"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*c,e[4]=r-t*h,e[8]=n*h+i,e[1]=h,e[5]=s*c,e[9]=-a*c,e[2]=-l*c,e[6]=i*h+n,e[10]=t-r*h}else if("XZY"===t.order){const t=s*o,i=s*l,n=a*o,r=a*l;e[0]=o*c,e[4]=-h,e[8]=l*c,e[1]=t*h+r,e[5]=s*c,e[9]=i*h-n,e[2]=n*h-i,e[6]=a*c,e[10]=r*h+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Ue,t,Be)}lookAt(t,e,i){const n=this.elements;return Ge.subVectors(t,e),0===Ge.lengthSq()&&(Ge.z=1),Ge.normalize(),Fe.crossVectors(i,Ge),0===Fe.lengthSq()&&(1===Math.abs(i.z)?Ge.x+=1e-4:Ge.z+=1e-4,Ge.normalize(),Fe.crossVectors(i,Ge)),Fe.normalize(),ke.crossVectors(Ge,Fe),n[0]=Fe.x,n[4]=ke.x,n[8]=Ge.x,n[1]=Fe.y,n[5]=ke.y,n[9]=Ge.y,n[2]=Fe.z,n[6]=ke.z,n[10]=Ge.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,r=this.elements,s=i[0],a=i[4],o=i[8],l=i[12],c=i[1],h=i[5],u=i[9],d=i[13],p=i[2],m=i[6],f=i[10],g=i[14],v=i[3],x=i[7],_=i[11],y=i[15],M=n[0],b=n[4],S=n[8],w=n[12],T=n[1],A=n[5],E=n[9],C=n[13],L=n[2],R=n[6],P=n[10],I=n[14],D=n[3],N=n[7],O=n[11],z=n[15];return r[0]=s*M+a*T+o*L+l*D,r[4]=s*b+a*A+o*R+l*N,r[8]=s*S+a*E+o*P+l*O,r[12]=s*w+a*C+o*I+l*z,r[1]=c*M+h*T+u*L+d*D,r[5]=c*b+h*A+u*R+d*N,r[9]=c*S+h*E+u*P+d*O,r[13]=c*w+h*C+u*I+d*z,r[2]=p*M+m*T+f*L+g*D,r[6]=p*b+m*A+f*R+g*N,r[10]=p*S+m*E+f*P+g*O,r[14]=p*w+m*C+f*I+g*z,r[3]=v*M+x*T+_*L+y*D,r[7]=v*b+x*A+_*R+y*N,r[11]=v*S+x*E+_*P+y*O,r[15]=v*w+x*C+_*I+y*z,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],r=t[12],s=t[1],a=t[5],o=t[9],l=t[13],c=t[2],h=t[6],u=t[10],d=t[14];return t[3]*(+r*o*h-n*l*h-r*a*u+i*l*u+n*a*d-i*o*d)+t[7]*(+e*o*d-e*l*u+r*s*u-n*s*d+n*l*c-r*o*c)+t[11]*(+e*l*h-e*a*d-r*s*h+i*s*d+r*a*c-i*l*c)+t[15]*(-n*a*c-e*o*h+e*a*u+n*s*h-i*s*u+i*o*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],r=t[3],s=t[4],a=t[5],o=t[6],l=t[7],c=t[8],h=t[9],u=t[10],d=t[11],p=t[12],m=t[13],f=t[14],g=t[15],v=h*f*l-m*u*l+m*o*d-a*f*d-h*o*g+a*u*g,x=p*u*l-c*f*l-p*o*d+s*f*d+c*o*g-s*u*g,_=c*m*l-p*h*l+p*a*d-s*m*d-c*a*g+s*h*g,y=p*h*o-c*m*o-p*a*u+s*m*u+c*a*f-s*h*f,M=e*v+i*x+n*_+r*y;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const b=1/M;return t[0]=v*b,t[1]=(m*u*r-h*f*r-m*n*d+i*f*d+h*n*g-i*u*g)*b,t[2]=(a*f*r-m*o*r+m*n*l-i*f*l-a*n*g+i*o*g)*b,t[3]=(h*o*r-a*u*r-h*n*l+i*u*l+a*n*d-i*o*d)*b,t[4]=x*b,t[5]=(c*f*r-p*u*r+p*n*d-e*f*d-c*n*g+e*u*g)*b,t[6]=(p*o*r-s*f*r-p*n*l+e*f*l+s*n*g-e*o*g)*b,t[7]=(s*u*r-c*o*r+c*n*l-e*u*l-s*n*d+e*o*d)*b,t[8]=_*b,t[9]=(p*h*r-c*m*r-p*i*d+e*m*d+c*i*g-e*h*g)*b,t[10]=(s*m*r-p*a*r+p*i*l-e*m*l-s*i*g+e*a*g)*b,t[11]=(c*a*r-s*h*r-c*i*l+e*h*l+s*i*d-e*a*d)*b,t[12]=y*b,t[13]=(c*m*n-p*h*n+p*i*u-e*m*u-c*i*f+e*h*f)*b,t[14]=(p*a*n-s*m*n-p*i*o+e*m*o+s*i*f-e*a*f)*b,t[15]=(s*h*n-c*a*n+c*i*o-e*h*o-s*i*u+e*a*u)*b,this}scale(t){const e=this.elements,i=t.x,n=t.y,r=t.z;return e[0]*=i,e[4]*=n,e[8]*=r,e[1]*=i,e[5]*=n,e[9]*=r,e[2]*=i,e[6]*=n,e[10]*=r,e[3]*=i,e[7]*=n,e[11]*=r,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),r=1-i,s=t.x,a=t.y,o=t.z,l=r*s,c=r*a;return this.set(l*s+i,l*a-n*o,l*o+n*a,0,l*a+n*o,c*a+i,c*o-n*s,0,l*o-n*a,c*o+n*s,r*o*o+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,r,s){return this.set(1,i,r,0,t,1,s,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,r=e._x,s=e._y,a=e._z,o=e._w,l=r+r,c=s+s,h=a+a,u=r*l,d=r*c,p=r*h,m=s*c,f=s*h,g=a*h,v=o*l,x=o*c,_=o*h,y=i.x,M=i.y,b=i.z;return n[0]=(1-(m+g))*y,n[1]=(d+_)*y,n[2]=(p-x)*y,n[3]=0,n[4]=(d-_)*M,n[5]=(1-(u+g))*M,n[6]=(f+v)*M,n[7]=0,n[8]=(p+x)*b,n[9]=(f-v)*b,n[10]=(1-(u+m))*b,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let r=Oe.set(n[0],n[1],n[2]).length();const s=Oe.set(n[4],n[5],n[6]).length(),a=Oe.set(n[8],n[9],n[10]).length();this.determinant()<0&&(r=-r),t.x=n[12],t.y=n[13],t.z=n[14],ze.copy(this);const o=1/r,l=1/s,c=1/a;return ze.elements[0]*=o,ze.elements[1]*=o,ze.elements[2]*=o,ze.elements[4]*=l,ze.elements[5]*=l,ze.elements[6]*=l,ze.elements[8]*=c,ze.elements[9]*=c,ze.elements[10]*=c,e.setFromRotationMatrix(ze),i.x=r,i.y=s,i.z=a,this}makePerspective(t,e,i,n,r,s){const a=this.elements,o=2*r/(e-t),l=2*r/(i-n),c=(e+t)/(e-t),h=(i+n)/(i-n),u=-(s+r)/(s-r),d=-2*s*r/(s-r);return a[0]=o,a[4]=0,a[8]=c,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,r,s){const a=this.elements,o=1/(e-t),l=1/(i-n),c=1/(s-r),h=(e+t)*o,u=(i+n)*l,d=(s+r)*c;return a[0]=2*o,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=-2*c,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const Oe=new ne,ze=new Ne,Ue=new ne(0,0,0),Be=new ne(1,1,1),Fe=new ne,ke=new ne,Ge=new ne,Ve=new Ne,He=new ie;class We{constructor(t=0,e=0,i=0,n=We.DefaultOrder){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,r=n[0],s=n[4],a=n[8],o=n[1],l=n[5],c=n[9],h=n[2],u=n[6],d=n[10];switch(e){case"XYZ":this._y=Math.asin(yt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-s,r)):(this._x=Math.atan2(u,l),this._z=0);break;case"YXZ":this._x=Math.asin(-yt(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(o,l)):(this._y=Math.atan2(-h,r),this._z=0);break;case"ZXY":this._x=Math.asin(yt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-s,l)):(this._y=0,this._z=Math.atan2(o,r));break;case"ZYX":this._y=Math.asin(-yt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(u,d),this._z=Math.atan2(o,r)):(this._x=0,this._z=Math.atan2(-s,l));break;case"YZX":this._z=Math.asin(yt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,r)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-yt(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(u,l),this._y=Math.atan2(a,r)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Ve.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ve,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return He.setFromEuler(this),this.setFromQuaternion(He,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}We.DefaultOrder="XYZ",We.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class je{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return 0!=(this.mask&t.mask)}isEnabled(t){return 0!=(this.mask&(1<<t|0))}}let qe=0;const Xe=new ne,Ye=new ie,Ze=new Ne,Je=new ne,Ke=new ne,$e=new ne,Qe=new ie,ti=new ne(1,0,0),ei=new ne(0,1,0),ii=new ne(0,0,1),ni={type:"added"},ri={type:"removed"};class si extends mt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:qe++}),this.uuid=_t(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=si.DefaultUp.clone();const t=new ne,e=new We,i=new ie,n=new ne(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Ne},normalMatrix:{value:new Rt}}),this.matrix=new Ne,this.matrixWorld=new Ne,this.matrixAutoUpdate=si.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=si.DefaultMatrixWorldAutoUpdate,this.layers=new je,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Ye.setFromAxisAngle(t,e),this.quaternion.multiply(Ye),this}rotateOnWorldAxis(t,e){return Ye.setFromAxisAngle(t,e),this.quaternion.premultiply(Ye),this}rotateX(t){return this.rotateOnAxis(ti,t)}rotateY(t){return this.rotateOnAxis(ei,t)}rotateZ(t){return this.rotateOnAxis(ii,t)}translateOnAxis(t,e){return Xe.copy(t).applyQuaternion(this.quaternion),this.position.add(Xe.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(ti,t)}translateY(t){return this.translateOnAxis(ei,t)}translateZ(t){return this.translateOnAxis(ii,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(Ze.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Je.copy(t):Je.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Ke.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ze.lookAt(Ke,Je,this.up):Ze.lookAt(Je,Ke,this.up),this.quaternion.setFromRotationMatrix(Ze),n&&(Ze.extractRotation(n.matrixWorld),Ye.setFromRotationMatrix(Ze),this.quaternion.premultiply(Ye.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(ni)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ri)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const e=this.children[t];e.parent=null,e.dispatchEvent(ri)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),Ze.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),Ze.multiply(t.parent.matrixWorld)),t.applyMatrix4(Ze),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ke,t,$e),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ke,Qe,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++){const n=e[i];!0!==n.matrixWorldAutoUpdate&&!0!==t||n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function r(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=r(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];r(t.shapes,n)}else r(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(r(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(r(t.materials,this.material[i]));n.material=e}else n.material=r(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(r(t.animations,i))}}if(e){const e=s(t.geometries),n=s(t.materials),r=s(t.textures),a=s(t.images),o=s(t.shapes),l=s(t.skeletons),c=s(t.animations),h=s(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),r.length>0&&(i.textures=r),a.length>0&&(i.images=a),o.length>0&&(i.shapes=o),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c),h.length>0&&(i.nodes=h)}return i.object=n,i;function s(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}si.DefaultUp=new ne(0,1,0),si.DefaultMatrixAutoUpdate=!0,si.DefaultMatrixWorldAutoUpdate=!0;const ai=new ne,oi=new ne,li=new ne,ci=new ne,hi=new ne,ui=new ne,di=new ne,pi=new ne,mi=new ne,fi=new ne;class gi{constructor(t=new ne,e=new ne,i=new ne){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),ai.subVectors(t,e),n.cross(ai);const r=n.lengthSq();return r>0?n.multiplyScalar(1/Math.sqrt(r)):n.set(0,0,0)}static getBarycoord(t,e,i,n,r){ai.subVectors(n,e),oi.subVectors(i,e),li.subVectors(t,e);const s=ai.dot(ai),a=ai.dot(oi),o=ai.dot(li),l=oi.dot(oi),c=oi.dot(li),h=s*l-a*a;if(0===h)return r.set(-2,-1,-1);const u=1/h,d=(l*o-a*c)*u,p=(s*c-a*o)*u;return r.set(1-d-p,p,d)}static containsPoint(t,e,i,n){return this.getBarycoord(t,e,i,n,ci),ci.x>=0&&ci.y>=0&&ci.x+ci.y<=1}static getUV(t,e,i,n,r,s,a,o){return this.getBarycoord(t,e,i,n,ci),o.set(0,0),o.addScaledVector(r,ci.x),o.addScaledVector(s,ci.y),o.addScaledVector(a,ci.z),o}static isFrontFacing(t,e,i,n){return ai.subVectors(i,e),oi.subVectors(t,e),ai.cross(oi).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ai.subVectors(this.c,this.b),oi.subVectors(this.a,this.b),.5*ai.cross(oi).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return gi.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return gi.getBarycoord(t,this.a,this.b,this.c,e)}getUV(t,e,i,n,r){return gi.getUV(t,this.a,this.b,this.c,e,i,n,r)}containsPoint(t){return gi.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return gi.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,r=this.c;let s,a;hi.subVectors(n,i),ui.subVectors(r,i),pi.subVectors(t,i);const o=hi.dot(pi),l=ui.dot(pi);if(o<=0&&l<=0)return e.copy(i);mi.subVectors(t,n);const c=hi.dot(mi),h=ui.dot(mi);if(c>=0&&h<=c)return e.copy(n);const u=o*h-c*l;if(u<=0&&o>=0&&c<=0)return s=o/(o-c),e.copy(i).addScaledVector(hi,s);fi.subVectors(t,r);const d=hi.dot(fi),p=ui.dot(fi);if(p>=0&&d<=p)return e.copy(r);const m=d*l-o*p;if(m<=0&&l>=0&&p<=0)return a=l/(l-p),e.copy(i).addScaledVector(ui,a);const f=c*p-d*h;if(f<=0&&h-c>=0&&d-p>=0)return di.subVectors(r,n),a=(h-c)/(h-c+(d-p)),e.copy(n).addScaledVector(di,a);const g=1/(f+m+u);return s=m*g,a=u*g,e.copy(i).addScaledVector(hi,s).addScaledVector(ui,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}let vi=0;class xi extends mt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:vi++}),this.uuid=_t(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=i,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ht,this.stencilZFail=ht,this.stencilZPass=ht,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),e){const e=n(t.textures),r=n(t.images);e.length>0&&(i.textures=e),r.length>0&&(i.images=r)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class _i extends xi{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new jt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const yi=new ne,Mi=new Lt;class bi{constructor(t,e,i){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===i,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,r=this.itemSize;n<r;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)Mi.fromBufferAttribute(this,e),Mi.applyMatrix3(t),this.setXY(e,Mi.x,Mi.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)yi.fromBufferAttribute(this,e),yi.applyMatrix3(t),this.setXYZ(e,yi.x,yi.y,yi.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)yi.fromBufferAttribute(this,e),yi.applyMatrix4(t),this.setXYZ(e,yi.x,yi.y,yi.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)yi.fromBufferAttribute(this,e),yi.applyNormalMatrix(t),this.setXYZ(e,yi.x,yi.y,yi.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)yi.fromBufferAttribute(this,e),yi.transformDirection(t),this.setXYZ(e,yi.x,yi.y,yi.z);return this}set(t,e=0){return this.array.set(t,e),this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=At(e,this.array)),e}setX(t,e){return this.normalized&&(e=Et(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=At(e,this.array)),e}setY(t,e){return this.normalized&&(e=Et(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=At(e,this.array)),e}setZ(t,e){return this.normalized&&(e=Et(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=At(e,this.array)),e}setW(t,e){return this.normalized&&(e=Et(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=Et(e,this.array),i=Et(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=Et(e,this.array),i=Et(i,this.array),n=Et(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t*=this.itemSize,this.normalized&&(e=Et(e,this.array),i=Et(i,this.array),n=Et(n,this.array),r=Et(r,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=r,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==ut&&(t.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(t.updateRange=this.updateRange),t}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Si extends bi{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class wi extends bi{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class Ti extends bi{constructor(t,e,i){super(new Float32Array(t),e,i)}}let Ai=0;const Ei=new Ne,Ci=new si,Li=new ne,Ri=new ae,Pi=new ae,Ii=new ne;class Di extends mt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Ai++}),this.uuid=_t(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Pt(t)?wi:Si)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new Rt).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ei.makeRotationFromQuaternion(t),this.applyMatrix4(Ei),this}rotateX(t){return Ei.makeRotationX(t),this.applyMatrix4(Ei),this}rotateY(t){return Ei.makeRotationY(t),this.applyMatrix4(Ei),this}rotateZ(t){return Ei.makeRotationZ(t),this.applyMatrix4(Ei),this}translate(t,e,i){return Ei.makeTranslation(t,e,i),this.applyMatrix4(Ei),this}scale(t,e,i){return Ei.makeScale(t,e,i),this.applyMatrix4(Ei),this}lookAt(t){return Ci.lookAt(t),Ci.updateMatrix(),this.applyMatrix4(Ci.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Li).negate(),this.translate(Li.x,Li.y,Li.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Ti(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ae);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new ne(-1/0,-1/0,-1/0),new ne(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Ri.setFromBufferAttribute(i),this.morphTargetsRelative?(Ii.addVectors(this.boundingBox.min,Ri.min),this.boundingBox.expandByPoint(Ii),Ii.addVectors(this.boundingBox.max,Ri.max),this.boundingBox.expandByPoint(Ii)):(this.boundingBox.expandByPoint(Ri.min),this.boundingBox.expandByPoint(Ri.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Te);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new ne,1/0);if(t){const i=this.boundingSphere.center;if(Ri.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Pi.setFromBufferAttribute(i),this.morphTargetsRelative?(Ii.addVectors(Ri.min,Pi.min),Ri.expandByPoint(Ii),Ii.addVectors(Ri.max,Pi.max),Ri.expandByPoint(Ii)):(Ri.expandByPoint(Pi.min),Ri.expandByPoint(Pi.max))}Ri.getCenter(i);let n=0;for(let e=0,r=t.count;e<r;e++)Ii.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(Ii));if(e)for(let r=0,s=e.length;r<s;r++){const s=e[r],a=this.morphTargetsRelative;for(let e=0,r=s.count;e<r;e++)Ii.fromBufferAttribute(s,e),a&&(Li.fromBufferAttribute(t,e),Ii.add(Li)),n=Math.max(n,i.distanceToSquared(Ii))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=t.array,n=e.position.array,r=e.normal.array,s=e.uv.array,a=n.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new bi(new Float32Array(4*a),4));const o=this.getAttribute("tangent").array,l=[],c=[];for(let t=0;t<a;t++)l[t]=new ne,c[t]=new ne;const h=new ne,u=new ne,d=new ne,p=new Lt,m=new Lt,f=new Lt,g=new ne,v=new ne;function x(t,e,i){h.fromArray(n,3*t),u.fromArray(n,3*e),d.fromArray(n,3*i),p.fromArray(s,2*t),m.fromArray(s,2*e),f.fromArray(s,2*i),u.sub(h),d.sub(h),m.sub(p),f.sub(p);const r=1/(m.x*f.y-f.x*m.y);isFinite(r)&&(g.copy(u).multiplyScalar(f.y).addScaledVector(d,-m.y).multiplyScalar(r),v.copy(d).multiplyScalar(m.x).addScaledVector(u,-f.x).multiplyScalar(r),l[t].add(g),l[e].add(g),l[i].add(g),c[t].add(v),c[e].add(v),c[i].add(v))}let _=this.groups;0===_.length&&(_=[{start:0,count:i.length}]);for(let t=0,e=_.length;t<e;++t){const e=_[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)x(i[t+0],i[t+1],i[t+2])}const y=new ne,M=new ne,b=new ne,S=new ne;function w(t){b.fromArray(r,3*t),S.copy(b);const e=l[t];y.copy(e),y.sub(b.multiplyScalar(b.dot(e))).normalize(),M.crossVectors(S,e);const i=M.dot(c[t])<0?-1:1;o[4*t]=y.x,o[4*t+1]=y.y,o[4*t+2]=y.z,o[4*t+3]=i}for(let t=0,e=_.length;t<e;++t){const e=_[t],n=e.start;for(let t=n,r=n+e.count;t<r;t+=3)w(i[t+0]),w(i[t+1]),w(i[t+2])}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new bi(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new ne,r=new ne,s=new ne,a=new ne,o=new ne,l=new ne,c=new ne,h=new ne;if(t)for(let u=0,d=t.count;u<d;u+=3){const d=t.getX(u+0),p=t.getX(u+1),m=t.getX(u+2);n.fromBufferAttribute(e,d),r.fromBufferAttribute(e,p),s.fromBufferAttribute(e,m),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),a.fromBufferAttribute(i,d),o.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),a.add(c),o.add(c),l.add(c),i.setXYZ(d,a.x,a.y,a.z),i.setXYZ(p,o.x,o.y,o.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let t=0,a=e.count;t<a;t+=3)n.fromBufferAttribute(e,t+0),r.fromBufferAttribute(e,t+1),s.fromBufferAttribute(e,t+2),c.subVectors(s,r),h.subVectors(n,r),c.cross(h),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)Ii.fromBufferAttribute(t,e),Ii.normalize(),t.setXYZ(e,Ii.x,Ii.y,Ii.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,r=t.normalized,s=new i.constructor(e.length*n);let a=0,o=0;for(let r=0,l=e.length;r<l;r++){a=t.isInterleavedBufferAttribute?e[r]*t.data.stride+t.offset:e[r]*n;for(let t=0;t<n;t++)s[o++]=i[a++]}return new bi(s,n,r)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new Di,i=this.index.array,n=this.attributes;for(const r in n){const s=t(n[r],i);e.setAttribute(r,s)}const r=this.morphAttributes;for(const n in r){const s=[],a=r[n];for(let e=0,n=a.length;e<n;e++){const n=t(a[e],i);s.push(n)}e.morphAttributes[n]=s}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let r=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],s=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];s.push(n.toJSON(t.data))}s.length>0&&(n[e]=s,r=!0)}r&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const a=this.boundingSphere;return null!==a&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const r=t.morphAttributes;for(const t in r){const i=[],n=r[t];for(let t=0,r=n.length;t<r;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let t=0,e=s.length;t<e;t++){const e=s[t];this.addGroup(e.start,e.count,e.materialIndex)}const a=t.boundingBox;null!==a&&(this.boundingBox=a.clone());const o=t.boundingSphere;return null!==o&&(this.boundingSphere=o.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,void 0!==t.parameters&&(this.parameters=Object.assign({},t.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Ni=new Ne,Oi=new De,zi=new Te,Ui=new ne,Bi=new ne,Fi=new ne,ki=new ne,Gi=new ne,Vi=new ne,Hi=new ne,Wi=new ne,ji=new ne,qi=new Lt,Xi=new Lt,Yi=new Lt,Zi=new ne,Ji=new ne;class Ki extends si{constructor(t=new Di,e=new _i){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}raycast(t,e){const i=this.geometry,n=this.material,r=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),zi.copy(i.boundingSphere),zi.applyMatrix4(r),!1===t.ray.intersectsSphere(zi))return;if(Ni.copy(r).invert(),Oi.copy(t.ray).applyMatrix4(Ni),null!==i.boundingBox&&!1===Oi.intersectsBox(i.boundingBox))return;let s;const a=i.index,o=i.attributes.position,l=i.morphAttributes.position,c=i.morphTargetsRelative,h=i.attributes.uv,u=i.attributes.uv2,d=i.groups,p=i.drawRange;if(null!==a)if(Array.isArray(n))for(let i=0,r=d.length;i<r;i++){const r=d[i],m=n[r.materialIndex];for(let i=Math.max(r.start,p.start),n=Math.min(a.count,Math.min(r.start+r.count,p.start+p.count));i<n;i+=3){const n=a.getX(i),d=a.getX(i+1),p=a.getX(i+2);s=$i(this,m,t,Oi,o,l,c,h,u,n,d,p),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let i=Math.max(0,p.start),r=Math.min(a.count,p.start+p.count);i<r;i+=3){const r=a.getX(i),d=a.getX(i+1),p=a.getX(i+2);s=$i(this,n,t,Oi,o,l,c,h,u,r,d,p),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}else if(void 0!==o)if(Array.isArray(n))for(let i=0,r=d.length;i<r;i++){const r=d[i],a=n[r.materialIndex];for(let i=Math.max(r.start,p.start),n=Math.min(o.count,Math.min(r.start+r.count,p.start+p.count));i<n;i+=3){s=$i(this,a,t,Oi,o,l,c,h,u,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),s.face.materialIndex=r.materialIndex,e.push(s))}}else{for(let i=Math.max(0,p.start),r=Math.min(o.count,p.start+p.count);i<r;i+=3){s=$i(this,n,t,Oi,o,l,c,h,u,i,i+1,i+2),s&&(s.faceIndex=Math.floor(i/3),e.push(s))}}}}function $i(t,e,i,n,r,s,a,o,l,c,h,u){Ui.fromBufferAttribute(r,c),Bi.fromBufferAttribute(r,h),Fi.fromBufferAttribute(r,u);const d=t.morphTargetInfluences;if(s&&d){Hi.set(0,0,0),Wi.set(0,0,0),ji.set(0,0,0);for(let t=0,e=s.length;t<e;t++){const e=d[t],i=s[t];0!==e&&(ki.fromBufferAttribute(i,c),Gi.fromBufferAttribute(i,h),Vi.fromBufferAttribute(i,u),a?(Hi.addScaledVector(ki,e),Wi.addScaledVector(Gi,e),ji.addScaledVector(Vi,e)):(Hi.addScaledVector(ki.sub(Ui),e),Wi.addScaledVector(Gi.sub(Bi),e),ji.addScaledVector(Vi.sub(Fi),e)))}Ui.add(Hi),Bi.add(Wi),Fi.add(ji)}t.isSkinnedMesh&&(t.boneTransform(c,Ui),t.boneTransform(h,Bi),t.boneTransform(u,Fi));const p=function(t,e,i,n,r,s,a,o){let l;if(l=1===e.side?n.intersectTriangle(a,s,r,!0,o):n.intersectTriangle(r,s,a,2!==e.side,o),null===l)return null;Ji.copy(o),Ji.applyMatrix4(t.matrixWorld);const c=i.ray.origin.distanceTo(Ji);return c<i.near||c>i.far?null:{distance:c,point:Ji.clone(),object:t}}(t,e,i,n,Ui,Bi,Fi,Zi);if(p){o&&(qi.fromBufferAttribute(o,c),Xi.fromBufferAttribute(o,h),Yi.fromBufferAttribute(o,u),p.uv=gi.getUV(Zi,Ui,Bi,Fi,qi,Xi,Yi,new Lt)),l&&(qi.fromBufferAttribute(l,c),Xi.fromBufferAttribute(l,h),Yi.fromBufferAttribute(l,u),p.uv2=gi.getUV(Zi,Ui,Bi,Fi,qi,Xi,Yi,new Lt));const t={a:c,b:h,c:u,normal:new ne,materialIndex:0};gi.getNormal(Ui,Bi,Fi,t.normal),p.face=t}return p}class Qi extends Di{constructor(t=1,e=1,i=1,n=1,r=1,s=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:r,depthSegments:s};const a=this;n=Math.floor(n),r=Math.floor(r),s=Math.floor(s);const o=[],l=[],c=[],h=[];let u=0,d=0;function p(t,e,i,n,r,s,p,m,f,g,v){const x=s/f,_=p/g,y=s/2,M=p/2,b=m/2,S=f+1,w=g+1;let T=0,A=0;const E=new ne;for(let s=0;s<w;s++){const a=s*_-M;for(let o=0;o<S;o++){const u=o*x-y;E[t]=u*n,E[e]=a*r,E[i]=b,l.push(E.x,E.y,E.z),E[t]=0,E[e]=0,E[i]=m>0?1:-1,c.push(E.x,E.y,E.z),h.push(o/f),h.push(1-s/g),T+=1}}for(let t=0;t<g;t++)for(let e=0;e<f;e++){const i=u+e+S*t,n=u+e+S*(t+1),r=u+(e+1)+S*(t+1),s=u+(e+1)+S*t;o.push(i,n,s),o.push(n,r,s),A+=6}a.addGroup(d,A,v),d+=A,u+=T}p("z","y","x",-1,-1,i,e,t,s,r,0),p("z","y","x",1,-1,i,e,-t,s,r,1),p("x","z","y",1,1,t,i,e,n,s,2),p("x","z","y",1,-1,t,i,-e,n,s,3),p("x","y","z",1,-1,t,e,i,n,r,4),p("x","y","z",-1,-1,t,e,-i,n,r,5),this.setIndex(o),this.setAttribute("position",new Ti(l,3)),this.setAttribute("normal",new Ti(c,3)),this.setAttribute("uv",new Ti(h,2))}static fromJSON(t){return new Qi(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function tn(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const r=t[i][n];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?e[i][n]=r.clone():Array.isArray(r)?e[i][n]=r.slice():e[i][n]=r}}return e}function en(t){const e={};for(let i=0;i<t.length;i++){const n=tn(t[i]);for(const t in n)e[t]=n[t]}return e}const nn={clone:tn,merge:en};class rn extends xi{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=tn(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class sn extends si{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ne,this.projectionMatrix=new Ne,this.projectionMatrixInverse=new Ne}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class an extends sn{constructor(t=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*xt*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*vt*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*xt*Math.atan(Math.tan(.5*vt*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(t,e,i,n,r,s){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*vt*this.fov)/this.zoom,i=2*e,n=this.aspect*i,r=-.5*n;const s=this.view;if(null!==this.view&&this.view.enabled){const t=s.fullWidth,a=s.fullHeight;r+=s.offsetX*n/t,e-=s.offsetY*i/a,n*=s.width/t,i*=s.height/a}const a=this.filmOffset;0!==a&&(r+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+n,e,e-i,t,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const on=90;class ln extends si{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i;const n=new an(on,1,t,e);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new ne(1,0,0)),this.add(n);const r=new an(on,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new ne(-1,0,0)),this.add(r);const s=new an(on,1,t,e);s.layers=this.layers,s.up.set(0,0,1),s.lookAt(new ne(0,1,0)),this.add(s);const a=new an(on,1,t,e);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new ne(0,-1,0)),this.add(a);const o=new an(on,1,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new ne(0,0,1)),this.add(o);const l=new an(on,1,t,e);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new ne(0,0,-1)),this.add(l)}update(t,e){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,r,s,a,o,l]=this.children,c=t.getRenderTarget(),h=t.toneMapping,u=t.xr.enabled;t.toneMapping=0,t.xr.enabled=!1;const d=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0),t.render(e,n),t.setRenderTarget(i,1),t.render(e,r),t.setRenderTarget(i,2),t.render(e,s),t.setRenderTarget(i,3),t.render(e,a),t.setRenderTarget(i,4),t.render(e,o),i.texture.generateMipmaps=d,t.setRenderTarget(i,5),t.render(e,l),t.setRenderTarget(c),t.toneMapping=h,t.xr.enabled=u,i.texture.needsPMREMUpdate=!0}}class cn extends Kt{constructor(t,e,i,n,s,a,o,l,c,h){super(t=void 0!==t?t:[],e=void 0!==e?e:r,i,n,s,a,o,l,c,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class hn extends Qt{constructor(t,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new cn(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:f}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.encoding=e.encoding,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new Qi(5,5,5),r=new rn({name:"CubemapFromEquirect",uniforms:tn(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});r.uniforms.tEquirect.value=e;const s=new Ki(n,r),a=e.minFilter;e.minFilter===v&&(e.minFilter=f);return new ln(1,10,this).update(t,s),e.minFilter=a,s.geometry.dispose(),s.material.dispose(),this}clear(t,e,i,n){const r=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,i,n);t.setRenderTarget(r)}}const un=new ne,dn=new ne,pn=new Rt;class mn{constructor(t=new ne(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=un.subVectors(i,e).cross(dn.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)}intersectLine(t,e){const i=t.delta(un),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const r=-(t.start.dot(this.normal)+this.constant)/n;return r<0||r>1?null:e.copy(i).multiplyScalar(r).add(t.start)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||pn.getNormalMatrix(t),n=this.coplanarPoint(un).applyMatrix4(t),r=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(r),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const fn=new Te,gn=new ne;class vn{constructor(t=new mn,e=new mn,i=new mn,n=new mn,r=new mn,s=new mn){this.planes=[t,e,i,n,r,s]}set(t,e,i,n,r,s){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(i),a[3].copy(n),a[4].copy(r),a[5].copy(s),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t){const e=this.planes,i=t.elements,n=i[0],r=i[1],s=i[2],a=i[3],o=i[4],l=i[5],c=i[6],h=i[7],u=i[8],d=i[9],p=i[10],m=i[11],f=i[12],g=i[13],v=i[14],x=i[15];return e[0].setComponents(a-n,h-o,m-u,x-f).normalize(),e[1].setComponents(a+n,h+o,m+u,x+f).normalize(),e[2].setComponents(a+r,h+l,m+d,x+g).normalize(),e[3].setComponents(a-r,h-l,m-d,x-g).normalize(),e[4].setComponents(a-s,h-c,m-p,x-v).normalize(),e[5].setComponents(a+s,h+c,m+p,x+v).normalize(),this}intersectsObject(t){const e=t.geometry;return null===e.boundingSphere&&e.computeBoundingSphere(),fn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(fn)}intersectsSprite(t){return fn.center.set(0,0,0),fn.radius=.7071067811865476,fn.applyMatrix4(t.matrixWorld),this.intersectsSphere(fn)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(gn.x=n.normal.x>0?t.max.x:t.min.x,gn.y=n.normal.y>0?t.max.y:t.min.y,gn.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(gn)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function xn(){let t=null,e=!1,i=null,n=null;function r(e,s){i(e,s),n=t.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(r),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function _n(t,e){const i=e.isWebGL2,n=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),n.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const i=n.get(e);i&&(t.deleteBuffer(i.buffer),n.delete(e))},update:function(e,r){if(e.isGLBufferAttribute){const t=n.get(e);return void((!t||t.version<e.version)&&n.set(e,{buffer:e.buffer,type:e.type,bytesPerElement:e.elementSize,version:e.version}))}e.isInterleavedBufferAttribute&&(e=e.data);const s=n.get(e);void 0===s?n.set(e,function(e,n){const r=e.array,s=e.usage,a=t.createBuffer();let o;if(t.bindBuffer(n,a),t.bufferData(n,r,s),e.onUploadCallback(),r instanceof Float32Array)o=5126;else if(r instanceof Uint16Array)if(e.isFloat16BufferAttribute){if(!i)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");o=5131}else o=5123;else if(r instanceof Int16Array)o=5122;else if(r instanceof Uint32Array)o=5125;else if(r instanceof Int32Array)o=5124;else if(r instanceof Int8Array)o=5120;else if(r instanceof Uint8Array)o=5121;else{if(!(r instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+r);o=5121}return{buffer:a,type:o,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,r)):s.version<e.version&&(!function(e,n,r){const s=n.array,a=n.updateRange;t.bindBuffer(r,e),-1===a.count?t.bufferSubData(r,0,s):(i?t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s,a.offset,a.count):t.bufferSubData(r,a.offset*s.BYTES_PER_ELEMENT,s.subarray(a.offset,a.offset+a.count)),a.count=-1)}(s.buffer,e,r),s.version=e.version)}}}class yn extends Di{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const r=t/2,s=e/2,a=Math.floor(i),o=Math.floor(n),l=a+1,c=o+1,h=t/a,u=e/o,d=[],p=[],m=[],f=[];for(let t=0;t<c;t++){const e=t*u-s;for(let i=0;i<l;i++){const n=i*h-r;p.push(n,-e,0),m.push(0,0,1),f.push(i/a),f.push(1-t/o)}}for(let t=0;t<o;t++)for(let e=0;e<a;e++){const i=e+l*t,n=e+l*(t+1),r=e+1+l*(t+1),s=e+1+l*t;d.push(i,n,s),d.push(n,r,s)}this.setIndex(d),this.setAttribute("position",new Ti(p,3)),this.setAttribute("normal",new Ti(m,3)),this.setAttribute("uv",new Ti(f,2))}static fromJSON(t){return new yn(t.width,t.height,t.widthSegments,t.heightSegments)}}const Mn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n\t\tfloat x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n\t\tfloat x2 = x * x;\n\t\tfloat x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n\t\treturn ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,\t0.0556434,\n\t\t-1.5371385,\t1.8760108, -0.2040259,\n\t\t-0.4985314,\t0.0415560,\t1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert\n#define Material_LightProbeLOD( material )\t(0)",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(\t\t0, 1,\t\t0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t\tf.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(\t1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,\t1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,\t1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},bn={common:{diffuse:{value:new jt(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Rt},uv2Transform:{value:new Rt},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Lt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new jt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new jt(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Rt}},sprite:{diffuse:{value:new jt(16777215)},opacity:{value:1},center:{value:new Lt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Rt}}},Sn={basic:{uniforms:en([bn.common,bn.specularmap,bn.envmap,bn.aomap,bn.lightmap,bn.fog]),vertexShader:Mn.meshbasic_vert,fragmentShader:Mn.meshbasic_frag},lambert:{uniforms:en([bn.common,bn.specularmap,bn.envmap,bn.aomap,bn.lightmap,bn.emissivemap,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.fog,bn.lights,{emissive:{value:new jt(0)}}]),vertexShader:Mn.meshlambert_vert,fragmentShader:Mn.meshlambert_frag},phong:{uniforms:en([bn.common,bn.specularmap,bn.envmap,bn.aomap,bn.lightmap,bn.emissivemap,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.fog,bn.lights,{emissive:{value:new jt(0)},specular:{value:new jt(1118481)},shininess:{value:30}}]),vertexShader:Mn.meshphong_vert,fragmentShader:Mn.meshphong_frag},standard:{uniforms:en([bn.common,bn.envmap,bn.aomap,bn.lightmap,bn.emissivemap,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.roughnessmap,bn.metalnessmap,bn.fog,bn.lights,{emissive:{value:new jt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Mn.meshphysical_vert,fragmentShader:Mn.meshphysical_frag},toon:{uniforms:en([bn.common,bn.aomap,bn.lightmap,bn.emissivemap,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.gradientmap,bn.fog,bn.lights,{emissive:{value:new jt(0)}}]),vertexShader:Mn.meshtoon_vert,fragmentShader:Mn.meshtoon_frag},matcap:{uniforms:en([bn.common,bn.bumpmap,bn.normalmap,bn.displacementmap,bn.fog,{matcap:{value:null}}]),vertexShader:Mn.meshmatcap_vert,fragmentShader:Mn.meshmatcap_frag},points:{uniforms:en([bn.points,bn.fog]),vertexShader:Mn.points_vert,fragmentShader:Mn.points_frag},dashed:{uniforms:en([bn.common,bn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Mn.linedashed_vert,fragmentShader:Mn.linedashed_frag},depth:{uniforms:en([bn.common,bn.displacementmap]),vertexShader:Mn.depth_vert,fragmentShader:Mn.depth_frag},normal:{uniforms:en([bn.common,bn.bumpmap,bn.normalmap,bn.displacementmap,{opacity:{value:1}}]),vertexShader:Mn.meshnormal_vert,fragmentShader:Mn.meshnormal_frag},sprite:{uniforms:en([bn.sprite,bn.fog]),vertexShader:Mn.sprite_vert,fragmentShader:Mn.sprite_frag},background:{uniforms:{uvTransform:{value:new Rt},t2D:{value:null}},vertexShader:Mn.background_vert,fragmentShader:Mn.background_frag},cube:{uniforms:en([bn.envmap,{opacity:{value:1}}]),vertexShader:Mn.cube_vert,fragmentShader:Mn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Mn.equirect_vert,fragmentShader:Mn.equirect_frag},distanceRGBA:{uniforms:en([bn.common,bn.displacementmap,{referencePosition:{value:new ne},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Mn.distanceRGBA_vert,fragmentShader:Mn.distanceRGBA_frag},shadow:{uniforms:en([bn.lights,bn.fog,{color:{value:new jt(0)},opacity:{value:1}}]),vertexShader:Mn.shadow_vert,fragmentShader:Mn.shadow_frag}};function wn(t,e,i,n,r,s){const a=new jt(0);let o,c,h=!0===r?0:1,u=null,d=0,p=null;function m(t,e){i.buffers.color.setClear(t.r,t.g,t.b,e,s)}return{getClearColor:function(){return a},setClearColor:function(t,e=1){a.set(t),h=e,m(a,h)},getClearAlpha:function(){return h},setClearAlpha:function(t){h=t,m(a,h)},render:function(i,r){let s=!1,f=!0===r.isScene?r.background:null;f&&f.isTexture&&(f=e.get(f));const g=t.xr,v=g.getSession&&g.getSession();v&&"additive"===v.environmentBlendMode&&(f=null),null===f?m(a,h):f&&f.isColor&&(m(f,1),s=!0),(t.autoClear||s)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),f&&(f.isCubeTexture||f.mapping===l)?(void 0===c&&(c=new Ki(new Qi(1,1,1),new rn({name:"BackgroundCubeMaterial",uniforms:tn(Sn.cube.uniforms),vertexShader:Sn.cube.vertexShader,fragmentShader:Sn.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(c)),c.material.uniforms.envMap.value=f,c.material.uniforms.flipEnvMap.value=f.isCubeTexture&&!1===f.isRenderTargetTexture?-1:1,u===f&&d===f.version&&p===t.toneMapping||(c.material.needsUpdate=!0,u=f,d=f.version,p=t.toneMapping),c.layers.enableAll(),i.unshift(c,c.geometry,c.material,0,0,null)):f&&f.isTexture&&(void 0===o&&(o=new Ki(new yn(2,2),new rn({name:"BackgroundMaterial",uniforms:tn(Sn.background.uniforms),vertexShader:Sn.background.vertexShader,fragmentShader:Sn.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=f,!0===f.matrixAutoUpdate&&f.updateMatrix(),o.material.uniforms.uvTransform.value.copy(f.matrix),u===f&&d===f.version&&p===t.toneMapping||(o.material.needsUpdate=!0,u=f,d=f.version,p=t.toneMapping),o.layers.enableAll(),i.unshift(o,o.geometry,o.material,0,0,null))}}}function Tn(t,e,i,n){const r=t.getParameter(34921),s=n.isWebGL2?null:e.get("OES_vertex_array_object"),a=n.isWebGL2||null!==s,o={},l=p(null);let c=l,h=!1;function u(e){return n.isWebGL2?t.bindVertexArray(e):s.bindVertexArrayOES(e)}function d(e){return n.isWebGL2?t.deleteVertexArray(e):s.deleteVertexArrayOES(e)}function p(t){const e=[],i=[],n=[];for(let t=0;t<r;t++)e[t]=0,i[t]=0,n[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:i,attributeDivisors:n,object:t,attributes:{},index:null}}function m(){const t=c.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function f(t){g(t,0)}function g(i,r){const s=c.newAttributes,a=c.enabledAttributes,o=c.attributeDivisors;if(s[i]=1,0===a[i]&&(t.enableVertexAttribArray(i),a[i]=1),o[i]!==r){(n.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,r),o[i]=r}}function v(){const e=c.newAttributes,i=c.enabledAttributes;for(let n=0,r=i.length;n<r;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function x(e,i,r,s,a,o){!0!==n.isWebGL2||5124!==r&&5125!==r?t.vertexAttribPointer(e,i,r,s,a,o):t.vertexAttribIPointer(e,i,r,a,o)}function _(){y(),h=!0,c!==l&&(c=l,u(c.object))}function y(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(r,l,d,_,y){let M=!1;if(a){const e=function(e,i,r){const a=!0===r.wireframe;let l=o[e.id];void 0===l&&(l={},o[e.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let h=c[a];void 0===h&&(h=p(n.isWebGL2?t.createVertexArray():s.createVertexArrayOES()),c[a]=h);return h}(_,d,l);c!==e&&(c=e,u(c.object)),M=function(t,e,i,n){const r=c.attributes,s=e.attributes;let a=0;const o=i.getAttributes();for(const e in o){if(o[e].location>=0){const i=r[e];let n=s[e];if(void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor)),void 0===i)return!0;if(i.attribute!==n)return!0;if(n&&i.data!==n.data)return!0;a++}}return c.attributesNum!==a||c.index!==n}(r,_,d,y),M&&function(t,e,i,n){const r={},s=e.attributes;let a=0;const o=i.getAttributes();for(const e in o){if(o[e].location>=0){let i=s[e];void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor));const n={};n.attribute=i,i&&i.data&&(n.data=i.data),r[e]=n,a++}}c.attributes=r,c.attributesNum=a,c.index=n}(r,_,d,y)}else{const t=!0===l.wireframe;c.geometry===_.id&&c.program===d.id&&c.wireframe===t||(c.geometry=_.id,c.program=d.id,c.wireframe=t,M=!0)}null!==y&&i.update(y,34963),(M||h)&&(h=!1,function(r,s,a,o){if(!1===n.isWebGL2&&(r.isInstancedMesh||o.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;m();const l=o.attributes,c=a.getAttributes(),h=s.defaultAttributeValues;for(const e in c){const n=c[e];if(n.location>=0){let s=l[e];if(void 0===s&&("instanceMatrix"===e&&r.instanceMatrix&&(s=r.instanceMatrix),"instanceColor"===e&&r.instanceColor&&(s=r.instanceColor)),void 0!==s){const e=s.normalized,a=s.itemSize,l=i.get(s);if(void 0===l)continue;const c=l.buffer,h=l.type,u=l.bytesPerElement;if(s.isInterleavedBufferAttribute){const i=s.data,l=i.stride,d=s.offset;if(i.isInstancedInterleavedBuffer){for(let t=0;t<n.locationSize;t++)g(n.location+t,i.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let t=0;t<n.locationSize;t++)f(n.location+t);t.bindBuffer(34962,c);for(let t=0;t<n.locationSize;t++)x(n.location+t,a/n.locationSize,h,e,l*u,(d+a/n.locationSize*t)*u)}else{if(s.isInstancedBufferAttribute){for(let t=0;t<n.locationSize;t++)g(n.location+t,s.meshPerAttribute);!0!==r.isInstancedMesh&&void 0===o._maxInstanceCount&&(o._maxInstanceCount=s.meshPerAttribute*s.count)}else for(let t=0;t<n.locationSize;t++)f(n.location+t);t.bindBuffer(34962,c);for(let t=0;t<n.locationSize;t++)x(n.location+t,a/n.locationSize,h,e,a*u,a/n.locationSize*t*u)}}else if(void 0!==h){const i=h[e];if(void 0!==i)switch(i.length){case 2:t.vertexAttrib2fv(n.location,i);break;case 3:t.vertexAttrib3fv(n.location,i);break;case 4:t.vertexAttrib4fv(n.location,i);break;default:t.vertexAttrib1fv(n.location,i)}}}}v()}(r,l,d,_),null!==y&&t.bindBuffer(34963,i.get(y).buffer))},reset:_,resetDefaultState:y,dispose:function(){_();for(const t in o){const e=o[t];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t]}},releaseStatesOfGeometry:function(t){if(void 0===o[t.id])return;const e=o[t.id];for(const t in e){const i=e[t];for(const t in i)d(i[t].object),delete i[t];delete e[t]}delete o[t.id]},releaseStatesOfProgram:function(t){for(const e in o){const i=o[e];if(void 0===i[t.id])continue;const n=i[t.id];for(const t in n)d(n[t].object),delete n[t];delete i[t.id]}},initAttributes:m,enableAttribute:f,disableUnusedAttributes:v}}function An(t,e,i,n){const r=n.isWebGL2;let s;this.setMode=function(t){s=t},this.render=function(e,n){t.drawArrays(s,e,n),i.update(n,s,1)},this.renderInstances=function(n,a,o){if(0===o)return;let l,c;if(r)l=t,c="drawArraysInstanced";else if(l=e.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](s,n,a,o),i.update(a,s,o)}}function En(t,e,i){let n;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const s="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let a=void 0!==i.precision?i.precision:"highp";const o=r(a);o!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",o,"instead."),a=o);const l=s||e.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,h=t.getParameter(34930),u=t.getParameter(35660),d=t.getParameter(3379),p=t.getParameter(34076),m=t.getParameter(34921),f=t.getParameter(36347),g=t.getParameter(36348),v=t.getParameter(36349),x=u>0,_=s||e.has("OES_texture_float");return{isWebGL2:s,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");n=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:r,precision:a,logarithmicDepthBuffer:c,maxTextures:h,maxVertexTextures:u,maxTextureSize:d,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:x,floatFragmentTextures:_,floatVertexTextures:x&&_,maxSamples:s?t.getParameter(36183):0}}function Cn(t){const e=this;let i=null,n=0,r=!1,s=!1;const a=new mn,o=new Rt,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(t,i,n,r){const s=null!==t?t.length:0;let c=null;if(0!==s){if(c=l.value,!0!==r||null===c){const e=n+4*s,r=i.matrixWorldInverse;o.getNormalMatrix(r),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,i=n;e!==s;++e,i+=4)a.copy(t[e]).applyMatrix4(r,o),a.normal.toArray(c,i),c[i+3]=a.constant}l.value=c,l.needsUpdate=!0}return e.numPlanes=s,e.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e,s){const a=0!==t.length||e||0!==n||r;return r=e,i=h(t,s,0),n=t.length,a},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1,c()},this.setState=function(e,a,o){const u=e.clippingPlanes,d=e.clipIntersection,p=e.clipShadows,m=t.get(e);if(!r||null===u||0===u.length||s&&!p)s?h(null):c();else{const t=s?0:n,e=4*t;let r=m.clippingState||null;l.value=r,r=h(u,a,e,o);for(let t=0;t!==e;++t)r[t]=i[t];m.clippingState=r,this.numIntersection=d?this.numPlanes:0,this.numPlanes+=t}}}function Ln(t){let e=new WeakMap;function i(t,e){return e===a?t.mapping=r:e===o&&(t.mapping=s),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(r){if(r&&r.isTexture&&!1===r.isRenderTargetTexture){const s=r.mapping;if(s===a||s===o){if(e.has(r)){return i(e.get(r).texture,r.mapping)}{const s=r.image;if(s&&s.height>0){const a=new hn(s.height/2);return a.fromEquirectangularTexture(t,r),e.set(r,a),r.addEventListener("dispose",n),i(a.texture,r.mapping)}return null}}}return r},dispose:function(){e=new WeakMap}}}Sn.physical={uniforms:en([Sn.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Lt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new jt(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Lt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new jt(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new jt(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Mn.meshphysical_vert,fragmentShader:Mn.meshphysical_frag};class Rn extends sn{constructor(t=-1,e=1,i=1,n=-1,r=.1,s=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=r,this.far=s,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,r,s){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=r,this.view.height=s,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let r=i-t,s=i+t,a=n+e,o=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;r+=t*this.view.offsetX,s=r+t*this.view.width,a-=e*this.view.offsetY,o=a-e*this.view.height}this.projectionMatrix.makeOrthographic(r,s,a,o,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const Pn=[.125,.215,.35,.446,.526,.582],In=20,Dn=new Rn,Nn=new jt;let On=null;const zn=(1+Math.sqrt(5))/2,Un=1/zn,Bn=[new ne(1,1,1),new ne(-1,1,1),new ne(1,1,-1),new ne(-1,1,-1),new ne(0,zn,Un),new ne(0,zn,-Un),new ne(Un,0,zn),new ne(-Un,0,zn),new ne(zn,Un,0),new ne(-zn,Un,0)];class Fn{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){On=this._renderer.getRenderTarget(),this._setSize(256);const r=this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,i,n,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Hn(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Vn(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(On),t.scissorTest=!1,Gn(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===r||t.mapping===s?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),On=this._renderer.getRenderTarget();const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:f,minFilter:f,generateMipmaps:!1,type:b,format:w,encoding:at,depthBuffer:!1},n=kn(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=kn(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let r=t;const s=t-4+1+Pn.length;for(let a=0;a<s;a++){const s=Math.pow(2,r);i.push(s);let o=1/s;a>t-4?o=Pn[a-t+4-1]:0===a&&(o=0),n.push(o);const l=1/(s-2),c=-l,h=1+l,u=[c,c,h,c,h,h,c,c,h,h,c,h],d=6,p=6,m=3,f=2,g=1,v=new Float32Array(m*p*d),x=new Float32Array(f*p*d),_=new Float32Array(g*p*d);for(let t=0;t<d;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];v.set(n,m*p*t),x.set(u,f*p*t);const r=[t,t,t,t,t,t];_.set(r,g*p*t)}const y=new Di;y.setAttribute("position",new bi(v,m)),y.setAttribute("uv",new bi(x,f)),y.setAttribute("faceIndex",new bi(_,g)),e.push(y),r>4&&r--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(In),r=new ne(0,1,0);return new rn({name:"SphericalGaussianBlur",defines:{n:In,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:Wn(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(n,t,e)}return n}_compileMaterial(t){const e=new Ki(this._lodPlanes[0],t);this._renderer.compile(e,Dn)}_sceneToCubeUV(t,e,i,n){const r=new an(90,1,e,i),s=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],o=this._renderer,l=o.autoClear,c=o.toneMapping;o.getClearColor(Nn),o.toneMapping=0,o.autoClear=!1;const h=new _i({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),u=new Ki(new Qi,h);let d=!1;const p=t.background;p?p.isColor&&(h.color.copy(p),t.background=null,d=!0):(h.color.copy(Nn),d=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(r.up.set(0,s[e],0),r.lookAt(a[e],0,0)):1===i?(r.up.set(0,0,s[e]),r.lookAt(0,a[e],0)):(r.up.set(0,s[e],0),r.lookAt(0,0,a[e]));const l=this._cubeSize;Gn(n,i*l,e>2?l:0,l,l),o.setRenderTarget(n),d&&o.render(u,r),o.render(t,r)}u.geometry.dispose(),u.material.dispose(),o.toneMapping=c,o.autoClear=l,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===r||t.mapping===s;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=Hn()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Vn());const a=n?this._cubemapMaterial:this._equirectMaterial,o=new Ki(this._lodPlanes[0],a);a.uniforms.envMap.value=t;const l=this._cubeSize;Gn(e,0,0,3*l,2*l),i.setRenderTarget(e),i.render(o,Dn)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;for(let e=1;e<this._lodPlanes.length;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),n=Bn[(e-1)%Bn.length];this._blur(t,e-1,e,i,n)}e.autoClear=i}_blur(t,e,i,n,r){const s=this._pingPongRenderTarget;this._halfBlur(t,s,e,i,n,"latitudinal",r),this._halfBlur(s,t,i,i,n,"longitudinal",r)}_halfBlur(t,e,i,n,r,s,a){const o=this._renderer,l=this._blurMaterial;"latitudinal"!==s&&"longitudinal"!==s&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Ki(this._lodPlanes[n],l),h=l.uniforms,u=this._sizeLods[i]-1,d=isFinite(r)?Math.PI/(2*u):2*Math.PI/39,p=r/d,m=isFinite(r)?1+Math.floor(3*p):In;m>In&&console.warn(`sigmaRadians, ${r}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const f=[];let g=0;for(let t=0;t<In;++t){const e=t/p,i=Math.exp(-e*e/2);f.push(i),0===t?g+=i:t<m&&(g+=2*i)}for(let t=0;t<f.length;t++)f[t]=f[t]/g;h.envMap.value=t.texture,h.samples.value=m,h.weights.value=f,h.latitudinal.value="latitudinal"===s,a&&(h.poleAxis.value=a);const{_lodMax:v}=this;h.dTheta.value=d,h.mipInt.value=v-i;const x=this._sizeLods[n];Gn(e,3*x*(n>v-4?n-v+4:0),4*(this._cubeSize-x),3*x,2*x),o.setRenderTarget(e),o.render(c,Dn)}}function kn(t,e,i){const n=new Qt(t,e,i);return n.texture.mapping=l,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Gn(t,e,i,n,r){t.viewport.set(e,i,n,r),t.scissor.set(e,i,n,r)}function Vn(){return new rn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Wn(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Hn(){return new rn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Wn(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Wn(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function jn(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const r=e.get(i);void 0!==r&&(e.delete(i),r.dispose())}return{get:function(l){if(l&&l.isTexture){const c=l.mapping,h=c===a||c===o,u=c===r||c===s;if(h||u){if(l.isRenderTargetTexture&&!0===l.needsPMREMUpdate){l.needsPMREMUpdate=!1;let n=e.get(l);return null===i&&(i=new Fn(t)),n=h?i.fromEquirectangular(l,n):i.fromCubemap(l,n),e.set(l,n),n.texture}if(e.has(l))return e.get(l).texture;{const r=l.image;if(h&&r&&r.height>0||u&&r&&function(t){let e=0;const i=6;for(let n=0;n<i;n++)void 0!==t[n]&&e++;return e===i}(r)){null===i&&(i=new Fn(t));const r=h?i.fromEquirectangular(l):i.fromCubemap(l);return e.set(l,r),l.addEventListener("dispose",n),r.texture}return null}}}return l},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function qn(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(t){t.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function Xn(t,e,i,n){const r={},s=new WeakMap;function a(t){const o=t.target;null!==o.index&&e.remove(o.index);for(const t in o.attributes)e.remove(o.attributes[t]);o.removeEventListener("dispose",a),delete r[o.id];const l=s.get(o);l&&(e.remove(l),s.delete(o)),n.releaseStatesOfGeometry(o),!0===o.isInstancedBufferGeometry&&delete o._maxInstanceCount,i.memory.geometries--}function o(t){const i=[],n=t.index,r=t.attributes.position;let a=0;if(null!==n){const t=n.array;a=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],r=t[e+1],s=t[e+2];i.push(n,r,r,s,s,n)}}else{const t=r.array;a=r.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,r=e+2;i.push(t,n,n,r,r,t)}}const o=new(Pt(i)?wi:Si)(i,1);o.version=a;const l=s.get(t);l&&e.remove(l),s.set(t,o)}return{get:function(t,e){return!0===r[e.id]||(e.addEventListener("dispose",a),r[e.id]=!0,i.memory.geometries++),e},update:function(t){const i=t.attributes;for(const t in i)e.update(i[t],34962);const n=t.morphAttributes;for(const t in n){const i=n[t];for(let t=0,n=i.length;t<n;t++)e.update(i[t],34962)}},getWireframeAttribute:function(t){const e=s.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&o(t)}else o(t);return s.get(t)}}}function Yn(t,e,i,n){const r=n.isWebGL2;let s,a,o;this.setMode=function(t){s=t},this.setIndex=function(t){a=t.type,o=t.bytesPerElement},this.render=function(e,n){t.drawElements(s,n,a,e*o),i.update(n,s,1)},this.renderInstances=function(n,l,c){if(0===c)return;let h,u;if(r)h=t,u="drawElementsInstanced";else if(h=e.get("ANGLE_instanced_arrays"),u="drawElementsInstancedANGLE",null===h)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[u](s,l,a,n*o,c),i.update(l,s,c)}}function Zn(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,i,n){switch(e.calls++,i){case 4:e.triangles+=n*(t/3);break;case 1:e.lines+=n*(t/2);break;case 3:e.lines+=n*(t-1);break;case 2:e.lines+=n*t;break;case 0:e.points+=n*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}function Jn(t,e){return t[0]-e[0]}function Kn(t,e){return Math.abs(e[1])-Math.abs(t[1])}function $n(t,e,i){const n={},r=new Float32Array(8),s=new WeakMap,a=new $t,o=[];for(let t=0;t<8;t++)o[t]=[t,0];return{update:function(l,c,h,u){const d=l.morphTargetInfluences;if(!0===e.isWebGL2){const p=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,m=void 0!==p?p.length:0;let f=s.get(c);if(void 0===f||f.count!==m){void 0!==f&&f.texture.dispose();const x=void 0!==c.morphAttributes.position,_=void 0!==c.morphAttributes.normal,y=void 0!==c.morphAttributes.color,b=c.morphAttributes.position||[],S=c.morphAttributes.normal||[],w=c.morphAttributes.color||[];let T=0;!0===x&&(T=1),!0===_&&(T=2),!0===y&&(T=3);let A=c.attributes.position.count*T,E=1;A>e.maxTextureSize&&(E=Math.ceil(A/e.maxTextureSize),A=e.maxTextureSize);const C=new Float32Array(A*E*4*m),L=new te(C,A,E,m);L.type=M,L.needsUpdate=!0;const R=4*T;for(let I=0;I<m;I++){const D=b[I],N=S[I],O=w[I],z=A*E*4*I;for(let U=0;U<D.count;U++){const B=U*R;!0===x&&(a.fromBufferAttribute(D,U),C[z+B+0]=a.x,C[z+B+1]=a.y,C[z+B+2]=a.z,C[z+B+3]=0),!0===_&&(a.fromBufferAttribute(N,U),C[z+B+4]=a.x,C[z+B+5]=a.y,C[z+B+6]=a.z,C[z+B+7]=0),!0===y&&(a.fromBufferAttribute(O,U),C[z+B+8]=a.x,C[z+B+9]=a.y,C[z+B+10]=a.z,C[z+B+11]=4===O.itemSize?a.w:1)}}function P(){L.dispose(),s.delete(c),c.removeEventListener("dispose",P)}f={count:m,texture:L,size:new Lt(A,E)},s.set(c,f),c.addEventListener("dispose",P)}let g=0;for(let F=0;F<d.length;F++)g+=d[F];const v=c.morphTargetsRelative?1:1-g;u.getUniforms().setValue(t,"morphTargetBaseInfluence",v),u.getUniforms().setValue(t,"morphTargetInfluences",d),u.getUniforms().setValue(t,"morphTargetsTexture",f.texture,i),u.getUniforms().setValue(t,"morphTargetsTextureSize",f.size)}else{const k=void 0===d?0:d.length;let G=n[c.id];if(void 0===G||G.length!==k){G=[];for(let q=0;q<k;q++)G[q]=[q,0];n[c.id]=G}for(let X=0;X<k;X++){const Y=G[X];Y[0]=X,Y[1]=d[X]}G.sort(Kn);for(let Z=0;Z<8;Z++)Z<k&&G[Z][1]?(o[Z][0]=G[Z][0],o[Z][1]=G[Z][1]):(o[Z][0]=Number.MAX_SAFE_INTEGER,o[Z][1]=0);o.sort(Jn);const V=c.morphAttributes.position,H=c.morphAttributes.normal;let W=0;for(let J=0;J<8;J++){const K=o[J],$=K[0],Q=K[1];$!==Number.MAX_SAFE_INTEGER&&Q?(V&&c.getAttribute("morphTarget"+J)!==V[$]&&c.setAttribute("morphTarget"+J,V[$]),H&&c.getAttribute("morphNormal"+J)!==H[$]&&c.setAttribute("morphNormal"+J,H[$]),r[J]=Q,W+=Q):(V&&!0===c.hasAttribute("morphTarget"+J)&&c.deleteAttribute("morphTarget"+J),H&&!0===c.hasAttribute("morphNormal"+J)&&c.deleteAttribute("morphNormal"+J),r[J]=0)}const j=c.morphTargetsRelative?1:1-W;u.getUniforms().setValue(t,"morphTargetBaseInfluence",j),u.getUniforms().setValue(t,"morphTargetInfluences",r)}}}}function Qn(t,e,i,n){let r=new WeakMap;function s(t){const e=t.target;e.removeEventListener("dispose",s),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(t){const a=n.render.frame,o=t.geometry,l=e.get(t,o);return r.get(l)!==a&&(e.update(l),r.set(l,a)),t.isInstancedMesh&&(!1===t.hasEventListener("dispose",s)&&t.addEventListener("dispose",s),i.update(t.instanceMatrix,34962),null!==t.instanceColor&&i.update(t.instanceColor,34962)),l},dispose:function(){r=new WeakMap}}}const tr=new Kt,er=new te,ir=new ee,nr=new cn,rr=[],sr=[],ar=new Float32Array(16),or=new Float32Array(9),lr=new Float32Array(4);function cr(t,e,i){const n=t[0];if(n<=0||n>0)return t;const r=e*i;let s=rr[r];if(void 0===s&&(s=new Float32Array(r),rr[r]=s),0!==e){n.toArray(s,0);for(let n=1,r=0;n!==e;++n)r+=i,t[n].toArray(s,r)}return s}function hr(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function ur(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function dr(t,e){let i=sr[e];void 0===i&&(i=new Int32Array(e),sr[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function pr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function mr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(hr(i,e))return;t.uniform2fv(this.addr,e),ur(i,e)}}function fr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(hr(i,e))return;t.uniform3fv(this.addr,e),ur(i,e)}}function gr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(hr(i,e))return;t.uniform4fv(this.addr,e),ur(i,e)}}function vr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(hr(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),ur(i,e)}else{if(hr(i,n))return;lr.set(n),t.uniformMatrix2fv(this.addr,!1,lr),ur(i,n)}}function xr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(hr(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),ur(i,e)}else{if(hr(i,n))return;or.set(n),t.uniformMatrix3fv(this.addr,!1,or),ur(i,n)}}function _r(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(hr(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),ur(i,e)}else{if(hr(i,n))return;ar.set(n),t.uniformMatrix4fv(this.addr,!1,ar),ur(i,n)}}function yr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Mr(t,e){const i=this.cache;hr(i,e)||(t.uniform2iv(this.addr,e),ur(i,e))}function br(t,e){const i=this.cache;hr(i,e)||(t.uniform3iv(this.addr,e),ur(i,e))}function Sr(t,e){const i=this.cache;hr(i,e)||(t.uniform4iv(this.addr,e),ur(i,e))}function wr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Tr(t,e){const i=this.cache;hr(i,e)||(t.uniform2uiv(this.addr,e),ur(i,e))}function Ar(t,e){const i=this.cache;hr(i,e)||(t.uniform3uiv(this.addr,e),ur(i,e))}function Er(t,e){const i=this.cache;hr(i,e)||(t.uniform4uiv(this.addr,e),ur(i,e))}function Cr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2D(e||tr,r)}function Lr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture3D(e||ir,r)}function Rr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTextureCube(e||nr,r)}function Pr(t,e,i){const n=this.cache,r=i.allocateTextureUnit();n[0]!==r&&(t.uniform1i(this.addr,r),n[0]=r),i.setTexture2DArray(e||er,r)}function Ir(t,e){t.uniform1fv(this.addr,e)}function Dr(t,e){const i=cr(e,this.size,2);t.uniform2fv(this.addr,i)}function Nr(t,e){const i=cr(e,this.size,3);t.uniform3fv(this.addr,i)}function Or(t,e){const i=cr(e,this.size,4);t.uniform4fv(this.addr,i)}function zr(t,e){const i=cr(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Ur(t,e){const i=cr(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function Br(t,e){const i=cr(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Fr(t,e){t.uniform1iv(this.addr,e)}function kr(t,e){t.uniform2iv(this.addr,e)}function Gr(t,e){t.uniform3iv(this.addr,e)}function Vr(t,e){t.uniform4iv(this.addr,e)}function Hr(t,e){t.uniform1uiv(this.addr,e)}function Wr(t,e){t.uniform2uiv(this.addr,e)}function jr(t,e){t.uniform3uiv(this.addr,e)}function qr(t,e){t.uniform4uiv(this.addr,e)}function Xr(t,e,i){const n=e.length,r=dr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2D(e[t]||tr,r[t])}function Yr(t,e,i){const n=e.length,r=dr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture3D(e[t]||ir,r[t])}function Zr(t,e,i){const n=e.length,r=dr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTextureCube(e[t]||nr,r[t])}function Jr(t,e,i){const n=e.length,r=dr(i,n);t.uniform1iv(this.addr,r);for(let t=0;t!==n;++t)i.setTexture2DArray(e[t]||er,r[t])}class Kr{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.setValue=function(t){switch(t){case 5126:return pr;case 35664:return mr;case 35665:return fr;case 35666:return gr;case 35674:return vr;case 35675:return xr;case 35676:return _r;case 5124:case 35670:return yr;case 35667:case 35671:return Mr;case 35668:case 35672:return br;case 35669:case 35673:return Sr;case 5125:return wr;case 36294:return Tr;case 36295:return Ar;case 36296:return Er;case 35678:case 36198:case 36298:case 36306:case 35682:return Cr;case 35679:case 36299:case 36307:return Lr;case 35680:case 36300:case 36308:case 36293:return Rr;case 36289:case 36303:case 36311:case 36292:return Pr}}(e.type)}}class $r{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Ir;case 35664:return Dr;case 35665:return Nr;case 35666:return Or;case 35674:return zr;case 35675:return Ur;case 35676:return Br;case 5124:case 35670:return Fr;case 35667:case 35671:return kr;case 35668:case 35672:return Gr;case 35669:case 35673:return Vr;case 5125:return Hr;case 36294:return Wr;case 36295:return jr;case 36296:return qr;case 35678:case 36198:case 36298:case 36306:case 35682:return Xr;case 35679:case 36299:case 36307:return Yr;case 35680:case 36300:case 36308:case 36293:return Zr;case 36289:case 36303:case 36311:case 36292:return Jr}}(e.type)}}class Qr{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const n=this.seq;for(let r=0,s=n.length;r!==s;++r){const s=n[r];s.setValue(t,e[s.id],i)}}}const ts=/(\w+)(\])?(\[|\.)?/g;function es(t,e){t.seq.push(e),t.map[e.id]=e}function is(t,e,i){const n=t.name,r=n.length;for(ts.lastIndex=0;;){const s=ts.exec(n),a=ts.lastIndex;let o=s[1];const l="]"===s[2],c=s[3];if(l&&(o|=0),void 0===c||"["===c&&a+2===r){es(i,void 0===c?new Kr(o,t,e):new $r(o,t,e));break}{let t=i.map[o];void 0===t&&(t=new Qr(o),es(i,t)),i=t}}}class ns{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,35718);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);is(i,t.getUniformLocation(e,i.name),this)}}setValue(t,e,i,n){const r=this.map[e];void 0!==r&&r.setValue(t,i,n)}setOptional(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)}static upload(t,e,i,n){for(let r=0,s=e.length;r!==s;++r){const s=e[r],a=i[s.id];!1!==a.needsUpdate&&s.setValue(t,a.value,n)}}static seqWithValue(t,e){const i=[];for(let n=0,r=t.length;n!==r;++n){const r=t[n];r.id in e&&i.push(r)}return i}}function rs(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}let ss=0;function as(t,e,i){const n=t.getShaderParameter(e,35713),r=t.getShaderInfoLog(e).trim();if(n&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const n=parseInt(s[1]);return i.toUpperCase()+"\n\n"+r+"\n\n"+function(t,e){const i=t.split("\n"),n=[],r=Math.max(e-6,0),s=Math.min(e+6,i.length);for(let t=r;t<s;t++){const r=t+1;n.push(`${r===e?">":" "} ${r}: ${i[t]}`)}return n.join("\n")}(t.getShaderSource(e),n)}return r}function os(t,e){const i=function(t){switch(t){case at:return["Linear","( value )"];case ot:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function ls(t,e){let i;switch(e){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="OptimizedCineon";break;case 4:i="ACESFilmic";break;case 5:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function cs(t){return""!==t}function hs(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function us(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ds=/^[ \t]*#include +<([\w\d./]+)>/gm;function ps(t){return t.replace(ds,ms)}function ms(t,e){const i=Mn[e];if(void 0===i)throw new Error("Can not resolve #include <"+e+">");return ps(i)}const fs=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function gs(t){return t.replace(fs,vs)}function vs(t,e,i,n){let r="";for(let t=parseInt(e);t<parseInt(i);t++)r+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return r}function xs(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function _s(t,e,i,n){const a=t.getContext(),o=i.defines;let c=i.vertexShader,h=i.fragmentShader;const u=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(i),d=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case r:case s:e="ENVMAP_TYPE_CUBE";break;case l:e="ENVMAP_TYPE_CUBE_UV"}return e}(i),p=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===s&&(e="ENVMAP_MODE_REFRACTION");return e}(i),m=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(i),f=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(i),g=i.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUVHeight||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap||t.transmission)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(cs).join("\n")}(i),v=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(o),x=a.createProgram();let _,y,M=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(_=[v].filter(cs).join("\n"),_.length>0&&(_+="\n"),y=[g,v].filter(cs).join("\n"),y.length>0&&(y+="\n")):(_=[xs(i),"#define SHADER_NAME "+i.shaderName,v,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+p:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphColors&&i.isWebGL2?"#define USE_MORPHCOLORS":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+i.morphTextureStride:"",i.morphTargetsCount>0&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(cs).join("\n"),y=[g,xs(i),"#define SHADER_NAME "+i.shaderName,v,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.envMap?"#define "+p:"",i.envMap?"#define "+m:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.iridescence?"#define USE_IRIDESCENCE":"",i.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",i.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+u:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==i.toneMapping?"#define TONE_MAPPING":"",0!==i.toneMapping?Mn.tonemapping_pars_fragment:"",0!==i.toneMapping?ls("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.opaque?"#define OPAQUE":"",Mn.encodings_pars_fragment,os("linearToOutputTexel",i.outputEncoding),i.useDepthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter(cs).join("\n")),c=ps(c),c=hs(c,i),c=us(c,i),h=ps(h),h=hs(h,i),h=us(h,i),c=gs(c),h=gs(h),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(M="#version 300 es\n",_=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+_,y=["#define varying in",i.glslVersion===dt?"":"layout(location = 0) out highp vec4 pc_fragColor;",i.glslVersion===dt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const b=M+y+h,S=rs(a,35633,M+_+c),w=rs(a,35632,b);if(a.attachShader(x,S),a.attachShader(x,w),void 0!==i.index0AttributeName?a.bindAttribLocation(x,0,i.index0AttributeName):!0===i.morphTargets&&a.bindAttribLocation(x,0,"position"),a.linkProgram(x),t.debug.checkShaderErrors){const t=a.getProgramInfoLog(x).trim(),e=a.getShaderInfoLog(S).trim(),i=a.getShaderInfoLog(w).trim();let n=!0,r=!0;if(!1===a.getProgramParameter(x,35714)){n=!1;const e=as(a,S,"vertex"),i=as(a,w,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(x,35715)+"\n\nProgram Info Log: "+t+"\n"+e+"\n"+i)}else""!==t?console.warn("THREE.WebGLProgram: Program Info Log:",t):""!==e&&""!==i||(r=!1);r&&(this.diagnostics={runnable:n,programLog:t,vertexShader:{log:e,prefix:_},fragmentShader:{log:i,prefix:y}})}let T,A;return a.deleteShader(S),a.deleteShader(w),this.getUniforms=function(){return void 0===T&&(T=new ns(a,x)),T},this.getAttributes=function(){return void 0===A&&(A=function(t,e){const i={},n=t.getProgramParameter(e,35721);for(let r=0;r<n;r++){const n=t.getActiveAttrib(e,r),s=n.name;let a=1;35674===n.type&&(a=2),35675===n.type&&(a=3),35676===n.type&&(a=4),i[s]={type:n.type,location:t.getAttribLocation(e,s),locationSize:a}}return i}(a,x)),A},this.destroy=function(){n.releaseStatesOfProgram(this),a.deleteProgram(x),this.program=void 0},this.name=i.shaderName,this.id=ss++,this.cacheKey=e,this.usedTimes=1,this.program=x,this.vertexShader=S,this.fragmentShader=w,this}let ys=0;class Ms{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),r=this._getShaderStage(i),s=this._getShaderCacheForMaterial(t);return!1===s.has(n)&&(s.add(n),n.usedTimes++),!1===s.has(r)&&(s.add(r),r.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return void 0===i&&(i=new bs(t),e.set(t,i)),i}}class bs{constructor(t){this.id=ys++,this.code=t,this.usedTimes=0}}function Ss(t,e,i,n,r,s,a){const o=new je,c=new Ms,h=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,p=r.vertexTextures;let m=r.precision;const f={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(s,o,h,g,v){const x=g.fog,_=v.geometry,y=s.isMeshStandardMaterial?g.environment:null,M=(s.isMeshStandardMaterial?i:e).get(s.envMap||y),b=M&&M.mapping===l?M.image.height:null,S=f[s.type];null!==s.precision&&(m=r.getMaxPrecision(s.precision),m!==s.precision&&console.warn("THREE.WebGLProgram.getParameters:",s.precision,"not supported, using",m,"instead."));const w=_.morphAttributes.position||_.morphAttributes.normal||_.morphAttributes.color,T=void 0!==w?w.length:0;let A,E,C,L,R=0;if(void 0!==_.morphAttributes.position&&(R=1),void 0!==_.morphAttributes.normal&&(R=2),void 0!==_.morphAttributes.color&&(R=3),S){const t=Sn[S];A=t.vertexShader,E=t.fragmentShader}else A=s.vertexShader,E=s.fragmentShader,c.update(s),C=c.getVertexShaderID(s),L=c.getFragmentShaderID(s);const P=t.getRenderTarget(),I=s.alphaTest>0,D=s.clearcoat>0,N=s.iridescence>0;return{isWebGL2:u,shaderID:S,shaderName:s.type,vertexShader:A,fragmentShader:E,defines:s.defines,customVertexShaderID:C,customFragmentShaderID:L,isRawShaderMaterial:!0===s.isRawShaderMaterial,glslVersion:s.glslVersion,precision:m,instancing:!0===v.isInstancedMesh,instancingColor:!0===v.isInstancedMesh&&null!==v.instanceColor,supportsVertexTextures:p,outputEncoding:null===P?t.outputEncoding:!0===P.isXRRenderTarget?P.texture.encoding:at,map:!!s.map,matcap:!!s.matcap,envMap:!!M,envMapMode:M&&M.mapping,envMapCubeUVHeight:b,lightMap:!!s.lightMap,aoMap:!!s.aoMap,emissiveMap:!!s.emissiveMap,bumpMap:!!s.bumpMap,normalMap:!!s.normalMap,objectSpaceNormalMap:1===s.normalMapType,tangentSpaceNormalMap:0===s.normalMapType,decodeVideoTexture:!!s.map&&!0===s.map.isVideoTexture&&s.map.encoding===ot,clearcoat:D,clearcoatMap:D&&!!s.clearcoatMap,clearcoatRoughnessMap:D&&!!s.clearcoatRoughnessMap,clearcoatNormalMap:D&&!!s.clearcoatNormalMap,iridescence:N,iridescenceMap:N&&!!s.iridescenceMap,iridescenceThicknessMap:N&&!!s.iridescenceThicknessMap,displacementMap:!!s.displacementMap,roughnessMap:!!s.roughnessMap,metalnessMap:!!s.metalnessMap,specularMap:!!s.specularMap,specularIntensityMap:!!s.specularIntensityMap,specularColorMap:!!s.specularColorMap,opaque:!1===s.transparent&&1===s.blending,alphaMap:!!s.alphaMap,alphaTest:I,gradientMap:!!s.gradientMap,sheen:s.sheen>0,sheenColorMap:!!s.sheenColorMap,sheenRoughnessMap:!!s.sheenRoughnessMap,transmission:s.transmission>0,transmissionMap:!!s.transmissionMap,thicknessMap:!!s.thicknessMap,combine:s.combine,vertexTangents:!!s.normalMap&&!!_.attributes.tangent,vertexColors:s.vertexColors,vertexAlphas:!0===s.vertexColors&&!!_.attributes.color&&4===_.attributes.color.itemSize,vertexUvs:!!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatMap||s.clearcoatRoughnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.displacementMap||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheenColorMap||s.sheenRoughnessMap),uvsVertexOnly:!(s.map||s.bumpMap||s.normalMap||s.specularMap||s.alphaMap||s.emissiveMap||s.roughnessMap||s.metalnessMap||s.clearcoatNormalMap||s.iridescenceMap||s.iridescenceThicknessMap||s.transmission>0||s.transmissionMap||s.thicknessMap||s.specularIntensityMap||s.specularColorMap||s.sheen>0||s.sheenColorMap||s.sheenRoughnessMap||!s.displacementMap),fog:!!x,useFog:!0===s.fog,fogExp2:x&&x.isFogExp2,flatShading:!!s.flatShading,sizeAttenuation:s.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==_.morphAttributes.position,morphNormals:void 0!==_.morphAttributes.normal,morphColors:void 0!==_.morphAttributes.color,morphTargetsCount:T,morphTextureStride:R,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numSpotLightMaps:o.spotLightMap.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numSpotLightShadowsWithMaps:o.numSpotLightShadowsWithMaps,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:s.dithering,shadowMapEnabled:t.shadowMap.enabled&&h.length>0,shadowMapType:t.shadowMap.type,toneMapping:s.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:s.premultipliedAlpha,doubleSided:2===s.side,flipSided:1===s.side,useDepthPacking:!!s.depthPacking,depthPacking:s.depthPacking||0,index0AttributeName:s.index0AttributeName,extensionDerivatives:s.extensions&&s.extensions.derivatives,extensionFragDepth:s.extensions&&s.extensions.fragDepth,extensionDrawBuffers:s.extensions&&s.extensions.drawBuffers,extensionShaderTextureLOD:s.extensions&&s.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:s.customProgramCacheKey()}},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputEncoding),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.combine),t.push(e.vertexUvs),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){o.disableAll(),e.isWebGL2&&o.enable(0);e.supportsVertexTextures&&o.enable(1);e.instancing&&o.enable(2);e.instancingColor&&o.enable(3);e.map&&o.enable(4);e.matcap&&o.enable(5);e.envMap&&o.enable(6);e.lightMap&&o.enable(7);e.aoMap&&o.enable(8);e.emissiveMap&&o.enable(9);e.bumpMap&&o.enable(10);e.normalMap&&o.enable(11);e.objectSpaceNormalMap&&o.enable(12);e.tangentSpaceNormalMap&&o.enable(13);e.clearcoat&&o.enable(14);e.clearcoatMap&&o.enable(15);e.clearcoatRoughnessMap&&o.enable(16);e.clearcoatNormalMap&&o.enable(17);e.iridescence&&o.enable(18);e.iridescenceMap&&o.enable(19);e.iridescenceThicknessMap&&o.enable(20);e.displacementMap&&o.enable(21);e.specularMap&&o.enable(22);e.roughnessMap&&o.enable(23);e.metalnessMap&&o.enable(24);e.gradientMap&&o.enable(25);e.alphaMap&&o.enable(26);e.alphaTest&&o.enable(27);e.vertexColors&&o.enable(28);e.vertexAlphas&&o.enable(29);e.vertexUvs&&o.enable(30);e.vertexTangents&&o.enable(31);e.uvsVertexOnly&&o.enable(32);t.push(o.mask),o.disableAll(),e.fog&&o.enable(0);e.useFog&&o.enable(1);e.flatShading&&o.enable(2);e.logarithmicDepthBuffer&&o.enable(3);e.skinning&&o.enable(4);e.morphTargets&&o.enable(5);e.morphNormals&&o.enable(6);e.morphColors&&o.enable(7);e.premultipliedAlpha&&o.enable(8);e.shadowMapEnabled&&o.enable(9);e.physicallyCorrectLights&&o.enable(10);e.doubleSided&&o.enable(11);e.flipSided&&o.enable(12);e.useDepthPacking&&o.enable(13);e.dithering&&o.enable(14);e.specularIntensityMap&&o.enable(15);e.specularColorMap&&o.enable(16);e.transmission&&o.enable(17);e.transmissionMap&&o.enable(18);e.thicknessMap&&o.enable(19);e.sheen&&o.enable(20);e.sheenColorMap&&o.enable(21);e.sheenRoughnessMap&&o.enable(22);e.decodeVideoTexture&&o.enable(23);e.opaque&&o.enable(24);t.push(o.mask)}(i,e),i.push(t.outputEncoding)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=f[t.type];let i;if(e){const t=Sn[e];i=nn.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=h.length;t<e;t++){const e=h[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new _s(t,i,e,s),h.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=h.indexOf(t);h[e]=h[h.length-1],h.pop(),t.destroy()}},releaseShaderCache:function(t){c.remove(t)},programs:h,dispose:function(){c.dispose()}}}function ws(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function Ts(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function As(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Es(){const t=[];let e=0;const i=[],n=[],r=[];function s(i,n,r,s,a,o){let l=t[e];return void 0===l?(l={id:i.id,object:i,geometry:n,material:r,groupOrder:s,renderOrder:i.renderOrder,z:a,group:o},t[e]=l):(l.id=i.id,l.object=i,l.geometry=n,l.material=r,l.groupOrder=s,l.renderOrder=i.renderOrder,l.z=a,l.group=o),e++,l}return{opaque:i,transmissive:n,transparent:r,init:function(){e=0,i.length=0,n.length=0,r.length=0},push:function(t,e,a,o,l,c){const h=s(t,e,a,o,l,c);a.transmission>0?n.push(h):!0===a.transparent?r.push(h):i.push(h)},unshift:function(t,e,a,o,l,c){const h=s(t,e,a,o,l,c);a.transmission>0?n.unshift(h):!0===a.transparent?r.unshift(h):i.unshift(h)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||Ts),n.length>1&&n.sort(e||As),r.length>1&&r.sort(e||As)}}}function Cs(){let t=new WeakMap;return{get:function(e,i){const n=t.get(e);let r;return void 0===n?(r=new Es,t.set(e,[r])):i>=n.length?(r=new Es,n.push(r)):r=n[i],r},dispose:function(){t=new WeakMap}}}function Ls(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new ne,color:new jt};break;case"SpotLight":i={position:new ne,direction:new ne,color:new jt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new ne,color:new jt,distance:0,decay:0};break;case"HemisphereLight":i={direction:new ne,skyColor:new jt,groundColor:new jt};break;case"RectAreaLight":i={color:new jt,position:new ne,halfWidth:new ne,halfHeight:new ne}}return t[e.id]=i,i}}}let Rs=0;function Ps(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Is(t,e){const i=new Ls,n=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Lt};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Lt,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let t=0;t<9;t++)r.probe.push(new ne);const s=new ne,a=new Ne,o=new Ne;return{setup:function(s,a){let o=0,l=0,c=0;for(let t=0;t<9;t++)r.probe[t].set(0,0,0);let h=0,u=0,d=0,p=0,m=0,f=0,g=0,v=0,x=0,_=0;s.sort(Ps);const y=!0!==a?Math.PI:1;for(let t=0,e=s.length;t<e;t++){const e=s[t],a=e.color,M=e.intensity,b=e.distance,S=e.shadow&&e.shadow.map?e.shadow.map.texture:null;if(e.isAmbientLight)o+=a.r*M*y,l+=a.g*M*y,c+=a.b*M*y;else if(e.isLightProbe)for(let t=0;t<9;t++)r.probe[t].addScaledVector(e.sh.coefficients[t],M);else if(e.isDirectionalLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,r.directionalShadow[h]=i,r.directionalShadowMap[h]=S,r.directionalShadowMatrix[h]=e.shadow.matrix,f++}r.directional[h]=t,h++}else if(e.isSpotLight){const t=i.get(e);t.position.setFromMatrixPosition(e.matrixWorld),t.color.copy(a).multiplyScalar(M*y),t.distance=b,t.coneCos=Math.cos(e.angle),t.penumbraCos=Math.cos(e.angle*(1-e.penumbra)),t.decay=e.decay,r.spot[d]=t;const s=e.shadow;if(e.map&&(r.spotLightMap[x]=e.map,x++,s.updateMatrices(e),e.castShadow&&_++),r.spotLightMatrix[d]=s.matrix,e.castShadow){const t=n.get(e);t.shadowBias=s.bias,t.shadowNormalBias=s.normalBias,t.shadowRadius=s.radius,t.shadowMapSize=s.mapSize,r.spotShadow[d]=t,r.spotShadowMap[d]=S,v++}d++}else if(e.isRectAreaLight){const t=i.get(e);t.color.copy(a).multiplyScalar(M),t.halfWidth.set(.5*e.width,0,0),t.halfHeight.set(0,.5*e.height,0),r.rectArea[p]=t,p++}else if(e.isPointLight){const t=i.get(e);if(t.color.copy(e.color).multiplyScalar(e.intensity*y),t.distance=e.distance,t.decay=e.decay,e.castShadow){const t=e.shadow,i=n.get(e);i.shadowBias=t.bias,i.shadowNormalBias=t.normalBias,i.shadowRadius=t.radius,i.shadowMapSize=t.mapSize,i.shadowCameraNear=t.camera.near,i.shadowCameraFar=t.camera.far,r.pointShadow[u]=i,r.pointShadowMap[u]=S,r.pointShadowMatrix[u]=e.shadow.matrix,g++}r.point[u]=t,u++}else if(e.isHemisphereLight){const t=i.get(e);t.skyColor.copy(e.color).multiplyScalar(M*y),t.groundColor.copy(e.groundColor).multiplyScalar(M*y),r.hemi[m]=t,m++}}p>0&&(e.isWebGL2||!0===t.has("OES_texture_float_linear")?(r.rectAreaLTC1=bn.LTC_FLOAT_1,r.rectAreaLTC2=bn.LTC_FLOAT_2):!0===t.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=bn.LTC_HALF_1,r.rectAreaLTC2=bn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=o,r.ambient[1]=l,r.ambient[2]=c;const M=r.hash;M.directionalLength===h&&M.pointLength===u&&M.spotLength===d&&M.rectAreaLength===p&&M.hemiLength===m&&M.numDirectionalShadows===f&&M.numPointShadows===g&&M.numSpotShadows===v&&M.numSpotMaps===x||(r.directional.length=h,r.spot.length=d,r.rectArea.length=p,r.point.length=u,r.hemi.length=m,r.directionalShadow.length=f,r.directionalShadowMap.length=f,r.pointShadow.length=g,r.pointShadowMap.length=g,r.spotShadow.length=v,r.spotShadowMap.length=v,r.directionalShadowMatrix.length=f,r.pointShadowMatrix.length=g,r.spotLightMatrix.length=v+x-_,r.spotLightMap.length=x,r.numSpotLightShadowsWithMaps=_,M.directionalLength=h,M.pointLength=u,M.spotLength=d,M.rectAreaLength=p,M.hemiLength=m,M.numDirectionalShadows=f,M.numPointShadows=g,M.numSpotShadows=v,M.numSpotMaps=x,r.version=Rs++)},setupView:function(t,e){let i=0,n=0,l=0,c=0,h=0;const u=e.matrixWorldInverse;for(let e=0,d=t.length;e<d;e++){const d=t[e];if(d.isDirectionalLight){const t=r.directional[i];t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),i++}else if(d.isSpotLight){const t=r.spot[l];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),t.direction.setFromMatrixPosition(d.matrixWorld),s.setFromMatrixPosition(d.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(u),l++}else if(d.isRectAreaLight){const t=r.rectArea[c];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),o.identity(),a.copy(d.matrixWorld),a.premultiply(u),o.extractRotation(a),t.halfWidth.set(.5*d.width,0,0),t.halfHeight.set(0,.5*d.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),c++}else if(d.isPointLight){const t=r.point[n];t.position.setFromMatrixPosition(d.matrixWorld),t.position.applyMatrix4(u),n++}else if(d.isHemisphereLight){const t=r.hemi[h];t.direction.setFromMatrixPosition(d.matrixWorld),t.direction.transformDirection(u),h++}}},state:r}}function Ds(t,e){const i=new Is(t,e),n=[],r=[];return{init:function(){n.length=0,r.length=0},state:{lightsArray:n,shadowsArray:r,lights:i},setupLights:function(t){i.setup(n,t)},setupLightsView:function(t){i.setupView(n,t)},pushLight:function(t){n.push(t)},pushShadow:function(t){r.push(t)}}}function Ns(t,e){let i=new WeakMap;return{get:function(n,r=0){const s=i.get(n);let a;return void 0===s?(a=new Ds(t,e),i.set(n,[a])):r>=s.length?(a=new Ds(t,e),s.push(a)):a=s[r],a},dispose:function(){i=new WeakMap}}}class Os extends xi{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class zs extends xi{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new ne,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.referencePosition.copy(t.referencePosition),this.nearDistance=t.nearDistance,this.farDistance=t.farDistance,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function Us(t,e,i){let n=new vn;const r=new Lt,s=new Lt,a=new $t,o=new Os({depthPacking:3201}),l=new zs,c={},h=i.maxTextureSize,u={0:1,1:0,2:2},p=new rn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Lt},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),m=p.clone();m.defines.HORIZONTAL_PASS=1;const f=new Di;f.setAttribute("position",new bi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Ki(f,p),v=this;function x(i,n){const s=e.update(g);p.defines.VSM_SAMPLES!==i.blurSamples&&(p.defines.VSM_SAMPLES=i.blurSamples,m.defines.VSM_SAMPLES=i.blurSamples,p.needsUpdate=!0,m.needsUpdate=!0),null===i.mapPass&&(i.mapPass=new Qt(r.x,r.y)),p.uniforms.shadow_pass.value=i.map.texture,p.uniforms.resolution.value=i.mapSize,p.uniforms.radius.value=i.radius,t.setRenderTarget(i.mapPass),t.clear(),t.renderBufferDirect(n,null,s,p,g,null),m.uniforms.shadow_pass.value=i.mapPass.texture,m.uniforms.resolution.value=i.mapSize,m.uniforms.radius.value=i.radius,t.setRenderTarget(i.map),t.clear(),t.renderBufferDirect(n,null,s,m,g,null)}function _(e,i,n,r,s,a){let h=null;const d=!0===n.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(h=void 0!==d?d:!0===n.isPointLight?l:o,t.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0){const t=h.uuid,e=i.uuid;let n=c[t];void 0===n&&(n={},c[t]=n);let r=n[e];void 0===r&&(r=h.clone(),n[e]=r),h=r}return h.visible=i.visible,h.wireframe=i.wireframe,h.side=3===a?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:u[i.side],h.alphaMap=i.alphaMap,h.alphaTest=i.alphaTest,h.clipShadows=i.clipShadows,h.clippingPlanes=i.clippingPlanes,h.clipIntersection=i.clipIntersection,h.displacementMap=i.displacementMap,h.displacementScale=i.displacementScale,h.displacementBias=i.displacementBias,h.wireframeLinewidth=i.wireframeLinewidth,h.linewidth=i.linewidth,!0===n.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(n.matrixWorld),h.nearDistance=r,h.farDistance=s),h}function y(i,r,s,a,o){if(!1===i.visible)return;if(i.layers.test(r.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&3===o)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,i.matrixWorld);const n=e.update(i),r=i.material;if(Array.isArray(r)){const e=n.groups;for(let l=0,c=e.length;l<c;l++){const c=e[l],h=r[c.materialIndex];if(h&&h.visible){const e=_(i,h,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,c)}}}else if(r.visible){const e=_(i,r,a,s.near,s.far,o);t.renderBufferDirect(s,null,n,e,i,null)}}const l=i.children;for(let t=0,e=l.length;t<e;t++)y(l[t],r,s,a,o)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,i,o){if(!1===v.enabled)return;if(!1===v.autoUpdate&&!1===v.needsUpdate)return;if(0===e.length)return;const l=t.getRenderTarget(),c=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),p=t.state;p.setBlending(0),p.buffers.color.setClear(1,1,1,1),p.buffers.depth.setTest(!0),p.setScissorTest(!1);for(let l=0,c=e.length;l<c;l++){const c=e[l],u=c.shadow;if(void 0===u){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===u.autoUpdate&&!1===u.needsUpdate)continue;r.copy(u.mapSize);const m=u.getFrameExtents();if(r.multiply(m),s.copy(u.mapSize),(r.x>h||r.y>h)&&(r.x>h&&(s.x=Math.floor(h/m.x),r.x=s.x*m.x,u.mapSize.x=s.x),r.y>h&&(s.y=Math.floor(h/m.y),r.y=s.y*m.y,u.mapSize.y=s.y)),null===u.map){const t=3!==this.type?{minFilter:d,magFilter:d}:{};u.map=new Qt(r.x,r.y,t),u.map.texture.name=c.name+".shadowMap",u.camera.updateProjectionMatrix()}t.setRenderTarget(u.map),t.clear();const f=u.getViewportCount();for(let t=0;t<f;t++){const e=u.getViewport(t);a.set(s.x*e.x,s.y*e.y,s.x*e.z,s.y*e.w),p.viewport(a),u.updateMatrices(c,t),n=u.getFrustum(),y(i,o,u.camera,c,this.type)}!0!==u.isPointLightShadow&&3===this.type&&x(u,o),u.needsUpdate=!1}v.needsUpdate=!1,t.setRenderTarget(l,c,u)}}function Bs(t,e,n){const r=n.isWebGL2;const s=new function(){let e=!1;const i=new $t;let n=null;const r=new $t(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,s,a,o){!0===o&&(e*=a,n*=a,s*=a),i.set(e,n,s,a),!1===r.equals(i)&&(t.clearColor(e,n,s,a),r.copy(i))},reset:function(){e=!1,n=null,r.set(-1,0,0,0)}}},a=new function(){let e=!1,i=null,n=null,r=null;return{setTest:function(t){t?G(2929):V(2929)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:default:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517)}else t.depthFunc(515);n=e}},setLocked:function(t){e=t},setClear:function(e){r!==e&&(t.clearDepth(e),r=e)},reset:function(){e=!1,i=null,n=null,r=null}}},o=new function(){let e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null;return{setTest:function(t){e||(t?G(2960):V(2960))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,a){n===e&&r===i&&s===a||(t.stencilFunc(e,i,a),n=e,r=i,s=a)},setOp:function(e,i,n){a===e&&o===i&&l===n||(t.stencilOp(e,i,n),a=e,o=i,l=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null}}},l=new WeakMap,c=new WeakMap;let h={},u={},d=new WeakMap,p=[],m=null,f=!1,g=null,v=null,x=null,_=null,y=null,M=null,b=null,S=!1,w=null,T=null,A=null,E=null,C=null;const L=t.getParameter(35661);let R=!1,P=0;const I=t.getParameter(7938);-1!==I.indexOf("WebGL")?(P=parseFloat(/^WebGL (\d)/.exec(I)[1]),R=P>=1):-1!==I.indexOf("OpenGL ES")&&(P=parseFloat(/^OpenGL ES (\d)/.exec(I)[1]),R=P>=2);let D=null,N={};const O=t.getParameter(3088),z=t.getParameter(2978),U=(new $t).fromArray(O),B=(new $t).fromArray(z);function F(e,i,n){const r=new Uint8Array(4),s=t.createTexture();t.bindTexture(e,s),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let e=0;e<n;e++)t.texImage2D(i+e,0,6408,1,1,0,6408,5121,r);return s}const k={};function G(e){!0!==h[e]&&(t.enable(e),h[e]=!0)}function V(e){!1!==h[e]&&(t.disable(e),h[e]=!1)}k[3553]=F(3553,3553,1),k[34067]=F(34067,34069,6),s.setClear(0,0,0,1),a.setClear(1),o.setClear(0),G(2929),a.setFunc(3),q(!1),X(1),G(2884),j(0);const H={[i]:32774,101:32778,102:32779};if(r)H[103]=32775,H[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(H[103]=t.MIN_EXT,H[104]=t.MAX_EXT)}const W={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function j(e,n,r,s,a,o,l,c){if(0!==e){if(!1===f&&(G(3042),f=!0),5===e)a=a||n,o=o||r,l=l||s,n===v&&a===y||(t.blendEquationSeparate(H[n],H[a]),v=n,y=a),r===x&&s===_&&o===M&&l===b||(t.blendFuncSeparate(W[r],W[s],W[o],W[l]),x=r,_=s,M=o,b=l),g=e,S=null;else if(e!==g||c!==S){if(v===i&&y===i||(t.blendEquation(32774),v=i,y=i),c)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFuncSeparate(0,769,0,1);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}x=null,_=null,M=null,b=null,g=e,S=c}}else!0===f&&(V(3042),f=!1)}function q(e){w!==e&&(e?t.frontFace(2304):t.frontFace(2305),w=e)}function X(e){0!==e?(G(2884),e!==T&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):V(2884),T=e}function Y(e,i,n){e?(G(32823),E===i&&C===n||(t.polygonOffset(i,n),E=i,C=n)):V(32823)}function Z(e){void 0===e&&(e=33984+L-1),D!==e&&(t.activeTexture(e),D=e)}return{buffers:{color:s,depth:a,stencil:o},enable:G,disable:V,bindFramebuffer:function(e,i){return u[e]!==i&&(t.bindFramebuffer(e,i),u[e]=i,r&&(36009===e&&(u[36160]=i),36160===e&&(u[36009]=i)),!0)},drawBuffers:function(i,r){let s=p,a=!1;if(i)if(s=d.get(r),void 0===s&&(s=[],d.set(r,s)),i.isWebGLMultipleRenderTargets){const t=i.texture;if(s.length!==t.length||36064!==s[0]){for(let e=0,i=t.length;e<i;e++)s[e]=36064+e;s.length=t.length,a=!0}}else 36064!==s[0]&&(s[0]=36064,a=!0);else 1029!==s[0]&&(s[0]=1029,a=!0);a&&(n.isWebGL2?t.drawBuffers(s):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(s))},useProgram:function(e){return m!==e&&(t.useProgram(e),m=e,!0)},setBlending:j,setMaterial:function(t,e){2===t.side?V(2884):G(2884);let i=1===t.side;e&&(i=!i),q(i),1===t.blending&&!1===t.transparent?j(0):j(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),a.setFunc(t.depthFunc),a.setTest(t.depthTest),a.setMask(t.depthWrite),s.setMask(t.colorWrite);const n=t.stencilWrite;o.setTest(n),n&&(o.setMask(t.stencilWriteMask),o.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),o.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),Y(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),!0===t.alphaToCoverage?G(32926):V(32926)},setFlipSided:q,setCullFace:X,setLineWidth:function(e){e!==A&&(R&&t.lineWidth(e),A=e)},setPolygonOffset:Y,setScissorTest:function(t){t?G(3089):V(3089)},activeTexture:Z,bindTexture:function(e,i){null===D&&Z();let n=N[D];void 0===n&&(n={type:void 0,texture:void 0},N[D]=n),n.type===e&&n.texture===i||(t.bindTexture(e,i||k[e]),n.type=e,n.texture=i)},unbindTexture:function(){const e=N[D];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,i){let n=c.get(i);void 0===n&&(n=new WeakMap,c.set(i,n));let r=n.get(e);void 0===r&&(r=t.getUniformBlockIndex(i,e.name),n.set(e,r))},uniformBlockBinding:function(e,i){const n=c.get(i).get(e);l.get(e)!==n&&(t.uniformBlockBinding(i,n,e.__bindingPointIndex),l.set(e,n))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===U.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),U.copy(e))},viewport:function(e){!1===B.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),B.copy(e))},reset:function(){t.disable(3042),t.disable(2884),t.disable(2929),t.disable(32823),t.disable(3089),t.disable(2960),t.disable(32926),t.blendEquation(32774),t.blendFunc(1,0),t.blendFuncSeparate(1,0,1,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(513),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(519,0,4294967295),t.stencilOp(7680,7680,7680),t.clearStencil(0),t.cullFace(1029),t.frontFace(2305),t.polygonOffset(0,0),t.activeTexture(33984),t.bindFramebuffer(36160,null),!0===r&&(t.bindFramebuffer(36009,null),t.bindFramebuffer(36008,null)),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),h={},D=null,N={},u={},d=new WeakMap,p=[],m=null,f=!1,g=null,v=null,x=null,_=null,y=null,M=null,b=null,S=!1,w=null,T=null,A=null,E=null,C=null,U.set(0,0,t.canvas.width,t.canvas.height),B.set(0,0,t.canvas.width,t.canvas.height),s.reset(),a.reset(),o.reset()}}}function Fs(t,e,i,n,r,s,a){const o=r.isWebGL2,l=r.maxTextures,E=r.maxCubemapSize,C=r.maxTextureSize,L=r.maxSamples,R=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,P=/OculusBrowser/g.test(navigator.userAgent),I=new WeakMap;let D;const N=new WeakMap;let O=!1;try{O="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function z(t,e){return O?new OffscreenCanvas(t,e):Nt("canvas")}function U(t,e,i,n){let r=1;if((t.width>n||t.height>n)&&(r=n/Math.max(t.width,t.height)),r<1||!0===e){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const n=e?Tt:Math.floor,s=n(r*t.width),a=n(r*t.height);void 0===D&&(D=z(s,a));const o=i?z(s,a):D;o.width=s,o.height=a;return o.getContext("2d").drawImage(t,0,0,s,a),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+t.width+"x"+t.height+") to ("+s+"x"+a+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+t.width+"x"+t.height+")."),t}return t}function B(t){return St(t.width)&&St(t.height)}function F(t,e){return t.generateMipmaps&&e&&t.minFilter!==d&&t.minFilter!==f}function k(e){t.generateMipmap(e)}function G(i,n,r,s,a=!1){if(!1===o)return n;if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let l=n;return 6403===n&&(5126===r&&(l=33326),5131===r&&(l=33325),5121===r&&(l=33321)),33319===n&&(5126===r&&(l=33328),5131===r&&(l=33327),5121===r&&(l=33323)),6408===n&&(5126===r&&(l=34836),5131===r&&(l=34842),5121===r&&(l=s===ot&&!1===a?35907:32856),32819===r&&(l=32854),32820===r&&(l=32855)),33325!==l&&33326!==l&&33327!==l&&33328!==l&&34842!==l&&34836!==l||e.get("EXT_color_buffer_float"),l}function V(t,e,i){return!0===F(t,i)||t.isFramebufferTexture&&t.minFilter!==d&&t.minFilter!==f?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function H(t){return t===d||t===p||t===m?9728:9729}function W(t){const e=t.target;e.removeEventListener("dispose",W),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,r=N.get(i);if(r){const n=r[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&q(t),0===Object.keys(r).length&&N.delete(i)}n.remove(t)}(e),e.isVideoTexture&&I.delete(e)}function j(e){const i=e.target;i.removeEventListener("dispose",j),function(e){const i=e.texture,r=n.get(e),s=n.get(i);void 0!==s.__webglTexture&&(t.deleteTexture(s.__webglTexture),a.memory.textures--);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++)t.deleteFramebuffer(r.__webglFramebuffer[e]),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer[e]);else{if(t.deleteFramebuffer(r.__webglFramebuffer),r.__webglDepthbuffer&&t.deleteRenderbuffer(r.__webglDepthbuffer),r.__webglMultisampledFramebuffer&&t.deleteFramebuffer(r.__webglMultisampledFramebuffer),r.__webglColorRenderbuffer)for(let e=0;e<r.__webglColorRenderbuffer.length;e++)r.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(r.__webglColorRenderbuffer[e]);r.__webglDepthRenderbuffer&&t.deleteRenderbuffer(r.__webglDepthRenderbuffer)}if(e.isWebGLMultipleRenderTargets)for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);r.__webglTexture&&(t.deleteTexture(r.__webglTexture),a.memory.textures--),n.remove(i[e])}n.remove(i),n.remove(e)}(i)}function q(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const r=e.source;delete N.get(r)[i.__cacheKey],a.memory.textures--}let X=0;function Y(t,e){const r=n.get(t);if(t.isVideoTexture&&function(t){const e=a.render.frame;I.get(t)!==e&&(I.set(t,e),t.update())}(t),!1===t.isRenderTargetTexture&&t.version>0&&r.__version!==t.version){const i=t.image;if(null===i)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==i.complete)return void Q(r,t,e);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+e),i.bindTexture(3553,r.__webglTexture)}const Z={[c]:10497,[h]:33071,[u]:33648},J={[d]:9728,[p]:9984,[m]:9986,[f]:9729,[g]:9985,[v]:9987};function K(i,s,a){if(a?(t.texParameteri(i,10242,Z[s.wrapS]),t.texParameteri(i,10243,Z[s.wrapT]),32879!==i&&35866!==i||t.texParameteri(i,32882,Z[s.wrapR]),t.texParameteri(i,10240,J[s.magFilter]),t.texParameteri(i,10241,J[s.minFilter])):(t.texParameteri(i,10242,33071),t.texParameteri(i,10243,33071),32879!==i&&35866!==i||t.texParameteri(i,32882,33071),s.wrapS===h&&s.wrapT===h||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(i,10240,H(s.magFilter)),t.texParameteri(i,10241,H(s.minFilter)),s.minFilter!==d&&s.minFilter!==f&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const a=e.get("EXT_texture_filter_anisotropic");if(s.type===M&&!1===e.has("OES_texture_float_linear"))return;if(!1===o&&s.type===b&&!1===e.has("OES_texture_half_float_linear"))return;(s.anisotropy>1||n.get(s).__currentAnisotropy)&&(t.texParameterf(i,a.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,r.getMaxAnisotropy())),n.get(s).__currentAnisotropy=s.anisotropy)}}function $(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",W));const r=i.source;let s=N.get(r);void 0===s&&(s={},N.set(r,s));const o=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.encoding),e.join()}(i);if(o!==e.__cacheKey){void 0===s[o]&&(s[o]={texture:t.createTexture(),usedTimes:0},a.memory.textures++,n=!0),s[o].usedTimes++;const r=s[e.__cacheKey];void 0!==r&&(s[e.__cacheKey].usedTimes--,0===r.usedTimes&&q(i)),e.__cacheKey=o,e.__webglTexture=s[o].texture}return n}function Q(e,n,r){let a=3553;n.isDataArrayTexture&&(a=35866),n.isData3DTexture&&(a=32879);const l=$(e,n),c=n.source;if(i.activeTexture(33984+r),i.bindTexture(a,e.__webglTexture),c.version!==c.__currentVersion||!0===l){t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const e=function(t){return!o&&(t.wrapS!==h||t.wrapT!==h||t.minFilter!==d&&t.minFilter!==f)}(n)&&!1===B(n.image);let r=U(n.image,e,!1,C);r=st(n,r);const u=B(r)||o,p=s.convert(n.format,n.encoding);let m,g=s.convert(n.type),v=G(n.internalFormat,p,g,n.encoding,n.isVideoTexture);K(a,n,u);const x=n.mipmaps,b=o&&!0!==n.isVideoTexture,E=void 0===c.__currentVersion||!0===l,L=V(n,r,u);if(n.isDepthTexture)v=6402,o?v=n.type===M?36012:n.type===y?33190:n.type===S?35056:33189:n.type===M&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===T&&6402===v&&n.type!==_&&n.type!==y&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=y,g=s.convert(n.type)),n.format===A&&6402===v&&(v=34041,n.type!==S&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=S,g=s.convert(n.type))),E&&(b?i.texStorage2D(3553,1,v,r.width,r.height):i.texImage2D(3553,0,v,r.width,r.height,0,p,g,null));else if(n.isDataTexture)if(x.length>0&&u){b&&E&&i.texStorage2D(3553,L,v,x[0].width,x[0].height);for(let t=0,e=x.length;t<e;t++)m=x[t],b?i.texSubImage2D(3553,t,0,0,m.width,m.height,p,g,m.data):i.texImage2D(3553,t,v,m.width,m.height,0,p,g,m.data);n.generateMipmaps=!1}else b?(E&&i.texStorage2D(3553,L,v,r.width,r.height),i.texSubImage2D(3553,0,0,0,r.width,r.height,p,g,r.data)):i.texImage2D(3553,0,v,r.width,r.height,0,p,g,r.data);else if(n.isCompressedTexture){b&&E&&i.texStorage2D(3553,L,v,x[0].width,x[0].height);for(let t=0,e=x.length;t<e;t++)m=x[t],n.format!==w?null!==p?b?i.compressedTexSubImage2D(3553,t,0,0,m.width,m.height,p,m.data):i.compressedTexImage2D(3553,t,v,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b?i.texSubImage2D(3553,t,0,0,m.width,m.height,p,g,m.data):i.texImage2D(3553,t,v,m.width,m.height,0,p,g,m.data)}else if(n.isDataArrayTexture)b?(E&&i.texStorage3D(35866,L,v,r.width,r.height,r.depth),i.texSubImage3D(35866,0,0,0,0,r.width,r.height,r.depth,p,g,r.data)):i.texImage3D(35866,0,v,r.width,r.height,r.depth,0,p,g,r.data);else if(n.isData3DTexture)b?(E&&i.texStorage3D(32879,L,v,r.width,r.height,r.depth),i.texSubImage3D(32879,0,0,0,0,r.width,r.height,r.depth,p,g,r.data)):i.texImage3D(32879,0,v,r.width,r.height,r.depth,0,p,g,r.data);else if(n.isFramebufferTexture){if(E)if(b)i.texStorage2D(3553,L,v,r.width,r.height);else{let t=r.width,e=r.height;for(let n=0;n<L;n++)i.texImage2D(3553,n,v,t,e,0,p,g,null),t>>=1,e>>=1}}else if(x.length>0&&u){b&&E&&i.texStorage2D(3553,L,v,x[0].width,x[0].height);for(let t=0,e=x.length;t<e;t++)m=x[t],b?i.texSubImage2D(3553,t,0,0,p,g,m):i.texImage2D(3553,t,v,p,g,m);n.generateMipmaps=!1}else b?(E&&i.texStorage2D(3553,L,v,r.width,r.height),i.texSubImage2D(3553,0,0,0,p,g,r)):i.texImage2D(3553,0,v,p,g,r);F(n,u)&&k(a),c.__currentVersion=c.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}function tt(e,r,a,o,l){const c=s.convert(a.format,a.encoding),h=s.convert(a.type),u=G(a.internalFormat,c,h,a.encoding);n.get(r).__hasExternalTextures||(32879===l||35866===l?i.texImage3D(l,0,u,r.width,r.height,r.depth,0,c,h,null):i.texImage2D(l,0,u,r.width,r.height,0,c,h,null)),i.bindFramebuffer(36160,e),rt(r)?R.framebufferTexture2DMultisampleEXT(36160,o,l,n.get(a).__webglTexture,0,nt(r)):t.framebufferTexture2D(36160,o,l,n.get(a).__webglTexture,0),i.bindFramebuffer(36160,null)}function et(e,i,n){if(t.bindRenderbuffer(36161,e),i.depthBuffer&&!i.stencilBuffer){let r=33189;if(n||rt(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===M?r=36012:e.type===y&&(r=33190));const n=nt(i);rt(i)?R.renderbufferStorageMultisampleEXT(36161,n,r,i.width,i.height):t.renderbufferStorageMultisample(36161,n,r,i.width,i.height)}else t.renderbufferStorage(36161,r,i.width,i.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(i.depthBuffer&&i.stencilBuffer){const r=nt(i);n&&!1===rt(i)?t.renderbufferStorageMultisample(36161,r,35056,i.width,i.height):rt(i)?R.renderbufferStorageMultisampleEXT(36161,r,35056,i.width,i.height):t.renderbufferStorage(36161,34041,i.width,i.height),t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=!0===i.isWebGLMultipleRenderTargets?i.texture:[i.texture];for(let r=0;r<e.length;r++){const a=e[r],o=s.convert(a.format,a.encoding),l=s.convert(a.type),c=G(a.internalFormat,o,l,a.encoding),h=nt(i);n&&!1===rt(i)?t.renderbufferStorageMultisample(36161,h,c,i.width,i.height):rt(i)?R.renderbufferStorageMultisampleEXT(36161,h,c,i.width,i.height):t.renderbufferStorage(36161,c,i.width,i.height)}}t.bindRenderbuffer(36161,null)}function it(e){const r=n.get(e),s=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!r.__autoAllocateDepthBuffer){if(s)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,r){if(r&&r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,e),!r.depthTexture||!r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(r.depthTexture).__webglTexture&&r.depthTexture.image.width===r.width&&r.depthTexture.image.height===r.height||(r.depthTexture.image.width=r.width,r.depthTexture.image.height=r.height,r.depthTexture.needsUpdate=!0),Y(r.depthTexture,0);const s=n.get(r.depthTexture).__webglTexture,a=nt(r);if(r.depthTexture.format===T)rt(r)?R.framebufferTexture2DMultisampleEXT(36160,36096,3553,s,0,a):t.framebufferTexture2D(36160,36096,3553,s,0);else{if(r.depthTexture.format!==A)throw new Error("Unknown depthTexture format");rt(r)?R.framebufferTexture2DMultisampleEXT(36160,33306,3553,s,0,a):t.framebufferTexture2D(36160,33306,3553,s,0)}}(r.__webglFramebuffer,e)}else if(s){r.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,r.__webglFramebuffer[n]),r.__webglDepthbuffer[n]=t.createRenderbuffer(),et(r.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(36160,r.__webglFramebuffer),r.__webglDepthbuffer=t.createRenderbuffer(),et(r.__webglDepthbuffer,e,!1);i.bindFramebuffer(36160,null)}function nt(t){return Math.min(L,t.samples)}function rt(t){const i=n.get(t);return o&&t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function st(t,i){const n=t.encoding,r=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||t.format===pt||n!==at&&(n===ot?!1===o?!0===e.has("EXT_sRGB")&&r===w?(t.format=pt,t.minFilter=f,t.generateMipmaps=!1):i=Xt.sRGBToLinear(i):r===w&&s===x||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",n)),i}this.allocateTextureUnit=function(){const t=X;return t>=l&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+l),X+=1,t},this.resetTextureUnits=function(){X=0},this.setTexture2D=Y,this.setTexture2DArray=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?Q(r,t,e):(i.activeTexture(33984+e),i.bindTexture(35866,r.__webglTexture))},this.setTexture3D=function(t,e){const r=n.get(t);t.version>0&&r.__version!==t.version?Q(r,t,e):(i.activeTexture(33984+e),i.bindTexture(32879,r.__webglTexture))},this.setTextureCube=function(e,r){const a=n.get(e);e.version>0&&a.__version!==e.version?function(e,n,r){if(6!==n.image.length)return;const a=$(e,n),l=n.source;if(i.activeTexture(33984+r),i.bindTexture(34067,e.__webglTexture),l.version!==l.__currentVersion||!0===a){t.pixelStorei(37440,n.flipY),t.pixelStorei(37441,n.premultiplyAlpha),t.pixelStorei(3317,n.unpackAlignment),t.pixelStorei(37443,0);const e=n.isCompressedTexture||n.image[0].isCompressedTexture,r=n.image[0]&&n.image[0].isDataTexture,c=[];for(let t=0;t<6;t++)c[t]=e||r?r?n.image[t].image:n.image[t]:U(n.image[t],!1,!0,E),c[t]=st(n,c[t]);const h=c[0],u=B(h)||o,d=s.convert(n.format,n.encoding),p=s.convert(n.type),m=G(n.internalFormat,d,p,n.encoding),f=o&&!0!==n.isVideoTexture,g=void 0===l.__currentVersion||!0===a;let v,x=V(n,h,u);if(K(34067,n,u),e){f&&g&&i.texStorage2D(34067,x,m,h.width,h.height);for(let t=0;t<6;t++){v=c[t].mipmaps;for(let e=0;e<v.length;e++){const r=v[e];n.format!==w?null!==d?f?i.compressedTexSubImage2D(34069+t,e,0,0,r.width,r.height,d,r.data):i.compressedTexImage2D(34069+t,e,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):f?i.texSubImage2D(34069+t,e,0,0,r.width,r.height,d,p,r.data):i.texImage2D(34069+t,e,m,r.width,r.height,0,d,p,r.data)}}}else{v=n.mipmaps,f&&g&&(v.length>0&&x++,i.texStorage2D(34067,x,m,c[0].width,c[0].height));for(let t=0;t<6;t++)if(r){f?i.texSubImage2D(34069+t,0,0,0,c[t].width,c[t].height,d,p,c[t].data):i.texImage2D(34069+t,0,m,c[t].width,c[t].height,0,d,p,c[t].data);for(let e=0;e<v.length;e++){const n=v[e].image[t].image;f?i.texSubImage2D(34069+t,e+1,0,0,n.width,n.height,d,p,n.data):i.texImage2D(34069+t,e+1,m,n.width,n.height,0,d,p,n.data)}}else{f?i.texSubImage2D(34069+t,0,0,0,d,p,c[t]):i.texImage2D(34069+t,0,m,d,p,c[t]);for(let e=0;e<v.length;e++){const n=v[e];f?i.texSubImage2D(34069+t,e+1,0,0,d,p,n.image[t]):i.texImage2D(34069+t,e+1,m,d,p,n.image[t])}}}F(n,u)&&k(34067),l.__currentVersion=l.version,n.onUpdate&&n.onUpdate(n)}e.__version=n.version}(a,e,r):(i.activeTexture(33984+r),i.bindTexture(34067,a.__webglTexture))},this.rebindTextures=function(t,e,i){const r=n.get(t);void 0!==e&&tt(r.__webglFramebuffer,t,t.texture,36064,3553),void 0!==i&&it(t)},this.setupRenderTarget=function(e){const l=e.texture,c=n.get(e),h=n.get(l);e.addEventListener("dispose",j),!0!==e.isWebGLMultipleRenderTargets&&(void 0===h.__webglTexture&&(h.__webglTexture=t.createTexture()),h.__version=l.version,a.memory.textures++);const u=!0===e.isWebGLCubeRenderTarget,d=!0===e.isWebGLMultipleRenderTargets,p=B(e)||o;if(u){c.__webglFramebuffer=[];for(let e=0;e<6;e++)c.__webglFramebuffer[e]=t.createFramebuffer()}else{if(c.__webglFramebuffer=t.createFramebuffer(),d)if(r.drawBuffers){const i=e.texture;for(let e=0,r=i.length;e<r;e++){const r=n.get(i[e]);void 0===r.__webglTexture&&(r.__webglTexture=t.createTexture(),a.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(o&&e.samples>0&&!1===rt(e)){const n=d?l:[l];c.__webglMultisampledFramebuffer=t.createFramebuffer(),c.__webglColorRenderbuffer=[],i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer);for(let i=0;i<n.length;i++){const r=n[i];c.__webglColorRenderbuffer[i]=t.createRenderbuffer(),t.bindRenderbuffer(36161,c.__webglColorRenderbuffer[i]);const a=s.convert(r.format,r.encoding),o=s.convert(r.type),l=G(r.internalFormat,a,o,r.encoding),h=nt(e);t.renderbufferStorageMultisample(36161,h,l,e.width,e.height),t.framebufferRenderbuffer(36160,36064+i,36161,c.__webglColorRenderbuffer[i])}t.bindRenderbuffer(36161,null),e.depthBuffer&&(c.__webglDepthRenderbuffer=t.createRenderbuffer(),et(c.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(36160,null)}}if(u){i.bindTexture(34067,h.__webglTexture),K(34067,l,p);for(let t=0;t<6;t++)tt(c.__webglFramebuffer[t],e,l,36064,34069+t);F(l,p)&&k(34067),i.unbindTexture()}else if(d){const t=e.texture;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=n.get(s);i.bindTexture(3553,a.__webglTexture),K(3553,s,p),tt(c.__webglFramebuffer,e,s,36064+r,3553),F(s,p)&&k(3553)}i.unbindTexture()}else{let t=3553;(e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(o?t=e.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),i.bindTexture(t,h.__webglTexture),K(t,l,p),tt(c.__webglFramebuffer,e,l,36064,t),F(l,p)&&k(t),i.unbindTexture()}e.depthBuffer&&it(e)},this.updateRenderTargetMipmap=function(t){const e=B(t)||o,r=!0===t.isWebGLMultipleRenderTargets?t.texture:[t.texture];for(let s=0,a=r.length;s<a;s++){const a=r[s];if(F(a,e)){const e=t.isWebGLCubeRenderTarget?34067:3553,r=n.get(a).__webglTexture;i.bindTexture(e,r),k(e),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(o&&e.samples>0&&!1===rt(e)){const r=e.isWebGLMultipleRenderTargets?e.texture:[e.texture],s=e.width,a=e.height;let o=16384;const l=[],c=e.stencilBuffer?33306:36096,h=n.get(e),u=!0===e.isWebGLMultipleRenderTargets;if(u)for(let e=0;e<r.length;e++)i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+e,36161,null),i.bindFramebuffer(36160,h.__webglFramebuffer),t.framebufferTexture2D(36009,36064+e,3553,null,0);i.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,h.__webglFramebuffer);for(let i=0;i<r.length;i++){l.push(36064+i),e.depthBuffer&&l.push(c);const d=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===d&&(e.depthBuffer&&(o|=256),e.stencilBuffer&&(o|=1024)),u&&t.framebufferRenderbuffer(36008,36064,36161,h.__webglColorRenderbuffer[i]),!0===d&&(t.invalidateFramebuffer(36008,[c]),t.invalidateFramebuffer(36009,[c])),u){const e=n.get(r[i]).__webglTexture;t.framebufferTexture2D(36009,36064,3553,e,0)}t.blitFramebuffer(0,0,s,a,0,0,s,a,o,9728),P&&t.invalidateFramebuffer(36008,l)}if(i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,null),u)for(let e=0;e<r.length;e++){i.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064+e,36161,h.__webglColorRenderbuffer[e]);const s=n.get(r[e]).__webglTexture;i.bindFramebuffer(36160,h.__webglFramebuffer),t.framebufferTexture2D(36009,36064+e,3553,s,0)}i.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=it,this.setupFrameBufferTexture=tt,this.useMultisampledRTT=rt}function ks(t,e,i){const n=i.isWebGL2;return{convert:function(i,r=null){let s;if(i===x)return 5121;if(1017===i)return 32819;if(1018===i)return 32820;if(1010===i)return 5120;if(1011===i)return 5122;if(i===_)return 5123;if(1013===i)return 5124;if(i===y)return 5125;if(i===M)return 5126;if(i===b)return n?5131:(s=e.get("OES_texture_half_float"),null!==s?s.HALF_FLOAT_OES:null);if(1021===i)return 6406;if(i===w)return 6408;if(1024===i)return 6409;if(1025===i)return 6410;if(i===T)return 6402;if(i===A)return 34041;if(1028===i)return 6403;if(1022===i)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(i===pt)return s=e.get("EXT_sRGB"),null!==s?s.SRGB_ALPHA_EXT:null;if(1029===i)return 36244;if(1030===i)return 33319;if(1031===i)return 33320;if(1033===i)return 36249;if(i===E||i===C||i===L||i===R)if(r===ot){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===E)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===C)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===L)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===R)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===E)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===C)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===L)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===R)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===P||i===I||i===D||i===N){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(i===P)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===I)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===D)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===N)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i)return s=e.get("WEBGL_compressed_texture_etc1"),null!==s?s.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===O||i===z){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(i===O)return r===ot?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===z)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(i===U||i===B||i===F||i===k||i===G||i===V||i===H||i===W||i===j||i===q||i===X||i===Y||i===Z||i===J){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(i===U)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===B)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===F)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===k)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===G)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===V)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===H)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===W)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===j)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===q)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===X)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===Y)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===Z)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===J)return r===ot?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===K){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(i===K)return r===ot?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}return i===S?n?34042:(s=e.get("WEBGL_depth_texture"),null!==s?s.UNSIGNED_INT_24_8_WEBGL:null):void 0!==t[i]?t[i]:null}}}class Gs extends an{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class Vs extends si{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Hs={type:"move"};class Ws{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Vs,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Vs,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ne,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ne),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Vs,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ne,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ne),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,r=null,s=null;const a=this._targetRay,o=this._grip,l=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(l&&t.hand){s=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const t=new Vs;t.matrixAutoUpdate=!1,t.visible=!1,l.joints[n.jointName]=t,l.add(t)}const r=l.joints[n.jointName];null!==t&&(r.matrix.fromArray(t.transform.matrix),r.matrix.decompose(r.position,r.rotation,r.scale),r.jointRadius=t.radius),r.visible=null!==t}const n=l.joints["index-finger-tip"],r=l.joints["thumb-tip"],a=n.position.distanceTo(r.position),o=.02,c=.005;l.inputState.pinching&&a>o+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!l.inputState.pinching&&a<=o-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==o&&t.gripSpace&&(r=e.getPose(t.gripSpace,i),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1));null!==a&&(n=e.getPose(t.targetRaySpace,i),null===n&&null!==r&&(n=r),null!==n&&(a.matrix.fromArray(n.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),n.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(n.linearVelocity)):a.hasLinearVelocity=!1,n.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(n.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(Hs)))}return null!==a&&(a.visible=null!==n),null!==o&&(o.visible=null!==r),null!==l&&(l.visible=null!==s),this}}class js extends Kt{constructor(t,e,i,n,r,s,a,o,l,c){if((c=void 0!==c?c:T)!==T&&c!==A)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===T&&(i=y),void 0===i&&c===A&&(i=S),super(null,n,r,s,a,o,c,i,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==a?a:d,this.minFilter=void 0!==o?o:d,this.flipY=!1,this.generateMipmaps=!1}}class qs extends mt{constructor(t,e){super();const i=this;let n=null,r=1,s=null,a="local-floor",o=null,l=null,c=null,h=null,u=null,d=null;const p=e.getContextAttributes();let m=null,f=null;const g=[],v=[],_=new an;_.layers.enable(1),_.viewport=new $t;const M=new an;M.layers.enable(2),M.viewport=new $t;const b=[_,M],E=new Gs;E.layers.enable(1),E.layers.enable(2);let C=null,L=null;function R(t){const e=v.indexOf(t.inputSource);if(-1===e)return;const i=g[e];void 0!==i&&i.dispatchEvent({type:t.type,data:t.inputSource})}function P(){n.removeEventListener("select",R),n.removeEventListener("selectstart",R),n.removeEventListener("selectend",R),n.removeEventListener("squeeze",R),n.removeEventListener("squeezestart",R),n.removeEventListener("squeezeend",R),n.removeEventListener("end",P),n.removeEventListener("inputsourceschange",I);for(let t=0;t<g.length;t++){const e=v[t];null!==e&&(v[t]=null,g[t].disconnect(e))}C=null,L=null,t.setRenderTarget(m),u=null,h=null,c=null,n=null,f=null,U.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function I(t){for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=v.indexOf(i);n>=0&&(v[n]=null,g[n].dispatchEvent({type:"disconnected",data:i}))}for(let e=0;e<t.added.length;e++){const i=t.added[e];let n=v.indexOf(i);if(-1===n){for(let t=0;t<g.length;t++){if(t>=v.length){v.push(i),n=t;break}if(null===v[t]){v[t]=i,n=t;break}}if(-1===n)break}const r=g[n];r&&r.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=g[t];return void 0===e&&(e=new Ws,g[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=g[t];return void 0===e&&(e=new Ws,g[t]=e),e.getGripSpace()},this.getHand=function(t){let e=g[t];return void 0===e&&(e=new Ws,g[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){r=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){a=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o||s},this.setReferenceSpace=function(t){o=t},this.getBaseLayer=function(){return null!==h?h:u},this.getBinding=function(){return c},this.getFrame=function(){return d},this.getSession=function(){return n},this.setSession=async function(l){if(n=l,null!==n){if(m=t.getRenderTarget(),n.addEventListener("select",R),n.addEventListener("selectstart",R),n.addEventListener("selectend",R),n.addEventListener("squeeze",R),n.addEventListener("squeezestart",R),n.addEventListener("squeezeend",R),n.addEventListener("end",P),n.addEventListener("inputsourceschange",I),!0!==p.xrCompatible&&await e.makeXRCompatible(),void 0===n.renderState.layers||!1===t.capabilities.isWebGL2){const i={antialias:void 0!==n.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:u}),f=new Qt(u.framebufferWidth,u.framebufferHeight,{format:w,type:x,encoding:t.outputEncoding,stencilBuffer:p.stencil})}else{let i=null,s=null,a=null;p.depth&&(a=p.stencil?35056:33190,i=p.stencil?A:T,s=p.stencil?S:y);const o={colorFormat:32856,depthFormat:a,scaleFactor:r};c=new XRWebGLBinding(n,e),h=c.createProjectionLayer(o),n.updateRenderState({layers:[h]}),f=new Qt(h.textureWidth,h.textureHeight,{format:w,type:x,depthTexture:new js(h.textureWidth,h.textureHeight,s,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:p.stencil,encoding:t.outputEncoding,samples:p.antialias?4:0});t.properties.get(f).__ignoreDepthValues=h.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(1),o=null,s=await n.requestReferenceSpace(a),U.setContext(n),U.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const D=new ne,N=new ne;function O(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;E.near=M.near=_.near=t.near,E.far=M.far=_.far=t.far,C===E.near&&L===E.far||(n.updateRenderState({depthNear:E.near,depthFar:E.far}),C=E.near,L=E.far);const e=t.parent,i=E.cameras;O(E,e);for(let t=0;t<i.length;t++)O(i[t],e);E.matrixWorld.decompose(E.position,E.quaternion,E.scale),t.matrix.copy(E.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale);const r=t.children;for(let t=0,e=r.length;t<e;t++)r[t].updateMatrixWorld(!0);2===i.length?function(t,e,i){D.setFromMatrixPosition(e.matrixWorld),N.setFromMatrixPosition(i.matrixWorld);const n=D.distanceTo(N),r=e.projectionMatrix.elements,s=i.projectionMatrix.elements,a=r[14]/(r[10]-1),o=r[14]/(r[10]+1),l=(r[9]+1)/r[5],c=(r[9]-1)/r[5],h=(r[8]-1)/r[0],u=(s[8]+1)/s[0],d=a*h,p=a*u,m=n/(-h+u),f=m*-h;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(f),t.translateZ(m),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const g=a+m,v=o+m,x=d-f,_=p+(n-f),y=l*o/v*g,M=c*o/v*g;t.projectionMatrix.makePerspective(x,_,y,M,g,v)}(E,_,M):E.projectionMatrix.copy(_.projectionMatrix)},this.getCamera=function(){return E},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(t){null!==h&&(h.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)};let z=null;const U=new xn;U.setAnimationLoop((function(e,i){if(l=i.getViewerPose(o||s),d=i,null!==l){const e=l.views;null!==u&&(t.setRenderTargetFramebuffer(f,u.framebuffer),t.setRenderTarget(f));let i=!1;e.length!==E.cameras.length&&(E.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const r=e[n];let s=null;if(null!==u)s=u.getViewport(r);else{const e=c.getViewSubImage(h,r);s=e.viewport,0===n&&(t.setRenderTargetTextures(f,e.colorTexture,h.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(f))}let a=b[n];void 0===a&&(a=new an,a.layers.enable(n),a.viewport=new $t,b[n]=a),a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(s.x,s.y,s.width,s.height),0===n&&E.matrix.copy(a.matrix),!0===i&&E.cameras.push(a)}}for(let t=0;t<g.length;t++){const e=v[t],n=g[t];null!==e&&void 0!==n&&n.update(e,i,o||s)}z&&z(e,i),d=null})),this.setAnimationLoop=function(t){z=t},this.dispose=function(){}}}function Xs(t,e){function i(i,n){i.opacity.value=n.opacity,n.color&&i.diffuse.value.copy(n.color),n.emissive&&i.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(i.map.value=n.map),n.alphaMap&&(i.alphaMap.value=n.alphaMap),n.bumpMap&&(i.bumpMap.value=n.bumpMap,i.bumpScale.value=n.bumpScale,1===n.side&&(i.bumpScale.value*=-1)),n.displacementMap&&(i.displacementMap.value=n.displacementMap,i.displacementScale.value=n.displacementScale,i.displacementBias.value=n.displacementBias),n.emissiveMap&&(i.emissiveMap.value=n.emissiveMap),n.normalMap&&(i.normalMap.value=n.normalMap,i.normalScale.value.copy(n.normalScale),1===n.side&&i.normalScale.value.negate()),n.specularMap&&(i.specularMap.value=n.specularMap),n.alphaTest>0&&(i.alphaTest.value=n.alphaTest);const r=e.get(n).envMap;if(r&&(i.envMap.value=r,i.flipEnvMap.value=r.isCubeTexture&&!1===r.isRenderTargetTexture?-1:1,i.reflectivity.value=n.reflectivity,i.ior.value=n.ior,i.refractionRatio.value=n.refractionRatio),n.lightMap){i.lightMap.value=n.lightMap;const e=!0!==t.physicallyCorrectLights?Math.PI:1;i.lightMapIntensity.value=n.lightMapIntensity*e}let s,a;n.aoMap&&(i.aoMap.value=n.aoMap,i.aoMapIntensity.value=n.aoMapIntensity),n.map?s=n.map:n.specularMap?s=n.specularMap:n.displacementMap?s=n.displacementMap:n.normalMap?s=n.normalMap:n.bumpMap?s=n.bumpMap:n.roughnessMap?s=n.roughnessMap:n.metalnessMap?s=n.metalnessMap:n.alphaMap?s=n.alphaMap:n.emissiveMap?s=n.emissiveMap:n.clearcoatMap?s=n.clearcoatMap:n.clearcoatNormalMap?s=n.clearcoatNormalMap:n.clearcoatRoughnessMap?s=n.clearcoatRoughnessMap:n.iridescenceMap?s=n.iridescenceMap:n.iridescenceThicknessMap?s=n.iridescenceThicknessMap:n.specularIntensityMap?s=n.specularIntensityMap:n.specularColorMap?s=n.specularColorMap:n.transmissionMap?s=n.transmissionMap:n.thicknessMap?s=n.thicknessMap:n.sheenColorMap?s=n.sheenColorMap:n.sheenRoughnessMap&&(s=n.sheenRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),i.uvTransform.value.copy(s.matrix)),n.aoMap?a=n.aoMap:n.lightMap&&(a=n.lightMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),i.uv2Transform.value.copy(a.matrix))}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,n,r,s,a){n.isMeshBasicMaterial||n.isMeshLambertMaterial?i(t,n):n.isMeshToonMaterial?(i(t,n),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,n)):n.isMeshPhongMaterial?(i(t,n),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,n)):n.isMeshStandardMaterial?(i(t,n),function(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap);i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap);e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}(t,n),n.isMeshPhysicalMaterial&&function(t,e,i){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap),e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate()));e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=i.texture,t.transmissionSamplerSize.value.set(i.width,i.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap);e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap)}(t,n,a)):n.isMeshMatcapMaterial?(i(t,n),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,n)):n.isMeshDepthMaterial?i(t,n):n.isMeshDistanceMaterial?(i(t,n),function(t,e){t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,n)):n.isMeshNormalMaterial?i(t,n):n.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,n),n.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,n)):n.isPointsMaterial?function(t,e,i,n){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*i,t.scale.value=.5*n,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let r;e.map?r=e.map:e.alphaMap&&(r=e.alphaMap);void 0!==r&&(!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix))}(t,n,r,s):n.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);e.alphaTest>0&&(t.alphaTest.value=e.alphaTest);let i;e.map?i=e.map:e.alphaMap&&(i=e.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uvTransform.value.copy(i.matrix))}(t,n):n.isShadowMaterial?(t.color.value.copy(n.color),t.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Ys(t,e,i,n){let r={},s={},a=[];const o=i.isWebGL2?t.getParameter(35375):0;function l(t,e,i){const n=t.value;if(void 0===i[e])return i[e]="number"==typeof n?n:n.clone(),!0;if("number"==typeof n){if(i[e]!==n)return i[e]=n,!0}else{const t=i[e];if(!1===t.equals(n))return t.copy(n),!0}return!1}function c(t){const e=t.value,i={boundary:0,storage:0};return"number"==typeof e?(i.boundary=4,i.storage=4):e.isVector2?(i.boundary=8,i.storage=8):e.isVector3||e.isColor?(i.boundary=16,i.storage=12):e.isVector4?(i.boundary=16,i.storage=16):e.isMatrix3?(i.boundary=48,i.storage=48):e.isMatrix4?(i.boundary=64,i.storage=64):e.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",e),i}function h(e){const i=e.target;i.removeEventListener("dispose",h);const n=a.indexOf(i.__bindingPointIndex);a.splice(n,1),t.deleteBuffer(r[i.id]),delete r[i.id],delete s[i.id]}return{bind:function(t,e){const i=e.program;n.uniformBlockBinding(t,i)},update:function(i,u){let d=r[i.id];void 0===d&&(!function(t){const e=t.uniforms;let i=0;const n=16;let r=0;for(let t=0,s=e.length;t<s;t++){const s=e[t],a=c(s);if(s.__data=new Float32Array(a.storage/Float32Array.BYTES_PER_ELEMENT),s.__offset=i,t>0){r=i%n;const t=n-r;0!==r&&t-a.boundary<0&&(i+=n-r,s.__offset=i)}i+=a.storage}r=i%n,r>0&&(i+=n-r);t.__size=i,t.__cache={}}(i),d=function(e){const i=function(){for(let t=0;t<o;t++)if(-1===a.indexOf(t))return a.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=i;const n=t.createBuffer(),r=e.__size,s=e.usage;return t.bindBuffer(35345,n),t.bufferData(35345,r,s),t.bindBuffer(35345,null),t.bindBufferBase(35345,i,n),n}(i),r[i.id]=d,i.addEventListener("dispose",h));const p=u.program;n.updateUBOMapping(i,p);const m=e.render.frame;s[i.id]!==m&&(!function(e){const i=r[e.id],n=e.uniforms,s=e.__cache;t.bindBuffer(35345,i);for(let e=0,i=n.length;e<i;e++){const i=n[e];if(!0===l(i,e,s)){const e=i.value,n=i.__offset;"number"==typeof e?(i.__data[0]=e,t.bufferSubData(35345,n,i.__data)):(i.value.isMatrix3?(i.__data[0]=i.value.elements[0],i.__data[1]=i.value.elements[1],i.__data[2]=i.value.elements[2],i.__data[3]=i.value.elements[0],i.__data[4]=i.value.elements[3],i.__data[5]=i.value.elements[4],i.__data[6]=i.value.elements[5],i.__data[7]=i.value.elements[0],i.__data[8]=i.value.elements[6],i.__data[9]=i.value.elements[7],i.__data[10]=i.value.elements[8],i.__data[11]=i.value.elements[0]):e.toArray(i.__data),t.bufferSubData(35345,n,i.__data))}}t.bindBuffer(35345,null)}(i),s[i.id]=m)},dispose:function(){for(const e in r)t.deleteBuffer(r[e]);a=[],r={},s={}}}}function Zs(t={}){this.isWebGLRenderer=!0;const e=void 0!==t.canvas?t.canvas:function(){const t=Nt("canvas");return t.style.display="block",t}(),i=void 0!==t.context?t.context:null,n=void 0===t.depth||t.depth,r=void 0===t.stencil||t.stencil,s=void 0!==t.antialias&&t.antialias,a=void 0===t.premultipliedAlpha||t.premultipliedAlpha,o=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,l=void 0!==t.powerPreference?t.powerPreference:"default",c=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let h;h=null!==i?i.getContextAttributes().alpha:void 0!==t.alpha&&t.alpha;let u=null,d=null;const p=[],m=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=at,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const f=this;let g=!1,_=0,y=0,S=null,T=-1,A=null;const E=new $t,C=new $t;let L=null,R=e.width,P=e.height,I=1,D=null,N=null;const O=new $t(0,0,R,P),z=new $t(0,0,R,P);let U=!1;const B=new vn;let F=!1,k=!1,G=null;const V=new Ne,H=new Lt,W=new ne,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function q(){return null===S?I:1}let X,Y,Z,J,K,$,Q,tt,et,it,nt,rt,st,ot,lt,ct,ht,ut,dt,pt,mt,ft,gt,vt,xt=i;function _t(t,i){for(let n=0;n<t.length;n++){const r=t[n],s=e.getContext(r,i);if(null!==s)return s}return null}try{const t={alpha:!0,depth:n,stencil:r,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:o,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r144"),e.addEventListener("webglcontextlost",bt,!1),e.addEventListener("webglcontextrestored",St,!1),e.addEventListener("webglcontextcreationerror",wt,!1),null===xt){const e=["webgl2","webgl","experimental-webgl"];if(!0===f.isWebGL1Renderer&&e.shift(),xt=_t(e,t),null===xt)throw _t(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===xt.getShaderPrecisionFormat&&(xt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function yt(){X=new qn(xt),Y=new En(xt,X,t),X.init(Y),ft=new ks(xt,X,Y),Z=new Bs(xt,X,Y),J=new Zn,K=new ws,$=new Fs(xt,X,Z,K,Y,ft,J),Q=new Ln(f),tt=new jn(f),et=new _n(xt,Y),gt=new Tn(xt,X,et,Y),it=new Xn(xt,et,J,gt),nt=new Qn(xt,it,et,J),dt=new $n(xt,Y,$),ct=new Cn(K),rt=new Ss(f,Q,tt,X,Y,gt,ct),st=new Xs(f,K),ot=new Cs,lt=new Ns(X,Y),ut=new wn(f,Q,Z,nt,h,a),ht=new Us(f,nt,Y),vt=new Ys(xt,J,Y,Z),pt=new An(xt,X,J,Y),mt=new Yn(xt,X,J,Y),J.programs=rt.programs,f.capabilities=Y,f.extensions=X,f.properties=K,f.renderLists=ot,f.shadowMap=ht,f.state=Z,f.info=J}yt();const Mt=new qs(f,xt);function bt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),g=!0}function St(){console.log("THREE.WebGLRenderer: Context Restored."),g=!1;const t=J.autoReset,e=ht.enabled,i=ht.autoUpdate,n=ht.needsUpdate,r=ht.type;yt(),J.autoReset=t,ht.enabled=e,ht.autoUpdate=i,ht.needsUpdate=n,ht.type=r}function wt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function At(t){const e=t.target;e.removeEventListener("dispose",At),function(t){(function(t){const e=K.get(t).programs;void 0!==e&&(e.forEach((function(t){rt.releaseProgram(t)})),t.isShaderMaterial&&rt.releaseShaderCache(t))})(t),K.remove(t)}(e)}this.xr=Mt,this.getContext=function(){return xt},this.getContextAttributes=function(){return xt.getContextAttributes()},this.forceContextLoss=function(){const t=X.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=X.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return I},this.setPixelRatio=function(t){void 0!==t&&(I=t,this.setSize(R,P,!1))},this.getSize=function(t){return t.set(R,P)},this.setSize=function(t,i,n){Mt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=t,P=i,e.width=Math.floor(t*I),e.height=Math.floor(i*I),!1!==n&&(e.style.width=t+"px",e.style.height=i+"px"),this.setViewport(0,0,t,i))},this.getDrawingBufferSize=function(t){return t.set(R*I,P*I).floor()},this.setDrawingBufferSize=function(t,i,n){R=t,P=i,I=n,e.width=Math.floor(t*n),e.height=Math.floor(i*n),this.setViewport(0,0,t,i)},this.getCurrentViewport=function(t){return t.copy(E)},this.getViewport=function(t){return t.copy(O)},this.setViewport=function(t,e,i,n){t.isVector4?O.set(t.x,t.y,t.z,t.w):O.set(t,e,i,n),Z.viewport(E.copy(O).multiplyScalar(I).floor())},this.getScissor=function(t){return t.copy(z)},this.setScissor=function(t,e,i,n){t.isVector4?z.set(t.x,t.y,t.z,t.w):z.set(t,e,i,n),Z.scissor(C.copy(z).multiplyScalar(I).floor())},this.getScissorTest=function(){return U},this.setScissorTest=function(t){Z.setScissorTest(U=t)},this.setOpaqueSort=function(t){D=t},this.setTransparentSort=function(t){N=t},this.getClearColor=function(t){return t.copy(ut.getClearColor())},this.setClearColor=function(){ut.setClearColor.apply(ut,arguments)},this.getClearAlpha=function(){return ut.getClearAlpha()},this.setClearAlpha=function(){ut.setClearAlpha.apply(ut,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;t&&(n|=16384),e&&(n|=256),i&&(n|=1024),xt.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",bt,!1),e.removeEventListener("webglcontextrestored",St,!1),e.removeEventListener("webglcontextcreationerror",wt,!1),ot.dispose(),lt.dispose(),K.dispose(),Q.dispose(),tt.dispose(),nt.dispose(),gt.dispose(),vt.dispose(),rt.dispose(),Mt.dispose(),Mt.removeEventListener("sessionstart",Ct),Mt.removeEventListener("sessionend",Rt),G&&(G.dispose(),G=null),Pt.stop()},this.renderBufferDirect=function(t,e,i,n,r,s){null===e&&(e=j);const a=r.isMesh&&r.matrixWorld.determinant()<0,o=function(t,e,i,n,r){!0!==e.isScene&&(e=j);$.resetTextureUnits();const s=e.fog,a=n.isMeshStandardMaterial?e.environment:null,o=null===S?f.outputEncoding:!0===S.isXRRenderTarget?S.texture.encoding:at,l=(n.isMeshStandardMaterial?tt:Q).get(n.envMap||a),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,h=!!n.normalMap&&!!i.attributes.tangent,u=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,m=!!i.morphAttributes.color,g=n.toneMapped?f.toneMapping:0,v=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,x=void 0!==v?v.length:0,_=K.get(n),y=d.state.lights;if(!0===F&&(!0===k||t!==A)){const e=t===A&&n.id===T;ct.setState(n,t,e)}let M=!1;n.version===_.__version?_.needsLights&&_.lightsStateVersion!==y.state.version||_.outputEncoding!==o||r.isInstancedMesh&&!1===_.instancing?M=!0:r.isInstancedMesh||!0!==_.instancing?r.isSkinnedMesh&&!1===_.skinning?M=!0:r.isSkinnedMesh||!0!==_.skinning?_.envMap!==l||!0===n.fog&&_.fog!==s?M=!0:void 0===_.numClippingPlanes||_.numClippingPlanes===ct.numPlanes&&_.numIntersection===ct.numIntersection?(_.vertexAlphas!==c||_.vertexTangents!==h||_.morphTargets!==u||_.morphNormals!==p||_.morphColors!==m||_.toneMapping!==g||!0===Y.isWebGL2&&_.morphTargetsCount!==x)&&(M=!0):M=!0:M=!0:M=!0:(M=!0,_.__version=n.version);let b=_.currentProgram;!0===M&&(b=Ut(n,e,r));let w=!1,E=!1,C=!1;const L=b.getUniforms(),R=_.uniforms;Z.useProgram(b.program)&&(w=!0,E=!0,C=!0);n.id!==T&&(T=n.id,E=!0);if(w||A!==t){if(L.setValue(xt,"projectionMatrix",t.projectionMatrix),Y.logarithmicDepthBuffer&&L.setValue(xt,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),A!==t&&(A=t,E=!0,C=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=L.map.cameraPosition;void 0!==e&&e.setValue(xt,W.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&L.setValue(xt,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||r.isSkinnedMesh)&&L.setValue(xt,"viewMatrix",t.matrixWorldInverse)}if(r.isSkinnedMesh){L.setOptional(xt,r,"bindMatrix"),L.setOptional(xt,r,"bindMatrixInverse");const t=r.skeleton;t&&(Y.floatVertexTextures?(null===t.boneTexture&&t.computeBoneTexture(),L.setValue(xt,"boneTexture",t.boneTexture,$),L.setValue(xt,"boneTextureSize",t.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const D=i.morphAttributes;(void 0!==D.position||void 0!==D.normal||void 0!==D.color&&!0===Y.isWebGL2)&&dt.update(r,i,n,b);(E||_.receiveShadow!==r.receiveShadow)&&(_.receiveShadow=r.receiveShadow,L.setValue(xt,"receiveShadow",r.receiveShadow));n.isMeshGouraudMaterial&&null!==n.envMap&&(R.envMap.value=l,R.flipEnvMap.value=l.isCubeTexture&&!1===l.isRenderTargetTexture?-1:1);E&&(L.setValue(xt,"toneMappingExposure",f.toneMappingExposure),_.needsLights&&(O=C,(N=R).ambientLightColor.needsUpdate=O,N.lightProbe.needsUpdate=O,N.directionalLights.needsUpdate=O,N.directionalLightShadows.needsUpdate=O,N.pointLights.needsUpdate=O,N.pointLightShadows.needsUpdate=O,N.spotLights.needsUpdate=O,N.spotLightShadows.needsUpdate=O,N.rectAreaLights.needsUpdate=O,N.hemisphereLights.needsUpdate=O),s&&!0===n.fog&&st.refreshFogUniforms(R,s),st.refreshMaterialUniforms(R,n,I,P,G),ns.upload(xt,_.uniformsList,R,$));var N,O;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(ns.upload(xt,_.uniformsList,R,$),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&L.setValue(xt,"center",r.center);if(L.setValue(xt,"modelViewMatrix",r.modelViewMatrix),L.setValue(xt,"normalMatrix",r.normalMatrix),L.setValue(xt,"modelMatrix",r.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){const t=n.uniformsGroups;for(let e=0,i=t.length;e<i;e++)if(Y.isWebGL2){const i=t[e];vt.update(i,b),vt.bind(i,b)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return b}(t,e,i,n,r);Z.setMaterial(n,a);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let h,u=1;!0===n.wireframe&&(l=it.getWireframeAttribute(i),u=2),gt.setup(r,n,o,i,l);let p=pt;null!==l&&(h=et.get(l),p=mt,p.setIndex(h));const m=null!==l?l.count:c.count,g=i.drawRange.start*u,v=i.drawRange.count*u,x=null!==s?s.start*u:0,_=null!==s?s.count*u:1/0,y=Math.max(g,x),M=Math.min(m,g+v,x+_)-1,b=Math.max(0,M-y+1);if(0!==b){if(r.isMesh)!0===n.wireframe?(Z.setLineWidth(n.wireframeLinewidth*q()),p.setMode(1)):p.setMode(4);else if(r.isLine){let t=n.linewidth;void 0===t&&(t=1),Z.setLineWidth(t*q()),r.isLineSegments?p.setMode(1):r.isLineLoop?p.setMode(2):p.setMode(3)}else r.isPoints?p.setMode(0):r.isSprite&&p.setMode(4);if(r.isInstancedMesh)p.renderInstances(y,b,r.count);else if(i.isInstancedBufferGeometry){const t=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(y,b,t)}else p.render(y,b)}},this.compile=function(t,e){function i(t,e,i){!0===t.transparent&&2===t.side?(t.side=1,t.needsUpdate=!0,Ut(t,e,i),t.side=0,t.needsUpdate=!0,Ut(t,e,i),t.side=2):Ut(t,e,i)}d=lt.get(t),d.init(),m.push(d),t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(d.pushLight(t),t.castShadow&&d.pushShadow(t))})),d.setupLights(f.physicallyCorrectLights),t.traverse((function(e){const n=e.material;if(n)if(Array.isArray(n))for(let r=0;r<n.length;r++){i(n[r],t,e)}else i(n,t,e)})),m.pop(),d=null};let Et=null;function Ct(){Pt.stop()}function Rt(){Pt.start()}const Pt=new xn;function It(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)d.pushLight(t),t.castShadow&&d.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||B.intersectsSprite(t)){n&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=nt.update(t),r=t.material;r.visible&&u.push(t,e,r,i,W.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(t.isSkinnedMesh&&t.skeleton.frame!==J.render.frame&&(t.skeleton.update(),t.skeleton.frame=J.render.frame),!t.frustumCulled||B.intersectsObject(t))){n&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(V);const e=nt.update(t),r=t.material;if(Array.isArray(r)){const n=e.groups;for(let s=0,a=n.length;s<a;s++){const a=n[s],o=r[a.materialIndex];o&&o.visible&&u.push(t,e,o,i,W.z,a)}}else r.visible&&u.push(t,e,r,i,W.z,null)}const r=t.children;for(let t=0,s=r.length;t<s;t++)It(r[t],e,i,n)}function Dt(t,e,i,n){const r=t.opaque,a=t.transmissive,o=t.transparent;d.setupLightsView(i),a.length>0&&function(t,e,i){const n=Y.isWebGL2;null===G&&(G=new Qt(1,1,{generateMipmaps:!0,type:X.has("EXT_color_buffer_half_float")?b:x,minFilter:v,samples:n&&!0===s?4:0}));f.getDrawingBufferSize(H),n?G.setSize(H.x,H.y):G.setSize(Tt(H.x),Tt(H.y));const r=f.getRenderTarget();f.setRenderTarget(G),f.clear();const a=f.toneMapping;f.toneMapping=0,Ot(t,e,i),f.toneMapping=a,$.updateMultisampleRenderTarget(G),$.updateRenderTargetMipmap(G),f.setRenderTarget(r)}(r,e,i),n&&Z.viewport(E.copy(n)),r.length>0&&Ot(r,e,i),a.length>0&&Ot(a,e,i),o.length>0&&Ot(o,e,i),Z.buffers.depth.setTest(!0),Z.buffers.depth.setMask(!0),Z.buffers.color.setMask(!0),Z.setPolygonOffset(!1)}function Ot(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let r=0,s=t.length;r<s;r++){const s=t[r],a=s.object,o=s.geometry,l=null===n?s.material:n,c=s.group;a.layers.test(i.layers)&&zt(a,e,i,o,l,c)}}function zt(t,e,i,n,r,s){t.onBeforeRender(f,e,i,n,r,s),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),r.onBeforeRender(f,e,i,n,t,s),!0===r.transparent&&2===r.side?(r.side=1,r.needsUpdate=!0,f.renderBufferDirect(i,e,n,r,t,s),r.side=0,r.needsUpdate=!0,f.renderBufferDirect(i,e,n,r,t,s),r.side=2):f.renderBufferDirect(i,e,n,r,t,s),t.onAfterRender(f,e,i,n,r,s)}function Ut(t,e,i){!0!==e.isScene&&(e=j);const n=K.get(t),r=d.state.lights,s=d.state.shadowsArray,a=r.state.version,o=rt.getParameters(t,r.state,s,e,i),l=rt.getProgramCacheKey(o);let c=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?tt:Q).get(t.envMap||n.environment),void 0===c&&(t.addEventListener("dispose",At),c=new Map,n.programs=c);let h=c.get(l);if(void 0!==h){if(n.currentProgram===h&&n.lightsStateVersion===a)return Bt(t,o),h}else o.uniforms=rt.getUniforms(t),t.onBuild(i,o,f),t.onBeforeCompile(o,f),h=rt.acquireProgram(o,l),c.set(l,h),n.uniforms=o.uniforms;const u=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(u.clippingPlanes=ct.uniform),Bt(t,o),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=a,n.needsLights&&(u.ambientLightColor.value=r.state.ambient,u.lightProbe.value=r.state.probe,u.directionalLights.value=r.state.directional,u.directionalLightShadows.value=r.state.directionalShadow,u.spotLights.value=r.state.spot,u.spotLightShadows.value=r.state.spotShadow,u.rectAreaLights.value=r.state.rectArea,u.ltc_1.value=r.state.rectAreaLTC1,u.ltc_2.value=r.state.rectAreaLTC2,u.pointLights.value=r.state.point,u.pointLightShadows.value=r.state.pointShadow,u.hemisphereLights.value=r.state.hemi,u.directionalShadowMap.value=r.state.directionalShadowMap,u.directionalShadowMatrix.value=r.state.directionalShadowMatrix,u.spotShadowMap.value=r.state.spotShadowMap,u.spotLightMatrix.value=r.state.spotLightMatrix,u.spotLightMap.value=r.state.spotLightMap,u.pointShadowMap.value=r.state.pointShadowMap,u.pointShadowMatrix.value=r.state.pointShadowMatrix);const p=h.getUniforms(),m=ns.seqWithValue(p.seq,u);return n.currentProgram=h,n.uniformsList=m,h}function Bt(t,e){const i=K.get(t);i.outputEncoding=e.outputEncoding,i.instancing=e.instancing,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Pt.setAnimationLoop((function(t){Et&&Et(t)})),"undefined"!=typeof self&&Pt.setContext(self),this.setAnimationLoop=function(t){Et=t,Mt.setAnimationLoop(t),null===t?Pt.stop():Pt.start()},Mt.addEventListener("sessionstart",Ct),Mt.addEventListener("sessionend",Rt),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===g)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===Mt.enabled&&!0===Mt.isPresenting&&(!0===Mt.cameraAutoUpdate&&Mt.updateCamera(e),e=Mt.getCamera()),!0===t.isScene&&t.onBeforeRender(f,t,e,S),d=lt.get(t,m.length),d.init(),m.push(d),V.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),B.setFromProjectionMatrix(V),k=this.localClippingEnabled,F=ct.init(this.clippingPlanes,k,e),u=ot.get(t,p.length),u.init(),p.push(u),It(t,e,0,f.sortObjects),u.finish(),!0===f.sortObjects&&u.sort(D,N),!0===F&&ct.beginShadows();const i=d.state.shadowsArray;if(ht.render(i,t,e),!0===F&&ct.endShadows(),!0===this.info.autoReset&&this.info.reset(),ut.render(u,t),d.setupLights(f.physicallyCorrectLights),e.isArrayCamera){const i=e.cameras;for(let e=0,n=i.length;e<n;e++){const n=i[e];Dt(u,t,n,n.viewport)}}else Dt(u,t,e);null!==S&&($.updateMultisampleRenderTarget(S),$.updateRenderTargetMipmap(S)),!0===t.isScene&&t.onAfterRender(f,t,e),gt.resetDefaultState(),T=-1,A=null,m.pop(),d=m.length>0?m[m.length-1]:null,p.pop(),u=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return _},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return S},this.setRenderTargetTextures=function(t,e,i){K.get(t.texture).__webglTexture=e,K.get(t.depthTexture).__webglTexture=i;const n=K.get(t);n.__hasExternalTextures=!0,n.__hasExternalTextures&&(n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===X.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(t,e){const i=K.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){S=t,_=e,y=i;let n=!0;if(t){const e=K.get(t);void 0!==e.__useDefaultFramebuffer?(Z.bindFramebuffer(36160,null),n=!1):void 0===e.__webglFramebuffer?$.setupRenderTarget(t):e.__hasExternalTextures&&$.rebindTextures(t,K.get(t.texture).__webglTexture,K.get(t.depthTexture).__webglTexture)}let r=null,s=!1,a=!1;if(t){const i=t.texture;(i.isData3DTexture||i.isDataArrayTexture)&&(a=!0);const n=K.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e],s=!0):r=Y.isWebGL2&&t.samples>0&&!1===$.useMultisampledRTT(t)?K.get(t).__webglMultisampledFramebuffer:n,E.copy(t.viewport),C.copy(t.scissor),L=t.scissorTest}else E.copy(O).multiplyScalar(I).floor(),C.copy(z).multiplyScalar(I).floor(),L=U;if(Z.bindFramebuffer(36160,r)&&Y.drawBuffers&&n&&Z.drawBuffers(t,r),Z.viewport(E),Z.scissor(C),Z.setScissorTest(L),s){const n=K.get(t.texture);xt.framebufferTexture2D(36160,36064,34069+e,n.__webglTexture,i)}else if(a){const n=K.get(t.texture),r=e||0;xt.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,r)}T=-1},this.readRenderTargetPixels=function(t,e,i,n,r,s,a){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let o=K.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==a&&(o=o[a]),o){Z.bindFramebuffer(36160,o);try{const a=t.texture,o=a.format,l=a.type;if(o!==w&&ft.convert(o)!==xt.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===b&&(X.has("EXT_color_buffer_half_float")||Y.isWebGL2&&X.has("EXT_color_buffer_float"));if(!(l===x||ft.convert(l)===xt.getParameter(35738)||l===M&&(Y.isWebGL2||X.has("OES_texture_float")||X.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-n&&i>=0&&i<=t.height-r&&xt.readPixels(e,i,n,r,ft.convert(o),ft.convert(l),s)}finally{const t=null!==S?K.get(S).__webglFramebuffer:null;Z.bindFramebuffer(36160,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){const n=Math.pow(2,-i),r=Math.floor(e.image.width*n),s=Math.floor(e.image.height*n);$.setTexture2D(e,0),xt.copyTexSubImage2D(3553,i,0,0,t.x,t.y,r,s),Z.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const r=e.image.width,s=e.image.height,a=ft.convert(i.format),o=ft.convert(i.type);$.setTexture2D(i,0),xt.pixelStorei(37440,i.flipY),xt.pixelStorei(37441,i.premultiplyAlpha),xt.pixelStorei(3317,i.unpackAlignment),e.isDataTexture?xt.texSubImage2D(3553,n,t.x,t.y,r,s,a,o,e.image.data):e.isCompressedTexture?xt.compressedTexSubImage2D(3553,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,a,e.mipmaps[0].data):xt.texSubImage2D(3553,n,t.x,t.y,a,o,e.image),0===n&&i.generateMipmaps&&xt.generateMipmap(3553),Z.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,r=0){if(f.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const s=t.max.x-t.min.x+1,a=t.max.y-t.min.y+1,o=t.max.z-t.min.z+1,l=ft.convert(n.format),c=ft.convert(n.type);let h;if(n.isData3DTexture)$.setTexture3D(n,0),h=32879;else{if(!n.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");$.setTexture2DArray(n,0),h=35866}xt.pixelStorei(37440,n.flipY),xt.pixelStorei(37441,n.premultiplyAlpha),xt.pixelStorei(3317,n.unpackAlignment);const u=xt.getParameter(3314),d=xt.getParameter(32878),p=xt.getParameter(3316),m=xt.getParameter(3315),g=xt.getParameter(32877),v=i.isCompressedTexture?i.mipmaps[0]:i.image;xt.pixelStorei(3314,v.width),xt.pixelStorei(32878,v.height),xt.pixelStorei(3316,t.min.x),xt.pixelStorei(3315,t.min.y),xt.pixelStorei(32877,t.min.z),i.isDataTexture||i.isData3DTexture?xt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,c,v.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),xt.compressedTexSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,v.data)):xt.texSubImage3D(h,r,e.x,e.y,e.z,s,a,o,l,c,v),xt.pixelStorei(3314,u),xt.pixelStorei(32878,d),xt.pixelStorei(3316,p),xt.pixelStorei(3315,m),xt.pixelStorei(32877,g),0===r&&n.generateMipmaps&&xt.generateMipmap(h),Z.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?$.setTextureCube(t,0):t.isData3DTexture?$.setTexture3D(t,0):t.isDataArrayTexture?$.setTexture2DArray(t,0):$.setTexture2D(t,0),Z.unbindTexture()},this.resetState=function(){_=0,y=0,S=null,Z.reset(),gt.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class Js extends Zs{}Js.prototype.isWebGL1Renderer=!0;class Ks{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new jt(t),this.density=e}clone(){return new Ks(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class $s{constructor(t,e=1,i=1e3){this.isFog=!0,this.name="",this.color=new jt(t),this.near=e,this.far=i}clone(){return new $s(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class Qs extends si{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),e}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(t){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=t}}class ta{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=ut,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=_t()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}setUsage(t){return this.usage=t,this}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,r=this.stride;n<r;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=_t()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=_t()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ea=new ne;class ia{constructor(t,e,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)ea.fromBufferAttribute(this,e),ea.applyMatrix4(t),this.setXYZ(e,ea.x,ea.y,ea.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)ea.fromBufferAttribute(this,e),ea.applyNormalMatrix(t),this.setXYZ(e,ea.x,ea.y,ea.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)ea.fromBufferAttribute(this,e),ea.transformDirection(t),this.setXYZ(e,ea.x,ea.y,ea.z);return this}setX(t,e){return this.normalized&&(e=Et(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=Et(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=Et(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=Et(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=At(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=At(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=At(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=At(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=Et(e,this.array),i=Et(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=Et(e,this.array),i=Et(i,this.array),n=Et(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,r){return t=t*this.data.stride+this.offset,this.normalized&&(e=Et(e,this.array),i=Et(i,this.array),n=Et(n,this.array),r=Et(r,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=r,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new bi(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new ia(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class na extends xi{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new jt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}let ra;const sa=new ne,aa=new ne,oa=new ne,la=new Lt,ca=new Lt,ha=new Ne,ua=new ne,da=new ne,pa=new ne,ma=new Lt,fa=new Lt,ga=new Lt;class va extends si{constructor(t){if(super(),this.isSprite=!0,this.type="Sprite",void 0===ra){ra=new Di;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),e=new ta(t,5);ra.setIndex([0,1,2,0,2,3]),ra.setAttribute("position",new ia(e,3,0,!1)),ra.setAttribute("uv",new ia(e,2,3,!1))}this.geometry=ra,this.material=void 0!==t?t:new na,this.center=new Lt(.5,.5)}raycast(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),aa.setFromMatrixScale(this.matrixWorld),ha.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),oa.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&aa.multiplyScalar(-oa.z);const i=this.material.rotation;let n,r;0!==i&&(r=Math.cos(i),n=Math.sin(i));const s=this.center;xa(ua.set(-.5,-.5,0),oa,s,aa,n,r),xa(da.set(.5,-.5,0),oa,s,aa,n,r),xa(pa.set(.5,.5,0),oa,s,aa,n,r),ma.set(0,0),fa.set(1,0),ga.set(1,1);let a=t.ray.intersectTriangle(ua,da,pa,!1,sa);if(null===a&&(xa(da.set(-.5,.5,0),oa,s,aa,n,r),fa.set(0,1),a=t.ray.intersectTriangle(ua,pa,da,!1,sa),null===a))return;const o=t.ray.origin.distanceTo(sa);o<t.near||o>t.far||e.push({distance:o,point:sa.clone(),uv:gi.getUV(sa,ua,da,pa,ma,fa,ga,new Lt),face:null,object:this})}copy(t,e){return super.copy(t,e),void 0!==t.center&&this.center.copy(t.center),this.material=t.material,this}}function xa(t,e,i,n,r,s){la.subVectors(t,i).addScalar(.5).multiply(n),void 0!==r?(ca.x=s*la.x-r*la.y,ca.y=r*la.x+s*la.y):ca.copy(la),t.copy(e),t.x+=ca.x,t.y+=ca.y,t.applyMatrix4(ha)}const _a=new ne,ya=new ne;class Ma extends si{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(t){super.copy(t,!1);const e=t.levels;for(let t=0,i=e.length;t<i;t++){const i=e[t];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=t.autoUpdate,this}addLevel(t,e=0){e=Math.abs(e);const i=this.levels;let n;for(n=0;n<i.length&&!(e<i[n].distance);n++);return i.splice(n,0,{distance:e,object:t}),this.add(t),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(t){const e=this.levels;if(e.length>0){let i,n;for(i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object}return null}raycast(t,e){if(this.levels.length>0){_a.setFromMatrixPosition(this.matrixWorld);const i=t.ray.origin.distanceTo(_a);this.getObjectForDistance(i).raycast(t,e)}}update(t){const e=this.levels;if(e.length>1){_a.setFromMatrixPosition(t.matrixWorld),ya.setFromMatrixPosition(this.matrixWorld);const i=_a.distanceTo(ya)/t.zoom;let n,r;for(e[0].object.visible=!0,n=1,r=e.length;n<r&&i>=e[n].distance;n++)e[n-1].object.visible=!1,e[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)e[n].object.visible=!1}}toJSON(t){const e=super.toJSON(t);!1===this.autoUpdate&&(e.object.autoUpdate=!1),e.object.levels=[];const i=this.levels;for(let t=0,n=i.length;t<n;t++){const n=i[t];e.object.levels.push({object:n.object.uuid,distance:n.distance})}return e}}const ba=new ne,Sa=new $t,wa=new $t,Ta=new ne,Aa=new Ne;class Ea extends Ki{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Ne,this.bindMatrixInverse=new Ne}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,this}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new $t,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(t,e){const i=this.skeleton,n=this.geometry;Sa.fromBufferAttribute(n.attributes.skinIndex,t),wa.fromBufferAttribute(n.attributes.skinWeight,t),ba.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=wa.getComponent(t);if(0!==n){const r=Sa.getComponent(t);Aa.multiplyMatrices(i.bones[r].matrixWorld,i.boneInverses[r]),e.addScaledVector(Ta.copy(ba).applyMatrix4(Aa),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}class Ca extends si{constructor(){super(),this.isBone=!0,this.type="Bone"}}class La extends Kt{constructor(t=null,e=1,i=1,n,r,s,a,o,l=1003,c=1003,h,u){super(null,s,a,o,l,c,n,r,h,u),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const Ra=new Ne,Pa=new Ne;class Ia{constructor(t=[],e=[]){this.uuid=_t(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new Ne)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new Ne;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,r=t.length;n<r;n++){const r=t[n]?t[n].matrixWorld:Pa;Ra.multiplyMatrices(r,e[n]),Ra.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Ia(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=wt(t),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new La(e,t,t,w,M);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this.boneTextureSize=t,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let r=e[n];void 0===r&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),r=new Ca),this.bones.push(r),this.boneInverses.push((new Ne).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,r=e.length;n<r;n++){const r=e[n];t.bones.push(r.uuid);const s=i[n];t.boneInverses.push(s.toArray())}return t}}class Da extends bi{constructor(t,e,i,n=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Na=new Ne,Oa=new Ne,za=[],Ua=new Ki;class Ba extends Ki{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Da(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}raycast(t,e){const i=this.matrixWorld,n=this.count;if(Ua.geometry=this.geometry,Ua.material=this.material,void 0!==Ua.material)for(let r=0;r<n;r++){this.getMatrixAt(r,Na),Oa.multiplyMatrices(i,Na),Ua.matrixWorld=Oa,Ua.raycast(t,za);for(let t=0,i=za.length;t<i;t++){const i=za[t];i.instanceId=r,i.object=this,e.push(i)}za.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Da(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Fa extends xi{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new jt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const ka=new ne,Ga=new ne,Va=new Ne,Ha=new De,Wa=new Te;class ja extends si{constructor(t=new Di,e=new Fa){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)ka.fromBufferAttribute(e,t-1),Ga.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=ka.distanceTo(Ga);t.setAttribute("lineDistance",new Ti(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Line.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Wa.copy(i.boundingSphere),Wa.applyMatrix4(n),Wa.radius+=r,!1===t.ray.intersectsSphere(Wa))return;Va.copy(n).invert(),Ha.copy(t.ray).applyMatrix4(Va);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=new ne,c=new ne,h=new ne,u=new ne,d=this.isLineSegments?2:1,p=i.index,m=i.attributes.position;if(null!==p){for(let i=Math.max(0,s.start),n=Math.min(p.count,s.start+s.count)-1;i<n;i+=d){const n=p.getX(i),r=p.getX(i+1);l.fromBufferAttribute(m,n),c.fromBufferAttribute(m,r);if(Ha.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const s=t.ray.origin.distanceTo(u);s<t.near||s>t.far||e.push({distance:s,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,s.start),n=Math.min(m.count,s.start+s.count)-1;i<n;i+=d){l.fromBufferAttribute(m,i),c.fromBufferAttribute(m,i+1);if(Ha.distanceSqToSegment(l,c,u,h)>o)continue;u.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(u);n<t.near||n>t.far||e.push({distance:n,point:h.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}const qa=new ne,Xa=new ne;class Ya extends ja{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)qa.fromBufferAttribute(e,t),Xa.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+qa.distanceTo(Xa);t.setAttribute("lineDistance",new Ti(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Za extends ja{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Ja extends xi{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new jt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Ka=new Ne,$a=new De,Qa=new Te,to=new ne;class eo extends si{constructor(t=new Di,e=new Ja){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,r=t.params.Points.threshold,s=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Qa.copy(i.boundingSphere),Qa.applyMatrix4(n),Qa.radius+=r,!1===t.ray.intersectsSphere(Qa))return;Ka.copy(n).invert(),$a.copy(t.ray).applyMatrix4(Ka);const a=r/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,l=i.index,c=i.attributes.position;if(null!==l){for(let i=Math.max(0,s.start),r=Math.min(l.count,s.start+s.count);i<r;i++){const r=l.getX(i);to.fromBufferAttribute(c,r),io(to,r,o,n,t,e,this)}}else{for(let i=Math.max(0,s.start),r=Math.min(c.count,s.start+s.count);i<r;i++)to.fromBufferAttribute(c,i),io(to,i,o,n,t,e,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function io(t,e,i,n,r,s,a){const o=$a.distanceSqToPoint(t);if(o<i){const i=new ne;$a.closestPointToPoint(t,i),i.applyMatrix4(n);const l=r.ray.origin.distanceTo(i);if(l<r.near||l>r.far)return;s.push({distance:l,distanceToRay:Math.sqrt(o),point:i,index:e,face:null,object:a})}}class no extends Kt{constructor(t,e,i,n,r,s,a,o,l,c,h,u){super(null,s,a,o,l,c,n,r,h,u),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class ro{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),r=0;e.push(0);for(let s=1;s<=t;s++)i=this.getPoint(s/t),r+=i.distanceTo(n),e.push(r),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const r=i.length;let s;s=e||t*i[r-1];let a,o=0,l=r-1;for(;o<=l;)if(n=Math.floor(o+(l-o)/2),a=i[n]-s,a<0)o=n+1;else{if(!(a>0)){l=n;break}l=n-1}if(n=l,i[n]===s)return n/(r-1);const c=i[n];return(n+(s-c)/(i[n+1]-c))/(r-1)}getTangent(t,e){const i=1e-4;let n=t-i,r=t+i;n<0&&(n=0),r>1&&(r=1);const s=this.getPoint(n),a=this.getPoint(r),o=e||(s.isVector2?new Lt:new ne);return o.copy(a).sub(s).normalize(),o}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new ne,n=[],r=[],s=[],a=new ne,o=new Ne;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new ne)}r[0]=new ne,s[0]=new ne;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),h=Math.abs(n[0].y),u=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),h<=l&&(l=h,i.set(0,1,0)),u<=l&&i.set(0,0,1),a.crossVectors(n[0],i).normalize(),r[0].crossVectors(n[0],a),s[0].crossVectors(n[0],r[0]);for(let e=1;e<=t;e++){if(r[e]=r[e-1].clone(),s[e]=s[e-1].clone(),a.crossVectors(n[e-1],n[e]),a.length()>Number.EPSILON){a.normalize();const t=Math.acos(yt(n[e-1].dot(n[e]),-1,1));r[e].applyMatrix4(o.makeRotationAxis(a,t))}s[e].crossVectors(n[e],r[e])}if(!0===e){let e=Math.acos(yt(r[0].dot(r[t]),-1,1));e/=t,n[0].dot(a.crossVectors(r[0],r[t]))>0&&(e=-e);for(let i=1;i<=t;i++)r[i].applyMatrix4(o.makeRotationAxis(n[i],e*i)),s[i].crossVectors(n[i],r[i])}return{tangents:n,normals:r,binormals:s}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class so extends ro{constructor(t=0,e=0,i=1,n=1,r=0,s=2*Math.PI,a=!1,o=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=s,this.aClockwise=a,this.aRotation=o}getPoint(t,e){const i=e||new Lt,n=2*Math.PI;let r=this.aEndAngle-this.aStartAngle;const s=Math.abs(r)<Number.EPSILON;for(;r<0;)r+=n;for(;r>n;)r-=n;r<Number.EPSILON&&(r=s?0:n),!0!==this.aClockwise||s||(r===n?r=-n:r-=n);const a=this.aStartAngle+t*r;let o=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=o-this.aX,n=l-this.aY;o=i*t-n*e+this.aX,l=i*e+n*t+this.aY}return i.set(o,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class ao extends so{constructor(t,e,i,n,r,s){super(t,e,i,i,n,r,s),this.isArcCurve=!0,this.type="ArcCurve"}}function oo(){let t=0,e=0,i=0,n=0;function r(r,s,a,o){t=r,e=a,i=-3*r+3*s-2*a-o,n=2*r-2*s+a+o}return{initCatmullRom:function(t,e,i,n,s){r(e,i,s*(i-t),s*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,s,a,o){let l=(e-t)/s-(i-t)/(s+a)+(i-e)/a,c=(i-e)/a-(n-e)/(a+o)+(n-i)/o;l*=a,c*=a,r(e,i,l,c)},calc:function(r){const s=r*r;return t+e*r+i*s+n*(s*r)}}}const lo=new ne,co=new oo,ho=new oo,uo=new oo;class po extends ro{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new ne){const i=e,n=this.points,r=n.length,s=(r-(this.closed?0:1))*t;let a,o,l=Math.floor(s),c=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/r)+1)*r:0===c&&l===r-1&&(l=r-2,c=1),this.closed||l>0?a=n[(l-1)%r]:(lo.subVectors(n[0],n[1]).add(n[0]),a=lo);const h=n[l%r],u=n[(l+1)%r];if(this.closed||l+2<r?o=n[(l+2)%r]:(lo.subVectors(n[r-1],n[r-2]).add(n[r-1]),o=lo),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(a.distanceToSquared(h),t),i=Math.pow(h.distanceToSquared(u),t),n=Math.pow(u.distanceToSquared(o),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),co.initNonuniformCatmullRom(a.x,h.x,u.x,o.x,e,i,n),ho.initNonuniformCatmullRom(a.y,h.y,u.y,o.y,e,i,n),uo.initNonuniformCatmullRom(a.z,h.z,u.z,o.z,e,i,n)}else"catmullrom"===this.curveType&&(co.initCatmullRom(a.x,h.x,u.x,o.x,this.tension),ho.initCatmullRom(a.y,h.y,u.y,o.y,this.tension),uo.initCatmullRom(a.z,h.z,u.z,o.z,this.tension));return i.set(co.calc(c),ho.calc(c),uo.calc(c)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new ne).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function mo(t,e,i,n,r){const s=.5*(n-e),a=.5*(r-i),o=t*t;return(2*i-2*n+s+a)*(t*o)+(-3*i+3*n-2*s-a)*o+s*t+i}function fo(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function go(t,e,i,n,r){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,r)}class vo extends ro{constructor(t=new Lt,e=new Lt,i=new Lt,n=new Lt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Lt){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(go(t,n.x,r.x,s.x,a.x),go(t,n.y,r.y,s.y,a.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class xo extends ro{constructor(t=new ne,e=new ne,i=new ne,n=new ne){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new ne){const i=e,n=this.v0,r=this.v1,s=this.v2,a=this.v3;return i.set(go(t,n.x,r.x,s.x,a.x),go(t,n.y,r.y,s.y,a.y),go(t,n.z,r.z,s.z,a.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class _o extends ro{constructor(t=new Lt,e=new Lt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Lt){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e){const i=e||new Lt;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class yo extends ro{constructor(t=new ne,e=new ne){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new ne){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Mo extends ro{constructor(t=new Lt,e=new Lt,i=new Lt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Lt){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(fo(t,n.x,r.x,s.x),fo(t,n.y,r.y,s.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class bo extends ro{constructor(t=new ne,e=new ne,i=new ne){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new ne){const i=e,n=this.v0,r=this.v1,s=this.v2;return i.set(fo(t,n.x,r.x,s.x),fo(t,n.y,r.y,s.y),fo(t,n.z,r.z,s.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class So extends ro{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Lt){const i=e,n=this.points,r=(n.length-1)*t,s=Math.floor(r),a=r-s,o=n[0===s?s:s-1],l=n[s],c=n[s>n.length-2?n.length-1:s+1],h=n[s>n.length-3?n.length-1:s+2];return i.set(mo(a,o.x,l.x,c.x,h.x),mo(a,o.y,l.y,c.y,h.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Lt).fromArray(i))}return this}}var wo=Object.freeze({__proto__:null,ArcCurve:ao,CatmullRomCurve3:po,CubicBezierCurve:vo,CubicBezierCurve3:xo,EllipseCurve:so,LineCurve:_o,LineCurve3:yo,QuadraticBezierCurve:Mo,QuadraticBezierCurve3:bo,SplineCurve:So});class To extends ro{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new _o(e,t))}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let r=0;for(;r<n.length;){if(n[r]>=i){const t=n[r]-i,s=this.curves[r],a=s.getLength(),o=0===a?0:1-t/a;return s.getPointAt(o,e)}r++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,r=this.curves;n<r.length;n++){const s=r[n],a=s.isEllipseCurve?2*t:s.isLineCurve||s.isLineCurve3?1:s.isSplineCurve?t*s.points.length:t,o=s.getPoints(a);for(let t=0;t<o.length;t++){const n=o[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new wo[i.type]).fromJSON(i))}return this}}class Ao extends To{constructor(t){super(),this.type="Path",this.currentPoint=new Lt,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new _o(this.currentPoint.clone(),new Lt(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const r=new Mo(this.currentPoint.clone(),new Lt(t,e),new Lt(i,n));return this.curves.push(r),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,r,s){const a=new vo(this.currentPoint.clone(),new Lt(t,e),new Lt(i,n),new Lt(r,s));return this.curves.push(a),this.currentPoint.set(r,s),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new So(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,r,s){const a=this.currentPoint.x,o=this.currentPoint.y;return this.absarc(t+a,e+o,i,n,r,s),this}absarc(t,e,i,n,r,s){return this.absellipse(t,e,i,i,n,r,s),this}ellipse(t,e,i,n,r,s,a,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+l,e+c,i,n,r,s,a,o),this}absellipse(t,e,i,n,r,s,a,o){const l=new so(t,e,i,n,r,s,a,o);if(this.curves.length>0){const t=l.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Eo extends Di{constructor(t=[new Lt(0,-.5),new Lt(.5,0),new Lt(0,.5)],e=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:i,phiLength:n},e=Math.floor(e),n=yt(n,0,2*Math.PI);const r=[],s=[],a=[],o=[],l=[],c=1/e,h=new ne,u=new Lt,d=new ne,p=new ne,m=new ne;let f=0,g=0;for(let e=0;e<=t.length-1;e++)switch(e){case 0:f=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-f,d.z=0*g,m.copy(d),d.normalize(),o.push(d.x,d.y,d.z);break;case t.length-1:o.push(m.x,m.y,m.z);break;default:f=t[e+1].x-t[e].x,g=t[e+1].y-t[e].y,d.x=1*g,d.y=-f,d.z=0*g,p.copy(d),d.x+=m.x,d.y+=m.y,d.z+=m.z,d.normalize(),o.push(d.x,d.y,d.z),m.copy(p)}for(let r=0;r<=e;r++){const d=i+r*c*n,p=Math.sin(d),m=Math.cos(d);for(let i=0;i<=t.length-1;i++){h.x=t[i].x*p,h.y=t[i].y,h.z=t[i].x*m,s.push(h.x,h.y,h.z),u.x=r/e,u.y=i/(t.length-1),a.push(u.x,u.y);const n=o[3*i+0]*p,c=o[3*i+1],d=o[3*i+0]*m;l.push(n,c,d)}}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const n=e+i*t.length,s=n,a=n+t.length,o=n+t.length+1,l=n+1;r.push(s,a,l),r.push(o,l,a)}this.setIndex(r),this.setAttribute("position",new Ti(s,3)),this.setAttribute("uv",new Ti(a,2)),this.setAttribute("normal",new Ti(l,3))}static fromJSON(t){return new Eo(t.points,t.segments,t.phiStart,t.phiLength)}}class Co extends Eo{constructor(t=1,e=1,i=4,n=8){const r=new Ao;r.absarc(0,-e/2,t,1.5*Math.PI,0),r.absarc(0,e/2,t,0,.5*Math.PI),super(r.getPoints(i),n),this.type="CapsuleGeometry",this.parameters={radius:t,height:e,capSegments:i,radialSegments:n}}static fromJSON(t){return new Co(t.radius,t.length,t.capSegments,t.radialSegments)}}class Lo extends Di{constructor(t=1,e=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:i,thetaLength:n},e=Math.max(3,e);const r=[],s=[],a=[],o=[],l=new ne,c=new Lt;s.push(0,0,0),a.push(0,0,1),o.push(.5,.5);for(let r=0,h=3;r<=e;r++,h+=3){const u=i+r/e*n;l.x=t*Math.cos(u),l.y=t*Math.sin(u),s.push(l.x,l.y,l.z),a.push(0,0,1),c.x=(s[h]/t+1)/2,c.y=(s[h+1]/t+1)/2,o.push(c.x,c.y)}for(let t=1;t<=e;t++)r.push(t,t+1,0);this.setIndex(r),this.setAttribute("position",new Ti(s,3)),this.setAttribute("normal",new Ti(a,3)),this.setAttribute("uv",new Ti(o,2))}static fromJSON(t){return new Lo(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Ro extends Di{constructor(t=1,e=1,i=1,n=8,r=1,s=!1,a=0,o=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:i,radialSegments:n,heightSegments:r,openEnded:s,thetaStart:a,thetaLength:o};const l=this;n=Math.floor(n),r=Math.floor(r);const c=[],h=[],u=[],d=[];let p=0;const m=[],f=i/2;let g=0;function v(i){const r=p,s=new Lt,m=new ne;let v=0;const x=!0===i?t:e,_=!0===i?1:-1;for(let t=1;t<=n;t++)h.push(0,f*_,0),u.push(0,_,0),d.push(.5,.5),p++;const y=p;for(let t=0;t<=n;t++){const e=t/n*o+a,i=Math.cos(e),r=Math.sin(e);m.x=x*r,m.y=f*_,m.z=x*i,h.push(m.x,m.y,m.z),u.push(0,_,0),s.x=.5*i+.5,s.y=.5*r*_+.5,d.push(s.x,s.y),p++}for(let t=0;t<n;t++){const e=r+t,n=y+t;!0===i?c.push(n,n+1,e):c.push(n+1,n,e),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}!function(){const s=new ne,v=new ne;let x=0;const _=(e-t)/i;for(let l=0;l<=r;l++){const c=[],g=l/r,x=g*(e-t)+t;for(let t=0;t<=n;t++){const e=t/n,r=e*o+a,l=Math.sin(r),m=Math.cos(r);v.x=x*l,v.y=-g*i+f,v.z=x*m,h.push(v.x,v.y,v.z),s.set(l,_,m).normalize(),u.push(s.x,s.y,s.z),d.push(e,1-g),c.push(p++)}m.push(c)}for(let t=0;t<n;t++)for(let e=0;e<r;e++){const i=m[e][t],n=m[e+1][t],r=m[e+1][t+1],s=m[e][t+1];c.push(i,n,s),c.push(n,r,s),x+=6}l.addGroup(g,x,0),g+=x}(),!1===s&&(t>0&&v(!0),e>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Ti(h,3)),this.setAttribute("normal",new Ti(u,3)),this.setAttribute("uv",new Ti(d,2))}static fromJSON(t){return new Ro(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Po extends Ro{constructor(t=1,e=1,i=8,n=1,r=!1,s=0,a=2*Math.PI){super(0,t,e,i,n,r,s,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:s,thetaLength:a}}static fromJSON(t){return new Po(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Io extends Di{constructor(t=[],e=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:i,detail:n};const r=[],s=[];function a(t,e,i,n){const r=n+1,s=[];for(let n=0;n<=r;n++){s[n]=[];const a=t.clone().lerp(i,n/r),o=e.clone().lerp(i,n/r),l=r-n;for(let t=0;t<=l;t++)s[n][t]=0===t&&n===r?a:a.clone().lerp(o,t/l)}for(let t=0;t<r;t++)for(let e=0;e<2*(r-t)-1;e++){const i=Math.floor(e/2);e%2==0?(o(s[t][i+1]),o(s[t+1][i]),o(s[t][i])):(o(s[t][i+1]),o(s[t+1][i+1]),o(s[t+1][i]))}}function o(t){r.push(t.x,t.y,t.z)}function l(e,i){const n=3*e;i.x=t[n+0],i.y=t[n+1],i.z=t[n+2]}function c(t,e,i,n){n<0&&1===t.x&&(s[e]=t.x-1),0===i.x&&0===i.z&&(s[e]=n/2/Math.PI+.5)}function h(t){return Math.atan2(t.z,-t.x)}!function(t){const i=new ne,n=new ne,r=new ne;for(let s=0;s<e.length;s+=3)l(e[s+0],i),l(e[s+1],n),l(e[s+2],r),a(i,n,r,t)}(n),function(t){const e=new ne;for(let i=0;i<r.length;i+=3)e.x=r[i+0],e.y=r[i+1],e.z=r[i+2],e.normalize().multiplyScalar(t),r[i+0]=e.x,r[i+1]=e.y,r[i+2]=e.z}(i),function(){const t=new ne;for(let i=0;i<r.length;i+=3){t.x=r[i+0],t.y=r[i+1],t.z=r[i+2];const n=h(t)/2/Math.PI+.5,a=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);s.push(n,1-a)}var e;(function(){const t=new ne,e=new ne,i=new ne,n=new ne,a=new Lt,o=new Lt,l=new Lt;for(let u=0,d=0;u<r.length;u+=9,d+=6){t.set(r[u+0],r[u+1],r[u+2]),e.set(r[u+3],r[u+4],r[u+5]),i.set(r[u+6],r[u+7],r[u+8]),a.set(s[d+0],s[d+1]),o.set(s[d+2],s[d+3]),l.set(s[d+4],s[d+5]),n.copy(t).add(e).add(i).divideScalar(3);const p=h(n);c(a,d+0,t,p),c(o,d+2,e,p),c(l,d+4,i,p)}})(),function(){for(let t=0;t<s.length;t+=6){const e=s[t+0],i=s[t+2],n=s[t+4],r=Math.max(e,i,n),a=Math.min(e,i,n);r>.9&&a<.1&&(e<.2&&(s[t+0]+=1),i<.2&&(s[t+2]+=1),n<.2&&(s[t+4]+=1))}}()}(),this.setAttribute("position",new Ti(r,3)),this.setAttribute("normal",new Ti(r.slice(),3)),this.setAttribute("uv",new Ti(s,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(t){return new Io(t.vertices,t.indices,t.radius,t.details)}}class Do extends Io{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Do(t.radius,t.detail)}}const No=new ne,Oo=new ne,zo=new ne,Uo=new gi;class Bo extends Di{constructor(t=null,e=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:t,thresholdAngle:e},null!==t){const i=4,n=Math.pow(10,i),r=Math.cos(vt*e),s=t.getIndex(),a=t.getAttribute("position"),o=s?s.count:a.count,l=[0,0,0],c=["a","b","c"],h=new Array(3),u={},d=[];for(let t=0;t<o;t+=3){s?(l[0]=s.getX(t),l[1]=s.getX(t+1),l[2]=s.getX(t+2)):(l[0]=t,l[1]=t+1,l[2]=t+2);const{a:e,b:i,c:o}=Uo;if(e.fromBufferAttribute(a,l[0]),i.fromBufferAttribute(a,l[1]),o.fromBufferAttribute(a,l[2]),Uo.getNormal(zo),h[0]=`${Math.round(e.x*n)},${Math.round(e.y*n)},${Math.round(e.z*n)}`,h[1]=`${Math.round(i.x*n)},${Math.round(i.y*n)},${Math.round(i.z*n)}`,h[2]=`${Math.round(o.x*n)},${Math.round(o.y*n)},${Math.round(o.z*n)}`,h[0]!==h[1]&&h[1]!==h[2]&&h[2]!==h[0])for(let t=0;t<3;t++){const e=(t+1)%3,i=h[t],n=h[e],s=Uo[c[t]],a=Uo[c[e]],o=`${i}_${n}`,p=`${n}_${i}`;p in u&&u[p]?(zo.dot(u[p].normal)<=r&&(d.push(s.x,s.y,s.z),d.push(a.x,a.y,a.z)),u[p]=null):o in u||(u[o]={index0:l[t],index1:l[e],normal:zo.clone()})}}for(const t in u)if(u[t]){const{index0:e,index1:i}=u[t];No.fromBufferAttribute(a,e),Oo.fromBufferAttribute(a,i),d.push(No.x,No.y,No.z),d.push(Oo.x,Oo.y,Oo.z)}this.setAttribute("position",new Ti(d,3))}}}class Fo extends Ao{constructor(t){super(t),this.uuid=_t(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new Ao).fromJSON(i))}return this}}const ko=function(t,e,i=2){const n=e&&e.length,r=n?e[0]*i:t.length;let s=Go(t,0,r,i,!0);const a=[];if(!s||s.next===s.prev)return a;let o,l,c,h,u,d,p;if(n&&(s=function(t,e,i,n){const r=[];let s,a,o,l,c;for(s=0,a=e.length;s<a;s++)o=e[s]*n,l=s<a-1?e[s+1]*n:t.length,c=Go(t,o,l,n,!1),c===c.next&&(c.steiner=!0),r.push($o(c));for(r.sort(Yo),s=0;s<r.length;s++)Zo(r[s],i),i=Vo(i,i.next);return i}(t,e,s,i)),t.length>80*i){o=c=t[0],l=h=t[1];for(let e=i;e<r;e+=i)u=t[e],d=t[e+1],u<o&&(o=u),d<l&&(l=d),u>c&&(c=u),d>h&&(h=d);p=Math.max(c-o,h-l),p=0!==p?1/p:0}return Ho(s,a,i,o,l,p),a};function Go(t,e,i,n,r){let s,a;if(r===function(t,e,i,n){let r=0;for(let s=e,a=i-n;s<i;s+=n)r+=(t[a]-t[s])*(t[s+1]+t[a+1]),a=s;return r}(t,e,i,n)>0)for(s=e;s<i;s+=n)a=ll(s,t[s],t[s+1],a);else for(s=i-n;s>=e;s-=n)a=ll(s,t[s],t[s+1],a);return a&&il(a,a.next)&&(cl(a),a=a.next),a}function Vo(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!il(n,n.next)&&0!==el(n.prev,n,n.next))n=n.next;else{if(cl(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function Ho(t,e,i,n,r,s,a){if(!t)return;!a&&s&&function(t,e,i,n){let r=t;do{null===r.z&&(r.z=Ko(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,i,n,r,s,a,o,l,c=1;do{for(i=t,t=null,s=null,a=0;i;){for(a++,n=i,o=0,e=0;e<c&&(o++,n=n.nextZ,n);e++);for(l=c;o>0||l>0&&n;)0!==o&&(0===l||!n||i.z<=n.z)?(r=i,i=i.nextZ,o--):(r=n,n=n.nextZ,l--),s?s.nextZ=r:t=r,r.prevZ=s,s=r;i=n}s.nextZ=null,c*=2}while(a>1)}(r)}(t,n,r,s);let o,l,c=t;for(;t.prev!==t.next;)if(o=t.prev,l=t.next,s?jo(t,n,r,s):Wo(t))e.push(o.i/i),e.push(t.i/i),e.push(l.i/i),cl(t),t=l.next,c=l.next;else if((t=l)===c){a?1===a?Ho(t=qo(Vo(t),e,i),e,i,n,r,s,2):2===a&&Xo(t,e,i,n,r,s):Ho(Vo(t),e,i,n,r,s,1);break}}function Wo(t){const e=t.prev,i=t,n=t.next;if(el(e,i,n)>=0)return!1;let r=t.next.next;for(;r!==t.prev;){if(Qo(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&el(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function jo(t,e,i,n){const r=t.prev,s=t,a=t.next;if(el(r,s,a)>=0)return!1;const o=r.x<s.x?r.x<a.x?r.x:a.x:s.x<a.x?s.x:a.x,l=r.y<s.y?r.y<a.y?r.y:a.y:s.y<a.y?s.y:a.y,c=r.x>s.x?r.x>a.x?r.x:a.x:s.x>a.x?s.x:a.x,h=r.y>s.y?r.y>a.y?r.y:a.y:s.y>a.y?s.y:a.y,u=Ko(o,l,e,i,n),d=Ko(c,h,e,i,n);let p=t.prevZ,m=t.nextZ;for(;p&&p.z>=u&&m&&m.z<=d;){if(p!==t.prev&&p!==t.next&&Qo(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&el(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==t.prev&&m!==t.next&&Qo(r.x,r.y,s.x,s.y,a.x,a.y,m.x,m.y)&&el(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=u;){if(p!==t.prev&&p!==t.next&&Qo(r.x,r.y,s.x,s.y,a.x,a.y,p.x,p.y)&&el(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=d;){if(m!==t.prev&&m!==t.next&&Qo(r.x,r.y,s.x,s.y,a.x,a.y,m.x,m.y)&&el(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function qo(t,e,i){let n=t;do{const r=n.prev,s=n.next.next;!il(r,s)&&nl(r,n,n.next,s)&&al(r,s)&&al(s,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(s.i/i),cl(n),cl(n.next),n=t=s),n=n.next}while(n!==t);return Vo(n)}function Xo(t,e,i,n,r,s){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.i!==t.i&&tl(a,t)){let o=ol(a,t);return a=Vo(a,a.next),o=Vo(o,o.next),Ho(a,e,i,n,r,s),void Ho(o,e,i,n,r,s)}t=t.next}a=a.next}while(a!==t)}function Yo(t,e){return t.x-e.x}function Zo(t,e){if(e=function(t,e){let i=e;const n=t.x,r=t.y;let s,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=n&&t>a){if(a=t,t===n){if(r===i.y)return i;if(r===i.next.y)return i.next}s=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!s)return null;if(n===a)return s;const o=s,l=s.x,c=s.y;let h,u=1/0;i=s;do{n>=i.x&&i.x>=l&&n!==i.x&&Qo(r<c?n:a,r,l,c,r<c?a:n,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(n-i.x),al(i,t)&&(h<u||h===u&&(i.x>s.x||i.x===s.x&&Jo(s,i)))&&(s=i,u=h)),i=i.next}while(i!==o);return s}(t,e),e){const i=ol(e,t);Vo(e,e.next),Vo(i,i.next)}}function Jo(t,e){return el(t.prev,t,e.prev)<0&&el(e.next,t,t.next)<0}function Ko(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $o(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Qo(t,e,i,n,r,s,a,o){return(r-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(n-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(r-a)*(n-o)>=0}function tl(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&nl(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(al(t,e)&&al(e,t)&&function(t,e){let i=t,n=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{i.y>s!=i.next.y>s&&i.next.y!==i.y&&r<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(el(t.prev,t,e.prev)||el(t,e.prev,e))||il(t,e)&&el(t.prev,t,t.next)>0&&el(e.prev,e,e.next)>0)}function el(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function il(t,e){return t.x===e.x&&t.y===e.y}function nl(t,e,i,n){const r=sl(el(t,e,i)),s=sl(el(t,e,n)),a=sl(el(i,n,t)),o=sl(el(i,n,e));return r!==s&&a!==o||(!(0!==r||!rl(t,i,e))||(!(0!==s||!rl(t,n,e))||(!(0!==a||!rl(i,t,n))||!(0!==o||!rl(i,e,n)))))}function rl(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function sl(t){return t>0?1:t<0?-1:0}function al(t,e){return el(t.prev,t,t.next)<0?el(t,e,t.next)>=0&&el(t,t.prev,e)>=0:el(t,e,t.prev)<0||el(t,t.next,e)<0}function ol(t,e){const i=new hl(t.i,t.x,t.y),n=new hl(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,s.next=n,n.prev=s,n}function ll(t,e,i,n){const r=new hl(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function cl(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function hl(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ul{static area(t){const e=t.length;let i=0;for(let n=e-1,r=0;r<e;n=r++)i+=t[n].x*t[r].y-t[r].x*t[n].y;return.5*i}static isClockWise(t){return ul.area(t)<0}static triangulateShape(t,e){const i=[],n=[],r=[];dl(t),pl(i,t);let s=t.length;e.forEach(dl);for(let t=0;t<e.length;t++)n.push(s),s+=e[t].length,pl(i,e[t]);const a=ko(i,n);for(let t=0;t<a.length;t+=3)r.push(a.slice(t,t+3));return r}}function dl(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function pl(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class ml extends Di{constructor(t=new Fo([new Lt(.5,.5),new Lt(-.5,.5),new Lt(-.5,-.5),new Lt(.5,-.5)]),e={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const i=this,n=[],r=[];for(let e=0,i=t.length;e<i;e++){s(t[e])}function s(t){const s=[],a=void 0!==e.curveSegments?e.curveSegments:12,o=void 0!==e.steps?e.steps:1,l=void 0!==e.depth?e.depth:1;let c=void 0===e.bevelEnabled||e.bevelEnabled,h=void 0!==e.bevelThickness?e.bevelThickness:.2,u=void 0!==e.bevelSize?e.bevelSize:h-.1,d=void 0!==e.bevelOffset?e.bevelOffset:0,p=void 0!==e.bevelSegments?e.bevelSegments:3;const m=e.extrudePath,f=void 0!==e.UVGenerator?e.UVGenerator:fl;let g,v,x,_,y,M=!1;m&&(g=m.getSpacedPoints(o),M=!0,c=!1,v=m.computeFrenetFrames(o,!1),x=new ne,_=new ne,y=new ne),c||(p=0,h=0,u=0,d=0);const b=t.extractPoints(a);let S=b.shape;const w=b.holes;if(!ul.isClockWise(S)){S=S.reverse();for(let t=0,e=w.length;t<e;t++){const e=w[t];ul.isClockWise(e)&&(w[t]=e.reverse())}}const T=ul.triangulateShape(S,w),A=S;for(let t=0,e=w.length;t<e;t++){const e=w[t];S=S.concat(e)}function E(t,e,i){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(i).add(t)}const C=S.length,L=T.length;function R(t,e,i){let n,r,s;const a=t.x-e.x,o=t.y-e.y,l=i.x-t.x,c=i.y-t.y,h=a*a+o*o,u=a*c-o*l;if(Math.abs(u)>Number.EPSILON){const u=Math.sqrt(h),d=Math.sqrt(l*l+c*c),p=e.x-o/u,m=e.y+a/u,f=((i.x-c/d-p)*c-(i.y+l/d-m)*l)/(a*c-o*l);n=p+a*f-t.x,r=m+o*f-t.y;const g=n*n+r*r;if(g<=2)return new Lt(n,r);s=Math.sqrt(g/2)}else{let t=!1;a>Number.EPSILON?l>Number.EPSILON&&(t=!0):a<-Number.EPSILON?l<-Number.EPSILON&&(t=!0):Math.sign(o)===Math.sign(c)&&(t=!0),t?(n=-o,r=a,s=Math.sqrt(h)):(n=a,r=o,s=Math.sqrt(h/2))}return new Lt(n/s,r/s)}const P=[];for(let t=0,e=A.length,i=e-1,n=t+1;t<e;t++,i++,n++)i===e&&(i=0),n===e&&(n=0),P[t]=R(A[t],A[i],A[n]);const I=[];let D,N=P.concat();for(let t=0,e=w.length;t<e;t++){const e=w[t];D=[];for(let t=0,i=e.length,n=i-1,r=t+1;t<i;t++,n++,r++)n===i&&(n=0),r===i&&(r=0),D[t]=R(e[t],e[n],e[r]);I.push(D),N=N.concat(D)}for(let t=0;t<p;t++){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=A.length;t<e;t++){const e=E(A[t],P[t],n);U(e.x,e.y,-i)}for(let t=0,e=w.length;t<e;t++){const e=w[t];D=I[t];for(let t=0,r=e.length;t<r;t++){const r=E(e[t],D[t],n);U(r.x,r.y,-i)}}}const O=u+d;for(let t=0;t<C;t++){const e=c?E(S[t],N[t],O):S[t];M?(_.copy(v.normals[0]).multiplyScalar(e.x),x.copy(v.binormals[0]).multiplyScalar(e.y),y.copy(g[0]).add(_).add(x),U(y.x,y.y,y.z)):U(e.x,e.y,0)}for(let t=1;t<=o;t++)for(let e=0;e<C;e++){const i=c?E(S[e],N[e],O):S[e];M?(_.copy(v.normals[t]).multiplyScalar(i.x),x.copy(v.binormals[t]).multiplyScalar(i.y),y.copy(g[t]).add(_).add(x),U(y.x,y.y,y.z)):U(i.x,i.y,l/o*t)}for(let t=p-1;t>=0;t--){const e=t/p,i=h*Math.cos(e*Math.PI/2),n=u*Math.sin(e*Math.PI/2)+d;for(let t=0,e=A.length;t<e;t++){const e=E(A[t],P[t],n);U(e.x,e.y,l+i)}for(let t=0,e=w.length;t<e;t++){const e=w[t];D=I[t];for(let t=0,r=e.length;t<r;t++){const r=E(e[t],D[t],n);M?U(r.x,r.y+g[o-1].y,g[o-1].x+i):U(r.x,r.y,l+i)}}}function z(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let t=0,i=o+2*p;t<i;t++){const i=C*t,s=C*(t+1);F(e+n+i,e+r+i,e+r+s,e+n+s)}}}function U(t,e,i){s.push(t),s.push(e),s.push(i)}function B(t,e,r){k(t),k(e),k(r);const s=n.length/3,a=f.generateTopUV(i,n,s-3,s-2,s-1);G(a[0]),G(a[1]),G(a[2])}function F(t,e,r,s){k(t),k(e),k(s),k(e),k(r),k(s);const a=n.length/3,o=f.generateSideWallUV(i,n,a-6,a-3,a-2,a-1);G(o[0]),G(o[1]),G(o[3]),G(o[1]),G(o[2]),G(o[3])}function k(t){n.push(s[3*t+0]),n.push(s[3*t+1]),n.push(s[3*t+2])}function G(t){r.push(t.x),r.push(t.y)}!function(){const t=n.length/3;if(c){let t=0,e=C*t;for(let t=0;t<L;t++){const i=T[t];B(i[2]+e,i[1]+e,i[0]+e)}t=o+2*p,e=C*t;for(let t=0;t<L;t++){const i=T[t];B(i[0]+e,i[1]+e,i[2]+e)}}else{for(let t=0;t<L;t++){const e=T[t];B(e[2],e[1],e[0])}for(let t=0;t<L;t++){const e=T[t];B(e[0]+C*o,e[1]+C*o,e[2]+C*o)}}i.addGroup(t,n.length/3-t,0)}(),function(){const t=n.length/3;let e=0;z(A,e),e+=A.length;for(let t=0,i=w.length;t<i;t++){const i=w[t];z(i,e),e+=i.length}i.addGroup(t,n.length/3-t,1)}()}this.setAttribute("position",new Ti(n,3)),this.setAttribute("uv",new Ti(r,2)),this.computeVertexNormals()}toJSON(){const t=super.toJSON();return function(t,e,i){if(i.shapes=[],Array.isArray(t))for(let e=0,n=t.length;e<n;e++){const n=t[e];i.shapes.push(n.uuid)}else i.shapes.push(t.uuid);i.options=Object.assign({},e),void 0!==e.extrudePath&&(i.options.extrudePath=e.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}const n=t.options.extrudePath;return void 0!==n&&(t.options.extrudePath=(new wo[n.type]).fromJSON(n)),new ml(i,t.options)}}const fl={generateTopUV:function(t,e,i,n,r){const s=e[3*i],a=e[3*i+1],o=e[3*n],l=e[3*n+1],c=e[3*r],h=e[3*r+1];return[new Lt(s,a),new Lt(o,l),new Lt(c,h)]},generateSideWallUV:function(t,e,i,n,r,s){const a=e[3*i],o=e[3*i+1],l=e[3*i+2],c=e[3*n],h=e[3*n+1],u=e[3*n+2],d=e[3*r],p=e[3*r+1],m=e[3*r+2],f=e[3*s],g=e[3*s+1],v=e[3*s+2];return Math.abs(o-h)<Math.abs(a-c)?[new Lt(a,1-l),new Lt(c,1-u),new Lt(d,1-m),new Lt(f,1-v)]:[new Lt(o,1-l),new Lt(h,1-u),new Lt(p,1-m),new Lt(g,1-v)]}};class gl extends Io{constructor(t=1,e=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new gl(t.radius,t.detail)}}class vl extends Io{constructor(t=1,e=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new vl(t.radius,t.detail)}}class xl extends Di{constructor(t=.5,e=1,i=8,n=1,r=0,s=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:r,thetaLength:s},i=Math.max(3,i);const a=[],o=[],l=[],c=[];let h=t;const u=(e-t)/(n=Math.max(1,n)),d=new ne,p=new Lt;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){const n=r+t/i*s;d.x=h*Math.cos(n),d.y=h*Math.sin(n),o.push(d.x,d.y,d.z),l.push(0,0,1),p.x=(d.x/e+1)/2,p.y=(d.y/e+1)/2,c.push(p.x,p.y)}h+=u}for(let t=0;t<n;t++){const e=t*(i+1);for(let t=0;t<i;t++){const n=t+e,r=n,s=n+i+1,o=n+i+2,l=n+1;a.push(r,s,l),a.push(s,o,l)}}this.setIndex(a),this.setAttribute("position",new Ti(o,3)),this.setAttribute("normal",new Ti(l,3)),this.setAttribute("uv",new Ti(c,2))}static fromJSON(t){return new xl(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class _l extends Di{constructor(t=new Fo([new Lt(0,.5),new Lt(-.5,-.5),new Lt(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],r=[],s=[];let a=0,o=0;if(!1===Array.isArray(t))l(t);else for(let e=0;e<t.length;e++)l(t[e]),this.addGroup(a,o,e),a+=o,o=0;function l(t){const a=n.length/3,l=t.extractPoints(e);let c=l.shape;const h=l.holes;!1===ul.isClockWise(c)&&(c=c.reverse());for(let t=0,e=h.length;t<e;t++){const e=h[t];!0===ul.isClockWise(e)&&(h[t]=e.reverse())}const u=ul.triangulateShape(c,h);for(let t=0,e=h.length;t<e;t++){const e=h[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];n.push(e.x,e.y,0),r.push(0,0,1),s.push(e.x,e.y)}for(let t=0,e=u.length;t<e;t++){const e=u[t],n=e[0]+a,r=e[1]+a,s=e[2]+a;i.push(n,r,s),o+=3}}this.setIndex(i),this.setAttribute("position",new Ti(n,3)),this.setAttribute("normal",new Ti(r,3)),this.setAttribute("uv",new Ti(s,2))}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,r=t.shapes.length;n<r;n++){const r=e[t.shapes[n]];i.push(r)}return new _l(i,t.curveSegments)}}class yl extends Di{constructor(t=1,e=32,i=16,n=0,r=2*Math.PI,s=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:i,phiStart:n,phiLength:r,thetaStart:s,thetaLength:a},e=Math.max(3,Math.floor(e)),i=Math.max(2,Math.floor(i));const o=Math.min(s+a,Math.PI);let l=0;const c=[],h=new ne,u=new ne,d=[],p=[],m=[],f=[];for(let d=0;d<=i;d++){const g=[],v=d/i;let x=0;0==d&&0==s?x=.5/e:d==i&&o==Math.PI&&(x=-.5/e);for(let i=0;i<=e;i++){const o=i/e;h.x=-t*Math.cos(n+o*r)*Math.sin(s+v*a),h.y=t*Math.cos(s+v*a),h.z=t*Math.sin(n+o*r)*Math.sin(s+v*a),p.push(h.x,h.y,h.z),u.copy(h).normalize(),m.push(u.x,u.y,u.z),f.push(o+x,1-v),g.push(l++)}c.push(g)}for(let t=0;t<i;t++)for(let n=0;n<e;n++){const e=c[t][n+1],r=c[t][n],a=c[t+1][n],l=c[t+1][n+1];(0!==t||s>0)&&d.push(e,r,l),(t!==i-1||o<Math.PI)&&d.push(r,a,l)}this.setIndex(d),this.setAttribute("position",new Ti(p,3)),this.setAttribute("normal",new Ti(m,3)),this.setAttribute("uv",new Ti(f,2))}static fromJSON(t){return new yl(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Ml extends Io{constructor(t=1,e=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Ml(t.radius,t.detail)}}class bl extends Di{constructor(t=1,e=.4,i=8,n=6,r=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:i,tubularSegments:n,arc:r},i=Math.floor(i),n=Math.floor(n);const s=[],a=[],o=[],l=[],c=new ne,h=new ne,u=new ne;for(let s=0;s<=i;s++)for(let d=0;d<=n;d++){const p=d/n*r,m=s/i*Math.PI*2;h.x=(t+e*Math.cos(m))*Math.cos(p),h.y=(t+e*Math.cos(m))*Math.sin(p),h.z=e*Math.sin(m),a.push(h.x,h.y,h.z),c.x=t*Math.cos(p),c.y=t*Math.sin(p),u.subVectors(h,c).normalize(),o.push(u.x,u.y,u.z),l.push(d/n),l.push(s/i)}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*t+e-1,r=(n+1)*(t-1)+e-1,a=(n+1)*(t-1)+e,o=(n+1)*t+e;s.push(i,r,o),s.push(r,a,o)}this.setIndex(s),this.setAttribute("position",new Ti(a,3)),this.setAttribute("normal",new Ti(o,3)),this.setAttribute("uv",new Ti(l,2))}static fromJSON(t){return new bl(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class Sl extends Di{constructor(t=1,e=.4,i=64,n=8,r=2,s=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:i,radialSegments:n,p:r,q:s},i=Math.floor(i),n=Math.floor(n);const a=[],o=[],l=[],c=[],h=new ne,u=new ne,d=new ne,p=new ne,m=new ne,f=new ne,g=new ne;for(let a=0;a<=i;++a){const x=a/i*r*Math.PI*2;v(x,r,s,t,d),v(x+.01,r,s,t,p),f.subVectors(p,d),g.addVectors(p,d),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let t=0;t<=n;++t){const r=t/n*Math.PI*2,s=-e*Math.cos(r),p=e*Math.sin(r);h.x=d.x+(s*g.x+p*m.x),h.y=d.y+(s*g.y+p*m.y),h.z=d.z+(s*g.z+p*m.z),o.push(h.x,h.y,h.z),u.subVectors(h,d).normalize(),l.push(u.x,u.y,u.z),c.push(a/i),c.push(t/n)}}for(let t=1;t<=i;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,o=(n+1)*(t-1)+e;a.push(i,r,o),a.push(r,s,o)}function v(t,e,i,n,r){const s=Math.cos(t),a=Math.sin(t),o=i/e*t,l=Math.cos(o);r.x=n*(2+l)*.5*s,r.y=n*(2+l)*a*.5,r.z=n*Math.sin(o)*.5}this.setIndex(a),this.setAttribute("position",new Ti(o,3)),this.setAttribute("normal",new Ti(l,3)),this.setAttribute("uv",new Ti(c,2))}static fromJSON(t){return new Sl(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class wl extends Di{constructor(t=new bo(new ne(-1,-1,0),new ne(-1,1,0),new ne(1,1,0)),e=64,i=1,n=8,r=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:i,radialSegments:n,closed:r};const s=t.computeFrenetFrames(e,r);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals;const a=new ne,o=new ne,l=new Lt;let c=new ne;const h=[],u=[],d=[],p=[];function m(r){c=t.getPointAt(r/e,c);const l=s.normals[r],d=s.binormals[r];for(let t=0;t<=n;t++){const e=t/n*Math.PI*2,r=Math.sin(e),s=-Math.cos(e);o.x=s*l.x+r*d.x,o.y=s*l.y+r*d.y,o.z=s*l.z+r*d.z,o.normalize(),u.push(o.x,o.y,o.z),a.x=c.x+i*o.x,a.y=c.y+i*o.y,a.z=c.z+i*o.z,h.push(a.x,a.y,a.z)}}!function(){for(let t=0;t<e;t++)m(t);m(!1===r?e:0),function(){for(let t=0;t<=e;t++)for(let i=0;i<=n;i++)l.x=t/e,l.y=i/n,d.push(l.x,l.y)}(),function(){for(let t=1;t<=e;t++)for(let e=1;e<=n;e++){const i=(n+1)*(t-1)+(e-1),r=(n+1)*t+(e-1),s=(n+1)*t+e,a=(n+1)*(t-1)+e;p.push(i,r,a),p.push(r,s,a)}}()}(),this.setIndex(p),this.setAttribute("position",new Ti(h,3)),this.setAttribute("normal",new Ti(u,3)),this.setAttribute("uv",new Ti(d,2))}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new wl((new wo[t.path.type]).fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class Tl extends Di{constructor(t=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:t},null!==t){const e=[],i=new Set,n=new ne,r=new ne;if(null!==t.index){const s=t.attributes.position,a=t.index;let o=t.groups;0===o.length&&(o=[{start:0,count:a.count,materialIndex:0}]);for(let t=0,l=o.length;t<l;++t){const l=o[t],c=l.start;for(let t=c,o=c+l.count;t<o;t+=3)for(let o=0;o<3;o++){const l=a.getX(t+o),c=a.getX(t+(o+1)%3);n.fromBufferAttribute(s,l),r.fromBufferAttribute(s,c),!0===Al(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}}else{const s=t.attributes.position;for(let t=0,a=s.count/3;t<a;t++)for(let a=0;a<3;a++){const o=3*t+a,l=3*t+(a+1)%3;n.fromBufferAttribute(s,o),r.fromBufferAttribute(s,l),!0===Al(n,r,i)&&(e.push(n.x,n.y,n.z),e.push(r.x,r.y,r.z))}}this.setAttribute("position",new Ti(e,3))}}}function Al(t,e,i){const n=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`,r=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`;return!0!==i.has(n)&&!0!==i.has(r)&&(i.add(n),i.add(r),!0)}var El=Object.freeze({__proto__:null,BoxGeometry:Qi,CapsuleGeometry:Co,CircleGeometry:Lo,ConeGeometry:Po,CylinderGeometry:Ro,DodecahedronGeometry:Do,EdgesGeometry:Bo,ExtrudeGeometry:ml,IcosahedronGeometry:gl,LatheGeometry:Eo,OctahedronGeometry:vl,PlaneGeometry:yn,PolyhedronGeometry:Io,RingGeometry:xl,ShapeGeometry:_l,SphereGeometry:yl,TetrahedronGeometry:Ml,TorusGeometry:bl,TorusKnotGeometry:Sl,TubeGeometry:wl,WireframeGeometry:Tl});class Cl extends xi{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new jt(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Ll extends rn{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Rl extends xi{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new jt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Pl extends Rl{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Lt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return yt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new jt(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new jt(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new jt(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(t)}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Il extends xi{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new jt(16777215),this.specular=new jt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Dl extends xi{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new jt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Nl extends xi{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Ol extends xi{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new jt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new jt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class zl extends xi{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new jt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Ul extends Fa{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function Bl(t,e,i){return kl(t)?new t.constructor(t.subarray(e,void 0!==i?i:t.length)):t.slice(e,i)}function Fl(t,e,i){return!t||!i&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)}function kl(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Gl(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i}function Vl(t,e,i){const n=t.length,r=new t.constructor(n);for(let s=0,a=0;a!==n;++s){const n=i[s]*e;for(let i=0;i!==e;++i)r[a++]=t[n+i]}return r}function Hl(t,e,i,n){let r=1,s=t[0];for(;void 0!==s&&void 0===s[n];)s=t[r++];if(void 0===s)return;let a=s[n];if(void 0!==a)if(Array.isArray(a))do{a=s[n],void 0!==a&&(e.push(s.time),i.push.apply(i,a)),s=t[r++]}while(void 0!==s);else if(void 0!==a.toArray)do{a=s[n],void 0!==a&&(e.push(s.time),a.toArray(i,i.length)),s=t[r++]}while(void 0!==s);else do{a=s[n],void 0!==a&&(e.push(s.time),i.push(a)),s=t[r++]}while(void 0!==s)}var Wl=Object.freeze({__proto__:null,arraySlice:Bl,convertArray:Fl,isTypedArray:kl,getKeyframeOrder:Gl,sortedArray:Vl,flattenJSON:Hl,subclip:function(t,e,i,n,r=30){const s=t.clone();s.name=e;const a=[];for(let t=0;t<s.tracks.length;++t){const e=s.tracks[t],o=e.getValueSize(),l=[],c=[];for(let t=0;t<e.times.length;++t){const s=e.times[t]*r;if(!(s<i||s>=n)){l.push(e.times[t]);for(let i=0;i<o;++i)c.push(e.values[t*o+i])}}0!==l.length&&(e.times=Fl(l,e.times.constructor),e.values=Fl(c,e.values.constructor),a.push(e))}s.tracks=a;let o=1/0;for(let t=0;t<s.tracks.length;++t)o>s.tracks[t].times[0]&&(o=s.tracks[t].times[0]);for(let t=0;t<s.tracks.length;++t)s.tracks[t].shift(-1*o);return s.resetDuration(),s},makeClipAdditive:function(t,e=0,i=t,n=30){n<=0&&(n=30);const r=i.tracks.length,s=e/n;for(let e=0;e<r;++e){const n=i.tracks[e],r=n.ValueTypeName;if("bool"===r||"string"===r)continue;const a=t.tracks.find((function(t){return t.name===n.name&&t.ValueTypeName===r}));if(void 0===a)continue;let o=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(o=l/3);let c=0;const h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=h/3);const u=n.times.length-1;let d;if(s<=n.times[0]){const t=o,e=l-o;d=Bl(n.values,t,e)}else if(s>=n.times[u]){const t=u*l+o,e=t+l-o;d=Bl(n.values,t,e)}else{const t=n.createInterpolant(),e=o,i=l-o;t.evaluate(s),d=Bl(t.resultBuffer,e,i)}if("quaternion"===r){(new ie).fromArray(d).normalize().conjugate().toArray(d)}const p=a.times.length;for(let t=0;t<p;++t){const e=t*h+c;if("quaternion"===r)ie.multiplyQuaternionsFlat(a.values,e,d,0,a.values,e);else{const t=h-2*c;for(let i=0;i<t;++i)a.values[e+i]-=d[i]}}}return t.blendMode=st,t}});class jl{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],r=e[i-1];t:{e:{let s;i:{n:if(!(t<n)){for(let s=i+2;;){if(void 0===n){if(t<r)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===s)break;if(r=n,n=e[++i],t<n)break e}s=e.length;break i}if(t>=r)break t;{const a=e[1];t<a&&(i=2,r=a);for(let s=i-2;;){if(void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(i===s)break;if(n=r,r=e[--i-1],t>=r)break e}s=i,i=0}}for(;i<s;){const n=i+s>>>1;t<e[n]?s=n:i=n+1}if(n=e[i],r=e[i-1],void 0===r)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,r,n)}return this.interpolate_(i,r,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,r=t*n;for(let t=0;t!==n;++t)e[t]=i[r+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class ql extends jl{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:et,endingEnd:et}}intervalChanged_(t,e,i){const n=this.parameterPositions;let r=t-2,s=t+1,a=n[r],o=n[s];if(void 0===a)switch(this.getSettings_().endingStart){case it:r=t,a=2*e-i;break;case nt:r=n.length-2,a=e+n[r]-n[r+1];break;default:r=t,a=i}if(void 0===o)switch(this.getSettings_().endingEnd){case it:s=t,o=2*i-e;break;case nt:s=1,o=i+n[1]-n[0];break;default:s=t-1,o=e}const l=.5*(i-e),c=this.valueSize;this._weightPrev=l/(e-a),this._weightNext=l/(o-i),this._offsetPrev=r*c,this._offsetNext=s*c}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=this._offsetPrev,h=this._offsetNext,u=this._weightPrev,d=this._weightNext,p=(i-e)/(n-e),m=p*p,f=m*p,g=-u*f+2*u*m-u*p,v=(1+u)*f+(-1.5-2*u)*m+(-.5+u)*p+1,x=(-1-d)*f+(1.5+d)*m+.5*p,_=d*f-d*m;for(let t=0;t!==a;++t)r[t]=g*s[c+t]+v*s[l+t]+x*s[o+t]+_*s[h+t];return r}}class Xl extends jl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=t*a,l=o-a,c=(i-e)/(n-e),h=1-c;for(let t=0;t!==a;++t)r[t]=s[l+t]*h+s[o+t]*c;return r}}class Yl extends jl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class Zl{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Fl(e,this.TimeBufferType),this.values=Fl(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Fl(t.times,Array),values:Fl(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new Yl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new Xl(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new ql(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case $:e=this.InterpolantFactoryMethodDiscrete;break;case Q:e=this.InterpolantFactoryMethodLinear;break;case tt:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return $;case this.InterpolantFactoryMethodLinear:return Q;case this.InterpolantFactoryMethodSmooth:return tt}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let r=0,s=n-1;for(;r!==n&&i[r]<t;)++r;for(;-1!==s&&i[s]>e;)--s;if(++s,0!==r||s!==n){r>=s&&(s=Math.max(s,1),r=s-1);const t=this.getValueSize();this.times=Bl(i,r,s),this.values=Bl(this.values,r*t,s*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,r=i.length;0===r&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let s=null;for(let e=0;e!==r;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==s&&s>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,s),t=!1;break}s=n}if(void 0!==n&&kl(n))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}return t}optimize(){const t=Bl(this.times),e=Bl(this.values),i=this.getValueSize(),n=this.getInterpolation()===tt,r=t.length-1;let s=1;for(let a=1;a<r;++a){let r=!1;const o=t[a];if(o!==t[a+1]&&(1!==a||o!==t[0]))if(n)r=!0;else{const t=a*i,n=t-i,s=t+i;for(let a=0;a!==i;++a){const i=e[t+a];if(i!==e[n+a]||i!==e[s+a]){r=!0;break}}}if(r){if(a!==s){t[s]=t[a];const n=a*i,r=s*i;for(let t=0;t!==i;++t)e[r+t]=e[n+t]}++s}}if(r>0){t[s]=t[r];for(let t=r*i,n=s*i,a=0;a!==i;++a)e[n+a]=e[t+a];++s}return s!==t.length?(this.times=Bl(t,0,s),this.values=Bl(e,0,s*i)):(this.times=t,this.values=e),this}clone(){const t=Bl(this.times,0),e=Bl(this.values,0),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}Zl.prototype.TimeBufferType=Float32Array,Zl.prototype.ValueBufferType=Float32Array,Zl.prototype.DefaultInterpolation=Q;class Jl extends Zl{}Jl.prototype.ValueTypeName="bool",Jl.prototype.ValueBufferType=Array,Jl.prototype.DefaultInterpolation=$,Jl.prototype.InterpolantFactoryMethodLinear=void 0,Jl.prototype.InterpolantFactoryMethodSmooth=void 0;class Kl extends Zl{}Kl.prototype.ValueTypeName="color";class $l extends Zl{}$l.prototype.ValueTypeName="number";class Ql extends jl{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const r=this.resultBuffer,s=this.sampleValues,a=this.valueSize,o=(i-e)/(n-e);let l=t*a;for(let t=l+a;l!==t;l+=4)ie.slerpFlat(r,0,s,l-a,s,l,o);return r}}class tc extends Zl{InterpolantFactoryMethodLinear(t){return new Ql(this.times,this.values,this.getValueSize(),t)}}tc.prototype.ValueTypeName="quaternion",tc.prototype.DefaultInterpolation=Q,tc.prototype.InterpolantFactoryMethodSmooth=void 0;class ec extends Zl{}ec.prototype.ValueTypeName="string",ec.prototype.ValueBufferType=Array,ec.prototype.DefaultInterpolation=$,ec.prototype.InterpolantFactoryMethodLinear=void 0,ec.prototype.InterpolantFactoryMethodSmooth=void 0;class ic extends Zl{}ic.prototype.ValueTypeName="vector";class nc{constructor(t,e=-1,i,n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=_t(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,r=i.length;t!==r;++t)e.push(rc(i[t]).scale(n));const r=new this(t.name,t.duration,e,t.blendMode);return r.uuid=t.uuid,r}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(Zl.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const r=e.length,s=[];for(let t=0;t<r;t++){let a=[],o=[];a.push((t+r-1)%r,t,(t+1)%r),o.push(0,1,0);const l=Gl(a);a=Vl(a,1,l),o=Vl(o,1,l),n||0!==a[0]||(a.push(r),o.push(o[0])),s.push(new $l(".morphTargetInfluences["+e[t].name+"]",a,o).scale(1/i))}return new this(t,-1,s)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},r=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],s=i.name.match(r);if(s&&s.length>1){const t=s[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const s=[];for(const t in n)s.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return s}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,r){if(0!==i.length){const s=[],a=[];Hl(i,s,a,n),0!==s.length&&r.push(new t(e,s,a))}},n=[],r=t.name||"default",s=t.fps||30,a=t.blendMode;let o=t.length||-1;const l=t.hierarchy||[];for(let t=0;t<l.length;t++){const r=l[t].keys;if(r&&0!==r.length)if(r[0].morphTargets){const t={};let e;for(e=0;e<r.length;e++)if(r[e].morphTargets)for(let i=0;i<r[e].morphTargets.length;i++)t[r[e].morphTargets[i]]=-1;for(const i in t){const t=[],s=[];for(let n=0;n!==r[e].morphTargets.length;++n){const n=r[e];t.push(n.time),s.push(n.morphTarget===i?1:0)}n.push(new $l(".morphTargetInfluence["+i+"]",t,s))}o=t.length*s}else{const s=".bones["+e[t].name+"]";i(ic,s+".position",r,"pos",n),i(tc,s+".quaternion",r,"rot",n),i(ic,s+".scale",r,"scl",n)}}if(0===n.length)return null;return new this(r,o,n,a)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function rc(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return $l;case"vector":case"vector2":case"vector3":case"vector4":return ic;case"color":return Kl;case"quaternion":return tc;case"bool":case"boolean":return Jl;case"string":return ec}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];Hl(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const sc={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class ac{constructor(t,e,i){const n=this;let r,s=!1,a=0,o=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){o++,!1===s&&void 0!==n.onStart&&n.onStart(t,a,o),s=!0},this.itemEnd=function(t){a++,void 0!==n.onProgress&&n.onProgress(t,a,o),a===o&&(s=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return r?r(t):t},this.setURLModifier=function(t){return r=t,this},this.addHandler=function(t,e){return l.push(t,e),this},this.removeHandler=function(t){const e=l.indexOf(t);return-1!==e&&l.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=l.length;e<i;e+=2){const i=l[e],n=l[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const oc=new ac;class lc{constructor(t){this.manager=void 0!==t?t:oc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,r){i.load(t,n,e,r)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}const cc={};class hc extends Error{constructor(t,e){super(t),this.response=e}}class uc extends lc{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=sc.get(t);if(void 0!==r)return this.manager.itemStart(t),setTimeout((()=>{e&&e(r),this.manager.itemEnd(t)}),0),r;if(void 0!==cc[t])return void cc[t].push({onLoad:e,onProgress:i,onError:n});cc[t]=[],cc[t].push({onLoad:e,onProgress:i,onError:n});const s=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,o=this.responseType;fetch(s).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=cc[t],n=e.body.getReader(),r=e.headers.get("Content-Length"),s=r?parseInt(r):0,a=0!==s;let o=0;const l=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:r})=>{if(n)t.close();else{o+=r.byteLength;const n=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(r),e()}}))}()}});return new Response(l)}throw new hc(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(o){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,a)));case"json":return t.json();default:if(void 0===a)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(a),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{sc.add(t,e);const i=cc[t];delete cc[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=cc[t];if(void 0===i)throw this.manager.itemError(t),e;delete cc[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class dc extends lc{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=sc.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a=Nt("img");function o(){c(),sc.add(t,this),e&&e(this),r.manager.itemEnd(t)}function l(e){c(),n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)}function c(){a.removeEventListener("load",o,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",o,!1),a.addEventListener("error",l,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(a.crossOrigin=this.crossOrigin),r.manager.itemStart(t),a.src=t,a}}class pc extends si{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new jt(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}}class mc extends pc{constructor(t,e,i){super(t,i),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(si.DefaultUp),this.updateMatrix(),this.groundColor=new jt(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const fc=new Ne,gc=new ne,vc=new ne;class xc{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Lt(512,512),this.map=null,this.mapPass=null,this.matrix=new Ne,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new vn,this._frameExtents=new Lt(1,1),this._viewportCount=1,this._viewports=[new $t(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;gc.setFromMatrixPosition(t.matrixWorld),e.position.copy(gc),vc.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(vc),e.updateMatrixWorld(),fc.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(fc),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(e.projectionMatrix),i.multiply(e.matrixWorldInverse)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class _c extends xc{constructor(){super(new an(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=2*xt*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,r=t.distance||e.far;i===e.fov&&n===e.aspect&&r===e.far||(e.fov=i,e.aspect=n,e.far=r,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class yc extends pc{constructor(t,e,i=0,n=Math.PI/3,r=0,s=1){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(si.DefaultUp),this.updateMatrix(),this.target=new si,this.distance=i,this.angle=n,this.penumbra=r,this.decay=s,this.map=null,this.shadow=new _c}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const Mc=new Ne,bc=new ne,Sc=new ne;class wc extends xc{constructor(){super(new an(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Lt(4,2),this._viewportCount=6,this._viewports=[new $t(2,1,1,1),new $t(0,1,1,1),new $t(3,1,1,1),new $t(1,1,1,1),new $t(3,0,1,1),new $t(1,0,1,1)],this._cubeDirections=[new ne(1,0,0),new ne(-1,0,0),new ne(0,0,1),new ne(0,0,-1),new ne(0,1,0),new ne(0,-1,0)],this._cubeUps=[new ne(0,1,0),new ne(0,1,0),new ne(0,1,0),new ne(0,1,0),new ne(0,0,1),new ne(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,r=t.distance||i.far;r!==i.far&&(i.far=r,i.updateProjectionMatrix()),bc.setFromMatrixPosition(t.matrixWorld),i.position.copy(bc),Sc.copy(i.position),Sc.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Sc),i.updateMatrixWorld(),n.makeTranslation(-bc.x,-bc.y,-bc.z),Mc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Mc)}}class Tc extends pc{constructor(t,e,i=0,n=1){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new wc}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class Ac extends xc{constructor(){super(new Rn(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Ec extends pc{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(si.DefaultUp),this.updateMatrix(),this.target=new si,this.shadow=new Ac}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Cc extends pc{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Lc extends pc{constructor(t,e,i=10,n=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class Rc{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new ne)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.282095),e.addScaledVector(s[1],.488603*n),e.addScaledVector(s[2],.488603*r),e.addScaledVector(s[3],.488603*i),e.addScaledVector(s[4],i*n*1.092548),e.addScaledVector(s[5],n*r*1.092548),e.addScaledVector(s[6],.315392*(3*r*r-1)),e.addScaledVector(s[7],i*r*1.092548),e.addScaledVector(s[8],.546274*(i*i-n*n)),e}getIrradianceAt(t,e){const i=t.x,n=t.y,r=t.z,s=this.coefficients;return e.copy(s[0]).multiplyScalar(.886227),e.addScaledVector(s[1],1.023328*n),e.addScaledVector(s[2],1.023328*r),e.addScaledVector(s[3],1.023328*i),e.addScaledVector(s[4],.858086*i*n),e.addScaledVector(s[5],.858086*n*r),e.addScaledVector(s[6],.743125*r*r-.247708),e.addScaledVector(s[7],.858086*i*r),e.addScaledVector(s[8],.429043*(i*i-n*n)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(t,e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(t,e+3*n);return this}toArray(t=[],e=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(t,e+3*n);return t}static getBasisAt(t,e){const i=t.x,n=t.y,r=t.z;e[0]=.282095,e[1]=.488603*n,e[2]=.488603*r,e[3]=.488603*i,e[4]=1.092548*i*n,e[5]=1.092548*n*r,e[6]=.315392*(3*r*r-1),e[7]=1.092548*i*r,e[8]=.546274*(i*i-n*n)}}class Pc extends pc{constructor(t=new Rc,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class Ic extends lc{constructor(t){super(t),this.textures={}}load(t,e,i,n){const r=this,s=new uc(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=this.textures;function i(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const n=Ic.createMaterialFromType(t.type);if(void 0!==t.uuid&&(n.uuid=t.uuid),void 0!==t.name&&(n.name=t.name),void 0!==t.color&&void 0!==n.color&&n.color.setHex(t.color),void 0!==t.roughness&&(n.roughness=t.roughness),void 0!==t.metalness&&(n.metalness=t.metalness),void 0!==t.sheen&&(n.sheen=t.sheen),void 0!==t.sheenColor&&(n.sheenColor=(new jt).setHex(t.sheenColor)),void 0!==t.sheenRoughness&&(n.sheenRoughness=t.sheenRoughness),void 0!==t.emissive&&void 0!==n.emissive&&n.emissive.setHex(t.emissive),void 0!==t.specular&&void 0!==n.specular&&n.specular.setHex(t.specular),void 0!==t.specularIntensity&&(n.specularIntensity=t.specularIntensity),void 0!==t.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(t.specularColor),void 0!==t.shininess&&(n.shininess=t.shininess),void 0!==t.clearcoat&&(n.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(n.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.iridescence&&(n.iridescence=t.iridescence),void 0!==t.iridescenceIOR&&(n.iridescenceIOR=t.iridescenceIOR),void 0!==t.iridescenceThicknessRange&&(n.iridescenceThicknessRange=t.iridescenceThicknessRange),void 0!==t.transmission&&(n.transmission=t.transmission),void 0!==t.thickness&&(n.thickness=t.thickness),void 0!==t.attenuationDistance&&(n.attenuationDistance=t.attenuationDistance),void 0!==t.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(t.attenuationColor),void 0!==t.fog&&(n.fog=t.fog),void 0!==t.flatShading&&(n.flatShading=t.flatShading),void 0!==t.blending&&(n.blending=t.blending),void 0!==t.combine&&(n.combine=t.combine),void 0!==t.side&&(n.side=t.side),void 0!==t.shadowSide&&(n.shadowSide=t.shadowSide),void 0!==t.opacity&&(n.opacity=t.opacity),void 0!==t.transparent&&(n.transparent=t.transparent),void 0!==t.alphaTest&&(n.alphaTest=t.alphaTest),void 0!==t.depthTest&&(n.depthTest=t.depthTest),void 0!==t.depthWrite&&(n.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(n.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(n.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(n.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(n.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(n.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(n.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(n.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(n.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(n.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(n.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(n.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(n.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(n.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(n.rotation=t.rotation),1!==t.linewidth&&(n.linewidth=t.linewidth),void 0!==t.dashSize&&(n.dashSize=t.dashSize),void 0!==t.gapSize&&(n.gapSize=t.gapSize),void 0!==t.scale&&(n.scale=t.scale),void 0!==t.polygonOffset&&(n.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(n.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(n.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.dithering&&(n.dithering=t.dithering),void 0!==t.alphaToCoverage&&(n.alphaToCoverage=t.alphaToCoverage),void 0!==t.premultipliedAlpha&&(n.premultipliedAlpha=t.premultipliedAlpha),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.toneMapped&&(n.toneMapped=t.toneMapped),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?n.vertexColors=t.vertexColors>0:n.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const r=t.uniforms[e];switch(n.uniforms[e]={},r.type){case"t":n.uniforms[e].value=i(r.value);break;case"c":n.uniforms[e].value=(new jt).setHex(r.value);break;case"v2":n.uniforms[e].value=(new Lt).fromArray(r.value);break;case"v3":n.uniforms[e].value=(new ne).fromArray(r.value);break;case"v4":n.uniforms[e].value=(new $t).fromArray(r.value);break;case"m3":n.uniforms[e].value=(new Rt).fromArray(r.value);break;case"m4":n.uniforms[e].value=(new Ne).fromArray(r.value);break;default:n.uniforms[e].value=r.value}}if(void 0!==t.defines&&(n.defines=t.defines),void 0!==t.vertexShader&&(n.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(n.fragmentShader=t.fragmentShader),void 0!==t.glslVersion&&(n.glslVersion=t.glslVersion),void 0!==t.extensions)for(const e in t.extensions)n.extensions[e]=t.extensions[e];if(void 0!==t.size&&(n.size=t.size),void 0!==t.sizeAttenuation&&(n.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(n.map=i(t.map)),void 0!==t.matcap&&(n.matcap=i(t.matcap)),void 0!==t.alphaMap&&(n.alphaMap=i(t.alphaMap)),void 0!==t.bumpMap&&(n.bumpMap=i(t.bumpMap)),void 0!==t.bumpScale&&(n.bumpScale=t.bumpScale),void 0!==t.normalMap&&(n.normalMap=i(t.normalMap)),void 0!==t.normalMapType&&(n.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),n.normalScale=(new Lt).fromArray(e)}return void 0!==t.displacementMap&&(n.displacementMap=i(t.displacementMap)),void 0!==t.displacementScale&&(n.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(n.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(n.roughnessMap=i(t.roughnessMap)),void 0!==t.metalnessMap&&(n.metalnessMap=i(t.metalnessMap)),void 0!==t.emissiveMap&&(n.emissiveMap=i(t.emissiveMap)),void 0!==t.emissiveIntensity&&(n.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(n.specularMap=i(t.specularMap)),void 0!==t.specularIntensityMap&&(n.specularIntensityMap=i(t.specularIntensityMap)),void 0!==t.specularColorMap&&(n.specularColorMap=i(t.specularColorMap)),void 0!==t.envMap&&(n.envMap=i(t.envMap)),void 0!==t.envMapIntensity&&(n.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(n.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(n.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(n.lightMap=i(t.lightMap)),void 0!==t.lightMapIntensity&&(n.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(n.aoMap=i(t.aoMap)),void 0!==t.aoMapIntensity&&(n.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(n.gradientMap=i(t.gradientMap)),void 0!==t.clearcoatMap&&(n.clearcoatMap=i(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(n.clearcoatNormalMap=i(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Lt).fromArray(t.clearcoatNormalScale)),void 0!==t.iridescenceMap&&(n.iridescenceMap=i(t.iridescenceMap)),void 0!==t.iridescenceThicknessMap&&(n.iridescenceThicknessMap=i(t.iridescenceThicknessMap)),void 0!==t.transmissionMap&&(n.transmissionMap=i(t.transmissionMap)),void 0!==t.thicknessMap&&(n.thicknessMap=i(t.thicknessMap)),void 0!==t.sheenColorMap&&(n.sheenColorMap=i(t.sheenColorMap)),void 0!==t.sheenRoughnessMap&&(n.sheenRoughnessMap=i(t.sheenRoughnessMap)),n}setTextures(t){return this.textures=t,this}static createMaterialFromType(t){return new{ShadowMaterial:Cl,SpriteMaterial:na,RawShaderMaterial:Ll,ShaderMaterial:rn,PointsMaterial:Ja,MeshPhysicalMaterial:Pl,MeshStandardMaterial:Rl,MeshPhongMaterial:Il,MeshToonMaterial:Dl,MeshNormalMaterial:Nl,MeshLambertMaterial:Ol,MeshDepthMaterial:Os,MeshDistanceMaterial:zs,MeshBasicMaterial:_i,MeshMatcapMaterial:zl,LineDashedMaterial:Ul,LineBasicMaterial:Fa,Material:xi}[t]}}class Dc{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Nc extends Di{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const t=super.toJSON(this);return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class Oc extends lc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new uc(r.manager);s.setPath(r.path),s.setRequestHeader(r.requestHeader),s.setWithCredentials(r.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e={},i={};function n(t,n){if(void 0!==e[n])return e[n];const r=t.interleavedBuffers[n],s=function(t,e){if(void 0!==i[e])return i[e];const n=t.arrayBuffers[e],r=new Uint32Array(n).buffer;return i[e]=r,r}(t,r.buffer),a=Dt(r.type,s),o=new ta(a,r.stride);return o.uuid=r.uuid,e[n]=o,o}const r=t.isInstancedBufferGeometry?new Nc:new Di,s=t.data.index;if(void 0!==s){const t=Dt(s.type,s.array);r.setIndex(new bi(t,1))}const a=t.data.attributes;for(const e in a){const i=a[e];let s;if(i.isInterleavedBufferAttribute){const e=n(t.data,i.data);s=new ia(e,i.itemSize,i.offset,i.normalized)}else{const t=Dt(i.type,i.array);s=new(i.isInstancedBufferAttribute?Da:bi)(t,i.itemSize,i.normalized)}void 0!==i.name&&(s.name=i.name),void 0!==i.usage&&s.setUsage(i.usage),void 0!==i.updateRange&&(s.updateRange.offset=i.updateRange.offset,s.updateRange.count=i.updateRange.count),r.setAttribute(e,s)}const o=t.data.morphAttributes;if(o)for(const e in o){const i=o[e],s=[];for(let e=0,r=i.length;e<r;e++){const r=i[e];let a;if(r.isInterleavedBufferAttribute){const e=n(t.data,r.data);a=new ia(e,r.itemSize,r.offset,r.normalized)}else{const t=Dt(r.type,r.array);a=new bi(t,r.itemSize,r.normalized)}void 0!==r.name&&(a.name=r.name),s.push(a)}r.morphAttributes[e]=s}t.data.morphTargetsRelative&&(r.morphTargetsRelative=!0);const l=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==l)for(let t=0,e=l.length;t!==e;++t){const e=l[t];r.addGroup(e.start,e.count,e.materialIndex)}const c=t.data.boundingSphere;if(void 0!==c){const t=new ne;void 0!==c.center&&t.fromArray(c.center),r.boundingSphere=new Te(t,c.radius)}return t.name&&(r.name=t.name),t.userData&&(r.userData=t.userData),r}}const zc={UVMapping:n,CubeReflectionMapping:r,CubeRefractionMapping:s,EquirectangularReflectionMapping:a,EquirectangularRefractionMapping:o,CubeUVReflectionMapping:l},Uc={RepeatWrapping:c,ClampToEdgeWrapping:h,MirroredRepeatWrapping:u},Bc={NearestFilter:d,NearestMipmapNearestFilter:p,NearestMipmapLinearFilter:m,LinearFilter:f,LinearMipmapNearestFilter:g,LinearMipmapLinearFilter:v};let Fc;const kc={getContext:function(){return void 0===Fc&&(Fc=new(window.AudioContext||window.webkitAudioContext)),Fc},setContext:function(t){Fc=t}};const Gc=new Ne,Vc=new Ne,Hc=new Ne;class Wc{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=jc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=jc();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function jc(){return("undefined"==typeof performance?Date:performance).now()}const qc=new ne,Xc=new ie,Yc=new ne,Zc=new ne;class Jc extends si{constructor(t){super(),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this}setMediaElementSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this}setMediaStreamSource(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this}setBuffer(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this}play(t=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.onended=this.onEnded.bind(this),e.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=e,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].connect(this.filters[t]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let t=1,e=this.filters.length;t<e;t++)this.filters[t-1].disconnect(this.filters[t]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(t){return t||(t=[]),!0===this._connected?(this.disconnect(),this.filters=t.slice(),this.connect()):this.filters=t.slice(),this}setDetune(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(t){return this.setFilters(t?[t]:[])}setPlaybackRate(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(t){return this.loopStart=t,this}setLoopEnd(t){return this.loopEnd=t,this}getVolume(){return this.gain.gain.value}setVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}}const Kc=new ne,$c=new ie,Qc=new ne,th=new ne;class eh{constructor(t,e,i){let n,r,s;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,r=this._slerpAdditive,s=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,r=this._select,s=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,r=this._lerpAdditive,s=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=r,this._setIdentity=s,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,r=t*n+n;let s=this.cumulativeWeight;if(0===s){for(let t=0;t!==n;++t)i[r+t]=i[t];s=e}else{s+=e;const t=e/s;this._mixBufferRegion(i,r,0,t,n)}this.cumulativeWeight=s}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,r=this.cumulativeWeight,s=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,r<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-r,e)}s>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,r=e+e;t!==r;++t)if(i[t]!==i[t+e]){a.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,r=n;t!==r;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,r){if(n>=.5)for(let n=0;n!==r;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){ie.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,r){const s=this._workIndex*r;ie.multiplyQuaternionsFlat(t,s,t,e,t,i),ie.slerpFlat(t,e,t,e,t,s,n)}_lerp(t,e,i,n,r){const s=1-n;for(let a=0;a!==r;++a){const r=e+a;t[r]=t[r]*s+t[i+a]*n}}_lerpAdditive(t,e,i,n,r){for(let s=0;s!==r;++s){const r=e+s;t[r]=t[r]+t[i+s]*n}}}const ih="\\[\\]\\.:\\/",nh=new RegExp("[\\[\\]\\.:\\/]","g"),rh="[^\\[\\]\\.:\\/]",sh="[^"+ih.replace("\\.","")+"]",ah=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",rh)+/(WCOD+)?/.source.replace("WCOD",sh)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",rh)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",rh)+"$"),oh=["material","materials","bones","map"];class lh{constructor(t,e,i){this.path=e,this.parsedPath=i||lh.parseTrackName(e),this.node=lh.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new lh.Composite(t,e,i):new lh(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(nh,"")}static parseTrackName(t){const e=ah.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==oh.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const r=t[n];if(r.name===e||r.uuid===e)return r;const s=i(r.children);if(s)return s}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,r=i.length;n!==r;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let r=e.propertyIndex;if(t||(t=lh.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;case"map":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const s=t[n];if(void 0===s){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let a=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?a=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(a=this.Versioning.MatrixWorldNeedsUpdate);let o=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[r]&&(r=t.morphTargetDictionary[r])}o=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(o=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(o=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=n;this.getValue=this.GetterByBindingType[o],this.setValue=this.SetterByBindingTypeAndVersioning[o][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}lh.Composite=class{constructor(t,e,i){const n=i||lh.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,r=i.length;n!==r;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},lh.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},lh.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},lh.prototype.GetterByBindingType=[lh.prototype._getValue_direct,lh.prototype._getValue_array,lh.prototype._getValue_arrayElement,lh.prototype._getValue_toArray],lh.prototype.SetterByBindingTypeAndVersioning=[[lh.prototype._setValue_direct,lh.prototype._setValue_direct_setNeedsUpdate,lh.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[lh.prototype._setValue_array,lh.prototype._setValue_array_setNeedsUpdate,lh.prototype._setValue_array_setMatrixWorldNeedsUpdate],[lh.prototype._setValue_arrayElement,lh.prototype._setValue_arrayElement_setNeedsUpdate,lh.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[lh.prototype._setValue_fromArray,lh.prototype._setValue_fromArray_setNeedsUpdate,lh.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class ch{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const r=e.tracks,s=r.length,a=new Array(s),o={endingStart:et,endingEnd:et};for(let t=0;t!==s;++t){const e=r[t].createInterpolant(null);a[t]=e,e.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(s),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,r=n/i,s=i/n;t.warp(1,r,e),this.warp(s,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,r=n.time,s=this.timeScale;let a=this._timeScaleInterpolant;null===a&&(a=n._lendControlInterpolant(),this._timeScaleInterpolant=a);const o=a.parameterPositions,l=a.sampleValues;return o[0]=r,o[1]=r+i,l[0]=t/s,l[1]=e/s,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const r=this._startTime;if(null!==r){const n=(t-r)*i;n<0||0===i?e=0:(this._startTime=null,e=i*n)}e*=this._updateTimeScale(t);const s=this._updateTime(e),a=this._updateWeight(t);if(a>0){const t=this._interpolants,e=this._propertyBindings;if(this.blendMode===st)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(s),e[i].accumulateAdditive(a);else for(let i=0,r=t.length;i!==r;++i)t[i].evaluate(s),e[i].accumulate(n,a)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,r=this._loopCount;const s=2202===i;if(0===t)return-1===r?n:s&&1==(1&r)?e-n:n;if(2200===i){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,s)):this._setEndings(0===this.repetitions,!0,s)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,r+=Math.abs(i);const a=this.repetitions-r;if(a<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===a){const e=t<0;this._setEndings(e,!e,s)}else this._setEndings(!1,!1,s);this._loopCount=r,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(s&&1==(1&r))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=it,n.endingEnd=it):(n.endingStart=t?this.zeroSlopeAtStart?it:et:nt,n.endingEnd=e?this.zeroSlopeAtEnd?it:et:nt)}_scheduleFading(t,e,i){const n=this._mixer,r=n.time;let s=this._weightInterpolant;null===s&&(s=n._lendControlInterpolant(),this._weightInterpolant=s);const a=s.parameterPositions,o=s.sampleValues;return a[0]=r,o[0]=e,a[1]=r+t,o[1]=i,this}}const hh=new Float32Array(1);class uh{constructor(t){this.value=t}clone(){return new uh(void 0===this.value.clone?this.value:this.value.clone())}}let dh=0;function ph(t,e){return t.distance-e.distance}function mh(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,r=n.length;t<r;t++)mh(n[t],e,i,!0)}}const fh=new Lt;const gh=new ne,vh=new ne;const xh=new ne;const _h=new ne,yh=new Ne,Mh=new Ne;function bh(t){const e=[];!0===t.isBone&&e.push(t);for(let i=0;i<t.children.length;i++)e.push.apply(e,bh(t.children[i]));return e}const Sh=new ne,wh=new jt,Th=new jt;const Ah=new ne,Eh=new ne,Ch=new ne;const Lh=new ne,Rh=new sn;function Ph(t,e,i,n,r,s,a){Lh.set(r,s,a).unproject(n);const o=e[t];if(void 0!==o){const t=i.getAttribute("position");for(let e=0,i=o.length;e<i;e++)t.setXYZ(o[e],Lh.x,Lh.y,Lh.z)}}const Ih=new ae;const Dh=new ne;let Nh,Oh;const zh=Uh();function Uh(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),n=new Uint32Array(512),r=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(n[t]=0,n[256|t]=32768,r[t]=24,r[256|t]=24):e<-14?(n[t]=1024>>-e-14,n[256|t]=1024>>-e-14|32768,r[t]=-e-1,r[256|t]=-e-1):e<=15?(n[t]=e+15<<10,n[256|t]=e+15<<10|32768,r[t]=13,r[256|t]=13):e<128?(n[t]=31744,n[256|t]=64512,r[t]=24,r[256|t]=24):(n[t]=31744,n[256|t]=64512,r[t]=13,r[256|t]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,i=0;for(;0==(8388608&e);)e<<=1,i-=8388608;e&=-8388609,i+=947912704,s[t]=e|i}for(let t=1024;t<2048;++t)s[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)a[t]=t<<23;a[31]=1199570944,a[32]=2147483648;for(let t=33;t<63;++t)a[t]=2147483648+(t-32<<23);a[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(o[t]=1024);return{floatView:e,uint32View:i,baseTable:n,shiftTable:r,mantissaTable:s,exponentTable:a,offsetTable:o}}var Bh=Object.freeze({__proto__:null,toHalfFloat:function(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=yt(t,-65504,65504),zh.floatView[0]=t;const e=zh.uint32View[0],i=e>>23&511;return zh.baseTable[i]+((8388607&e)>>zh.shiftTable[i])},fromHalfFloat:function(t){const e=t>>10;return zh.uint32View[0]=zh.mantissaTable[zh.offsetTable[e]+(1023&t)]+zh.exponentTable[e],zh.floatView[0]}});"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:e}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=e),t.ACESFilmicToneMapping=4,t.AddEquation=i,t.AddOperation=2,t.AdditiveAnimationBlendMode=st,t.AdditiveBlending=2,t.AlphaFormat=1021,t.AlwaysDepth=1,t.AlwaysStencilFunc=519,t.AmbientLight=Cc,t.AmbientLightProbe=class extends Pc{constructor(t,e=1){super(void 0,e),this.isAmbientLightProbe=!0;const i=(new jt).set(t);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}},t.AnimationClip=nc,t.AnimationLoader=class extends lc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new uc(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{e(r.parse(JSON.parse(i)))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}parse(t){const e=[];for(let i=0;i<t.length;i++){const n=nc.parse(t[i]);e.push(n)}return e}},t.AnimationMixer=class extends mt{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,r=n.length,s=t._propertyBindings,a=t._interpolants,o=i.uuid,l=this._bindingsByRootAndName;let c=l[o];void 0===c&&(c={},l[o]=c);for(let t=0;t!==r;++t){const r=n[t],l=r.name;let h=c[l];if(void 0!==h)++h.referenceCount,s[t]=h;else{if(h=s[t],void 0!==h){null===h._cacheIndex&&(++h.referenceCount,this._addInactiveBinding(h,o,l));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;h=new eh(lh.create(i,l,n),r.ValueTypeName,r.getValueSize()),++h.referenceCount,this._addInactiveBinding(h,o,l),s[t]=h}a[t].resultBuffer=h.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,r=this._actionsByClip;let s=r[e];if(void 0===s)s={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,r[e]=s;else{const e=s.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),s.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const r=t._clip.uuid,s=this._actionsByClip,a=s[r],o=a.knownActions,l=o[o.length-1],c=t._byClipCacheIndex;l._byClipCacheIndex=c,o[c]=l,o.pop(),t._byClipCacheIndex=null;delete a.actionByRoot[(t._localRoot||this._root).uuid],0===o.length&&delete s[r],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,r=this._bindings;let s=n[e];void 0===s&&(s={},n[e]=s),s[i]=t,t._cacheIndex=r.length,r.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,r=i.path,s=this._bindingsByRootAndName,a=s[n],o=e[e.length-1],l=t._cacheIndex;o._cacheIndex=l,e[l]=o,e.pop(),delete a[r],0===Object.keys(a).length&&delete s[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,r=e[n];t._cacheIndex=n,e[n]=t,r._cacheIndex=i,e[i]=r}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new Xl(new Float32Array(2),new Float32Array(2),1,hh),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,r=e[n];t.__cacheIndex=n,e[n]=t,r.__cacheIndex=i,e[i]=r}clipAction(t,e,i){const n=e||this._root,r=n.uuid;let s="string"==typeof t?nc.findByName(n,t):t;const a=null!==s?s.uuid:t,o=this._actionsByClip[a];let l=null;if(void 0===i&&(i=null!==s?s.blendMode:rt),void 0!==o){const t=o.actionByRoot[r];if(void 0!==t&&t.blendMode===i)return t;l=o.knownActions[0],null===s&&(s=l._clip)}if(null===s)return null;const c=new ch(this,s,e,i);return this._bindAction(c,l),this._addInactiveAction(c,a,r),c}existingAction(t,e){const i=e||this._root,n=i.uuid,r="string"==typeof t?nc.findByName(i,t):t,s=r?r.uuid:t,a=this._actionsByClip[s];return void 0!==a&&a.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,r=Math.sign(t),s=this._accuIndex^=1;for(let a=0;a!==i;++a){e[a]._update(n,t,r,s)}const a=this._bindings,o=this._nActiveBindings;for(let t=0;t!==o;++t)a[t].apply(s);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,r=n[i];if(void 0!==r){const t=r.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,s=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,s._cacheIndex=r,e[r]=s,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}},t.AnimationObjectGroup=class{constructor(){this.isAnimationObjectGroup=!0,this.uuid=_t(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let e=0,i=arguments.length;e!==i;++e)t[arguments[e].uuid]=e;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}add(){const t=this._objects,e=this._indicesByUUID,i=this._paths,n=this._parsedPaths,r=this._bindings,s=r.length;let a,o=t.length,l=this.nCachedObjects_;for(let c=0,h=arguments.length;c!==h;++c){const h=arguments[c],u=h.uuid;let d=e[u];if(void 0===d){d=o++,e[u]=d,t.push(h);for(let t=0,e=s;t!==e;++t)r[t].push(new lh(h,i[t],n[t]))}else if(d<l){a=t[d];const o=--l,c=t[o];e[c.uuid]=d,t[d]=c,e[u]=o,t[o]=h;for(let t=0,e=s;t!==e;++t){const e=r[t],s=e[o];let a=e[d];e[d]=s,void 0===a&&(a=new lh(h,i[t],n[t])),e[o]=a}}else t[d]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_;for(let s=0,a=arguments.length;s!==a;++s){const a=arguments[s],o=a.uuid,l=e[o];if(void 0!==l&&l>=r){const s=r++,c=t[s];e[c.uuid]=l,t[l]=c,e[o]=s,t[s]=a;for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[s],r=e[l];e[l]=n,e[s]=r}}}this.nCachedObjects_=r}uncache(){const t=this._objects,e=this._indicesByUUID,i=this._bindings,n=i.length;let r=this.nCachedObjects_,s=t.length;for(let a=0,o=arguments.length;a!==o;++a){const o=arguments[a].uuid,l=e[o];if(void 0!==l)if(delete e[o],l<r){const a=--r,o=t[a],c=--s,h=t[c];e[o.uuid]=l,t[l]=o,e[h.uuid]=a,t[a]=h,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t],n=e[a],r=e[c];e[l]=n,e[a]=r,e.pop()}}else{const r=--s,a=t[r];r>0&&(e[a.uuid]=l),t[l]=a,t.pop();for(let t=0,e=n;t!==e;++t){const e=i[t];e[l]=e[r],e.pop()}}}this.nCachedObjects_=r}subscribe_(t,e){const i=this._bindingsIndicesByPath;let n=i[t];const r=this._bindings;if(void 0!==n)return r[n];const s=this._paths,a=this._parsedPaths,o=this._objects,l=o.length,c=this.nCachedObjects_,h=new Array(l);n=r.length,i[t]=n,s.push(t),a.push(e),r.push(h);for(let i=c,n=o.length;i!==n;++i){const n=o[i];h[i]=new lh(n,t,e)}return h}unsubscribe_(t){const e=this._bindingsIndicesByPath,i=e[t];if(void 0!==i){const n=this._paths,r=this._parsedPaths,s=this._bindings,a=s.length-1,o=s[a];e[t[a]]=i,s[i]=o,s.pop(),r[i]=r[a],r.pop(),n[i]=n[a],n.pop()}}},t.AnimationUtils=Wl,t.ArcCurve=ao,t.ArrayCamera=Gs,t.ArrowHelper=class extends si{constructor(t=new ne(0,0,1),e=new ne(0,0,0),i=1,n=16776960,r=.2*i,s=.2*r){super(),this.type="ArrowHelper",void 0===Nh&&(Nh=new Di,Nh.setAttribute("position",new Ti([0,0,0,0,1,0],3)),Oh=new Ro(0,.5,1,5,1),Oh.translate(0,-.5,0)),this.position.copy(e),this.line=new ja(Nh,new Fa({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ki(Oh,new _i({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(i,r,s)}setDirection(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{Dh.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(Dh,e)}}setLength(t,e=.2*t,i=.2*e){this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(i,e,i),this.cone.position.y=t,this.cone.updateMatrix()}setColor(t){this.line.material.color.set(t),this.cone.material.color.set(t)}copy(t){return super.copy(t,!1),this.line.copy(t.line),this.cone.copy(t.cone),this}},t.Audio=Jc,t.AudioAnalyser=class{constructor(t,e=2048){this.analyser=t.context.createAnalyser(),this.analyser.fftSize=e,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let t=0;const e=this.getFrequencyData();for(let i=0;i<e.length;i++)t+=e[i];return t/e.length}},t.AudioContext=kc,t.AudioListener=class extends si{constructor(){super(),this.type="AudioListener",this.context=kc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Wc}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}updateMatrixWorld(t){super.updateMatrixWorld(t);const e=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(qc,Xc,Yc),Zc.set(0,0,-1).applyQuaternion(Xc),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(qc.x,t),e.positionY.linearRampToValueAtTime(qc.y,t),e.positionZ.linearRampToValueAtTime(qc.z,t),e.forwardX.linearRampToValueAtTime(Zc.x,t),e.forwardY.linearRampToValueAtTime(Zc.y,t),e.forwardZ.linearRampToValueAtTime(Zc.z,t),e.upX.linearRampToValueAtTime(i.x,t),e.upY.linearRampToValueAtTime(i.y,t),e.upZ.linearRampToValueAtTime(i.z,t)}else e.setPosition(qc.x,qc.y,qc.z),e.setOrientation(Zc.x,Zc.y,Zc.z,i.x,i.y,i.z)}},t.AudioLoader=class extends lc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new uc(this.manager);s.setResponseType("arraybuffer"),s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(function(i){try{const t=i.slice(0);kc.getContext().decodeAudioData(t,(function(t){e(t)}))}catch(e){n?n(e):console.error(e),r.manager.itemError(t)}}),i,n)}},t.AxesHelper=class extends Ya{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=new Di;i.setAttribute("position",new Ti(e,3)),i.setAttribute("color",new Ti([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new Fa({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(t,e,i){const n=new jt,r=this.geometry.attributes.color.array;return n.set(t),n.toArray(r,0),n.toArray(r,3),n.set(e),n.toArray(r,6),n.toArray(r,9),n.set(i),n.toArray(r,12),n.toArray(r,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}},t.BackSide=1,t.BasicDepthPacking=3200,t.BasicShadowMap=0,t.Bone=Ca,t.BooleanKeyframeTrack=Jl,t.Box2=class{constructor(t=new Lt(1/0,1/0),e=new Lt(-1/0,-1/0)){this.isBox2=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=fh.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(t){return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return fh.copy(t).clamp(this.min,this.max).sub(t).length()}intersect(t){return this.min.max(t.min),this.max.min(t.max),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}},t.Box3=ae,t.Box3Helper=class extends Ya{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Di;n.setIndex(new bi(i,1)),n.setAttribute("position",new Ti([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new Fa({color:e,toneMapped:!1})),this.box=t,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(t))}},t.BoxBufferGeometry=class extends Qi{constructor(t,e,i,n,r,s){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(t,e,i,n,r,s)}},t.BoxGeometry=Qi,t.BoxHelper=class extends Ya{constructor(t,e=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Di;r.setIndex(new bi(i,1)),r.setAttribute("position",new bi(n,3)),super(r,new Fa({color:e,toneMapped:!1})),this.object=t,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Ih.setFromObject(this.object),Ih.isEmpty())return;const e=Ih.min,i=Ih.max,n=this.geometry.attributes.position,r=n.array;r[0]=i.x,r[1]=i.y,r[2]=i.z,r[3]=e.x,r[4]=i.y,r[5]=i.z,r[6]=e.x,r[7]=e.y,r[8]=i.z,r[9]=i.x,r[10]=e.y,r[11]=i.z,r[12]=i.x,r[13]=i.y,r[14]=e.z,r[15]=e.x,r[16]=i.y,r[17]=e.z,r[18]=e.x,r[19]=e.y,r[20]=e.z,r[21]=i.x,r[22]=e.y,r[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(t){return this.object=t,this.update(),this}copy(t,e){return super.copy(t,e),this.object=t.object,this}},t.BufferAttribute=bi,t.BufferGeometry=Di,t.BufferGeometryLoader=Oc,t.ByteType=1010,t.Cache=sc,t.Camera=sn,t.CameraHelper=class extends Ya{constructor(t){const e=new Di,i=new Fa({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],r=[],s={};function a(t,e){o(t),o(e)}function o(t){n.push(0,0,0),r.push(0,0,0),void 0===s[t]&&(s[t]=[]),s[t].push(n.length/3-1)}a("n1","n2"),a("n2","n4"),a("n4","n3"),a("n3","n1"),a("f1","f2"),a("f2","f4"),a("f4","f3"),a("f3","f1"),a("n1","f1"),a("n2","f2"),a("n3","f3"),a("n4","f4"),a("p","n1"),a("p","n2"),a("p","n3"),a("p","n4"),a("u1","u2"),a("u2","u3"),a("u3","u1"),a("c","t"),a("p","c"),a("cn1","cn2"),a("cn3","cn4"),a("cf1","cf2"),a("cf3","cf4"),e.setAttribute("position",new Ti(n,3)),e.setAttribute("color",new Ti(r,3)),super(e,i),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update();const l=new jt(16755200),c=new jt(16711680),h=new jt(43775),u=new jt(16777215),d=new jt(3355443);this.setColors(l,c,h,u,d)}setColors(t,e,i,n,r){const s=this.geometry.getAttribute("color");s.setXYZ(0,t.r,t.g,t.b),s.setXYZ(1,t.r,t.g,t.b),s.setXYZ(2,t.r,t.g,t.b),s.setXYZ(3,t.r,t.g,t.b),s.setXYZ(4,t.r,t.g,t.b),s.setXYZ(5,t.r,t.g,t.b),s.setXYZ(6,t.r,t.g,t.b),s.setXYZ(7,t.r,t.g,t.b),s.setXYZ(8,t.r,t.g,t.b),s.setXYZ(9,t.r,t.g,t.b),s.setXYZ(10,t.r,t.g,t.b),s.setXYZ(11,t.r,t.g,t.b),s.setXYZ(12,t.r,t.g,t.b),s.setXYZ(13,t.r,t.g,t.b),s.setXYZ(14,t.r,t.g,t.b),s.setXYZ(15,t.r,t.g,t.b),s.setXYZ(16,t.r,t.g,t.b),s.setXYZ(17,t.r,t.g,t.b),s.setXYZ(18,t.r,t.g,t.b),s.setXYZ(19,t.r,t.g,t.b),s.setXYZ(20,t.r,t.g,t.b),s.setXYZ(21,t.r,t.g,t.b),s.setXYZ(22,t.r,t.g,t.b),s.setXYZ(23,t.r,t.g,t.b),s.setXYZ(24,e.r,e.g,e.b),s.setXYZ(25,e.r,e.g,e.b),s.setXYZ(26,e.r,e.g,e.b),s.setXYZ(27,e.r,e.g,e.b),s.setXYZ(28,e.r,e.g,e.b),s.setXYZ(29,e.r,e.g,e.b),s.setXYZ(30,e.r,e.g,e.b),s.setXYZ(31,e.r,e.g,e.b),s.setXYZ(32,i.r,i.g,i.b),s.setXYZ(33,i.r,i.g,i.b),s.setXYZ(34,i.r,i.g,i.b),s.setXYZ(35,i.r,i.g,i.b),s.setXYZ(36,i.r,i.g,i.b),s.setXYZ(37,i.r,i.g,i.b),s.setXYZ(38,n.r,n.g,n.b),s.setXYZ(39,n.r,n.g,n.b),s.setXYZ(40,r.r,r.g,r.b),s.setXYZ(41,r.r,r.g,r.b),s.setXYZ(42,r.r,r.g,r.b),s.setXYZ(43,r.r,r.g,r.b),s.setXYZ(44,r.r,r.g,r.b),s.setXYZ(45,r.r,r.g,r.b),s.setXYZ(46,r.r,r.g,r.b),s.setXYZ(47,r.r,r.g,r.b),s.setXYZ(48,r.r,r.g,r.b),s.setXYZ(49,r.r,r.g,r.b),s.needsUpdate=!0}update(){const t=this.geometry,e=this.pointMap;Rh.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Ph("c",e,t,Rh,0,0,-1),Ph("t",e,t,Rh,0,0,1),Ph("n1",e,t,Rh,-1,-1,-1),Ph("n2",e,t,Rh,1,-1,-1),Ph("n3",e,t,Rh,-1,1,-1),Ph("n4",e,t,Rh,1,1,-1),Ph("f1",e,t,Rh,-1,-1,1),Ph("f2",e,t,Rh,1,-1,1),Ph("f3",e,t,Rh,-1,1,1),Ph("f4",e,t,Rh,1,1,1),Ph("u1",e,t,Rh,.7,1.1,-1),Ph("u2",e,t,Rh,-.7,1.1,-1),Ph("u3",e,t,Rh,0,2,-1),Ph("cf1",e,t,Rh,-1,0,1),Ph("cf2",e,t,Rh,1,0,1),Ph("cf3",e,t,Rh,0,-1,1),Ph("cf4",e,t,Rh,0,1,1),Ph("cn1",e,t,Rh,-1,0,-1),Ph("cn2",e,t,Rh,1,0,-1),Ph("cn3",e,t,Rh,0,-1,-1),Ph("cn4",e,t,Rh,0,1,-1),t.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}},t.CanvasTexture=class extends Kt{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.isCanvasTexture=!0,this.needsUpdate=!0}},t.CapsuleBufferGeometry=class extends Co{constructor(t,e,i,n){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(t,e,i,n)}},t.CapsuleGeometry=Co,t.CatmullRomCurve3=po,t.CineonToneMapping=3,t.CircleBufferGeometry=class extends Lo{constructor(t,e,i,n){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(t,e,i,n)}},t.CircleGeometry=Lo,t.ClampToEdgeWrapping=h,t.Clock=Wc,t.Color=jt,t.ColorKeyframeTrack=Kl,t.ColorManagement=Bt,t.CompressedTexture=no,t.CompressedTextureLoader=class extends lc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=[],a=new no,o=new uc(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(r.withCredentials);let l=0;function c(c){o.load(t[c],(function(t){const i=r.parse(t,!0);s[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(a.minFilter=f),a.image=s,a.format=i.format,a.needsUpdate=!0,e&&e(a))}),i,n)}if(Array.isArray(t))for(let e=0,i=t.length;e<i;++e)c(e);else o.load(t,(function(t){const i=r.parse(t,!0);if(i.isCubemap){const t=i.mipmaps.length/i.mipmapCount;for(let e=0;e<t;e++){s[e]={mipmaps:[]};for(let t=0;t<i.mipmapCount;t++)s[e].mipmaps.push(i.mipmaps[e*i.mipmapCount+t]),s[e].format=i.format,s[e].width=i.width,s[e].height=i.height}a.image=s}else a.image.width=i.width,a.image.height=i.height,a.mipmaps=i.mipmaps;1===i.mipmapCount&&(a.minFilter=f),a.format=i.format,a.needsUpdate=!0,e&&e(a)}),i,n);return a}},t.ConeBufferGeometry=class extends Po{constructor(t,e,i,n,r,s,a){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(t,e,i,n,r,s,a)}},t.ConeGeometry=Po,t.CubeCamera=ln,t.CubeReflectionMapping=r,t.CubeRefractionMapping=s,t.CubeTexture=cn,t.CubeTextureLoader=class extends lc{constructor(t){super(t)}load(t,e,i,n){const r=new cn,s=new dc(this.manager);s.setCrossOrigin(this.crossOrigin),s.setPath(this.path);let a=0;function o(i){s.load(t[i],(function(t){r.images[i]=t,a++,6===a&&(r.needsUpdate=!0,e&&e(r))}),void 0,n)}for(let e=0;e<t.length;++e)o(e);return r}},t.CubeUVReflectionMapping=l,t.CubicBezierCurve=vo,t.CubicBezierCurve3=xo,t.CubicInterpolant=ql,t.CullFaceBack=1,t.CullFaceFront=2,t.CullFaceFrontBack=3,t.CullFaceNone=0,t.Curve=ro,t.CurvePath=To,t.CustomBlending=5,t.CustomToneMapping=5,t.CylinderBufferGeometry=class extends Ro{constructor(t,e,i,n,r,s,a,o){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(t,e,i,n,r,s,a,o)}},t.CylinderGeometry=Ro,t.Cylindrical=class{constructor(t=1,e=0,i=0){return this.radius=t,this.theta=e,this.y=i,this}set(t,e,i){return this.radius=t,this.theta=e,this.y=i,this}copy(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+i*i),this.theta=Math.atan2(t,i),this.y=e,this}clone(){return(new this.constructor).copy(this)}},t.Data3DTexture=ee,t.DataArrayTexture=te,t.DataTexture=La,t.DataTexture2DArray=class extends te{constructor(t,e,i,n){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(t,e,i,n)}},t.DataTexture3D=class extends ee{constructor(t,e,i,n){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(t,e,i,n)}},t.DataTextureLoader=class extends lc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=new La,a=new uc(this.manager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(r.withCredentials),a.load(t,(function(t){const i=r.parse(t);i&&(void 0!==i.image?s.image=i.image:void 0!==i.data&&(s.image.width=i.width,s.image.height=i.height,s.image.data=i.data),s.wrapS=void 0!==i.wrapS?i.wrapS:h,s.wrapT=void 0!==i.wrapT?i.wrapT:h,s.magFilter=void 0!==i.magFilter?i.magFilter:f,s.minFilter=void 0!==i.minFilter?i.minFilter:f,s.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(s.encoding=i.encoding),void 0!==i.flipY&&(s.flipY=i.flipY),void 0!==i.format&&(s.format=i.format),void 0!==i.type&&(s.type=i.type),void 0!==i.mipmaps&&(s.mipmaps=i.mipmaps,s.minFilter=v),1===i.mipmapCount&&(s.minFilter=f),void 0!==i.generateMipmaps&&(s.generateMipmaps=i.generateMipmaps),s.needsUpdate=!0,e&&e(s,i))}),i,n),s}},t.DataUtils=Bh,t.DecrementStencilOp=7683,t.DecrementWrapStencilOp=34056,t.DefaultLoadingManager=oc,t.DepthFormat=T,t.DepthStencilFormat=A,t.DepthTexture=js,t.DirectionalLight=Ec,t.DirectionalLightHelper=class extends si{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===e&&(e=1);let n=new Di;n.setAttribute("position",new Ti([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const r=new Fa({fog:!1,toneMapped:!1});this.lightPlane=new ja(n,r),this.add(this.lightPlane),n=new Di,n.setAttribute("position",new Ti([0,0,0,0,0,1],3)),this.targetLine=new ja(n,r),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){Ah.setFromMatrixPosition(this.light.matrixWorld),Eh.setFromMatrixPosition(this.light.target.matrixWorld),Ch.subVectors(Eh,Ah),this.lightPlane.lookAt(Eh),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Eh),this.targetLine.scale.z=Ch.length()}},t.DiscreteInterpolant=Yl,t.DodecahedronBufferGeometry=class extends Do{constructor(t,e){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(t,e)}},t.DodecahedronGeometry=Do,t.DoubleSide=2,t.DstAlphaFactor=206,t.DstColorFactor=208,t.DynamicCopyUsage=35050,t.DynamicDrawUsage=35048,t.DynamicReadUsage=35049,t.EdgesGeometry=Bo,t.EllipseCurve=so,t.EqualDepth=4,t.EqualStencilFunc=514,t.EquirectangularReflectionMapping=a,t.EquirectangularRefractionMapping=o,t.Euler=We,t.EventDispatcher=mt,t.ExtrudeBufferGeometry=class extends ml{constructor(t,e){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(t,e)}},t.ExtrudeGeometry=ml,t.FileLoader=uc,t.Float16BufferAttribute=class extends bi{constructor(t,e,i){super(new Uint16Array(t),e,i),this.isFloat16BufferAttribute=!0}},t.Float32BufferAttribute=Ti,t.Float64BufferAttribute=class extends bi{constructor(t,e,i){super(new Float64Array(t),e,i)}},t.FloatType=M,t.Fog=$s,t.FogExp2=Ks,t.FramebufferTexture=class extends Kt{constructor(t,e,i){super({width:t,height:e}),this.isFramebufferTexture=!0,this.format=i,this.magFilter=d,this.minFilter=d,this.generateMipmaps=!1,this.needsUpdate=!0}},t.FrontSide=0,t.Frustum=vn,t.GLBufferAttribute=class{constructor(t,e,i,n,r){this.isGLBufferAttribute=!0,this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=n,this.count=r,this.version=0}set needsUpdate(t){!0===t&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}},t.GLSL1="100",t.GLSL3=dt,t.GreaterDepth=6,t.GreaterEqualDepth=5,t.GreaterEqualStencilFunc=518,t.GreaterStencilFunc=516,t.GridHelper=class extends Ya{constructor(t=10,e=10,i=4473924,n=8947848){i=new jt(i),n=new jt(n);const r=e/2,s=t/e,a=t/2,o=[],l=[];for(let t=0,c=0,h=-a;t<=e;t++,h+=s){o.push(-a,0,h,a,0,h),o.push(h,0,-a,h,0,a);const e=t===r?i:n;e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3,e.toArray(l,c),c+=3}const c=new Di;c.setAttribute("position",new Ti(o,3)),c.setAttribute("color",new Ti(l,3));super(c,new Fa({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}},t.Group=Vs,t.HalfFloatType=b,t.HemisphereLight=mc,t.HemisphereLightHelper=class extends si{constructor(t,e,i){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new vl(e);n.rotateY(.5*Math.PI),this.material=new _i({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const r=n.getAttribute("position"),s=new Float32Array(3*r.count);n.setAttribute("color",new bi(s,3)),this.add(new Ki(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");wh.copy(this.light.color),Th.copy(this.light.groundColor);for(let t=0,i=e.count;t<i;t++){const n=t<i/2?wh:Th;e.setXYZ(t,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(Sh.setFromMatrixPosition(this.light.matrixWorld).negate())}},t.HemisphereLightProbe=class extends Pc{constructor(t,e,i=1){super(void 0,i),this.isHemisphereLightProbe=!0;const n=(new jt).set(t),r=(new jt).set(e),s=new ne(n.r,n.g,n.b),a=new ne(r.r,r.g,r.b),o=Math.sqrt(Math.PI),l=o*Math.sqrt(.75);this.sh.coefficients[0].copy(s).add(a).multiplyScalar(o),this.sh.coefficients[1].copy(s).sub(a).multiplyScalar(l)}},t.IcosahedronBufferGeometry=class extends gl{constructor(t,e){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(t,e)}},t.IcosahedronGeometry=gl,t.ImageBitmapLoader=class extends lc{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const r=this,s=sc.get(t);if(void 0!==s)return r.manager.itemStart(t),setTimeout((function(){e&&e(s),r.manager.itemEnd(t)}),0),s;const a={};a.credentials="anonymous"===this.crossOrigin?"same-origin":"include",a.headers=this.requestHeader,fetch(t,a).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(r.options,{colorSpaceConversion:"none"}))})).then((function(i){sc.add(t,i),e&&e(i),r.manager.itemEnd(t)})).catch((function(e){n&&n(e),r.manager.itemError(t),r.manager.itemEnd(t)})),r.manager.itemStart(t)}},t.ImageLoader=dc,t.ImageUtils=Xt,t.ImmediateRenderObject=function(){console.error("THREE.ImmediateRenderObject has been removed.")},t.IncrementStencilOp=7682,t.IncrementWrapStencilOp=34055,t.InstancedBufferAttribute=Da,t.InstancedBufferGeometry=Nc,t.InstancedInterleavedBuffer=class extends ta{constructor(t,e,i=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}},t.InstancedMesh=Ba,t.Int16BufferAttribute=class extends bi{constructor(t,e,i){super(new Int16Array(t),e,i)}},t.Int32BufferAttribute=class extends bi{constructor(t,e,i){super(new Int32Array(t),e,i)}},t.Int8BufferAttribute=class extends bi{constructor(t,e,i){super(new Int8Array(t),e,i)}},t.IntType=1013,t.InterleavedBuffer=ta,t.InterleavedBufferAttribute=ia,t.Interpolant=jl,t.InterpolateDiscrete=$,t.InterpolateLinear=Q,t.InterpolateSmooth=tt,t.InvertStencilOp=5386,t.KeepStencilOp=ht,t.KeyframeTrack=Zl,t.LOD=Ma,t.LatheBufferGeometry=class extends Eo{constructor(t,e,i,n){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(t,e,i,n)}},t.LatheGeometry=Eo,t.Layers=je,t.LessDepth=2,t.LessEqualDepth=3,t.LessEqualStencilFunc=515,t.LessStencilFunc=513,t.Light=pc,t.LightProbe=Pc,t.Line=ja,t.Line3=class{constructor(t=new ne,e=new ne){this.start=t,this.end=e}set(t,e){return this.start.copy(t),this.end.copy(e),this}copy(t){return this.start.copy(t.start),this.end.copy(t.end),this}getCenter(t){return t.addVectors(this.start,this.end).multiplyScalar(.5)}delta(t){return t.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(t,e){return this.delta(e).multiplyScalar(t).add(this.start)}closestPointToPointParameter(t,e){gh.subVectors(t,this.start),vh.subVectors(this.end,this.start);const i=vh.dot(vh);let n=vh.dot(gh)/i;return e&&(n=yt(n,0,1)),n}closestPointToPoint(t,e,i){const n=this.closestPointToPointParameter(t,e);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this}equals(t){return t.start.equals(this.start)&&t.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}},t.LineBasicMaterial=Fa,t.LineCurve=_o,t.LineCurve3=yo,t.LineDashedMaterial=Ul,t.LineLoop=Za,t.LineSegments=Ya,t.LinearEncoding=at,t.LinearFilter=f,t.LinearInterpolant=Xl,t.LinearMipMapLinearFilter=1008,t.LinearMipMapNearestFilter=1007,t.LinearMipmapLinearFilter=v,t.LinearMipmapNearestFilter=g,t.LinearSRGBColorSpace=ct,t.LinearToneMapping=1,t.Loader=lc,t.LoaderUtils=Dc,t.LoadingManager=ac,t.LoopOnce=2200,t.LoopPingPong=2202,t.LoopRepeat=2201,t.LuminanceAlphaFormat=1025,t.LuminanceFormat=1024,t.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},t.Material=xi,t.MaterialLoader=Ic,t.MathUtils=Ct,t.Matrix3=Rt,t.Matrix4=Ne,t.MaxEquation=104,t.Mesh=Ki,t.MeshBasicMaterial=_i,t.MeshDepthMaterial=Os,t.MeshDistanceMaterial=zs,t.MeshLambertMaterial=Ol,t.MeshMatcapMaterial=zl,t.MeshNormalMaterial=Nl,t.MeshPhongMaterial=Il,t.MeshPhysicalMaterial=Pl,t.MeshStandardMaterial=Rl,t.MeshToonMaterial=Dl,t.MinEquation=103,t.MirroredRepeatWrapping=u,t.MixOperation=1,t.MultiplyBlending=4,t.MultiplyOperation=0,t.NearestFilter=d,t.NearestMipMapLinearFilter=1005,t.NearestMipMapNearestFilter=1004,t.NearestMipmapLinearFilter=m,t.NearestMipmapNearestFilter=p,t.NeverDepth=0,t.NeverStencilFunc=512,t.NoBlending=0,t.NoColorSpace="",t.NoToneMapping=0,t.NormalAnimationBlendMode=rt,t.NormalBlending=1,t.NotEqualDepth=7,t.NotEqualStencilFunc=517,t.NumberKeyframeTrack=$l,t.Object3D=si,t.ObjectLoader=class extends lc{constructor(t){super(t)}load(t,e,i,n){const r=this,s=""===this.path?Dc.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||s;const a=new uc(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(i){let s=null;try{s=JSON.parse(i)}catch(e){return void 0!==n&&n(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const a=s.metadata;void 0!==a&&void 0!==a.type&&"geometry"!==a.type.toLowerCase()?r.parse(s,e):console.error("THREE.ObjectLoader: Can't load "+t)}),i,n)}async loadAsync(t,e){const i=""===this.path?Dc.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||i;const n=new uc(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const r=await n.loadAsync(t,e),s=JSON.parse(r),a=s.metadata;if(void 0===a||void 0===a.type||"geometry"===a.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+t);return await this.parseAsync(s)}parse(t,e){const i=this.parseAnimations(t.animations),n=this.parseShapes(t.shapes),r=this.parseGeometries(t.geometries,n),s=this.parseImages(t.images,(function(){void 0!==e&&e(l)})),a=this.parseTextures(t.textures,s),o=this.parseMaterials(t.materials,a),l=this.parseObject(t.object,r,o,a,i),c=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,c),void 0!==e){let t=!1;for(const e in s)if(s[e].data instanceof HTMLImageElement){t=!0;break}!1===t&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,i),r=await this.parseImagesAsync(t.images),s=this.parseTextures(t.textures,r),a=this.parseMaterials(t.materials,s),o=this.parseObject(t.object,n,a,s,e),l=this.parseSkeletons(t.skeletons,o);return this.bindSkeletons(o,l),o}parseShapes(t){const e={};if(void 0!==t)for(let i=0,n=t.length;i<n;i++){const n=(new Fo).fromJSON(t[i]);e[n.uuid]=n}return e}parseSkeletons(t,e){const i={},n={};if(e.traverse((function(t){t.isBone&&(n[t.uuid]=t)})),void 0!==t)for(let e=0,r=t.length;e<r;e++){const r=(new Ia).fromJSON(t[e],n);i[r.uuid]=r}return i}parseGeometries(t,e){const i={};if(void 0!==t){const n=new Oc;for(let r=0,s=t.length;r<s;r++){let s;const a=t[r];switch(a.type){case"BufferGeometry":case"InstancedBufferGeometry":s=n.parse(a);break;default:a.type in El?s=El[a.type].fromJSON(a,e):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${a.type}"`)}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),!0===s.isBufferGeometry&&void 0!==a.userData&&(s.userData=a.userData),i[a.uuid]=s}}return i}parseMaterials(t,e){const i={},n={};if(void 0!==t){const r=new Ic;r.setTextures(e);for(let e=0,s=t.length;e<s;e++){const s=t[e];void 0===i[s.uuid]&&(i[s.uuid]=r.parse(s)),n[s.uuid]=i[s.uuid]}}return n}parseAnimations(t){const e={};if(void 0!==t)for(let i=0;i<t.length;i++){const n=t[i],r=nc.parse(n);e[r.uuid]=r}return e}parseImages(t,e){const i=this,n={};let r;function s(t){if("string"==typeof t){const e=t;return function(t){return i.manager.itemStart(t),r.load(t,(function(){i.manager.itemEnd(t)}),void 0,(function(){i.manager.itemError(t),i.manager.itemEnd(t)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(e)?e:i.resourcePath+e)}return t.data?{data:Dt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){const i=new ac(e);r=new dc(i),r.setCrossOrigin(this.crossOrigin);for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.url;if(Array.isArray(r)){const t=[];for(let e=0,i=r.length;e<i;e++){const i=s(r[e]);null!==i&&(i instanceof HTMLImageElement?t.push(i):t.push(new La(i.data,i.width,i.height)))}n[i.uuid]=new Yt(t)}else{const t=s(i.url);n[i.uuid]=new Yt(t)}}}return n}async parseImagesAsync(t){const e=this,i={};let n;async function r(t){if("string"==typeof t){const i=t,r=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:e.resourcePath+i;return await n.loadAsync(r)}return t.data?{data:Dt(t.type,t.data),width:t.width,height:t.height}:null}if(void 0!==t&&t.length>0){n=new dc(this.manager),n.setCrossOrigin(this.crossOrigin);for(let e=0,n=t.length;e<n;e++){const n=t[e],s=n.url;if(Array.isArray(s)){const t=[];for(let e=0,i=s.length;e<i;e++){const i=s[e],n=await r(i);null!==n&&(n instanceof HTMLImageElement?t.push(n):t.push(new La(n.data,n.width,n.height)))}i[n.uuid]=new Yt(t)}else{const t=await r(n.url);i[n.uuid]=new Yt(t)}}}return i}parseTextures(t,e){function i(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const n={};if(void 0!==t)for(let r=0,s=t.length;r<s;r++){const s=t[r];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===e[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);const a=e[s.image],o=a.data;let l;Array.isArray(o)?(l=new cn,6===o.length&&(l.needsUpdate=!0)):(l=o&&o.data?new La:new Kt,o&&(l.needsUpdate=!0)),l.source=a,l.uuid=s.uuid,void 0!==s.name&&(l.name=s.name),void 0!==s.mapping&&(l.mapping=i(s.mapping,zc)),void 0!==s.offset&&l.offset.fromArray(s.offset),void 0!==s.repeat&&l.repeat.fromArray(s.repeat),void 0!==s.center&&l.center.fromArray(s.center),void 0!==s.rotation&&(l.rotation=s.rotation),void 0!==s.wrap&&(l.wrapS=i(s.wrap[0],Uc),l.wrapT=i(s.wrap[1],Uc)),void 0!==s.format&&(l.format=s.format),void 0!==s.type&&(l.type=s.type),void 0!==s.encoding&&(l.encoding=s.encoding),void 0!==s.minFilter&&(l.minFilter=i(s.minFilter,Bc)),void 0!==s.magFilter&&(l.magFilter=i(s.magFilter,Bc)),void 0!==s.anisotropy&&(l.anisotropy=s.anisotropy),void 0!==s.flipY&&(l.flipY=s.flipY),void 0!==s.premultiplyAlpha&&(l.premultiplyAlpha=s.premultiplyAlpha),void 0!==s.unpackAlignment&&(l.unpackAlignment=s.unpackAlignment),void 0!==s.userData&&(l.userData=s.userData),n[s.uuid]=l}return n}parseObject(t,e,i,n,r){let s,a,o;function l(t){return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined geometry",t),e[t]}function c(t){if(void 0!==t){if(Array.isArray(t)){const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];void 0===i[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),e.push(i[r])}return e}return void 0===i[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),i[t]}}function h(t){return void 0===n[t]&&console.warn("THREE.ObjectLoader: Undefined texture",t),n[t]}switch(t.type){case"Scene":s=new Qs,void 0!==t.background&&(Number.isInteger(t.background)?s.background=new jt(t.background):s.background=h(t.background)),void 0!==t.environment&&(s.environment=h(t.environment)),void 0!==t.fog&&("Fog"===t.fog.type?s.fog=new $s(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(s.fog=new Ks(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":s=new an(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(s.focus=t.focus),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.filmGauge&&(s.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(s.filmOffset=t.filmOffset),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"OrthographicCamera":s=new Rn(t.left,t.right,t.top,t.bottom,t.near,t.far),void 0!==t.zoom&&(s.zoom=t.zoom),void 0!==t.view&&(s.view=Object.assign({},t.view));break;case"AmbientLight":s=new Cc(t.color,t.intensity);break;case"DirectionalLight":s=new Ec(t.color,t.intensity);break;case"PointLight":s=new Tc(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":s=new Lc(t.color,t.intensity,t.width,t.height);break;case"SpotLight":s=new yc(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":s=new mc(t.color,t.groundColor,t.intensity);break;case"LightProbe":s=(new Pc).fromJSON(t);break;case"SkinnedMesh":a=l(t.geometry),o=c(t.material),s=new Ea(a,o),void 0!==t.bindMode&&(s.bindMode=t.bindMode),void 0!==t.bindMatrix&&s.bindMatrix.fromArray(t.bindMatrix),void 0!==t.skeleton&&(s.skeleton=t.skeleton);break;case"Mesh":a=l(t.geometry),o=c(t.material),s=new Ki(a,o);break;case"InstancedMesh":a=l(t.geometry),o=c(t.material);const e=t.count,i=t.instanceMatrix,n=t.instanceColor;s=new Ba(a,o,e),s.instanceMatrix=new Da(new Float32Array(i.array),16),void 0!==n&&(s.instanceColor=new Da(new Float32Array(n.array),n.itemSize));break;case"LOD":s=new Ma;break;case"Line":s=new ja(l(t.geometry),c(t.material));break;case"LineLoop":s=new Za(l(t.geometry),c(t.material));break;case"LineSegments":s=new Ya(l(t.geometry),c(t.material));break;case"PointCloud":case"Points":s=new eo(l(t.geometry),c(t.material));break;case"Sprite":s=new va(c(t.material));break;case"Group":s=new Vs;break;case"Bone":s=new Ca;break;default:s=new si}if(s.uuid=t.uuid,void 0!==t.name&&(s.name=t.name),void 0!==t.matrix?(s.matrix.fromArray(t.matrix),void 0!==t.matrixAutoUpdate&&(s.matrixAutoUpdate=t.matrixAutoUpdate),s.matrixAutoUpdate&&s.matrix.decompose(s.position,s.quaternion,s.scale)):(void 0!==t.position&&s.position.fromArray(t.position),void 0!==t.rotation&&s.rotation.fromArray(t.rotation),void 0!==t.quaternion&&s.quaternion.fromArray(t.quaternion),void 0!==t.scale&&s.scale.fromArray(t.scale)),void 0!==t.castShadow&&(s.castShadow=t.castShadow),void 0!==t.receiveShadow&&(s.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(s.shadow.bias=t.shadow.bias),void 0!==t.shadow.normalBias&&(s.shadow.normalBias=t.shadow.normalBias),void 0!==t.shadow.radius&&(s.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&s.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(s.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(s.visible=t.visible),void 0!==t.frustumCulled&&(s.frustumCulled=t.frustumCulled),void 0!==t.renderOrder&&(s.renderOrder=t.renderOrder),void 0!==t.userData&&(s.userData=t.userData),void 0!==t.layers&&(s.layers.mask=t.layers),void 0!==t.children){const a=t.children;for(let t=0;t<a.length;t++)s.add(this.parseObject(a[t],e,i,n,r))}if(void 0!==t.animations){const e=t.animations;for(let t=0;t<e.length;t++){const i=e[t];s.animations.push(r[i])}}if("LOD"===t.type){void 0!==t.autoUpdate&&(s.autoUpdate=t.autoUpdate);const e=t.levels;for(let t=0;t<e.length;t++){const i=e[t],n=s.getObjectByProperty("uuid",i.object);void 0!==n&&s.addLevel(n,i.distance)}}return s}bindSkeletons(t,e){0!==Object.keys(e).length&&t.traverse((function(t){if(!0===t.isSkinnedMesh&&void 0!==t.skeleton){const i=e[t.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",t.skeleton):t.bind(i,t.bindMatrix)}}))}},t.ObjectSpaceNormalMap=1,t.OctahedronBufferGeometry=class extends vl{constructor(t,e){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(t,e)}},t.OctahedronGeometry=vl,t.OneFactor=201,t.OneMinusDstAlphaFactor=207,t.OneMinusDstColorFactor=209,t.OneMinusSrcAlphaFactor=205,t.OneMinusSrcColorFactor=203,t.OrthographicCamera=Rn,t.PCFShadowMap=1,t.PCFSoftShadowMap=2,t.PMREMGenerator=Fn,t.Path=Ao,t.PerspectiveCamera=an,t.Plane=mn,t.PlaneBufferGeometry=class extends yn{constructor(t,e,i,n){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(t,e,i,n)}},t.PlaneGeometry=yn,t.PlaneHelper=class extends ja{constructor(t,e=1,i=16776960){const n=i,r=new Di;r.setAttribute("position",new Ti([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),r.computeBoundingSphere(),super(r,new Fa({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=t,this.size=e;const s=new Di;s.setAttribute("position",new Ti([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),s.computeBoundingSphere(),this.add(new Ki(s,new _i({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(t){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(t)}},t.PointLight=Tc,t.PointLightHelper=class extends Ki{constructor(t,e,i){super(new yl(e,4,2),new _i({wireframe:!0,fog:!1,toneMapped:!1})),this.light=t,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}},t.Points=eo,t.PointsMaterial=Ja,t.PolarGridHelper=class extends Ya{constructor(t=10,e=16,i=8,n=64,r=4473924,s=8947848){r=new jt(r),s=new jt(s);const a=[],o=[];if(e>1)for(let i=0;i<e;i++){const n=i/e*(2*Math.PI),l=Math.sin(n)*t,c=Math.cos(n)*t;a.push(0,0,0),a.push(l,0,c);const h=1&i?r:s;o.push(h.r,h.g,h.b),o.push(h.r,h.g,h.b)}for(let e=0;e<i;e++){const l=1&e?r:s,c=t-t/i*e;for(let t=0;t<n;t++){let e=t/n*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c;a.push(i,0,r),o.push(l.r,l.g,l.b),e=(t+1)/n*(2*Math.PI),i=Math.sin(e)*c,r=Math.cos(e)*c,a.push(i,0,r),o.push(l.r,l.g,l.b)}}const l=new Di;l.setAttribute("position",new Ti(a,3)),l.setAttribute("color",new Ti(o,3));super(l,new Fa({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}},t.PolyhedronBufferGeometry=class extends Io{constructor(t,e,i,n){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(t,e,i,n)}},t.PolyhedronGeometry=Io,t.PositionalAudio=class extends Jc{constructor(t){super(t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(t){return this.panner.refDistance=t,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(t){return this.panner.rolloffFactor=t,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(t){return this.panner.distanceModel=t,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(t){return this.panner.maxDistance=t,this}setDirectionalCone(t,e,i){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=i,this}updateMatrixWorld(t){if(super.updateMatrixWorld(t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Kc,$c,Qc),th.set(0,0,1).applyQuaternion($c);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime(Kc.x,t),e.positionY.linearRampToValueAtTime(Kc.y,t),e.positionZ.linearRampToValueAtTime(Kc.z,t),e.orientationX.linearRampToValueAtTime(th.x,t),e.orientationY.linearRampToValueAtTime(th.y,t),e.orientationZ.linearRampToValueAtTime(th.z,t)}else e.setPosition(Kc.x,Kc.y,Kc.z),e.setOrientation(th.x,th.y,th.z)}},t.PropertyBinding=lh,t.PropertyMixer=eh,t.QuadraticBezierCurve=Mo,t.QuadraticBezierCurve3=bo,t.Quaternion=ie,t.QuaternionKeyframeTrack=tc,t.QuaternionLinearInterpolant=Ql,t.REVISION=e,t.RGBADepthPacking=3201,t.RGBAFormat=w,t.RGBAIntegerFormat=1033,t.RGBA_ASTC_10x10_Format=Y,t.RGBA_ASTC_10x5_Format=j,t.RGBA_ASTC_10x6_Format=q,t.RGBA_ASTC_10x8_Format=X,t.RGBA_ASTC_12x10_Format=Z,t.RGBA_ASTC_12x12_Format=J,t.RGBA_ASTC_4x4_Format=U,t.RGBA_ASTC_5x4_Format=B,t.RGBA_ASTC_5x5_Format=F,t.RGBA_ASTC_6x5_Format=k,t.RGBA_ASTC_6x6_Format=G,t.RGBA_ASTC_8x5_Format=V,t.RGBA_ASTC_8x6_Format=H,t.RGBA_ASTC_8x8_Format=W,t.RGBA_BPTC_Format=K,t.RGBA_ETC2_EAC_Format=z,t.RGBA_PVRTC_2BPPV1_Format=N,t.RGBA_PVRTC_4BPPV1_Format=D,t.RGBA_S3TC_DXT1_Format=C,t.RGBA_S3TC_DXT3_Format=L,t.RGBA_S3TC_DXT5_Format=R,t.RGBFormat=1022,t.RGB_ETC1_Format=36196,t.RGB_ETC2_Format=O,t.RGB_PVRTC_2BPPV1_Format=I,t.RGB_PVRTC_4BPPV1_Format=P,t.RGB_S3TC_DXT1_Format=E,t.RGFormat=1030,t.RGIntegerFormat=1031,t.RawShaderMaterial=Ll,t.Ray=De,t.Raycaster=class{constructor(t,e,i=0,n=1/0){this.ray=new De(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new je,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}intersectObject(t,e=!0,i=[]){return mh(t,this,i,e),i.sort(ph),i}intersectObjects(t,e=!0,i=[]){for(let n=0,r=t.length;n<r;n++)mh(t[n],this,i,e);return i.sort(ph),i}},t.RectAreaLight=Lc,t.RedFormat=1028,t.RedIntegerFormat=1029,t.ReinhardToneMapping=2,t.RepeatWrapping=c,t.ReplaceStencilOp=7681,t.ReverseSubtractEquation=102,t.RingBufferGeometry=class extends xl{constructor(t,e,i,n,r,s){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(t,e,i,n,r,s)}},t.RingGeometry=xl,t.SRGBColorSpace=lt,t.Scene=Qs,t.ShaderChunk=Mn,t.ShaderLib=Sn,t.ShaderMaterial=rn,t.ShadowMaterial=Cl,t.Shape=Fo,t.ShapeBufferGeometry=class extends _l{constructor(t,e){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(t,e)}},t.ShapeGeometry=_l,t.ShapePath=class{constructor(){this.type="ShapePath",this.color=new jt,this.subPaths=[],this.currentPath=null}moveTo(t,e){return this.currentPath=new Ao,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this}lineTo(t,e){return this.currentPath.lineTo(t,e),this}quadraticCurveTo(t,e,i,n){return this.currentPath.quadraticCurveTo(t,e,i,n),this}bezierCurveTo(t,e,i,n,r,s){return this.currentPath.bezierCurveTo(t,e,i,n,r,s),this}splineThru(t){return this.currentPath.splineThru(t),this}toShapes(t){function e(t,e){const i=e.length;let n=!1;for(let r=i-1,s=0;s<i;r=s++){let i=e[r],a=e[s],o=a.x-i.x,l=a.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=e[s],o=-o,a=e[r],l=-l),t.y<i.y||t.y>a.y)continue;if(t.y===i.y){if(t.x===i.x)return!0}else{const e=l*(t.x-i.x)-o*(t.y-i.y);if(0===e)return!0;if(e<0)continue;n=!n}}else{if(t.y!==i.y)continue;if(a.x<=t.x&&t.x<=i.x||i.x<=t.x&&t.x<=a.x)return!0}}return n}const i=ul.isClockWise,n=this.subPaths;if(0===n.length)return[];let r,s,a;const o=[];if(1===n.length)return s=n[0],a=new Fo,a.curves=s.curves,o.push(a),o;let l=!i(n[0].getPoints());l=t?!l:l;const c=[],h=[];let u,d,p=[],m=0;h[m]=void 0,p[m]=[];for(let e=0,a=n.length;e<a;e++)s=n[e],u=s.getPoints(),r=i(u),r=t?!r:r,r?(!l&&h[m]&&m++,h[m]={s:new Fo,p:u},h[m].s.curves=s.curves,l&&m++,p[m]=[]):p[m].push({h:s,p:u[0]});if(!h[0])return function(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new Fo;r.curves=n.curves,e.push(r)}return e}(n);if(h.length>1){let t=!1,i=0;for(let t=0,e=h.length;t<e;t++)c[t]=[];for(let n=0,r=h.length;n<r;n++){const r=p[n];for(let s=0;s<r.length;s++){const a=r[s];let o=!0;for(let r=0;r<h.length;r++)e(a.p,h[r].p)&&(n!==r&&i++,o?(o=!1,c[r].push(a)):t=!0);o&&c[n].push(a)}}i>0&&!1===t&&(p=c)}for(let t=0,e=h.length;t<e;t++){a=h[t].s,o.push(a),d=p[t];for(let t=0,e=d.length;t<e;t++)a.holes.push(d[t].h)}return o}},t.ShapeUtils=ul,t.ShortType=1011,t.Skeleton=Ia,t.SkeletonHelper=class extends Ya{constructor(t){const e=bh(t),i=new Di,n=[],r=[],s=new jt(0,0,1),a=new jt(0,1,0);for(let t=0;t<e.length;t++){const i=e[t];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(s.r,s.g,s.b),r.push(a.r,a.g,a.b))}i.setAttribute("position",new Ti(n,3)),i.setAttribute("color",new Ti(r,3));super(i,new Fa({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=t,this.bones=e,this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(t){const e=this.bones,i=this.geometry,n=i.getAttribute("position");Mh.copy(this.root.matrixWorld).invert();for(let t=0,i=0;t<e.length;t++){const r=e[t];r.parent&&r.parent.isBone&&(yh.multiplyMatrices(Mh,r.matrixWorld),_h.setFromMatrixPosition(yh),n.setXYZ(i,_h.x,_h.y,_h.z),yh.multiplyMatrices(Mh,r.parent.matrixWorld),_h.setFromMatrixPosition(yh),n.setXYZ(i+1,_h.x,_h.y,_h.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(t)}},t.SkinnedMesh=Ea,t.Source=Yt,t.Sphere=Te,t.SphereBufferGeometry=class extends yl{constructor(t,e,i,n,r,s,a){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(t,e,i,n,r,s,a)}},t.SphereGeometry=yl,t.Spherical=class{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(yt(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}},t.SphericalHarmonics3=Rc,t.SplineCurve=So,t.SpotLight=yc,t.SpotLightHelper=class extends si{constructor(t,e){super(),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const i=new Di,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,e=1,i=32;t<i;t++,e++){const r=t/i*Math.PI*2,s=e/i*Math.PI*2;n.push(Math.cos(r),Math.sin(r),1,Math.cos(s),Math.sin(s),1)}i.setAttribute("position",new Ti(n,3));const r=new Fa({fog:!1,toneMapped:!1});this.cone=new Ya(i,r),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),xh.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(xh),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}},t.Sprite=va,t.SpriteMaterial=na,t.SrcAlphaFactor=204,t.SrcAlphaSaturateFactor=210,t.SrcColorFactor=202,t.StaticCopyUsage=35046,t.StaticDrawUsage=ut,t.StaticReadUsage=35045,t.StereoCamera=class{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new an,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new an,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep,Hc.copy(t.projectionMatrix);const i=e.eyeSep/2,n=i*e.near/e.focus,r=e.near*Math.tan(vt*e.fov*.5)/e.zoom;let s,a;Vc.elements[12]=-i,Gc.elements[12]=i,s=-r*e.aspect+n,a=r*e.aspect+n,Hc.elements[0]=2*e.near/(a-s),Hc.elements[8]=(a+s)/(a-s),this.cameraL.projectionMatrix.copy(Hc),s=-r*e.aspect-n,a=r*e.aspect-n,Hc.elements[0]=2*e.near/(a-s),Hc.elements[8]=(a+s)/(a-s),this.cameraR.projectionMatrix.copy(Hc)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Vc),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(Gc)}},t.StreamCopyUsage=35042,t.StreamDrawUsage=35040,t.StreamReadUsage=35041,t.StringKeyframeTrack=ec,t.SubtractEquation=101,t.SubtractiveBlending=3,t.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},t.TangentSpaceNormalMap=0,t.TetrahedronBufferGeometry=class extends Ml{constructor(t,e){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(t,e)}},t.TetrahedronGeometry=Ml,t.Texture=Kt,t.TextureLoader=class extends lc{constructor(t){super(t)}load(t,e,i,n){const r=new Kt,s=new dc(this.manager);return s.setCrossOrigin(this.crossOrigin),s.setPath(this.path),s.load(t,(function(t){r.image=t,r.needsUpdate=!0,void 0!==e&&e(r)}),i,n),r}},t.TorusBufferGeometry=class extends bl{constructor(t,e,i,n,r){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(t,e,i,n,r)}},t.TorusGeometry=bl,t.TorusKnotBufferGeometry=class extends Sl{constructor(t,e,i,n,r,s){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(t,e,i,n,r,s)}},t.TorusKnotGeometry=Sl,t.Triangle=gi,t.TriangleFanDrawMode=2,t.TriangleStripDrawMode=1,t.TrianglesDrawMode=0,t.TubeBufferGeometry=class extends wl{constructor(t,e,i,n,r){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(t,e,i,n,r)}},t.TubeGeometry=wl,t.UVMapping=n,t.Uint16BufferAttribute=Si,t.Uint32BufferAttribute=wi,t.Uint8BufferAttribute=class extends bi{constructor(t,e,i){super(new Uint8Array(t),e,i)}},t.Uint8ClampedBufferAttribute=class extends bi{constructor(t,e,i){super(new Uint8ClampedArray(t),e,i)}},t.Uniform=uh,t.UniformsGroup=class extends mt{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:dh++}),this.name="",this.usage=ut,this.uniforms=[]}add(t){return this.uniforms.push(t),this}remove(t){const e=this.uniforms.indexOf(t);return-1!==e&&this.uniforms.splice(e,1),this}setName(t){return this.name=t,this}setUsage(t){return this.usage=t,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(t){this.name=t.name,this.usage=t.usage;const e=t.uniforms;this.uniforms.length=0;for(let t=0,i=e.length;t<i;t++)this.uniforms.push(e[t].clone());return this}clone(){return(new this.constructor).copy(this)}},t.UniformsLib=bn,t.UniformsUtils=nn,t.UnsignedByteType=x,t.UnsignedInt248Type=S,t.UnsignedIntType=y,t.UnsignedShort4444Type=1017,t.UnsignedShort5551Type=1018,t.UnsignedShortType=_,t.VSMShadowMap=3,t.Vector2=Lt,t.Vector3=ne,t.Vector4=$t,t.VectorKeyframeTrack=ic,t.VideoTexture=class extends Kt{constructor(t,e,i,n,r,s,a,o,l){super(t,e,i,n,r,s,a,o,l),this.isVideoTexture=!0,this.minFilter=void 0!==s?s:f,this.magFilter=void 0!==r?r:f,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in t&&t.requestVideoFrameCallback((function e(){c.needsUpdate=!0,t.requestVideoFrameCallback(e)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const t=this.image;!1==="requestVideoFrameCallback"in t&&t.readyState>=t.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}},t.WebGL1Renderer=Js,t.WebGL3DRenderTarget=class extends Qt{constructor(t,e,i){super(t,e),this.isWebGL3DRenderTarget=!0,this.depth=i,this.texture=new ee(null,t,e,i),this.texture.isRenderTargetTexture=!0}},t.WebGLArrayRenderTarget=class extends Qt{constructor(t,e,i){super(t,e),this.isWebGLArrayRenderTarget=!0,this.depth=i,this.texture=new te(null,t,e,i),this.texture.isRenderTargetTexture=!0}},t.WebGLCubeRenderTarget=hn,t.WebGLMultipleRenderTargets=class extends Qt{constructor(t,e,i,n={}){super(t,e,n),this.isWebGLMultipleRenderTargets=!0;const r=this.texture;this.texture=[];for(let t=0;t<i;t++)this.texture[t]=r.clone(),this.texture[t].isRenderTargetTexture=!0}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,r=this.texture.length;n<r;n++)this.texture[n].image.width=t,this.texture[n].image.height=e,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e),this}copy(t){this.dispose(),this.width=t.width,this.height=t.height,this.depth=t.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.texture.length=0;for(let e=0,i=t.texture.length;e<i;e++)this.texture[e]=t.texture[e].clone(),this.texture[e].isRenderTargetTexture=!0;return this}},t.WebGLMultisampleRenderTarget=class extends Qt{constructor(t,e,i){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(t,e,i),this.samples=4}},t.WebGLRenderTarget=Qt,t.WebGLRenderer=Zs,t.WebGLUtils=ks,t.WireframeGeometry=Tl,t.WrapAroundEnding=nt,t.ZeroCurvatureEnding=et,t.ZeroFactor=200,t.ZeroSlopeEnding=it,t.ZeroStencilOp=0,t._SRGBAFormat=pt,t.sRGBEncoding=ot,Object.defineProperty(t,"__esModule",{value:!0})}));
!function(){function e(){throw new Error("BufferGeometryUtils: computeTangents renamed to computeMikkTSpaceTangents.")}function t(e,t,r=!0){if(!t||!t.isReady)throw new Error("BufferGeometryUtils: Initialized MikkTSpace library required.");if(!e.hasAttribute("position")||!e.hasAttribute("normal")||!e.hasAttribute("uv"))throw new Error('BufferGeometryUtils: Tangents require "position", "normal", and "uv" attributes.');function o(r){if(r.normalized||r.isInterleavedBufferAttribute){var o=(r.isInterleavedBufferAttribute?r.data:r).array;const n=new Float32Array(r.getCount()*r.itemSize);for(let e=0,t=0;e<r.getCount();e++)n[t++]=THREE.MathUtils.denormalize(r.getX(e),o),n[t++]=THREE.MathUtils.denormalize(r.getY(e),o),2<r.itemSize&&(n[t++]=THREE.MathUtils.denormalize(r.getZ(e),o));return n}return r.array instanceof Float32Array?r.array:new Float32Array(r.array)}const n=e.index?e.toNonIndexed():e,i=t.generateTangents(o(n.attributes.position),o(n.attributes.normal),o(n.attributes.uv));if(r)for(let e=3;e<i.length;e+=4)i[e]*=-1;return n.setAttribute("tangent",new THREE.BufferAttribute(i,4)),e!==n&&e.copy(n),e}function r(r,o=!1){var n=null!==r[0].index;const i=new Set(Object.keys(r[0].attributes)),s=new Set(Object.keys(r[0].morphAttributes)),a={},u={};var f=r[0].morphTargetsRelative;const l=new THREE.BufferGeometry;let m=0;for(let t=0;t<r.length;++t){var c=r[t];let e=0;if(n!=(null!==c.index))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(const E in c.attributes){if(!i.has(E))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+'. All geometries must have compatible attributes; make sure "'+E+'" attribute exists among all geometries, or in none of them.'),null;void 0===a[E]&&(a[E]=[]),a[E].push(c.attributes[E]),e++}if(e!==i.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". Make sure all geometries have the same number of attributes."),null;if(f!==c.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(const h in c.morphAttributes){if(!s.has(h))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+".  .morphAttributes must be consistent throughout all geometries."),null;void 0===u[h]&&(u[h]=[]),u[h].push(c.morphAttributes[h])}if(l.userData.mergedUserData=l.userData.mergedUserData||[],l.userData.mergedUserData.push(c.userData),o){let e;if(n)e=c.index.count;else{if(void 0===c.attributes.position)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+t+". The geometry must have either an index or a position attribute"),null;e=c.attributes.position.count}l.addGroup(m,e,t),m+=e}}if(n){let t=0;const b=[];for(let e=0;e<r.length;++e){const p=r[e].index;for(let e=0;e<p.count;++e)b.push(p.getX(e)+t);t+=r[e].attributes.position.count}l.setIndex(b)}for(const t in a){var e=B(a[t]);if(!e)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+t+" attribute."),null;l.setAttribute(t,e)}for(const y in u){var g=u[y][0].length;if(0===g)break;l.morphAttributes=l.morphAttributes||{},l.morphAttributes[y]=[];for(let t=0;t<g;++t){const T=[];for(let e=0;e<u[y].length;++e)T.push(u[y][e][t]);var d=B(T);if(!d)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+y+" morphAttribute."),null;l.morphAttributes[y].push(d)}}return l}function B(t){let r,o,n,i=0;for(let e=0;e<t.length;++e){var s=t[e];if(s.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(void 0===r&&(r=s.array.constructor),r!==s.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.array must be of consistent array types across matching attributes."),null;if(void 0===o&&(o=s.itemSize),o!==s.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.itemSize must be consistent across matching attributes."),null;if(void 0===n&&(n=s.normalized),n!==s.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. THREE.BufferAttribute.normalized must be consistent across matching attributes."),null;i+=s.array.length}const a=new r(i);let u=0;for(let e=0;e<t.length;++e)a.set(t[e].array,u),u+=t[e].array.length;return new THREE.BufferAttribute(a,o,n)}function o(r){let o,n=0,i=0;for(let e=0,t=r.length;e<t;++e){var s=r[e];if(void 0===o&&(o=s.array.constructor),o!==s.array.constructor)return console.error("AttributeBuffers of different types cannot be interleaved"),null;n+=s.array.length,i+=s.itemSize}var a=new THREE.InterleavedBuffer(new o(n),i);let u=0;const f=[];var l=["getX","getY","getZ","getW"],m=["setX","setY","setZ","setW"];for(let e=0,t=r.length;e<t;e++){const d=r[e];var c=d.itemSize,g=d.count;const E=new THREE.InterleavedBufferAttribute(a,c,u,d.normalized);f.push(E),u+=c;for(let t=0;t<g;t++)for(let e=0;e<c;e++)E[m[e]](t,d[l[e]](t))}return f}function u(t){const e=t.data.array.constructor;var r=t.count,o=t.itemSize,n=t.normalized,i=new e(r*o);let s;s=t.isInstancedInterleavedBufferAttribute?new THREE.InstancedBufferAttribute(i,o,n,t.meshPerAttribute):new THREE.BufferAttribute(i,o,n);for(let e=0;e<r;e++)s.setX(e,t.getX(e)),2<=o&&s.setY(e,t.getY(e)),3<=o&&s.setZ(e,t.getZ(e)),4<=o&&s.setW(e,t.getW(e));return s}function n(e){const t=e.attributes,r=e.morphTargets,o=new Map;for(const s in t){var n=t[s];n.isInterleavedBufferAttribute&&(o.has(n)||o.set(n,u(n)),t[s]=o.get(n))}for(const a in r){var i=r[a];i.isInterleavedBufferAttribute&&(o.has(i)||o.set(i,u(i)),r[a]=o.get(i))}}function i(e){let t=0;for(const n in e.attributes){var r=e.getAttribute(n);t+=r.count*r.itemSize*r.array.BYTES_PER_ELEMENT}var o=e.getIndex();return t+=o?o.count*o.itemSize*o.array.BYTES_PER_ELEMENT:0,t}function s(o,e=1e-4){e=Math.max(e,Number.EPSILON);const t={},n=o.getIndex();var r=o.getAttribute("position"),i=(n||r).count;let s=0;var a=Object.keys(o.attributes);const u={},f={},l=[];var m=["getX","getY","getZ","getW"];for(let e=0,t=a.length;e<t;e++){var c=a[e];u[c]=[];var g=o.morphAttributes[c];g&&(f[c]=new Array(g.length).fill().map(()=>[]))}var e=Math.log10(1/e),d=Math.pow(10,e);for(let e=0;e<i;e++){var E=n?n.getX(e):e;let r="";for(let e=0,t=a.length;e<t;e++){var h=a[e];const w=o.getAttribute(h);var b=w.itemSize;for(let e=0;e<b;e++)r+=~~(w[m[e]](E)*d)+","}if(r in t)l.push(t[r]);else{for(let e=0,t=a.length;e<t;e++){var p=a[e];const H=o.getAttribute(p),G=o.morphAttributes[p];var y=H.itemSize;const U=u[p],x=f[p];for(let e=0;e<y;e++){var T=m[e];if(U.push(H[T](E)),G)for(let e=0,t=G.length;e<t;e++)x[e].push(G[e][T](E))}}t[r]=s,l.push(s),s++}}const B=o.clone();for(let e=0,t=a.length;e<t;e++){var A=a[e];const I=o.getAttribute(A);var v=new I.array.constructor(u[A]),v=new THREE.BufferAttribute(v,I.itemSize,I.normalized);if(B.setAttribute(A,v),A in f)for(let e=0;e<f[A].length;e++){const z=o.morphAttributes[A][e];var R=new z.array.constructor(f[A][e]),R=new THREE.BufferAttribute(R,z.itemSize,z.normalized);B.morphAttributes[A][e]=R}}return B.setIndex(l),B}function a(e,r){if(r===THREE.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(r!==THREE.TriangleFanDrawMode&&r!==THREE.TriangleStripDrawMode)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",r),e;{let t=e.getIndex();if(null===t){const a=[];var o=e.getAttribute("position");if(void 0===o)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<o.count;e++)a.push(e);e.setIndex(a),t=e.getIndex()}var n=t.count-2;const i=[];if(r===THREE.TriangleFanDrawMode)for(let e=1;e<=n;e++)i.push(t.getX(0)),i.push(t.getX(e)),i.push(t.getX(e+1));else for(let e=0;e<n;e++)e%2==0?(i.push(t.getX(e)),i.push(t.getX(e+1)),i.push(t.getX(e+2))):(i.push(t.getX(e+2)),i.push(t.getX(e+1)),i.push(t.getX(e)));i.length/3!=n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=e.clone();return s.setIndex(i),s.clearGroups(),s}}function f(e){if(!0!==e.geometry.isBufferGeometry)return console.error("THREE.BufferGeometryUtils: Geometry is not of type THREE.BufferGeometry."),null;const m=new THREE.Vector3,c=new THREE.Vector3,g=new THREE.Vector3,d=new THREE.Vector3,E=new THREE.Vector3,h=new THREE.Vector3,b=new THREE.Vector3,p=new THREE.Vector3,y=new THREE.Vector3;function t(e,t,r,o,n,i,s,a){m.fromBufferAttribute(t,n),c.fromBufferAttribute(t,i),g.fromBufferAttribute(t,s);var u=e.morphTargetInfluences;if(r&&u){b.set(0,0,0),p.set(0,0,0),y.set(0,0,0);for(let e=0,t=r.length;e<t;e++){var f=u[e],l=r[e];0!==f&&(d.fromBufferAttribute(l,n),E.fromBufferAttribute(l,i),h.fromBufferAttribute(l,s),o?(b.addScaledVector(d,f),p.addScaledVector(E,f),y.addScaledVector(h,f)):(b.addScaledVector(d.sub(m),f),p.addScaledVector(E.sub(c),f),y.addScaledVector(h.sub(g),f)))}m.add(b),c.add(p),g.add(y)}e.isSkinnedMesh&&(e.boneTransform(n,m),e.boneTransform(i,c),e.boneTransform(s,g)),a[3*n+0]=m.x,a[3*n+1]=m.y,a[3*n+2]=m.z,a[3*i+0]=c.x,a[3*i+1]=c.y,a[3*i+2]=c.z,a[3*s+0]=g.x,a[3*s+1]=g.y,a[3*s+2]=g.z}var r=e.geometry,o=e.material;let n,i,s;const a=r.index;var u=r.attributes.position,f=r.morphAttributes.position,l=r.morphTargetsRelative,T=r.attributes.normal,B=r.morphAttributes.position,A=r.groups,v=r.drawRange;let R,w,H,G,U,x,I;var z=new Float32Array(u.count*u.itemSize),M=new Float32Array(T.count*T.itemSize),S,X;if(null!==a)if(Array.isArray(o))for(R=0,H=A.length;R<H;R++)for(U=A[R],x=Math.max(U.start,v.start),I=Math.min(U.start+U.count,v.start+v.count),w=x,G=I;w<G;w+=3)n=a.getX(w),i=a.getX(w+1),s=a.getX(w+2),t(e,u,f,l,n,i,s,z),t(e,T,B,l,n,i,s,M);else for(x=Math.max(0,v.start),I=Math.min(a.count,v.start+v.count),R=x,H=I;R<H;R+=3)n=a.getX(R),i=a.getX(R+1),s=a.getX(R+2),t(e,u,f,l,n,i,s,z),t(e,T,B,l,n,i,s,M);else if(Array.isArray(o))for(R=0,H=A.length;R<H;R++)for(U=A[R],x=Math.max(U.start,v.start),I=Math.min(U.start+U.count,v.start+v.count),w=x,G=I;w<G;w+=3)n=w,i=w+1,s=w+2,t(e,u,f,l,n,i,s,z),t(e,T,B,l,n,i,s,M);else for(x=Math.max(0,v.start),I=Math.min(u.count,v.start+v.count),R=x,H=I;R<H;R+=3)n=R,i=R+1,s=R+2,t(e,u,f,l,n,i,s,z),t(e,T,B,l,n,i,s,M);return{positionAttribute:u,normalAttribute:T,morphedPositionAttribute:new THREE.Float32BufferAttribute(z,3),morphedNormalAttribute:new THREE.Float32BufferAttribute(M,3)}}function l(t){if(0===t.groups.length)return console.warn("THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge."),t;let r=t.groups;if(r=r.sort((e,t)=>e.materialIndex!==t.materialIndex?e.materialIndex-t.materialIndex:e.start-t.start),null===t.getIndex()){var o=t.getAttribute("position");const c=[];for(let e=0;e<o.count;e+=3)c.push(e,e+1,e+2);t.setIndex(c)}const n=t.getIndex(),i=[];for(let e=0;e<r.length;e++){var s=r[e],a=s.start,u=a+s.count;for(let e=a;e<u;e++)i.push(n.getX(e))}t.dispose(),t.setIndex(i);let f=0;for(let e=0;e<r.length;e++){const g=r[e];g.start=f,f+=g.count}let l=r[0];t.groups=[l];for(let e=1;e<r.length;e++){var m=r[e];l.materialIndex===m.materialIndex?l.count+=m.count:(l=m,t.groups.push(l))}return t}THREE.BufferGeometryUtils={},THREE.BufferGeometryUtils.computeMikkTSpaceTangents=t,THREE.BufferGeometryUtils.computeMorphedAttributes=f,THREE.BufferGeometryUtils.computeTangents=e,THREE.BufferGeometryUtils.deinterleaveAttribute=u,THREE.BufferGeometryUtils.deinterleaveGeometry=n,THREE.BufferGeometryUtils.estimateBytesUsed=i,THREE.BufferGeometryUtils.interleaveAttributes=o,THREE.BufferGeometryUtils.mergeBufferAttributes=B,THREE.BufferGeometryUtils.mergeBufferGeometries=r,THREE.BufferGeometryUtils.mergeGroups=l,THREE.BufferGeometryUtils.mergeVertices=s,THREE.BufferGeometryUtils.toTrianglesDrawMode=a}();!function(){class c extends THREE.Loader{constructor(t){super(t),this.defaultDPI=90,this.defaultUnit="px"}load(e,r,t,n){const o=this,i=new THREE.FileLoader(o.manager);i.setPath(o.path),i.setRequestHeader(o.requestHeader),i.setWithCredentials(o.withCredentials),i.load(e,function(t){try{r(o.parse(t))}catch(t){n?n(t):console.error(t),o.manager.itemError(e)}},t,n)}parse(t){const e=this;function l(r,n){if(1===r.nodeType){var o=A(r);let e=!1,t=null;switch(r.nodeName){case"svg":n=v(r,n);break;case"style":y(r);break;case"g":n=v(r,n);break;case"path":n=v(r,n),r.hasAttribute("d")&&(t=u(r));break;case"rect":n=v(r,n),t=f(r);break;case"polygon":n=v(r,n),t=h(r);break;case"polyline":n=v(r,n),t=p(r);break;case"circle":n=v(r,n),t=x(r);break;case"ellipse":n=v(r,n),t=d(r);break;case"line":n=v(r,n),t=b(r);break;case"defs":e=!0;break;case"use":n=v(r,n);const c=r.getAttributeNS("http://www.w3.org/1999/xlink","href")||"";var i=c.substring(1),a=r.viewportElement.getElementById(i);a?l(a,n):console.warn("SVGLoader: 'use node' references non-existent node id: "+i)}t&&(void 0!==n.fill&&"none"!==n.fill&&t.color.setStyle(n.fill),k(t,G),M.push(t),t.userData={node:r,style:n});var s=r.childNodes;for(let t=0;t<s.length;t++){const r=s[t];e&&"style"!==r.nodeName&&"defs"!==r.nodeName||l(r,n)}o&&(P.pop(),0<P.length?G.copy(P[P.length-1]):G.identity())}}function u(t){const n=new THREE.ShapePath,o=new THREE.Vector2,i=new THREE.Vector2,a=new THREE.Vector2;let s=!0,c=!1;const e=t.getAttribute("d");var l=e.match(/[a-df-z][^a-df-z]*/gi);for(let t=0,e=l.length;t<e;t++){const b=l[t];var u=b.charAt(0),y=b.slice(1).trim(),f,h;!0===s&&(c=!0,s=!1);let r;switch(u){case"M":r=m(y);for(let t=0,e=r.length;t<e;t+=2)o.x=r[t+0],o.y=r[t+1],i.x=o.x,i.y=o.y,0===t?n.moveTo(o.x,o.y):n.lineTo(o.x,o.y),0===t&&a.copy(o);break;case"H":r=m(y);for(let t=0,e=r.length;t<e;t++)o.x=r[t],i.x=o.x,i.y=o.y,n.lineTo(o.x,o.y),0===t&&!0===c&&a.copy(o);break;case"V":r=m(y);for(let t=0,e=r.length;t<e;t++)o.y=r[t],i.x=o.x,i.y=o.y,n.lineTo(o.x,o.y),0===t&&!0===c&&a.copy(o);break;case"L":r=m(y);for(let t=0,e=r.length;t<e;t+=2)o.x=r[t+0],o.y=r[t+1],i.x=o.x,i.y=o.y,n.lineTo(o.x,o.y),0===t&&!0===c&&a.copy(o);break;case"C":r=m(y);for(let t=0,e=r.length;t<e;t+=6)n.bezierCurveTo(r[t+0],r[t+1],r[t+2],r[t+3],r[t+4],r[t+5]),i.x=r[t+2],i.y=r[t+3],o.x=r[t+4],o.y=r[t+5],0===t&&!0===c&&a.copy(o);break;case"S":r=m(y);for(let t=0,e=r.length;t<e;t+=4)n.bezierCurveTo(T(o.x,i.x),T(o.y,i.y),r[t+0],r[t+1],r[t+2],r[t+3]),i.x=r[t+0],i.y=r[t+1],o.x=r[t+2],o.y=r[t+3],0===t&&!0===c&&a.copy(o);break;case"Q":r=m(y);for(let t=0,e=r.length;t<e;t+=4)n.quadraticCurveTo(r[t+0],r[t+1],r[t+2],r[t+3]),i.x=r[t+0],i.y=r[t+1],o.x=r[t+2],o.y=r[t+3],0===t&&!0===c&&a.copy(o);break;case"T":r=m(y);for(let t=0,e=r.length;t<e;t+=2){var p=T(o.x,i.x),x=T(o.y,i.y);n.quadraticCurveTo(p,x,r[t+0],r[t+1]),i.x=p,i.y=x,o.x=r[t+0],o.y=r[t+1],0===t&&!0===c&&a.copy(o)}break;case"A":r=m(y,[3,4],7);for(let t=0,e=r.length;t<e;t+=7){r[t+5]==o.x&&r[t+6]==o.y||(f=o.clone(),o.x=r[t+5],o.y=r[t+6],i.x=o.x,i.y=o.y,g(n,r[t],r[t+1],r[t+2],r[t+3],r[t+4],f,o),0===t&&!0===c&&a.copy(o))}break;case"m":r=m(y);for(let t=0,e=r.length;t<e;t+=2)o.x+=r[t+0],o.y+=r[t+1],i.x=o.x,i.y=o.y,0===t?n.moveTo(o.x,o.y):n.lineTo(o.x,o.y),0===t&&a.copy(o);break;case"h":r=m(y);for(let t=0,e=r.length;t<e;t++)o.x+=r[t],i.x=o.x,i.y=o.y,n.lineTo(o.x,o.y),0===t&&!0===c&&a.copy(o);break;case"v":r=m(y);for(let t=0,e=r.length;t<e;t++)o.y+=r[t],i.x=o.x,i.y=o.y,n.lineTo(o.x,o.y),0===t&&!0===c&&a.copy(o);break;case"l":r=m(y);for(let t=0,e=r.length;t<e;t+=2)o.x+=r[t+0],o.y+=r[t+1],i.x=o.x,i.y=o.y,n.lineTo(o.x,o.y),0===t&&!0===c&&a.copy(o);break;case"c":r=m(y);for(let t=0,e=r.length;t<e;t+=6)n.bezierCurveTo(o.x+r[t+0],o.y+r[t+1],o.x+r[t+2],o.y+r[t+3],o.x+r[t+4],o.y+r[t+5]),i.x=o.x+r[t+2],i.y=o.y+r[t+3],o.x+=r[t+4],o.y+=r[t+5],0===t&&!0===c&&a.copy(o);break;case"s":r=m(y);for(let t=0,e=r.length;t<e;t+=4)n.bezierCurveTo(T(o.x,i.x),T(o.y,i.y),o.x+r[t+0],o.y+r[t+1],o.x+r[t+2],o.y+r[t+3]),i.x=o.x+r[t+0],i.y=o.y+r[t+1],o.x+=r[t+2],o.y+=r[t+3],0===t&&!0===c&&a.copy(o);break;case"q":r=m(y);for(let t=0,e=r.length;t<e;t+=4)n.quadraticCurveTo(o.x+r[t+0],o.y+r[t+1],o.x+r[t+2],o.y+r[t+3]),i.x=o.x+r[t+0],i.y=o.y+r[t+1],o.x+=r[t+2],o.y+=r[t+3],0===t&&!0===c&&a.copy(o);break;case"t":r=m(y);for(let t=0,e=r.length;t<e;t+=2){var d=T(o.x,i.x),E=T(o.y,i.y);n.quadraticCurveTo(d,E,o.x+r[t+0],o.y+r[t+1]),i.x=d,i.y=E,o.x=o.x+r[t+0],o.y=o.y+r[t+1],0===t&&!0===c&&a.copy(o)}break;case"a":r=m(y,[3,4],7);for(let t=0,e=r.length;t<e;t+=7){0==r[t+5]&&0==r[t+6]||(h=o.clone(),o.x+=r[t+5],o.y+=r[t+6],i.x=o.x,i.y=o.y,g(n,r[t],r[t+1],r[t+2],r[t+3],r[t+4],h,o),0===t&&!0===c&&a.copy(o))}break;case"Z":case"z":n.currentPath.autoClose=!0,0<n.currentPath.curves.length&&(o.copy(a),n.currentPath.currentPoint.copy(o),s=!0);break;default:console.warn(b)}c=!1}return n}function y(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(let t=0;t<e.sheet.cssRules.length;t++){const o=e.sheet.cssRules[t];if(1===o.type){var r=o.selectorText.split(/,/gm).filter(Boolean).map(t=>t.trim());for(let t=0;t<r.length;t++){var n=Object.fromEntries(Object.entries(o.style).filter(([,t])=>""!==t));s[r[t]]=Object.assign(s[r[t]]||{},n)}}}}function g(n,o,i,a,s,c,l,u){if(0!=o&&0!=i){a=a*Math.PI/180,o=Math.abs(o),i=Math.abs(i);var y=(l.x-u.x)/2,f=(l.y-u.y)/2,h=Math.cos(a)*y+Math.sin(a)*f,p=-Math.sin(a)*y+Math.cos(a)*f;let t=o*o,e=i*i;var x=h*h,y=p*p,f=x/t+y/e,d;1<f&&(o*=d=Math.sqrt(f),i*=d,t=o*o,e=i*i);var d=t*y+e*x,y=(t*e-d)/d;let r=Math.sqrt(Math.max(0,y));s===c&&(r=-r);var x=r*o*p/i,d=-r*i*h/o,y=Math.cos(a)*x-Math.sin(a)*d+(l.x+u.x)/2,s=Math.sin(a)*x+Math.cos(a)*d+(l.y+u.y)/2,l=E(1,0,(h-x)/o,(p-d)/i),d=E((h-x)/o,(p-d)/i,(-h-x)/o,(-p-d)/i)%(2*Math.PI);n.currentPath.absellipse(y,s,o,i,l,l+d,0===c,a)}else n.lineTo(u.x,u.y)}function E(t,e,r,n){var o=t*r+e*n,i=Math.sqrt(t*t+e*e)*Math.sqrt(r*r+n*n);let a=Math.acos(Math.max(-1,Math.min(1,o/i)));return t*n-e*r<0&&(a=-a),a}function f(t){var e=w(t.getAttribute("x")||0),r=w(t.getAttribute("y")||0),n=w(t.getAttribute("rx")||t.getAttribute("ry")||0),o=w(t.getAttribute("ry")||t.getAttribute("rx")||0),i=w(t.getAttribute("width")),a=w(t.getAttribute("height")),t=.448084975506;const s=new THREE.ShapePath;return s.moveTo(e+n,r),s.lineTo(e+i-n,r),0===n&&0===o||s.bezierCurveTo(e+i-n*t,r,e+i,r+o*t,e+i,r+o),s.lineTo(e+i,r+a-o),0===n&&0===o||s.bezierCurveTo(e+i,r+a-o*t,e+i-n*t,r+a,e+i-n,r+a),s.lineTo(e+n,r+a),0===n&&0===o||s.bezierCurveTo(e+n*t,r+a,e,r+a-o*t,e,r+a-o),s.lineTo(e,r+o),0===n&&0===o||s.bezierCurveTo(e,r+o*t,e+n*t,r,e+n,r),s}function h(t){function e(t,e,r){var e=w(e),r=w(r);0===o?n.moveTo(e,r):n.lineTo(e,r),o++}var r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g;const n=new THREE.ShapePath;let o=0;return t.getAttribute("points").replace(r,e),n.currentPath.autoClose=!0,n}function p(t){function e(t,e,r){var e=w(e),r=w(r);0===o?n.moveTo(e,r):n.lineTo(e,r),o++}var r=/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g;const n=new THREE.ShapePath;let o=0;return t.getAttribute("points").replace(r,e),n.currentPath.autoClose=!1,n}function x(t){var e=w(t.getAttribute("cx")||0),r=w(t.getAttribute("cy")||0),t=w(t.getAttribute("r")||0);const n=new THREE.Path;n.absarc(e,r,t,0,2*Math.PI);const o=new THREE.ShapePath;return o.subPaths.push(n),o}function d(t){var e=w(t.getAttribute("cx")||0),r=w(t.getAttribute("cy")||0),n=w(t.getAttribute("rx")||0),t=w(t.getAttribute("ry")||0);const o=new THREE.Path;o.absellipse(e,r,n,t,0,2*Math.PI);const i=new THREE.ShapePath;return i.subPaths.push(o),i}function b(t){var e=w(t.getAttribute("x1")||0),r=w(t.getAttribute("y1")||0),n=w(t.getAttribute("x2")||0),t=w(t.getAttribute("y2")||0);const o=new THREE.ShapePath;return o.moveTo(e,r),o.lineTo(n,t),o.currentPath.autoClose=!1,o}function v(n,o){o=Object.assign({},o);let i={};if(n.hasAttribute("class")){var e=n.getAttribute("class").split(/\s/).filter(Boolean).map(t=>t.trim());for(let t=0;t<e.length;t++)i=Object.assign(i,s["."+e[t]])}function t(t,e,r){void 0===r&&(r=function t(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),n.hasAttribute(t)&&(o[e]=r(n.getAttribute(t))),i[t]&&(o[e]=r(i[t])),n.style&&""!==n.style[t]&&(o[e]=r(n.style[t]))}function r(t){return Math.max(0,Math.min(1,w(t)))}function a(t){return Math.max(0,w(t))}return n.hasAttribute("id")&&(i=Object.assign(i,s["#"+n.getAttribute("id")])),t("fill","fill"),t("fill-opacity","fillOpacity",r),t("fill-rule","fillRule"),t("opacity","opacity",r),t("stroke","stroke"),t("stroke-opacity","strokeOpacity",r),t("stroke-width","strokeWidth",a),t("stroke-linejoin","strokeLineJoin"),t("stroke-linecap","strokeLineCap"),t("stroke-miterlimit","strokeMiterLimit",a),t("visibility","visibility"),o}function T(t,e){return t-(e-t)}function m(e,r,n){if("string"!=typeof e)throw new TypeError("Invalid input: "+typeof e);const o={SEPARATOR:/[ \t\r\n\,.\-+]/,WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/};var t=0,i=1,a=2,s=3,c;let l=0,u=!0,y="",f="";const h=[];function p(t,e,r){const n=new SyntaxError('Unexpected character "'+t+'" at index '+e+".");throw n.partial=r,n}function x(){""!==y&&(""===f?h.push(Number(y)):h.push(Number(y)*Math.pow(10,Number(f)))),y="",f=""}var d=e.length;for(let t=0;t<d;t++)if(c=e[t],Array.isArray(r)&&r.includes(h.length%n)&&o.FLAGS.test(c))l=1,y=c,x();else{if(0===l){if(o.WHITESPACE.test(c))continue;if(o.DIGIT.test(c)||o.SIGN.test(c)){l=1,y=c;continue}if(o.POINT.test(c)){l=2,y=c;continue}o.COMMA.test(c)&&(u&&p(c,t,h),u=!0)}if(1===l){if(o.DIGIT.test(c)){y+=c;continue}if(o.POINT.test(c)){y+=c,l=2;continue}if(o.EXP.test(c)){l=3;continue}o.SIGN.test(c)&&1===y.length&&o.SIGN.test(y[0])&&p(c,t,h)}if(2===l){if(o.DIGIT.test(c)){y+=c;continue}if(o.EXP.test(c)){l=3;continue}o.POINT.test(c)&&"."===y[y.length-1]&&p(c,t,h)}if(3===l){if(o.DIGIT.test(c)){f+=c;continue}if(o.SIGN.test(c)){if(""===f){f+=c;continue}1===f.length&&o.SIGN.test(f)&&p(c,t,h)}}o.WHITESPACE.test(c)?(x(),l=0,u=!1):o.COMMA.test(c)?(x(),l=0,u=!0):o.SIGN.test(c)?(x(),l=1,y=c):o.POINT.test(c)?(x(),l=2,y=c):p(c,t,h)}return x(),h}const i=["mm","cm","in","pt","pc","px"],a={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function w(r){let n="px";if("string"==typeof r||r instanceof String)for(let t=0,e=i.length;t<e;t++){var o=i[t];if(r.endsWith(o)){n=o,r=r.substring(0,r.length-o.length);break}}let t=void 0;return"px"===n&&"px"!==e.defaultUnit?t=a.in[e.defaultUnit]/e.defaultDPI:(t=a[n][e.defaultUnit],t<0&&(t=a[n].in*e.defaultDPI)),t*parseFloat(r)}function A(t){if(!(t.hasAttribute("transform")||"use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))))return null;const e=r(t);return 0<P.length&&e.premultiply(P[P.length-1]),G.copy(e),P.push(e),e}function r(t){const e=new THREE.Matrix3,r=S;var n,o;if("use"===t.nodeName&&(t.hasAttribute("x")||t.hasAttribute("y"))&&(n=w(t.getAttribute("x")),o=w(t.getAttribute("y")),e.translate(n,o)),t.hasAttribute("transform")){const u=t.getAttribute("transform").split(")");for(let t=u.length-1;0<=t;t--){const y=u[t].trim();if(""!==y){var i=y.indexOf("("),a=y.length;if(0<i&&i<a){var a=y.slice(0,i),s=m(y.slice(i+1));switch(r.identity(),a){case"translate":if(1<=s.length){var c=s[0];let t=0;2<=s.length&&(t=s[1]),r.translate(c,t)}break;case"rotate":if(1<=s.length){var l=0;let t=0,e=0;l=-s[0]*Math.PI/180,3<=s.length&&(t=s[1],e=s[2]),V.identity().translate(-t,-e),N.identity().rotate(l),C.multiplyMatrices(N,V),V.identity().translate(t,e),r.multiplyMatrices(V,C)}break;case"scale":if(1<=s.length){var l=s[0];let t=l;2<=s.length&&(t=s[1]),r.scale(l,t)}break;case"skewX":1===s.length&&r.set(1,Math.tan(s[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===s.length&&r.set(1,0,0,Math.tan(s[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===s.length&&r.set(s[0],s[2],s[4],s[1],s[3],s[5],0,0,1)}}e.premultiply(r)}}}return e}function k(t,r){function n(t){L.set(t.x,t.y,1).applyMatrix3(r),t.set(L.x,L.y)}var o=R(r),i=t.subPaths;for(let t=0,e=i.length;t<e;t++){var a,s=i[t].curves;for(let t=0;t<s.length;t++){const c=s[t];c.isLineCurve?(n(c.v1),n(c.v2)):c.isCubicBezierCurve?(n(c.v0),n(c.v1),n(c.v2),n(c.v3)):c.isQuadraticBezierCurve?(n(c.v0),n(c.v1),n(c.v2)):c.isEllipseCurve&&(o&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),O.set(c.aX,c.aY),n(O),c.aX=O.x,c.aY=O.y,c.xRadius*=H(r),c.yRadius*=I(r))}}}function R(t){return 0!==t.elements[1]||0!==t.elements[3]}function H(t){var t=t.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function I(t){var t=t.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}const M=[],s={},P=[],S=new THREE.Matrix3,V=new THREE.Matrix3,N=new THREE.Matrix3,C=new THREE.Matrix3,O=new THREE.Vector2,L=new THREE.Vector3,G=new THREE.Matrix3;var t=(new DOMParser).parseFromString(t,"image/svg+xml"),n;return l(t.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:M,xml:t.documentElement}}static createShapes(e){const t=999999999,v={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},T={loc:v.ORIGIN,t:0};function u(e,r,n,o){var i=e.x,a=r.x,t=n.x,s=o.x,c=e.y,l=r.y,u=n.y,y=o.y,f=(s-t)*(c-u)-(y-u)*(i-t),h,y=(y-u)*(a-i)-(s-t)*(l-c),s=f/y,t=((a-i)*(c-u)-(l-c)*(i-t))/y,p,x,d,E;if(0==y&&0!=f||s<=0||1<=s||t<0||1<t)return null;if(0==f&&0==y){for(let t=0;t<2;t++){if(m(0===t?n:o,e,r),T.loc==v.ORIGIN){var b=0===t?n:o;return{x:b.x,y:b.y,t:T.t}}if(T.loc==v.BETWEEN)return{x:+(i+T.t*(a-i)).toPrecision(10),y:+(c+T.t*(l-c)).toPrecision(10),t:T.t}}return null}for(let t=0;t<2;t++)if(m(0===t?n:o,e,r),T.loc==v.ORIGIN){var g=0===t?n:o;return{x:g.x,y:g.y,t:T.t}}return{x:+(i+s*(a-i)).toPrecision(10),y:+(c+s*(l-c)).toPrecision(10),t:s}}function m(t,e,r){var n=r.x-e.x,o=r.y-e.y,i=t.x-e.x,a=t.y-e.y,s=n*a-i*o;if(t.x===e.x&&t.y===e.y)return T.loc=v.ORIGIN,void(T.t=0);if(t.x===r.x&&t.y===r.y)return T.loc=v.DESTINATION,void(T.t=1);if(s<-Number.EPSILON)T.loc=v.LEFT;else if(s>Number.EPSILON)T.loc=v.RIGHT;else if(n*i<0||o*a<0)T.loc=v.BEHIND;else if(Math.sqrt(n*n+o*o)<Math.sqrt(i*i+a*a))T.loc=v.BEYOND;else{let t;t=0!=n?i/n:a/o,T.loc=v.BETWEEN,T.t=t}}function i(e,r){const n=[],o=[];for(let t=1;t<e.length;t++){var i=e[t-1],a=e[t],s,c;for(let t=1;t<r.length;t++){const l=u(i,a,r[t-1],r[t]);null!==l&&void 0===n.find(t=>t.t<=l.t+Number.EPSILON&&t.t>=l.t-Number.EPSILON)&&(n.push(l),o.push(new THREE.Vector2(l.x,l.y)))}}return o}function p(r,t,e){const n=new THREE.Vector2;t.getCenter(n);const o=[];return e.forEach(e=>{if(e.boundingBox.containsPoint(n)){const t=i(r,e.points);t.forEach(t=>{o.push({identifier:e.identifier,isCW:e.isCW,point:t})})}}),o.sort((t,e)=>t.point.x-e.point.x),o}function r(o,i,t,e,r){null!=r&&""!==r||(r="nonzero");var n=new THREE.Vector2,a;o.boundingBox.getCenter(n);const s=p([new THREE.Vector2(t,n.y),new THREE.Vector2(e,n.y)],o.boundingBox,i);s.sort((t,e)=>t.point.x-e.point.x);const c=[],l=[];s.forEach(t=>{(t.identifier===o.identifier?c:l).push(t)});var u=c[0].point.x;const y=[];let f=0;for(;f<l.length&&l[f].point.x<u;)0<y.length&&y[y.length-1]===l[f].identifier?y.pop():y.push(l[f].identifier),f++;if(y.push(o.identifier),"evenodd"===r){var e=y.length%2==0,n=y[y.length-2];return{identifier:o.identifier,isHole:e,for:n}}if("nonzero"===r){let e=!0,r=null,n=null;for(let t=0;t<y.length;t++){var h=y[t];e?(n=i[h].isCW,e=!1,r=h):n!==i[h].isCW&&(n=i[h].isCW,e=!0)}return{identifier:o.identifier,isHole:e,for:r}}console.warn('fill-rule: "'+r+'" is currently not implemented.')}let s=0,c=t,l=-t,o=e.subPaths.map(e=>{var r=e.getPoints();let n=-t,o=t,i=-t,a=t;for(let t=0;t<r.length;t++){const e=r[t];e.y>n&&(n=e.y),e.y<o&&(o=e.y),e.x>i&&(i=e.x),e.x<a&&(a=e.x)}return l<=i&&(l=i+1),c>=a&&(c=a-1),{curves:e.curves,points:r,isCW:THREE.ShapeUtils.isClockWise(r),identifier:s++,boundingBox:new THREE.Box2(new THREE.Vector2(a,o),new THREE.Vector2(i,n))}});o=o.filter(t=>1<t.points.length);const a=o.map(t=>r(t,o,c,l,e.userData?.style.fillRule)),y=[];return o.forEach(e=>{var t;if(!a[e.identifier].isHole){const r=new THREE.Shape;r.curves=e.curves;const n=a.filter(t=>t.isHole&&t.for===e.identifier);n.forEach(t=>{var t=o[t.identifier];const e=new THREE.Path;e.curves=t.curves,r.holes.push(e)}),y.push(r)}}),y}static getStrokeStyle(t,e,r,n,o){return{strokeColor:e=void 0!==e?e:"#000",strokeWidth:t=void 0!==t?t:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:n=void 0!==n?n:"butt",strokeMiterLimit:o=void 0!==o?o:4}}static pointsToStroke(t,e,r,n){var o=[],i=[],a=[];if(0===c.pointsToStrokeWithBuffers(t,e,r,n,o,i,a))return null;const s=new THREE.BufferGeometry;return s.setAttribute("position",new THREE.Float32BufferAttribute(o,3)),s.setAttribute("normal",new THREE.Float32BufferAttribute(i,3)),s.setAttribute("uv",new THREE.Float32BufferAttribute(a,2)),s}static pointsToStrokeWithBuffers(e,s,c,i,l,n,o,t){const u=new THREE.Vector2,y=new THREE.Vector2,f=new THREE.Vector2,h=new THREE.Vector2,r=new THREE.Vector2,a=new THREE.Vector2,p=new THREE.Vector2,x=new THREE.Vector2,d=new THREE.Vector2,E=new THREE.Vector2,b=new THREE.Vector2,g=new THREE.Vector2,v=new THREE.Vector2,T=new THREE.Vector2,m=new THREE.Vector2,w=new THREE.Vector2,A=new THREE.Vector2;c=void 0!==c?c:12,i=void 0!==i?i:.001,t=void 0!==t?t:0;var k=(e=$(e)).length;if(k<2)return 0;var R=e[0].equals(e[k-1]);let H,I=e[0],M;var P=s.strokeWidth/2,S=1/(k-1);let V=0,N,C,O,L,G=!1,B=0,W=3*t,z=2*t;U(e[0],e[1],u).multiplyScalar(P),x.copy(e[0]).sub(u),d.copy(e[0]).add(u),E.copy(x),b.copy(d);for(let t=1;t<k;t++){H=e[t],M=t===k-1?R?e[1]:void 0:e[t+1];const _=u;if(U(I,H,_),f.copy(_).multiplyScalar(P),g.copy(H).sub(f),v.copy(H).add(f),N=V+S,C=!1,void 0!==M){U(H,M,y),f.copy(y).multiplyScalar(P),T.copy(H).sub(f),m.copy(H).add(f),O=!0,f.subVectors(M,I),_.dot(f)<0&&(O=!1),1===t&&(G=O),f.subVectors(M,H),f.normalize();var q=Math.abs(_.dot(f));if(q>Number.EPSILON){var D=P/q;f.multiplyScalar(-D),h.subVectors(H,I),r.copy(h).setLength(D).add(f),w.copy(r).negate();var F=r.length(),q=h.length();h.divideScalar(q),a.subVectors(M,H);var D=a.length();switch(a.divideScalar(D),h.dot(w)<q&&a.dot(w)<D&&(C=!0),A.copy(r).add(H),w.add(H),L=!1,C?O?(m.copy(w),v.copy(w)):(T.copy(w),g.copy(w)):Y(),s.strokeLineJoin){case"bevel":Q(O,C,N);break;case"round":Z(O,C),O?J(H,g,T,N,0):J(H,m,v,N,1);break;default:var j=P*s.strokeMiterLimit/F;if(j<1){if("miter-clip"!==s.strokeLineJoin){Q(O,C,N);break}Z(O,C),O?(a.subVectors(A,g).multiplyScalar(j).add(g),p.subVectors(A,T).multiplyScalar(j).add(T),X(g,N,0),X(a,N,0),X(H,N,.5),X(H,N,.5),X(a,N,0),X(p,N,0),X(H,N,.5),X(p,N,0),X(T,N,0)):(a.subVectors(A,v).multiplyScalar(j).add(v),p.subVectors(A,m).multiplyScalar(j).add(m),X(v,N,1),X(a,N,1),X(H,N,.5),X(H,N,.5),X(a,N,1),X(p,N,1),X(H,N,.5),X(p,N,1),X(m,N,1))}else C?(O?(X(d,V,1),X(x,V,0),X(A,N,0),X(d,V,1),X(A,N,0),X(w,N,1)):(X(d,V,1),X(x,V,0),X(A,N,1),X(x,V,0),X(w,N,0),X(A,N,1)),(O?T:m).copy(A)):O?(X(g,N,0),X(A,N,0),X(H,N,.5),X(H,N,.5),X(A,N,0),X(T,N,0)):(X(v,N,1),X(A,N,1),X(H,N,.5),X(H,N,.5),X(A,N,1),X(m,N,1)),L=!0}}else Y()}else Y();R||t!==k-1||K(e[0],E,b,O,!0,V),V=N,I=H,x.copy(T),d.copy(m)}if(R){if(C&&l){let t=A,e=w;G!==O&&(t=w,e=A),O?(L||G)&&(e.toArray(l,0),e.toArray(l,9),L&&t.toArray(l,3)):!L&&G||(e.toArray(l,3),e.toArray(l,9),L&&t.toArray(l,0))}}else K(H,g,v,O,!1,N);return B;function U(t,e,r){return r.subVectors(e,t),r.set(-r.y,r.x).normalize()}function X(t,e,r){l&&(l[W]=t.x,l[W+1]=t.y,l[W+2]=0,n&&(n[W]=0,n[W+1]=0,n[W+2]=1),W+=3,o&&(o[z]=e,o[z+1]=r,z+=2)),B+=3}function J(r,t,e,n,o){u.copy(t).sub(r).normalize(),y.copy(e).sub(r).normalize();let i=Math.PI;var a=u.dot(y);Math.abs(a)<1&&(i=Math.abs(Math.acos(a))),i/=c,f.copy(t);for(let t=0,e=c-1;t<e;t++)h.copy(f).rotateAround(r,i),X(f,n,o),X(h,n,o),X(r,n,.5),f.copy(h);X(h,n,o),X(e,n,o),X(r,n,.5)}function Y(){X(d,V,1),X(x,V,0),X(g,N,0),X(d,V,1),X(g,N,1),X(v,N,0)}function Q(t,e,r){e?(t?(X(d,V,1),X(x,V,0),X(g,N,0),X(d,V,1),X(g,N,0),X(w,N,1),X(g,r,0),X(T,r,0)):(X(d,V,1),X(x,V,0),X(v,N,1),X(x,V,0),X(w,N,0),X(v,N,1),X(v,r,1),X(m,r,0)),X(w,r,.5)):(t?(X(g,r,0),X(T,r,0)):(X(v,r,1),X(m,r,0)),X(H,r,.5))}function Z(t,e){e&&(t?(X(d,V,1),X(x,V,0),X(g,N,0),X(d,V,1),X(g,N,0),X(w,N,1),X(g,V,0),X(H,N,.5),X(w,N,1),X(H,N,.5),X(T,V,0),X(w,N,1)):(X(d,V,1),X(x,V,0),X(v,N,1),X(x,V,0),X(w,N,0),X(v,N,1),X(v,V,1),X(w,N,0),X(H,N,.5),X(H,N,.5),X(w,N,0),X(m,V,1)))}function K(t,e,r,n,o,i){switch(s.strokeLineCap){case"round":o?J(t,r,e,i,.5):J(t,e,r,i,.5);break;case"square":var a;o?(u.subVectors(e,t),y.set(u.y,-u.x),f.addVectors(u,y).add(t),h.subVectors(y,u).add(t),n?(f.toArray(l,3),h.toArray(l,0),h.toArray(l,9)):(f.toArray(l,3),f.toArray(l,9),h.toArray(l,0))):(u.subVectors(r,t),y.set(u.y,-u.x),f.addVectors(u,y).add(t),h.subVectors(y,u).add(t),a=l.length,n?(f.toArray(l,a-3),h.toArray(l,a-6)):(f.toArray(l,a-6),h.toArray(l,a-3)),h.toArray(l,a-12))}}function $(r){let n=!1;for(let t=1,e=r.length-1;t<e;t++)if(r[t].distanceTo(r[t+1])<i){n=!0;break}if(!n)return r;const o=[];o.push(r[0]);for(let t=1,e=r.length-1;t<e;t++)r[t].distanceTo(r[t+1])>=i&&o.push(r[t]);return o.push(r[r.length-1]),o}}}THREE.SVGLoader=c}();!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).MeshBVHLib=t.MeshBVHLib||{},t.THREE)}(this,function(t,b){"use strict";const i=0,G=1,C=2;var e=0,r=1;const n=2,O=1.25,L=1,v=32,P=65535,x=Math.pow(2,-24);class w{constructor(){}}function F(t,e,r){return r.min.x=e[t],r.min.y=e[t+1],r.min.z=e[t+2],r.max.x=e[t+3],r.max.y=e[t+4],r.max.z=e[t+5],r}function W(e){let r=-1,n=-1/0;for(let t=0;t<3;t++){var o=e[t+3]-e[t];o>n&&(n=o,r=t)}return r}function X(t,e){e.set(t)}function Y(e,r,n){let o,i;for(let t=0;t<3;t++){var s=t+3;o=e[t],i=r[t],n[t]=o<i?o:i,o=e[s],i=r[s],n[s]=o>i?o:i}}function j(e,r,n){for(let t=0;t<3;t++){var o=r[e+2*t],i=r[e+2*t+1],s=o-i,i=o+i;s<n[t]&&(n[t]=s),i>n[t+3]&&(n[t+3]=i)}}function Z(t){var e=t[3]-t[0],r=t[4]-t[1],t=t[5]-t[2];return 2*(e*r+r*t+t*e)}function B(t,r){if(!t.index){var n=t.attributes.position.count;const o=r.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let e;e=65535<n?new Uint32Array(new o(4*n)):new Uint16Array(new o(2*n)),t.setIndex(new b.BufferAttribute(e,1));for(let t=0;t<n;t++)e[t]=t}}function T(t){if(!t.groups||!t.groups.length)return[{offset:0,count:t.index.count/3}];const e=[],r=new Set;for(const s of t.groups)r.add(s.start),r.add(s.start+s.count);var n=Array.from(r.values()).sort((t,e)=>t-e);for(let t=0;t<n.length-1;t++){var o=n[t],i=n[t+1];e.push({offset:o/3,count:(i-o)/3})}return e}function A(r,n,o,t,e=null){let i=1/0,s=1/0,a=1/0,c=-1/0,u=-1/0,l=-1/0,d=1/0,f=1/0,h=1/0,p=-1/0,v=-1/0,m=-1/0;var y=null!==e;for(let t=6*n,e=6*(n+o);t<e;t+=6){var x=r[t+0],g=r[t+1],b=x-g,g=x+g;b<i&&(i=b),g>c&&(c=g),y&&x<d&&(d=x),y&&x>p&&(p=x);var b=r[t+2],g=r[t+3],x=b-g,g=b+g;x<s&&(s=x),g>u&&(u=g),y&&b<f&&(f=b),y&&b>v&&(v=b);var x=r[t+4],g=r[t+5],b=x-g,g=x+g;b<a&&(a=b),g>l&&(l=g),y&&x<h&&(h=x),y&&x>m&&(m=x)}t[0]=i,t[1]=s,t[2]=a,t[3]=c,t[4]=u,t[5]=l,y&&(e[0]=d,e[1]=f,e[2]=h,e[3]=p,e[4]=v,e[5]=m)}function M(r,n,o,t){let i=1/0,s=1/0,a=1/0,c=-1/0,u=-1/0,l=-1/0;for(let t=6*n,e=6*(n+o);t<e;t+=6){var d=r[t+0];d<i&&(i=d),d>c&&(c=d);var d=r[t+2];d<s&&(s=d),d>u&&(u=d);var d=r[t+4];d<a&&(a=d),d>l&&(l=d)}t[0]=i,t[1]=s,t[2]=a,t[3]=c,t[4]=u,t[5]=l}function I(e,r,t,n,o){let i=t,s=t+n-1;for(var a=o.pos,c=2*o.axis;;){for(;i<=s&&r[6*i+c]<a;)i++;for(;i<=s&&r[6*s+c]>=a;)s--;if(!(i<s))return i;for(let t=0;t<3;t++){var u=e[3*i+t];e[3*i+t]=e[3*s+t],e[3*s+t]=u;var u=r[6*i+2*t];r[6*i+2*t]=r[6*s+2*t],r[6*s+2*t]=u;var u=r[6*i+2*t+1];r[6*i+2*t+1]=r[6*s+2*t+1],r[6*s+2*t+1]=u}i++,s--}}const $=32,J=(t,e)=>t.candidate-e.candidate,K=new Array($).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Q=new Float32Array(6);function S(t,e,r,n,s,o){let a=-1,c=0;if(o===i)a=W(e),-1!==a&&(c=(e[a]+e[a+3])/2);else if(o===G)a=W(t),-1!==a&&(c=tt(r,n,s,a));else if(o===C){var u=Z(t);let i=O*s;var l=6*n,d=6*(n+s);for(let o=0;o<3;o++){var f=e[o],h,p,v=(e[o+3]-f)/$,m,y;if(s<$/4){const z=[...K];z.length=s;let e=0;for(let t=l;t<d;t+=6,e++){const N=z[e];N.candidate=r[t+2*o],N.count=0;const{bounds:U,leftCacheBounds:E,rightCacheBounds:_}=N;for(let t=0;t<3;t++)_[t]=1/0,_[t+3]=-1/0,E[t]=1/0,E[t+3]=-1/0,U[t]=1/0,U[t+3]=-1/0;j(t,r,U)}z.sort(J);let n=s;for(let t=0;t<n;t++)for(var x=z[t];t+1<n&&z[t+1].candidate===x.candidate;)z.splice(t+1,1),n--;for(let e=l;e<d;e+=6){var g=r[e+2*o];for(let t=0;t<n;t++){const k=z[t];g>=k.candidate?j(e,r,k.rightCacheBounds):(j(e,r,k.leftCacheBounds),k.count++)}}for(let r=0;r<n;r++){var b=z[r],w=b.count,B=s-b.count;const Q=b.leftCacheBounds;var T=b.rightCacheBounds;let t=0;0!==w&&(t=Z(Q)/u);let e=0;0!=B&&(e=Z(T)/u);var B=L+O*(t*w+e*B);B<i&&(a=o,i=B,c=b.candidate)}}else{for(let t=0;t<$;t++){const H=K[t];H.count=0,H.candidate=f+v+t*v;const R=H.bounds;for(let t=0;t<3;t++)R[t]=1/0,R[t+3]=-1/0}for(let e=l;e<d;e+=6){let t=~~((r[e+2*o]-f)/v);t>=$&&(t=$-1);const q=K[t];q.count++,j(e,r,q.bounds)}var A=K[$-1];X(A.bounds,A.rightCacheBounds);for(let t=$-2;0<=t;t--){var M=K[t],I=K[t+1];Y(M.bounds,I.rightCacheBounds,M.rightCacheBounds)}let n=0;for(let r=0;r<$-1;r++){var P=K[r],S=P.count,F=P.bounds,V,D=K[r+1].rightCacheBounds;0!==S&&(0===n?X(F,Q):Y(F,Q,Q)),n+=S;let t=0,e=0;0!==n&&(t=Z(Q)/u);var S=s-n;0!=S&&(e=Z(D)/u);var S=L+O*(t*n+e*S);S<i&&(a=o,i=S,c=P.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${o} used.`);return{axis:a,pos:c}}function tt(r,n,o,i){let s=0;for(let t=n,e=n+o;t<e;t++)s+=r[6*t+2*i];return s/o}function V(t,u){const l=t.attributes.position;var e=t.index.array,r=e.length/3;const d=new Float32Array(6*r);var f=l.normalized,h=l.array,n=l.offset||0;let o=3;l.isInterleavedBufferAttribute&&(o=l.data.stride);var p=["getX","getY","getZ"];for(let t=0;t<r;t++){var i=3*t,v=6*t;let s,a,c;c=f?(s=e[0+i],a=e[1+i],e[2+i]):(s=e[0+i]*o+n,a=e[1+i]*o+n,e[2+i]*o+n);for(let i=0;i<3;i++){let t,e,r;r=f?(t=l[p[i]](s),e=l[p[i]](a),l[p[i]](c)):(t=h[s+i],e=h[a+i],h[c+i]);let n=t;e<n&&(n=e),r<n&&(n=r);let o=t;e>o&&(o=e),r>o&&(o=r);var m=(o-n)/2,y=2*i;d[v+y]=n+m,d[v+y+1]=m+(Math.abs(n)+m)*x,n<u[i]&&(u[i]=n),o>u[i+3]&&(u[i+3]=o)}}return d}function f(c,t){function u(t){r&&r(t/n)}function l(t,e,r,n=null,o=0){if(!x&&o>=p&&(x=!0,v&&(console.warn(`MeshBVH: Max depth of ${p} reached when generating BVH. Consider increasing maxDepth.`),console.warn(c))),r<=m||o>=p)return u(e+r),t.offset=e,t.count=r,t;var i=S(t.boundingData,n,f,e,r,y);if(-1===i.axis)return u(e+r),t.offset=e,t.count=r,t;var n=I(h,f,e,r,i);if(n===e||n===e+r)u(e+r),t.offset=e,t.count=r;else{t.splitAxis=i.axis;const s=new w;var i=e,e=n-e;t.left=s,s.boundingData=new Float32Array(6),A(f,i,e,s.boundingData,d),l(s,i,e,d,o+1);const a=new w;var n=n,e=r-e;t.right=a,a.boundingData=new Float32Array(6),A(f,n,e,a.boundingData,d),l(a,n,e,d,o+1)}return t}B(c,t);var e=new Float32Array(6);const d=new Float32Array(6),f=V(c,e),h=c.index.array,p=t.maxDepth,v=t.verbose,m=t.maxLeafTris,y=t.strategy,r=t.onProgress,n=c.index.count/3;let x=!1;const o=[];var i=T(c);if(1===i.length){var t=i[0];const a=new w;a.boundingData=e,M(f,t.offset,t.count,d),l(a,t.offset,t.count,d),o.push(a)}else for(var s of i){const g=new w;g.boundingData=new Float32Array(6),A(f,s.offset,s.count,g.boundingData,d),l(g,s.offset,s.count,d),o.push(g)}return o}function o(t,e){var r=f(t,e);let a,c,u;const n=[],o=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let t=0;t<r.length;t++){var i=r[t],s=l(i),s=new o(v*s);a=new Float32Array(s),c=new Uint32Array(s),u=new Uint16Array(s),d(0,i),n.push(s)}return n;function l(t){return t.count?1:1+l(t.left)+l(t.right)}function d(t,e){var r=t/4,n=t/2,o=!!e.count,i=e.boundingData;for(let t=0;t<6;t++)a[r+t]=i[t];if(o){var o=e.offset,s=e.count;return c[6+r]=o,u[14+n]=s,u[15+n]=P,t+v}var s=e.left,n=e.right,e=e.splitAxis,s,s=d(t+v,s);if(s/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return c[6+r]=s/4,s=d(s,n),c[7+r]=e,s}}class s{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(r,n){let o=1/0,i=-1/0;for(let t=0,e=r.length;t<e;t++){var s,a=r[t][n];o=a<o?a:o,i=a>i?a:i}this.min=o,this.max=i}setFromPoints(r,n){let o=1/0,i=-1/0;for(let t=0,e=n.length;t<e;t++){var s=n[t],s=r.dot(s);o=s<o?s:o,i=s>i?s:i}this.min=o,this.max=i}isSeparated(t){return this.min>t.max||t.min>this.max}}s.prototype.setFromBox=function(){const u=new b.Vector3;return function t(n,e){var o=e.min,i=e.max;let s=1/0,a=-1/0;for(let r=0;r<=1;r++)for(let e=0;e<=1;e++)for(let t=0;t<=1;t++){u.x=o.x*r+i.x*(1-r),u.y=o.y*e+i.y*(1-e),u.z=o.z*t+i.z*(1-t);var c=n.dot(u);s=Math.min(c,s),a=Math.max(c,a)}this.min=s,this.max=a}}();var a=function(){const h=new s;return function t(e,r){var n=e.points,o=e.satAxes,i=e.satBounds,s=r.points,a=r.satAxes,c=r.satBounds;for(let t=0;t<3;t++){const d=i[t];var u=o[t];if(h.setFromPoints(u,s),d.isSeparated(h))return!1}for(let t=0;t<3;t++){const f=c[t];var l=a[t];if(h.setFromPoints(l,n),f.isSeparated(h))return!1}}}();const h=function(){const f=new b.Vector3,h=new b.Vector3,p=new b.Vector3;return function t(e,r,n){var o=e.start;const i=f;var s=r.start;const a=h;p.subVectors(o,s),f.subVectors(e.end,e.start),h.subVectors(r.end,r.start);var c=p.dot(a),o=a.dot(i),s=a.dot(a),e=p.dot(i),u,r=i.dot(i)*s-o*o;let l,d;l=0!=r?(c*o-e*s)/r:0,d=(c+l*o)/s,n.x=l,n.y=d}}(),D=function(){const e=new b.Vector2,l=new b.Vector3,d=new b.Vector3;return function t(r,n,o,i){h(r,n,e);var s=e.x,a=e.y;if(0<=s&&s<=1&&0<=a&&a<=1)r.at(s,o),n.at(a,i);else if(0<=s&&s<=1)a<0?n.at(0,i):n.at(1,i),r.closestPointToPoint(i,!0,o);else if(0<=a&&a<=1)s<0?r.at(0,o):r.at(1,o),n.closestPointToPoint(o,!0,i);else{let t;t=s<0?r.start:r.end;let e;e=a<0?n.start:n.end;const c=l,u=d;r.closestPointToPoint(e,!0,l),n.closestPointToPoint(t,!0,d),c.distanceToSquared(e)<=u.distanceToSquared(t)?(o.copy(c),i.copy(e)):(o.copy(t),i.copy(u))}}}(),c=function(){const h=new b.Vector3,p=new b.Vector3,v=new b.Plane,m=new b.Line3;return function t(e,r){var{radius:n,center:o}=e,{a:i,b:s,c:e}=r,a;m.start=i,m.end=s;const c=m.closestPointToPoint(o,!0,h);if(c.distanceTo(o)<=n)return!0;m.start=i,m.end=e;const u=m.closestPointToPoint(o,!0,h);if(u.distanceTo(o)<=n)return!0;m.start=s,m.end=e;const l=m.closestPointToPoint(o,!0,h);if(l.distanceTo(o)<=n)return!0;const d=r.getPlane(v);if(Math.abs(d.distanceToPoint(o))<=n){var o=d.projectPoint(o,p),f;if(r.containsPoint(o))return!0}return!1}}(),u=1e-15;function et(t){return Math.abs(t)<u}class l extends b.Triangle{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new b.Vector3),this.satBounds=new Array(4).fill().map(()=>new s),this.points=[this.a,this.b,this.c],this.sphere=new b.Sphere,this.plane=new b.Plane,this.needsUpdate=!0}intersectsSphere(t){return c(t,this)}update(){var t=this.a,e=this.b,r=this.c,n=this.points,o=this.satAxes,i=this.satBounds,s=o[0];const a=i[0];this.getNormal(s),a.setFromPoints(s,n);const c=o[1],u=i[1];c.subVectors(t,e),u.setFromPoints(c,n);const l=o[2],d=i[2];l.subVectors(e,r),d.setFromPoints(l,n);const f=o[3],h=i[3];f.subVectors(r,t),h.setFromPoints(f,n),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(s,t),this.needsUpdate=!1}}l.prototype.closestPointToSegment=function(){const l=new b.Vector3,d=new b.Vector3,f=new b.Line3;return function t(e,r=null,n=null){const{start:o,end:i}=e;var s=this.points;let a,c=1/0;for(let t=0;t<3;t++){var u=(t+1)%3;f.start.copy(s[t]),f.end.copy(s[u]),D(f,e,l,d),a=l.distanceToSquared(d),a<c&&(c=a,r&&r.copy(l),n&&n.copy(d))}return this.closestPointToPoint(o,l),a=o.distanceToSquared(l),a<c&&(c=a,r&&r.copy(l),n&&n.copy(o)),this.closestPointToPoint(i,l),a=i.distanceToSquared(l),a<c&&(c=a,r&&r.copy(l),n&&n.copy(i)),Math.sqrt(c)}}(),l.prototype.intersectsTriangle=function(){const V=new l,D=new Array(3),z=new Array(3),N=new s,U=new s,E=new b.Vector3,_=new b.Vector3,k=new b.Vector3,H=new b.Vector3,R=new b.Line3,q=new b.Line3,G=new b.Line3;return function t(i,s=null){this.needsUpdate&&this.update(),i.isExtendedTriangle?i.needsUpdate&&i.update():(V.copy(i),V.update(),i=V);const a=this.plane,c=i.plane;if(Math.abs(a.normal.dot(c.normal))>1-1e-10){var e=this.satBounds,r=this.satAxes;z[0]=i.a,z[1]=i.b,z[2]=i.c;for(let t=0;t<4;t++){const I=e[t];var n=r[t];if(N.setFromPoints(n,z),I.isSeparated(N))return!1}var o=i.satBounds,u=i.satAxes;D[0]=this.a,D[1]=this.b,D[2]=this.c;for(let t=0;t<4;t++){const P=o[t];var l=u[t];if(N.setFromPoints(l,D),P.isSeparated(N))return!1}for(let t=0;t<4;t++){var d=r[t];for(let t=0;t<4;t++){var f=u[t];if(E.crossVectors(d,f),N.setFromPoints(E,D),U.setFromPoints(E,z),N.isSeparated(U))return!1}}return s&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),s.start.set(0,0,0),s.end.set(0,0,0)),!0}{var h=this.points;let e=!1,r=0;for(let t=0;t<3;t++){var p=h[t],v=h[(t+1)%3];R.start.copy(p),R.end.copy(v),R.delta(_);const S=e?q.start:q.end;var p=et(c.distanceToPoint(p)),m;if(et(c.normal.dot(_))&&p){q.copy(R),r=2;break}if((c.intersectLine(R,S)||p)&&!et(S.distanceTo(v))){if(r++,e)break;e=!0}}if(1===r&&i.containsPoint(q.end))return s&&(s.start.copy(q.end),s.end.copy(q.end)),!0;if(2!==r)return!1;var y=i.points,x;let n=!1,o=0;for(let t=0;t<3;t++){var g=y[t],b=y[(t+1)%3];R.start.copy(g),R.end.copy(b),R.delta(k);const F=n?G.start:G.end;var g=et(a.distanceToPoint(g)),w;if(et(a.normal.dot(k))&&g){G.copy(R),o=2;break}if((a.intersectLine(R,F)||g)&&!et(F.distanceTo(b))){if(o++,n)break;n=!0}}if(1===o&&this.containsPoint(G.end))return s&&(s.start.copy(G.end),s.end.copy(G.end)),!0;if(2!==o)return!1;q.delta(_),G.delta(k),_.dot(k)<0&&(x=G.start,G.start=G.end,G.end=x);var B=q.start.dot(_),T=q.end.dot(_),i=G.start.dot(_),x=G.end.dot(_),A,M;return B!==x&&i!==T&&T<i==B<x?!1:(s&&(H.subVectors(q.start,G.start),0<H.dot(_)?s.start.copy(q.start):s.start.copy(G.start),H.subVectors(q.end,G.end),H.dot(_)<0?s.end.copy(q.end):s.end.copy(G.end)),!0)}}}(),l.prototype.distanceToPoint=function(){const r=new b.Vector3;return function t(e){return this.closestPointToPoint(e,r),e.distanceTo(r)}}(),l.prototype.distanceToTriangle=function(){const h=new b.Vector3,p=new b.Vector3,v=["a","b","c"],m=new b.Line3,y=new b.Line3;return function t(r,n=null,o=null){const e=n||o?m:null;if(this.intersectsTriangle(r,e))return(n||o)&&(n&&e.getCenter(n),o&&e.getCenter(o)),0;let i=1/0;for(let e=0;e<3;e++){let t;var s=v[e];const d=r[s];this.closestPointToPoint(d,h),t=d.distanceToSquared(h),t<i&&(i=t,n&&n.copy(h),o&&o.copy(d));const f=this[s];r.closestPointToPoint(f,h),t=f.distanceToSquared(h),t<i&&(i=t,n&&n.copy(f),o&&o.copy(h))}for(let t=0;t<3;t++){var a=v[t],c=v[(t+1)%3];m.set(this[a],this[c]);for(let t=0;t<3;t++){var u=v[t],l=v[(t+1)%3];y.set(r[u],r[l]),D(m,y,h,p);var l=h.distanceToSquared(p);l<i&&(i=l,n&&n.copy(h),o&&o.copy(p))}}return Math.sqrt(i)}}();class d{constructor(t,e,r){this.isOrientedBox=!0,this.min=new b.Vector3,this.max=new b.Vector3,this.matrix=new b.Matrix4,this.invMatrix=new b.Matrix4,this.points=new Array(8).fill().map(()=>new b.Vector3),this.satAxes=new Array(3).fill().map(()=>new b.Vector3),this.satBounds=new Array(3).fill().map(()=>new s),this.alignedSatBounds=new Array(3).fill().map(()=>new s),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),r&&this.matrix.copy(r)}set(t,e,r){this.min.copy(t),this.max.copy(e),this.matrix.copy(r),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}d.prototype.update=function t(){var n=this.matrix,o=this.min,i=this.max,s=this.points,e;for(let r=0;r<=1;r++)for(let e=0;e<=1;e++)for(let t=0;t<=1;t++){const f=s[+r|2*e|4*t];f.x=(r?i:o).x,f.y=(e?i:o).y,f.z=(t?i:o).z,f.applyMatrix4(n)}var r=this.satBounds,a=this.satAxes,c=s[0];for(let t=0;t<3;t++){const h=a[t],p=r[t];var u,l=s[1<<t];h.subVectors(c,l),p.setFromPoints(h,s)}const d=this.alignedSatBounds;d[0].setFromPointsField(s,"x"),d[1].setFromPointsField(s,"y"),d[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},d.prototype.intersectsBox=function(){const u=new s;return function t(e){this.needsUpdate&&this.update();var r=e.min,n=e.max,o=this.satBounds,i=this.satAxes;const s=this.alignedSatBounds;if(u.min=r.x,u.max=n.x,s[0].isSeparated(u))return!1;if(u.min=r.y,u.max=n.y,s[1].isSeparated(u))return!1;if(u.min=r.z,u.max=n.z,s[2].isSeparated(u))return!1;for(let t=0;t<3;t++){var a=i[t];const c=o[t];if(u.setFromBox(a,e),c.isSeparated(u))return!1}return!0}}(),d.prototype.intersectsTriangle=function(){const h=new l,p=new Array(3),v=new s,m=new s,y=new b.Vector3;return function t(e){this.needsUpdate&&this.update(),e.isExtendedTriangle?e.needsUpdate&&e.update():(h.copy(e),h.update(),e=h);var r=this.satBounds,n=this.satAxes;p[0]=e.a,p[1]=e.b,p[2]=e.c;for(let t=0;t<3;t++){const d=r[t];var o=n[t];if(v.setFromPoints(o,p),d.isSeparated(v))return!1}var i=e.satBounds,s=e.satAxes,a=this.points;for(let t=0;t<3;t++){const f=i[t];var c=s[t];if(v.setFromPoints(c,a),f.isSeparated(v))return!1}for(let t=0;t<3;t++){var u=n[t];for(let t=0;t<4;t++){var l=s[t];if(y.crossVectors(u,l),v.setFromPoints(y,p),m.setFromPoints(y,a),v.isSeparated(m))return!1}}return!0}}(),d.prototype.closestPointToPoint=function t(e,r){return this.needsUpdate&&this.update(),r.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),r},d.prototype.distanceToPoint=function(){const r=new b.Vector3;return function t(e){return this.closestPointToPoint(e,r),e.distanceTo(r)}}(),d.prototype.distanceToBox=function(){const T=["x","y","z"],A=new Array(12).fill().map(()=>new b.Line3),M=new Array(12).fill().map(()=>new b.Line3),I=new b.Vector3,P=new b.Vector3;return function t(e,r=0,n=null,o=null){if(this.needsUpdate&&this.update(),this.intersectsBox(e))return(n||o)&&(e.getCenter(P),this.closestPointToPoint(P,I),e.closestPointToPoint(I,P),n&&n.copy(I),o&&o.copy(P)),0;var i=r*r,s=e.min,a=e.max,c=this.points;let u=1/0;for(let t=0;t<8;t++){const g=c[t];P.copy(g).clamp(s,a);var l=g.distanceToSquared(P);if(l<u&&(u=l,n&&n.copy(g),o&&o.copy(P),l<i))return Math.sqrt(l)}let d=0;for(let r=0;r<3;r++)for(let e=0;e<=1;e++)for(let t=0;t<=1;t++){var f=(r+1)%3,h=(r+2)%3,p=e<<f|t<<h,v=1<<r|e<<f|t<<h,p=c[p],v=c[v];const b=A[d];b.set(p,v);var p=T[r],v=T[f],f=T[h],h=M[d];const w=h.start,B=h.end;w[p]=s[p],w[v]=(e?s:a)[v],w[f]=t?s[f]:a[v],B[p]=a[p],B[v]=(e?s:a)[v],B[f]=t?s[f]:a[v],d++}for(let r=0;r<=1;r++)for(let e=0;e<=1;e++)for(let t=0;t<=1;t++){P.x=(r?a:s).x,P.y=(e?a:s).y,P.z=(t?a:s).z,this.closestPointToPoint(P,I);var m=P.distanceToSquared(I);if(m<u&&(u=m,n&&n.copy(I),o&&o.copy(P),m<i))return Math.sqrt(m)}for(let t=0;t<12;t++){var y=A[t];for(let t=0;t<12;t++){var x=M[t];D(y,x,I,P);var x=I.distanceToSquared(P);if(x<u&&(u=x,n&&n.copy(I),o&&o.copy(P),x<i))return Math.sqrt(x)}}return Math.sqrt(u)}}();const p=new b.Vector3,m=new b.Vector3,y=new b.Vector3,g=new b.Vector2,z=new b.Vector2,N=new b.Vector2,U=new b.Vector3;function E(t,e,r,n,o,i){let s;return s=i===b.BackSide?t.intersectTriangle(n,r,e,!0,o):t.intersectTriangle(e,r,n,i!==b.DoubleSide,o),null===s?null:{distance:t.origin.distanceTo(o),point:o.clone()};var a}function _(t,e,r,n,o,i,s){p.fromBufferAttribute(e,n),m.fromBufferAttribute(e,o),y.fromBufferAttribute(e,i);const a=E(t,p,m,y,U,s);var i;return a&&(r&&(g.fromBufferAttribute(r,n),z.fromBufferAttribute(r,o),N.fromBufferAttribute(r,i),a.uv=b.Triangle.getUV(U,p,m,y,g,z,N,new b.Vector2)),i={a:n,b:o,c:i,normal:new b.Vector3,materialIndex:0},b.Triangle.getNormal(p,m,y,i.normal),a.face=i,a.faceIndex=n),a}function k(t,e,r,n,o){var i=3*n,s=t.index.getX(i),a=t.index.getX(1+i),i=t.index.getX(2+i);const c=_(r,t.attributes.position,t.attributes.uv,s,a,i,e);return c?(c.faceIndex=n,o&&o.push(c),c):null}function H(r,n,o,i,s,a){for(let t=i,e=i+s;t<e;t++)k(r,n,o,t,a)}function R(r,n,o,i,s){let a=1/0,c=null;for(let t=i,e=i+s;t<e;t++){var u=k(r,n,o,t);u&&u.distance<a&&(c=u,a=u.distance)}return c}function q(t,e,r){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(r.ray.origin),t.object=e,t.distance<r.near||t.distance>r.far?null:t)}function rt(t,e,r,n){const o=t.a,i=t.b,s=t.c;let a=e,c=e+1,u=e+2;r&&(a=r.getX(e),c=r.getX(e+1),u=r.getX(e+2)),o.x=n.getX(a),o.y=n.getY(a),o.z=n.getZ(a),i.x=n.getX(c),i.y=n.getY(c),i.z=n.getZ(c),s.x=n.getX(u),s.y=n.getY(u),s.z=n.getZ(u)}function nt(r,n,t,o,i,s,a){var c=t.index,u=t.attributes.position;for(let t=r,e=n+r;t<e;t++)if(rt(a,3*t,c,u),a.needsUpdate=!0,o(a,t,i,s))return!0;return!1}const ot=new b.Vector3,it=new b.Vector3,st=new b.Vector3,at=new b.Vector2,ct=new b.Vector2,ut=new b.Vector2;function lt(t,e,r,n){var o=e.getIndex().array,i=e.getAttribute("position"),s=e.getAttribute("uv"),a=o[3*r],c=o[3*r+1],o=o[3*r+2];ot.fromBufferAttribute(i,a),it.fromBufferAttribute(i,c),st.fromBufferAttribute(i,o);let u=0;var l=e.groups,d=3*r;for(let t=0,e=l.length;t<e;t++){var f=l[t],{start:h,count:p}=f;if(h<=d&&d<h+p){u=f.materialIndex;break}}let v=null;return s&&(at.fromBufferAttribute(s,a),ct.fromBufferAttribute(s,c),ut.fromBufferAttribute(s,o),v=n&&n.uv?n.uv:new b.Vector2,b.Triangle.getUV(t,ot,it,st,at,ct,ut,v)),n?(n.face||(n.face={}),n.face.a=a,n.face.b=c,n.face.c=o,n.face.materialIndex=u,n.face.normal||(n.face.normal=new b.Vector3),b.Triangle.getNormal(ot,it,st,n.face.normal),n.uv||(n.uv=new b.Vector2),n.uv.copy(v),n):{face:{a:a,b:c,c:o,materialIndex:u,normal:b.Triangle.getNormal(ot,it,st,new b.Vector3)},uv:v}}class dt{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){const t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}function ft(t,e){return 65535===e[t+15]}function ht(t,e){return e[t+6]}function pt(t,e){return e[t+14]}function vt(t){return t+8}function mt(t,e){return e[t+6]}function yt(t,e){return e[t+7]}function xt(t){return t}const gt=new b.Box3,bt=new b.Vector3,wt=["x","y","z"];function Bt(t,e,r,n,o){var i=2*t,s=Ft,a=Vt,c=Dt,u,l,d,i,t;ft(i,a)?H(e,r,n,c[t+6],a[14+i],o):(It(i=t+8,s,n,bt)&&Bt(i,e,r,n,o),It(t=c[t+6],s,n,bt)&&Bt(t,e,r,n,o))}function Tt(r,n,o,i){var s=2*r,a=Ft,c=Vt,u=Dt,l=ft(s,c),t,e;if(l)return R(n,o,i,u[r+6],c[14+s]);{var l=u[r+7],c=wt[l],d,s=0<=i.direction[c];let t,e;e=s?(t=r+8,u[r+6]):(t=u[r+6],r+8);var f,r=It(t,a,i,bt)?Tt(t,n,o,i):null;if(r){var c=r.point[c],h;if(s?c<=a[e+l]:c>=a[e+l+3])return r}var p,i=It(e,a,i,bt)?Tt(e,n,o,i):null;return r&&i?r.distance<=i.distance?r:i:r||i||null}}const At=function(){let I,P;const n=[],o=new dt(()=>new b.Box3);return function t(...e){I=o.getPrimitive(),P=o.getPrimitive(),n.push(I,P);var r=S(...e);o.releasePrimitive(I),o.releasePrimitive(P),n.pop(),n.pop();var e=n.length;return 0<e&&(P=n[e-1],I=n[e-2]),r};function S(c,u,l,d,f=null,h=0,p=0){function v(t){let e=2*t,r=Vt,n=Dt;for(;!ft(e,r);)t+=8,e=2*t;return n[t+6]}function m(t){let e=2*t,r=Vt,n=Dt;for(;!ft(e,r);)t=n[t+6],e=2*t;return n[t+6]+pt(e,r)}var t=2*c,y=Ft,x=Vt,g=Dt,e;if(ft(t,x)){var r=g[c+6],b=x[14+t];return F(c,y,I),d(r,b,!1,p,h+c,I)}{var b=c+8,c=g[c+6],w;let t=b,e=c,r,n,o,i;f&&(o=I,i=P,F(t,y,o),F(e,y,i),r=f(o),n=f(i),n<r&&(t=c,e=b,w=r,r=n,n=w,o=i)),o||(o=I,F(t,y,o));var b=ft(2*t,x),w=l(o,b,r,p+1,h+t),b,B,T;let s;if(s=2===w?d(b=v(t),(B=m(t))-b,!0,p+1,h+t,o):w&&S(t,u,l,d,f,h,p+1),s)return!0;i=P,F(e,y,i);var y=ft(2*e,x),x=l(i,y,n,p+1,h+e),y,A,M;let a;return a=2===x?d(y=v(e),(A=m(e))-y,!0,p+1,h+e,i):x&&S(e,u,l,d,f,h,p+1),a?!0:!1}}}(),Mt=function(){const T=new l,A=new l,M=new b.Matrix4,I=new d,P=new d;return function t(e,r,n,o,i=null){var s=2*e,a=Ft,c=Vt,u=Dt,l,d;if(null===i&&(n.boundingBox||n.computeBoundingBox(),I.set(n.boundingBox.min,n.boundingBox.max,o),i=I),!ft(s,c)){var f=e+8,h=u[e+6],p,v;return(F(f,a,gt),i.intersectsBox(gt)&&t(f,r,n,o,i))?!0:(F(h,a,gt),!(!i.intersectsBox(gt)||!t(h,r,n,o,i)))}{const g=r.index,b=r.attributes.position;var m=n.index,y=n.attributes.position,x;const w=u[e+6],B=c[14+s];if(M.copy(o).invert(),n.boundsTree)return F(e,a,P),P.matrix.copy(M),P.needsUpdate=!0,n.boundsTree.shapecast({intersectsBounds:t=>P.intersectsBox(t),intersectsTriangle:r=>{r.a.applyMatrix4(o),r.b.applyMatrix4(o),r.c.applyMatrix4(o),r.needsUpdate=!0;for(let t=3*w,e=3*(B+w);t<e;t+=3)if(rt(A,t,g,b),A.needsUpdate=!0,r.intersectsTriangle(A))return!0;return!1}});for(let t=3*w,e=B+3*w;t<e;t+=3){rt(T,t,g,b),T.a.applyMatrix4(M),T.b.applyMatrix4(M),T.c.applyMatrix4(M),T.needsUpdate=!0;for(let t=0,e=m.count;t<e;t+=3)if(rt(A,t,m,y),A.needsUpdate=!0,T.intersectsTriangle(A))return!0}}}}();function It(t,e,r,n){return F(t,e,gt),r.intersectBox(gt,n)}const Pt=[];let St,Ft,Vt,Dt;function zt(t){St&&Pt.push(St),St=t,Ft=new Float32Array(t),Vt=new Uint16Array(t),Dt=new Uint32Array(t)}function Nt(){St=null,Ft=null,Vt=null,Dt=null,Pt.length&&zt(Pt.pop())}const Ut=Symbol("skip tree generation"),Et=new b.Box3,_t=new b.Box3,kt=new b.Matrix4,Ht=new d,Rt=new d,qt=new b.Vector3,Gt=new b.Vector3,Ct=new b.Vector3,Ot=new b.Vector3,Lt=new b.Vector3,Wt=new b.Box3,Xt=new dt(()=>new l);class Yt{static serialize(t,e={}){if(e.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Yt.serialize(t,{cloneBuffers:void 0===arguments[2]||arguments[2]});e={cloneBuffers:!0,...e};const r=t.geometry,n=t._roots,o=r.getIndex();let i;return i=e.cloneBuffers?{roots:n.map(t=>t.slice()),index:o.array.slice()}:{roots:n,index:o.array},i}static deserialize(t,e,r={}){if("boolean"==typeof r)return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Yt.deserialize(t,e,{setIndex:void 0===arguments[2]||arguments[2]});r={setIndex:!0,...r};var{index:n,roots:o}=t,t;const i=new Yt(e,{...r,[Ut]:!0});if(i._roots=o,r.setIndex){const s=e.getIndex();null===s?(t=new b.BufferAttribute(t.index,1,!1),e.setIndex(t)):s.array!==n&&(s.array.set(n),s.needsUpdate=!0)}return i}constructor(t,e={}){if(!t.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t.index&&t.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((e=Object.assign({strategy:i,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[Ut]:!1},e)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,e[Ut]||(this._roots=o(t,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new b.Box3))),this.geometry=t}refit(b=null){b&&Array.isArray(b)&&(b=new Set(b));var t=this.geometry;const w=t.index.array,B=t.attributes.position;let r,T,A,M,n=0;var o=this._roots;for(let t=0,e=o.length;t<e;t++)r=o[t],T=new Uint32Array(r),A=new Uint16Array(r),M=new Float32Array(r),I(0,n),n+=r.byteLength;function I(c,i,s=!1){var u=2*c,t;if(A[15+u]===P){var l=T[c+6],e;let r=1/0,n=1/0,o=1/0,i=-1/0,s=-1/0,a=-1/0;for(let t=3*l,e=3*(l+A[14+u]);t<e;t++){var d=w[t],f=B.getX(d),h=B.getY(d),d=B.getZ(d);f<r&&(r=f),f>i&&(i=f),h<n&&(n=h),h>s&&(s=h),d<o&&(o=d),d>a&&(a=d)}return(M[c+0]!==r||M[c+1]!==n||M[c+2]!==o||M[c+3]!==i||M[c+4]!==s||M[c+5]!==a)&&(M[c+0]=r,M[c+1]=n,M[c+2]=o,M[c+3]=i,M[c+4]=s,M[c+5]=a,!0)}{var a=c+8,p=T[c+6],v,u=p+i;let t=s,e=!1,r=!1;b?t||(e=b.has(a+i),r=b.has(u),t=!e&&!r):(e=!0,r=!0);var s=t||e,u=t||r;let n=!1;s&&(n=I(a,i,t));let o=!1;u&&(o=I(p,i,t));var i=n||o;if(i)for(let t=0;t<3;t++){var m=a+t,y=p+t,x=M[m],g=M[m+3],m=M[y],y=M[y+3];M[c+t]=x<m?x:m,M[c+t+3]=y<g?g:y}return i}}}traverse(a,t=0){const c=this._roots[t],u=new Uint32Array(c),l=new Uint16Array(c);function d(t,e=0){var r=2*t,n=l[15+r]===P,o,i,r,o,i,s;n?(o=u[t+6],i=l[14+r],a(e,n,new Float32Array(c,4*t,6),o,i)):(r=t+8,o=u[t+6],i=u[t+7],a(e,n,new Float32Array(c,4*t,6),i)||(d(r,e+1),d(o,e+1)))}d(0)}raycast(r,n=b.FrontSide){var o=this._roots,i=this.geometry;const s=[];var t=n.isMaterial,a=Array.isArray(n),c=i.groups,u=t?n.side:n;for(let t=0,e=o.length;t<e;t++){var l=a?n[c[t].materialIndex].side:u,d=s.length;if(zt(o[t]),Bt(0,i,l,r,s),Nt(),a){var f=c[t].materialIndex;for(let t=d,e=s.length;t<e;t++)s[t].face.materialIndex=f}}return s}raycastFirst(r,n=b.FrontSide){var o=this._roots,i=this.geometry,t=n.isMaterial,s=Array.isArray(n);let a=null;var c=i.groups,u=t?n.side:n;for(let t=0,e=o.length;t<e;t++){var l=s?n[c[t].materialIndex].side:u;zt(o[t]);const d=Tt(0,i,l,r);Nt(),null!=d&&(null==a||d.distance<a.distance)&&(a=d,s&&(d.face.materialIndex=c[t].materialIndex))}return a}intersectsGeometry(t,e){var r=this.geometry;let n=!1;for(const o of this._roots)if(zt(o),n=Mt(0,r,t,e),Nt(),n)break;return n}shapecast(t,e,r){const i=this.geometry;if(t instanceof Function){if(e){const d=e;e=(t,e,r,n)=>{var e=3*e;return d(t,e,1+e,2+e,r,n)}}t={boundsTraverseOrder:r,intersectsBounds:t,intersectsTriangle:e,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const s=Xt.getPrimitive();let{boundsTraverseOrder:n,intersectsBounds:o,intersectsRange:a,intersectsTriangle:c}=t;if(a&&c){const f=a;a=(t,e,r,n,o)=>!!f(t,e,r,n,o)||nt(t,e,i,c,r,n,s)}else a=a||(c?(t,e,r,n)=>nt(t,e,i,c,r,n,s):(t,e,r)=>r);let u=!1,l=0;for(const h of this._roots){if(zt(h),u=At(0,i,o,a,n,l),Nt(),u)break;l+=h.byteLength}return Xt.releasePrimitive(s),u}bvhcast(r,l,t){let{intersectsRanges:u,intersectsTriangles:d}=t;const f=this.geometry.index,h=this.geometry.attributes.position,p=r.geometry.index,v=r.geometry.attributes.position;kt.copy(l).invert();const m=Xt.getPrimitive(),y=Xt.getPrimitive();if(d){function c(n,o,e,i,s,a,c,u){for(let r=e,t=e+i;r<t;r++){rt(y,3*r,p,v),y.a.applyMatrix4(l),y.b.applyMatrix4(l),y.c.applyMatrix4(l),y.needsUpdate=!0;for(let t=n,e=n+o;t<e;t++)if(rt(m,3*t,f,h),m.needsUpdate=!0,d(m,y,t,r,s,a,c,u))return!0}return!1}if(u){const x=u;u=function(t,e,r,n,o,i,s,a){return!!x(t,e,r,n,o,i,s,a)||c(t,e,r,n,o,i,s,a)}}else u=c}r.getBoundingBox(_t),_t.applyMatrix4(l);var t=this.shapecast({intersectsBounds:t=>_t.intersectsBox(t),intersectsRange:(i,s,t,a,c,e)=>(Et.copy(e),Et.applyMatrix4(kt),r.shapecast({intersectsBounds:t=>Et.intersectsBox(t),intersectsRange:(t,e,r,n,o)=>u(i,s,t,e,a,c,n,o)}))});return Xt.releasePrimitive(m),Xt.releasePrimitive(y),t}intersectsBox(t,e){return Ht.set(t.min,t.max,e),Ht.needsUpdate=!0,this.shapecast({intersectsBounds:t=>Ht.intersectsBox(t),intersectsTriangle:t=>Ht.intersectsTriangle(t)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,a,t={},r={},c=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Ht.set(e.boundingBox.min,e.boundingBox.max,a),Ht.needsUpdate=!0;var n=this.geometry;const u=n.attributes.position,l=n.index,d=e.attributes.position,f=e.index,h=Xt.getPrimitive(),p=Xt.getPrimitive();let v=Gt,m=Ct,y=null,x=null;r&&(y=Ot,x=Lt);let g=1/0,b=null,w=null;return kt.copy(a).invert(),Rt.matrix.copy(kt),this.shapecast({boundsTraverseOrder:t=>Ht.distanceToBox(t),intersectsBounds:(t,e,r)=>r<g&&r<o&&(e&&(Rt.min.copy(t.min),Rt.max.copy(t.max),Rt.needsUpdate=!0),!0),intersectsRange:(i,s)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:t=>Rt.distanceToBox(t),intersectsBounds:(t,e,r)=>r<g&&r<o,intersectsRange:(e,n)=>{for(let r=3*e,t=3*(e+n);r<t;r+=3){rt(p,r,f,d),p.a.applyMatrix4(a),p.b.applyMatrix4(a),p.c.applyMatrix4(a),p.needsUpdate=!0;for(let t=3*i,e=3*(i+s);t<e;t+=3){rt(h,t,l,u),h.needsUpdate=!0;var o=h.distanceToTriangle(p,v,y);if(o<g&&(m.copy(v),x&&x.copy(y),g=o,b=t/3,w=r/3),o<c)return!0}}}});var t;for(let r=0,t=(f||d).count;r<t;r+=3){rt(p,r,f,d),p.a.applyMatrix4(a),p.b.applyMatrix4(a),p.c.applyMatrix4(a),p.needsUpdate=!0;for(let t=3*i,e=3*(i+s);t<e;t+=3){rt(h,t,l,u),h.needsUpdate=!0;var n=h.distanceToTriangle(p,v,y);if(n<g&&(m.copy(v),x&&x.copy(y),g=n,b=t/3,w=r/3),n<c)return!0}}}}),Xt.releasePrimitive(h),Xt.releasePrimitive(p),g===1/0?null:(t.point?t.point.copy(m):t.point=m.clone(),t.distance=g,t.faceIndex=b,r&&(r.point?r.point.copy(x):r.point=x.clone(),r.point.applyMatrix4(kt),m.applyMatrix4(kt),r.distance=m.sub(r.point).length(),r.faceIndex=w),t)}closestPointToPoint(r,t={},e=0,n=1/0){const o=e*e,i=n*n;let s=1/0,a=null;if(this.shapecast({boundsTraverseOrder:t=>(qt.copy(r).clamp(t.min,t.max),qt.distanceToSquared(r)),intersectsBounds:(t,e,r)=>r<s&&r<i,intersectsTriangle:(t,e)=>{t.closestPointToPoint(r,qt);var t=r.distanceToSquared(qt);return t<s&&(Gt.copy(qt),s=t,a=e),t<o}}),s===1/0)return null;var n=Math.sqrt(s);return t.point?t.point.copy(Gt):t.point=Gt.clone(),t.distance=n,t.faceIndex=a,t}getBoundingBox(e){e.makeEmpty();const t=this._roots;return t.forEach(t=>{F(0,new Float32Array(t),Wt),e.union(Wt)}),e}}const jt=new b.Box3;class Zt extends b.Object3D{get isMesh(){return!this.displayEdges}get isLineSegments(){return this.displayEdges}get isLine(){return this.displayEdges}constructor(t,e,r=10,n=0){super(),this.material=e,this.geometry=new b.BufferGeometry,this.name="MeshBVHRootVisualizer",this.depth=r,this.displayParents=!1,this.mesh=t,this.displayEdges=!0,this._group=n}raycast(){}update(){const t=this.geometry,o=this.mesh.geometry.boundsTree;var i=this._group;if(t.dispose(),this.visible=!1,o){const l=this.depth-1,d=this.displayParents;let r=0;o.traverse((t,e)=>t===l||e?(r++,!0):void(d&&r++),i);let c=0;const f=new Float32Array(24*r);o.traverse((t,e,r)=>{var e=t===l||e;if(e||d){F(0,r,jt);var{min:n,max:o}=jt;for(let t=-1;t<=1;t+=2){var i=(t<0?n:o).x;for(let t=-1;t<=1;t+=2){var s=(t<0?n:o).y;for(let t=-1;t<=1;t+=2){var a=(t<0?n:o).z;f[c+0]=i,f[c+1]=s,f[c+2]=a,c+=3}}}return e}},i);let e,n;n=this.displayEdges?new Uint8Array([0,4,1,5,2,6,3,7,0,2,1,3,4,6,5,7,0,1,2,3,4,5,6,7]):new Uint8Array([0,1,2,2,1,3,4,6,5,6,7,5,1,4,5,0,4,1,2,3,6,3,7,6,0,2,4,2,6,4,1,5,3,3,5,7]),e=new(65535<f.length?Uint32Array:Uint16Array)(n.length*r);var s=n.length;for(let t=0;t<r;t++){var a=8*t,u=t*s;for(let t=0;t<s;t++)e[u+t]=a+n[t]}t.setIndex(new b.BufferAttribute(e,1,!1)),t.setAttribute("position",new b.BufferAttribute(f,3,!1)),this.visible=!0}}}class $t extends b.Group{get color(){return this.edgeMaterial.color}get opacity(){return this.edgeMaterial.opacity}set opacity(t){this.edgeMaterial.opacity=t,this.meshMaterial.opacity=t}constructor(t,e=10){super(),this.name="MeshBVHVisualizer",this.depth=e,this.mesh=t,this.displayParents=!1,this.displayEdges=!0,this._roots=[];var t=new b.LineBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1});const r=new b.MeshBasicMaterial({color:65416,transparent:!0,opacity:.3,depthWrite:!1});r.color=t.color,this.edgeMaterial=t,this.meshMaterial=r,this.update()}update(){for(var t=this.mesh.geometry.boundsTree,e=t?t._roots.length:0,r;this._roots.length>e;){const n=this._roots.pop();n.geometry.dispose(),this.remove(n)}for(let t=0;t<e;t++){t>=this._roots.length&&(r=new Zt(this.mesh,this.edgeMaterial,this.depth,t),this.add(r),this._roots.push(r));const o=this._roots[t];o.depth=this.depth,o.mesh=this.mesh,o.displayParents=this.displayParents,o.displayEdges=this.displayEdges,o.material=this.displayEdges?this.edgeMaterial:this.meshMaterial,o.update()}}updateMatrixWorld(...t){this.position.copy(this.mesh.position),this.rotation.copy(this.mesh.rotation),this.scale.copy(this.mesh.scale),super.updateMatrixWorld(...t)}copy(t){this.depth=t.depth,this.mesh=t.mesh}clone(){return new $t(this.mesh,this.depth)}dispose(){this.edgeMaterial.dispose(),this.meshMaterial.dispose();const r=this.children;for(let t=0,e=r.length;t<e;t++)r[t].geometry.dispose()}}const Jt=new b.Box3,Kt=new b.Box3,Qt=new b.Vector3;function te(t){switch(typeof t){case"number":return 8;case"string":return 2*t.length;case"boolean":return 4;default:return 0}}function ee(t){const e=/(Uint|Int|Float)(8|16|32)Array/;return e.test(t.constructor.name)}function re(t,e){const a={nodeCount:0,leafNodeCount:0,depth:{min:1/0,max:-1/0},tris:{min:1/0,max:-1/0},splits:[0,0,0],surfaceAreaScore:0};return t.traverse((t,e,r,n,o)=>{var i=r[3]-r[0],s=r[4]-r[1],r=r[5]-r[2],i=2*(i*s+s*r+r*i);a.nodeCount++,e?(a.leafNodeCount++,a.depth.min=Math.min(t,a.depth.min),a.depth.max=Math.max(t,a.depth.max),a.tris.min=Math.min(o,a.tris.min),a.tris.max=Math.max(o,a.tris.max),a.surfaceAreaScore+=i*O*o):(a.splits[n]++,a.surfaceAreaScore+=i*L)},e),a.tris.min===1/0&&(a.tris.min=0,a.tris.max=0),a.depth.min===1/0&&(a.depth.min=0,a.depth.max=0),a}function ne(r){return r._roots.map((t,e)=>re(r,e))}function oe(t){const e=new Set,r=[t];let n=0;for(;r.length;){const i=r.pop();if(!e.has(i))for(var o in e.add(i),i){var o;i.hasOwnProperty(o)&&(n+=te(o),!(o=i[o])||"object"!=typeof o&&"function"!=typeof o?n+=te(o):ee(o)||o instanceof ArrayBuffer?n+=o.byteLength:r.push(o))}}return n}function ie(t){const e=t.geometry,u=[],l=e.index,d=e.getAttribute("position");let f=!0;return t.traverse((t,e,r,n,o)=>{var i={depth:t,isLeaf:e,boundingData:r,offset:n,count:o};u[t]=i,F(0,r,Jt);var t=u[t-1],r;if(e)for(let t=3*n,e=3*(n+o);t<e;t+=3){var s=l.getX(t),a=l.getX(t+1),c=l.getX(t+2),s;Qt.fromBufferAttribute(d,s),s=Jt.containsPoint(Qt),Qt.fromBufferAttribute(d,a),s=s&&Jt.containsPoint(Qt),Qt.fromBufferAttribute(d,c),s=s&&Jt.containsPoint(Qt),console.assert(s,"Leaf bounds does not fully contain triangle."),f=f&&s}t&&(F(0,r,Kt),r=Kt.containsBox(Jt),console.assert(r,"Parent bounds does not fully contain child."),f=f&&r)}),f}function se(t){const a=[];return t.traverse((t,e,r,n,o)=>{const i={bounds:F(0,r,new b.Box3)};e?(i.count=o,i.offset=n):(i.left=null,i.right=null),a[t]=i;const s=a[t-1];s&&(null===s.left?s.left=i:s.right=i)}),a[0]}const ae=new b.Ray,ce=new b.Matrix4,ue=b.Mesh.prototype.raycast;function le(r,n){if(this.geometry.boundsTree){if(void 0!==this.material){ce.copy(this.matrixWorld).invert(),ae.copy(r.ray).applyMatrix4(ce);const e=this.geometry.boundsTree;if(!0===r.firstHitOnly){var t=q(e.raycastFirst(ae,this.material),this,r);t&&n.push(t)}else{var o=e.raycast(ae,this.material);for(let t=0,e=o.length;t<e;t++){var i=q(o[t],this,r);i&&n.push(i)}}}}else ue.call(this,r,n)}function de(t){return this.boundsTree=new Yt(this,t),this.boundsTree}function fe(){this.boundsTree=null}function he(t){switch(t){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw new Error}function pe(t){switch(t){case 1:return b.RedFormat;case 2:return b.RGFormat;case 3:case 4:return b.RGBAFormat}}function ve(t){switch(t){case 1:return b.RedIntegerFormat;case 2:return b.RGIntegerFormat;case 3:case 4:return b.RGBAIntegerFormat}}class me extends b.DataTexture{constructor(){super(),this.minFilter=b.NearestFilter,this.magFilter=b.NearestFilter,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){var t=this.overrideItemSize,r=e.itemSize,n=e.count;if(null!==t){if(r*n%t!=0)throw new Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=t,e.count=n*r/t}var o=e.itemSize,i=e.count,s=e.normalized,a=e.array.constructor,c=a.BYTES_PER_ELEMENT;let u=this._forcedType,l=o;if(null===u)switch(a){case Float32Array:u=b.FloatType;break;case Uint8Array:case Uint16Array:case Uint32Array:u=b.UnsignedIntType;break;case Int8Array:case Int16Array:case Int32Array:u=b.IntType}let d,f,h,p,v=he(o);switch(u){case b.FloatType:h=1,f=pe(o),s&&1===c?(p=a,v+="8",a===Uint8Array?d=b.UnsignedByteType:(d=b.ByteType,v+="_SNORM")):(p=Float32Array,v+="32F",d=b.FloatType);break;case b.IntType:v+=8*c+"I",h=s?Math.pow(2,8*a.BYTES_PER_ELEMENT-1):1,f=ve(o),d=1===c?(p=Int8Array,b.ByteType):2===c?(p=Int16Array,b.ShortType):(p=Int32Array,b.IntType);break;case b.UnsignedIntType:v+=8*c+"UI",h=s?Math.pow(2,8*a.BYTES_PER_ELEMENT-1):1,f=ve(o),d=1===c?(p=Uint8Array,b.UnsignedByteType):2===c?(p=Uint16Array,b.UnsignedShortType):(p=Uint32Array,b.UnsignedIntType)}3!==l||f!==b.RGBAFormat&&f!==b.RGBAIntegerFormat||(l=4);var m=Math.ceil(Math.sqrt(i)),t=l*m*m;const y=new p(t);var t=e.normalized;e.normalized=!1;for(let t=0;t<i;t++){var x=l*t;y[x]=e.getX(t)/h,2<=o&&(y[1+x]=e.getY(t)/h),3<=o&&(y[2+x]=e.getZ(t)/h,4===l&&(y[3+x]=1)),4<=o&&(y[3+x]=e.getW(t)/h)}e.normalized=t,this.internalFormat=v,this.format=f,this.type=d,this.image.width=m,this.image.height=m,this.image.data=y,this.needsUpdate=!0,this.dispose(),e.itemSize=r,e.count=n}}class ye extends me{constructor(){super(),this._forcedType=b.UnsignedIntType}}class xe extends me{constructor(){super(),this._forcedType=b.IntType}}class ge extends me{constructor(){super(),this._forcedType=b.FloatType}}function be(t,e,r){var n=t._roots;if(1!==n.length)throw new Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");var t=n[0],o=new Uint16Array(t),i=new Uint32Array(t),s=new Float32Array(t),a=t.byteLength/v,n=2*Math.ceil(Math.sqrt(a/2));const c=new Float32Array(4*n*n);var t=Math.ceil(Math.sqrt(a));const u=new Uint32Array(2*t*t);for(let e=0;e<a;e++){var l=e*v/4,d=2*l,f=l,d,h,p,h,l;for(let t=0;t<3;t++)c[8*e+0+t]=s[0+f+t],c[8*e+4+t]=s[3+f+t];ft(d,o)?(d=o[14+d],h=i[6+l],u[2*e+0]=4294901760|d,u[2*e+1]=h):(h=4*i[6+l]/v,l=i[7+l],u[2*e+0]=l,u[2*e+1]=h)}e.image.data=c,e.image.width=n,e.image.height=n,e.format=b.RGBAFormat,e.type=b.FloatType,e.internalFormat="RGBA32F",e.minFilter=b.NearestFilter,e.magFilter=b.NearestFilter,e.generateMipmaps=!1,e.needsUpdate=!0,e.dispose(),r.image.data=u,r.image.width=t,r.image.height=t,r.format=b.RGIntegerFormat,r.type=b.UnsignedIntType,r.internalFormat="RG32UI",r.minFilter=b.NearestFilter,r.magFilter=b.NearestFilter,r.generateMipmaps=!1,r.needsUpdate=!0,r.dispose()}class we{constructor(){this.autoDispose=!0,this.index=new ye,this.position=new ge,this.bvhBounds=new b.DataTexture,this.bvhContents=new b.DataTexture,this.index.overrideItemSize=3}updateFrom(t){var{geometry:e}=t;be(t,this.bvhBounds,this.bvhContents),this.index.updateFrom(e.index),this.position.updateFrom(e.attributes.position)}dispose(){const{index:t,position:e,bvhBounds:r,bvhContents:n}=this;t&&t.dispose(),e&&e.dispose(),r&&r.dispose(),n&&n.dispose()}}var Be=`
#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,Te=`

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}

// Raycasting
float intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	float dist = max( t0, 0.0 );

	return t1 >= dist ? dist : INFINITY;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	BVH bvh, vec3 rayOrigin, vec3 rayDirection, uint offset, uint count,
	inout float minDistance,

	// output variables
	out uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,
	out float side, out float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( bvh.index, i ).xyz;
		vec3 a = texelFetch1D( bvh.position, indices.x ).rgb;
		vec3 b = texelFetch1D( bvh.position, indices.y ).rgb;
		vec3 c = texelFetch1D( bvh.position, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

float intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, BVH bvh, uint currNodeIndex ) {

	vec3 boundsMin = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 0u ).xyz;
	vec3 boundsMax = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax );

}

bool bvhIntersectFirstHit(
	BVH bvh, vec3 rayOrigin, vec3 rayDirection,

	// output variables
	out uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,
	out float side, out float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ 60 ];
	stack[ 0 ] = 0u;

	float triangleDistance = 1e20;
	bool found = false;
	while ( ptr > - 1 && ptr < 60 ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance = intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh, currNodeIndex );
		if ( boundsHitDistance == INFINITY || boundsHitDistance > triangleDistance ) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh.bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh, rayOrigin, rayDirection, offset, count, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,Ae=`

float dot2( in vec3 v ) {

	return dot( v, v );

}


// https://www.shadertoy.com/view/ttfGWl
vec3 closestPointToTriangle( vec3 p, vec3 v0, vec3 v1, vec3 v2, out vec3 barycoord ) {

    vec3 v10 = v1 - v0;
    vec3 v21 = v2 - v1;
    vec3 v02 = v0 - v2;

	vec3 p0 = p - v0;
	vec3 p1 = p - v1;
	vec3 p2 = p - v2;

    vec3 nor = cross( v10, v02 );

    // method 2, in barycentric space
    vec3  q = cross( nor, p0 );
    float d = 1.0 / dot2( nor );
    float u = d * dot( q, v02 );
    float v = d * dot( q, v10 );
    float w = 1.0 - u - v;

	if( u < 0.0 ) {

		w = clamp( dot( p2, v02 ) / dot2( v02 ), 0.0, 1.0 );
		u = 0.0;
		v = 1.0 - w;

	} else if( v < 0.0 ) {

		u = clamp( dot( p0, v10 ) / dot2( v10 ), 0.0, 1.0 );
		v = 0.0;
		w = 1.0 - u;

	} else if( w < 0.0 ) {

		v = clamp( dot( p1, v21 ) / dot2( v21 ), 0.0, 1.0 );
		w = 0.0;
		u = 1.0-v;

	}

	barycoord = vec3( u, v, w );
    return u * v1 + v * v2 + w * v0;

}

float distanceToTriangles(
	BVH bvh, vec3 point, uint offset, uint count, float closestDistanceSquared,

	out uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord, out float side, out vec3 outPoint
) {

	bool found = false;
	uvec3 localIndices;
	vec3 localBarycoord;
	vec3 localNormal;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( bvh.index, i ).xyz;
		vec3 a = texelFetch1D( bvh.position, indices.x ).rgb;
		vec3 b = texelFetch1D( bvh.position, indices.y ).rgb;
		vec3 c = texelFetch1D( bvh.position, indices.z ).rgb;

		// get the closest point and barycoord
		vec3 closestPoint = closestPointToTriangle( point, a, b, c, localBarycoord );
		vec3 delta = point - closestPoint;
		float sqDist = dot2( delta );
		if ( sqDist < closestDistanceSquared ) {

			// set the output results
			closestDistanceSquared = sqDist;
			faceIndices = uvec4( indices.xyz, i );
			faceNormal = normalize( cross( a - b, b - c ) );
			barycoord = localBarycoord;
			outPoint = closestPoint;
			side = sign( dot( faceNormal, delta ) );

		}

	}

	return closestDistanceSquared;

}

float distanceSqToBounds( vec3 point, vec3 boundsMin, vec3 boundsMax ) {

	vec3 clampedPoint = clamp( point, boundsMin, boundsMax );
	vec3 delta = point - clampedPoint;
	return dot( delta, delta );

}

float distanceSqToBVHNodeBoundsPoint( vec3 point, BVH bvh, uint currNodeIndex ) {

	vec3 boundsMin = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 0u ).xyz;
	vec3 boundsMax = texelFetch1D( bvh.bvhBounds, currNodeIndex * 2u + 1u ).xyz;
	return distanceSqToBounds( point, boundsMin, boundsMax );

}

float bvhClosestPointToPoint(
	BVH bvh, vec3 point,

	// output variables
	out uvec4 faceIndices, out vec3 faceNormal, out vec3 barycoord,
	out float side, out vec3 outPoint
 ) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ 60 ];
	stack[ 0 ] = 0u;
	float closestDistanceSquared = pow( 100000.0, 2.0 );
	bool found = false;
	while ( ptr > - 1 && ptr < 60 ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance = distanceSqToBVHNodeBoundsPoint( point, bvh, currNodeIndex );
		if ( boundsHitDistance > closestDistanceSquared ) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh.bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );
		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;
			closestDistanceSquared = distanceToTriangles(
				bvh, point, offset, count, closestDistanceSquared,

				// outputs
				faceIndices, faceNormal, barycoord, side, outPoint
			);

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;
			bool leftToRight = distanceSqToBVHNodeBoundsPoint( point, bvh, leftIndex ) < distanceSqToBVHNodeBoundsPoint( point, bvh, rightIndex );//rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;
			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return sqrt( closestDistanceSquared );

}
`;const Me=new b.Vector3,Ie=new b.Vector3,Pe=new b.Vector3,Se=new b.Vector4,Fe=new b.Vector3,Ve=new b.Vector3,De=new b.Vector4,ze=new b.Vector4,Ne=new b.Matrix4,Ue=new b.Matrix4;function Ee(t,e){if(t||e){var r=t.count===e.count,n=t.normalized===e.normalized,o=t.array.constructor===e.array.constructor,e=t.itemSize===e.itemSize;if(!(r&&n&&o&&e))throw new Error}}function _e(t,e=null){const r=t.array.constructor;var n=t.normalized,o=t.itemSize,e=null===e?t.count:e;return new b.BufferAttribute(new r(o*e),o,n)}function ke(r,n,o=0){if(r.isInterleavedBufferAttribute){var i=r.itemSize;for(let t=0,e=r.count;t<e;t++){var s=t+o;n.setX(s,r.getX(t)),2<=i&&n.setY(s,r.getY(t)),3<=i&&n.setZ(s,r.getZ(t)),4<=i&&n.setW(s,r.getW(t))}}else{var t=n.array;const a=t.constructor;var e=t.BYTES_PER_ELEMENT*r.itemSize*o;const c=new a(t.buffer,e,r.array.length);c.set(r.array)}}function He(t,e,r){const n=t.elements;var o=e.elements;for(let t=0,e=o.length;t<e;t++)n[t]+=o[t]*r}function Re(t,e,r){var n=t.skeleton,o=t.geometry,i=n.bones,s=n.boneInverses;De.fromBufferAttribute(o.attributes.skinIndex,e),ze.fromBufferAttribute(o.attributes.skinWeight,e),Ne.elements.fill(0);for(let t=0;t<4;t++){var a=ze.getComponent(t),c;0!==a&&(c=De.getComponent(t),Ue.multiplyMatrices(i[c].matrixWorld,s[c]),He(Ne,Ue,a))}return Ne.multiply(t.bindMatrix).premultiply(t.bindMatrixInverse),r.transformDirection(Ne),r}function qe(r,n,o,i,s){Fe.set(0,0,0);for(let t=0,e=r.length;t<e;t++){var a=n[t],c=r[t];0!==a&&(Ve.fromBufferAttribute(c,i),o?Fe.addScaledVector(Ve,a):Fe.addScaledVector(Ve.sub(s),a))}s.add(Fe)}function Ge(n,e={useGroups:!1,updateIndex:!1,skipAttributes:[]},o=new b.BufferGeometry){var r=null!==n[0].index,{useGroups:i=!1,updateIndex:e=!1,skipAttributes:s=[]}=e;const a=new Set(Object.keys(n[0].attributes)),c={};let u=0;o.clearGroups();for(let e=0;e<n.length;++e){var l=n[e];let t=0;if(r!=(null!==l.index))throw new Error("StaticGeometryGenerator: All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.");for(const v in l.attributes){if(!a.has(v))throw new Error('StaticGeometryGenerator: All geometries must have compatible attributes; make sure "'+v+'" attribute exists among all geometries, or in none of them.');void 0===c[v]&&(c[v]=[]),c[v].push(l.attributes[v]),t++}if(t!==a.size)throw new Error("StaticGeometryGenerator: Make sure all geometries have the same number of attributes.");if(i){let t;if(r)t=l.index.count;else{if(void 0===l.attributes.position)throw new Error("StaticGeometryGenerator: The geometry must have either an index or a position attribute");t=l.attributes.position.count}o.addGroup(u,t,e),u+=t}}if(r){let t=!1;if(!o.index){let e=0;for(let t=0;t<n.length;++t)e+=n[t].index.count;o.setIndex(new b.BufferAttribute(new Uint32Array(e),1,!1)),t=!0}if(e||t){const m=o.index;let e=0,r=0;for(let t=0;t<n.length;++t){var d=n[t];const y=d.index;if(!0!==s[t])for(let t=0;t<y.count;++t)m.setX(e,y.getX(t)+r),e++;r+=d.attributes.position.count}}}for(const x in c){var f=c[x];if(!(x in o.attributes)){let t=0;for(const g in f)t+=f[g].count;o.setAttribute(x,_e(c[x][0],t))}var h=o.attributes[x];let r=0;for(let t=0,e=f.length;t<e;t++){var p=f[t];!0!==s[t]&&ke(p,h,r),r+=p.count}}return o}function Ce(r,n){if(null===r||null===n)return r===n;if(r.length!==n.length)return!1;for(let t=0,e=r.length;t<e;t++)if(r[t]!==n[t])return!1;return!0}class Oe{constructor(t){this.matrixWorld=new b.Matrix4,this.geometryHash=null,this.boneMatrices=null,this.primitiveCount=-1,this.mesh=t,this.update()}update(){var t=this.mesh,e=t.geometry;const r=t.skeleton;var n=(e.index||e.attributes.position).count/3;if(this.matrixWorld.copy(t.matrixWorld),this.geometryHash=e.attributes.position.version,this.primitiveCount=n,r){r.boneTexture||r.computeBoneTexture(),r.update();const o=r.boneMatrices;this.boneMatrices&&this.boneMatrices.length===o.length?this.boneMatrices.set(o):this.boneMatrices=o.slice()}else this.boneMatrices=null}didChange(){var t=this.mesh,e=t.geometry,r=(e.index||e.attributes.position).count/3,n;return!(this.matrixWorld.equals(t.matrixWorld)&&this.geometryHash===e.attributes.position.version&&Ce(t.skeleton&&t.skeleton.boneMatrices||null,this.boneMatrices)&&this.primitiveCount===r)}}class Le{constructor(t){Array.isArray(t)||(t=[t]);const e=[];t.forEach(t=>{t.traverseVisible(t=>{t.isMesh&&e.push(t)})}),this.meshes=e,this.useGroups=!0,this.applyWorldTransforms=!0,this.attributes=["position","normal","color","tangent","uv","uv2"],this._intermediateGeometry=new Array(e.length).fill().map(()=>new b.BufferGeometry),this._diffMap=new WeakMap}getMaterials(){const e=[];return this.meshes.forEach(t=>{Array.isArray(t.material)?e.push(...t.material):e.push(t.material)}),e}generate(t=new b.BufferGeometry){let r=[];const{meshes:n,useGroups:e,_intermediateGeometry:o,_diffMap:i}=this;for(let t=0,e=n.length;t<e;t++){var s=n[t],a=o[t];const c=i.get(s);!c||c.didChange(s)?(this._convertToStaticGeometry(s,a),r.push(!1),c?c.update():i.set(s,new Oe(s))):r.push(!0)}Ge(o,{useGroups:e,skipAttributes:r},t);for(const u in t.attributes)t.attributes[u].needsUpdate=!0;return t}_convertToStaticGeometry(r,t=new b.BufferGeometry){var e=r.geometry,n=this.applyWorldTransforms,o=this.attributes.includes("normal"),i=this.attributes.includes("tangent"),s=e.attributes;const a=t.attributes;t.index||(t.index=e.index),a.position||t.setAttribute("position",_e(s.position)),o&&!a.normal&&s.normal&&t.setAttribute("normal",_e(s.normal)),i&&!a.tangent&&s.tangent&&t.setAttribute("tangent",_e(s.tangent)),Ee(e.index,t.index),Ee(s.position,a.position),o&&Ee(s.normal,a.normal),i&&Ee(s.tangent,a.tangent);var c=s.position,u=o?s.normal:null,l=i?s.tangent:null,d=e.morphAttributes.position,f=e.morphAttributes.normal,h=e.morphAttributes.tangent,p=e.morphTargetsRelative,v=r.morphTargetInfluences;const m=new b.Matrix3;m.getNormalMatrix(r.matrixWorld);for(let t=0,e=s.position.count;t<e;t++)Me.fromBufferAttribute(c,t),u&&Ie.fromBufferAttribute(u,t),l&&(Se.fromBufferAttribute(l,t),Pe.fromBufferAttribute(l,t)),v&&(d&&qe(d,v,p,t,Me),f&&qe(f,v,p,t,Ie),h&&qe(h,v,p,t,Pe)),r.isSkinnedMesh&&(r.boneTransform(t,Me),u&&Re(r,t,Ie),l&&Re(r,t,Pe)),n&&Me.applyMatrix4(r.matrixWorld),a.position.setXYZ(t,Me.x,Me.y,Me.z),u&&(n&&Ie.applyNormalMatrix(m),a.normal.setXYZ(t,Ie.x,Ie.y,Ie.z)),l&&(n&&Pe.transformDirection(r.matrixWorld),a.tangent.setXYZW(t,Pe.x,Pe.y,Pe.z,Se.w));for(const x in this.attributes){var y=this.attributes[x];"position"!==y&&"tangent"!==y&&"normal"!==y&&y in s&&(a[y]||t.setAttribute(y,_e(s[y])),Ee(s[y],a[y]),ke(s[y],a[y]))}return t}}t.AVERAGE=G,t.CENTER=i,t.CONTAINED=2,t.ExtendedTriangle=l,t.FloatVertexAttributeTexture=ge,t.INTERSECTED=1,t.IntVertexAttributeTexture=xe,t.MeshBVH=Yt,t.MeshBVHUniformStruct=we,t.MeshBVHVisualizer=$t,t.NOT_INTERSECTED=0,t.OrientedBox=d,t.SAH=C,t.StaticGeometryGenerator=Le,t.UIntVertexAttributeTexture=ye,t.VertexAttributeTexture=me,t.acceleratedRaycast=le,t.computeBoundsTree=de,t.disposeBoundsTree=fe,t.estimateMemoryInBytes=oe,t.getBVHExtremes=ne,t.getJSONStructure=se,t.getTriangleHitPointInfo=lt,t.shaderDistanceFunction=Ae,t.shaderIntersectFunction=Te,t.shaderStructs=Be,t.validateBounds=ie,Object.defineProperty(t,"__esModule",{value:!0})});"use strict";gapp.register("add.three",[],(e,t)=>{let r=THREE.Mesh.prototype,o=THREE.Box3.prototype,i=THREE.BufferGeometry.prototype;THREE.computeFaceNormal=function(e,t,r){const o=new THREE.Vector3,i=new THREE.Vector3;return i.subVectors(r,t),o.subVectors(e,t),i.cross(o),i.normalize(),i},THREE.addBVH=function(){var{computeBoundsTree:e,disposeBoundsTree:t,acceleratedRaycast:r}=MeshBVHLib;THREE.BufferGeometry.prototype.computeBoundsTree=e,THREE.BufferGeometry.prototype.disposeBoundsTree=t,THREE.Mesh.prototype.raycast=r},THREE.dispose=function(e){if(e&&(e.geometry&&e.geometry.dispose(),e.material&&e.material.map&&e.material.map.dispose&&e.material.map.dispose(),e.children&&e.children.length))for(var t of e.children)THREE.dispose(t)},Object.defineProperties(o,{dim:{get:function(){return this.max.clone().sub(this.min)}},mid:{get:function(){return this.dim.clone().multiplyScalar(.5).add(this.min)}}}),r.getBoundingBox=function(e){return this.geometry.getBoundingBox(e)},r.mirrorX=function(){return this.mirror(0)},r.mirrorY=function(){return this.mirror(1)},r.mirrorZ=function(){return this.mirror(2)},r.mirror=function(e){let t,r=this.geometry,o=r.attributes,i=o.position.array,n=o.normal.array;for(t=e||0;t<i.length;t+=3)i[t]=-i[t],n[t]=-n[t];return r.computeVertexNormals(),this},i.getBoundingBox=function(e){return!e&&this.boundingBox||(this.boundingBox=null,this.computeBoundingBox()),this.boundingBox},i.moveMesh=function(t=0,r=0,o=0){let e=this.attributes.position,i=e.array;for(let e=0;e<i.length;e+=3)i[e]+=t,i[e+1]+=r,i[e+2]+=o;return e.needsUpdate=!0,this},i.shallowClone=function(){let e=new THREE.BufferGeometry;for(var[t,r]of Object.entries(this.attributes))e.setAttribute(t,new THREE.BufferAttribute(r.array,r.itemSize));return e},THREE.Object3D.prototype.newGroup=function(){var e=new THREE.Group;return this.add(e),e},THREE.Object3D.prototype.removeAll=function(){this.children.slice().forEach(function(e){e.parent=void 0,e.dispatchEvent({type:"removed"})}),this.children=[]}});!function(){"use strict";var _={version:"6.4.2.2",use_lines:!0,use_xyz:!1},t=!1,e,i,i,e;"function"==typeof define&&define.amd&&define(_),"undefined"!=typeof document?window.ClipperLib=_:self.ClipperLib=_,e=t?(i="chrome","Netscape"):(i=navigator.userAgent.toString().toLowerCase(),navigator.appName);var n={},o;-1!=i.indexOf("chrome")&&-1==i.indexOf("chromium")?n.chrome=1:n.chrome=0,-1!=i.indexOf("chromium")?n.chromium=1:n.chromium=0,-1!=i.indexOf("safari")&&-1==i.indexOf("chrome")&&-1==i.indexOf("chromium")?n.safari=1:n.safari=0,-1!=i.indexOf("firefox")?n.firefox=1:n.firefox=0,-1!=i.indexOf("firefox/17")?n.firefox17=1:n.firefox17=0,-1!=i.indexOf("firefox/15")?n.firefox15=1:n.firefox15=0,-1!=i.indexOf("firefox/3")?n.firefox3=1:n.firefox3=0,-1!=i.indexOf("opera")?n.opera=1:n.opera=0,-1!=i.indexOf("msie 10")?n.msie10=1:n.msie10=0,-1!=i.indexOf("msie 9")?n.msie9=1:n.msie9=0,-1!=i.indexOf("msie 8")?n.msie8=1:n.msie8=0,-1!=i.indexOf("msie 7")?n.msie7=1:n.msie7=0,-1!=i.indexOf("msie ")?n.msie=1:n.msie=0;var r=0xdeadbeefcafe,s=!(_.biginteger_used=null);function c(t,e,i){_.biginteger_used=1,null!=t&&("number"==typeof t&&void 0===e?this.fromInt(t):"number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function v(){return new c(null,void 0,void 0)}function l(t,e,i,n,o,r){for(;0<=--r;){var s=e*this[t++]+i[n]+o;o=Math.floor(s/67108864),i[n++]=67108863&s}return o}function p(t,e,i,n,o,r){for(var s=32767&e,l=e>>15;0<=--r;){var p=32767&this[t],u=this[t++]>>15,h=l*p+u*s,p;o=((p=s*p+((32767&h)<<15)+i[n]+(1073741823&o))>>>30)+(h>>>15)+l*u+(o>>>30),i[n++]=1073741823&p}return o}function u(t,e,i,n,o,r){for(var s=16383&e,l=e>>14;0<=--r;){var p=16383&this[t],u=this[t++]>>14,h=l*p+u*s,p;o=((p=s*p+((16383&h)<<14)+i[n]+o)>>28)+(h>>14)+l*u,i[n++]=268435455&p}return o}o="Microsoft Internet Explorer"==e?(c.prototype.am=p,30):"Netscape"!=e?(c.prototype.am=l,26):(c.prototype.am=u,28),c.prototype.DB=o,c.prototype.DM=(1<<o)-1,c.prototype.DV=1<<o;var t=52;c.prototype.FV=Math.pow(2,t),c.prototype.F1=t-o,c.prototype.F2=2*o-t;for(var h="0123456789abcdefghijklmnopqrstuvwxyz",a=new Array,f,d,f="0".charCodeAt(0),d=0;d<=9;++d)a[f++]=d;for(f="a".charCodeAt(0),d=10;d<36;++d)a[f++]=d;for(f="A".charCodeAt(0),d=10;d<36;++d)a[f++]=d;function P(t){return h.charAt(t)}function m(t,e){var e=a[t.charCodeAt(e)];return null==e?-1:e}function y(t){for(var e=this.t-1;0<=e;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function C(t){this.t=1,this.s=t<0?-1:0,0<t?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}function I(t){var e=v();return e.fromInt(t),e}function x(t,e){var i;if(16==e)i=4;else if(8==e)i=3;else if(256==e)i=8;else if(2==e)i=1;else if(32==e)i=5;else{if(4!=e)return void this.fromRadix(t,e);i=2}this.t=0,this.s=0;for(var n=t.length,o=!1,r=0;0<=--n;){var s=8==i?255&t[n]:m(t,n);s<0?"-"==t.charAt(n)&&(o=!0):(o=!1,0==r?this[this.t++]=s:r+i>this.DB?(this[this.t-1]|=(s&(1<<this.DB-r)-1)<<r,this[this.t++]=s>>this.DB-r):this[this.t-1]|=s<<r,(r+=i)>=this.DB&&(r-=this.DB))}8==i&&0!=(128&t[0])&&(this.s=-1,0<r&&(this[this.t-1]|=(1<<this.DB-r)-1<<r)),this.clamp(),o&&c.ZERO.subTo(this,this)}function L(){for(var t=this.s&this.DM;0<this.t&&this[this.t-1]==t;)--this.t}function E(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var i=(1<<e)-1,n,o=!1,r="",s=this.t,l=this.DB-s*this.DB%e;if(0<s--)for(l<this.DB&&0<(n=this[s]>>l)&&(o=!0,r=P(n));0<=s;)l<e?(n=(this[s]&(1<<l)-1)<<e-l,n|=this[--s]>>(l+=this.DB-e)):(n=this[s]>>(l-=e)&i,l<=0&&(l+=this.DB,--s)),(o=0<n?!0:o)&&(r+=P(n));return o?r:"0"}function T(){var t=v();return c.ZERO.subTo(this,t),t}function g(){return this.s<0?this.negate():this}function X(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t,e;if(0!=(e=i-t.t))return this.s<0?-e:e;for(;0<=--i;)if(0!=(e=this[i]-t[i]))return e;return 0}function N(t){var e=1,i;return 0!=(i=t>>>16)&&(t=i,e+=16),0!=(i=t>>8)&&(t=i,e+=8),0!=(i=t>>4)&&(t=i,e+=4),0!=(i=t>>2)&&(t=i,e+=2),0!=(i=t>>1)&&(t=i,e+=1),e}function O(){return this.t<=0?0:this.DB*(this.t-1)+N(this[this.t-1]^this.s&this.DM)}function Y(t,e){for(var i,i=this.t-1;0<=i;--i)e[i+t]=this[i];for(i=t-1;0<=i;--i)e[i]=0;e.t=this.t+t,e.s=this.s}function S(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s}function A(t,e){for(var i=t%this.DB,n=this.DB-i,o=(1<<n)-1,r=Math.floor(t/this.DB),s=this.s<<i&this.DM,l,l=this.t-1;0<=l;--l)e[l+r+1]=this[l]>>n|s,s=(this[l]&o)<<i;for(l=r-1;0<=l;--l)e[l]=0;e[r]=s,e.t=this.t+r+1,e.s=this.s,e.clamp()}function B(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)e.t=0;else{var n=t%this.DB,o=this.DB-n,r=(1<<n)-1;e[0]=this[i]>>n;for(var s=i+1;s<this.t;++s)e[s-i-1]|=(this[s]&r)<<o,e[s-i]=this[s]>>n;0<n&&(e[this.t-i-1]|=(this.s&r)<<o),e.t=this.t-i,e.clamp()}}function D(t,e){for(var i=0,n=0,o=Math.min(t.t,this.t);i<o;)n+=this[i]-t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n-=t[i],e[i++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=n<0?-1:0,n<-1?e[i++]=this.DV+n:0<n&&(e[i++]=n),e.t=i,e.clamp()}function b(t,e){var i=this.abs(),n=t.abs(),o=i.t;for(e.t=o+n.t;0<=--o;)e[o]=0;for(o=0;o<n.t;++o)e[o+i.t]=i.am(0,n[o],e,o,0,i.t);e.s=0,e.clamp(),this.s!=t.s&&c.ZERO.subTo(e,e)}function M(t){for(var e=this.abs(),i=t.t=2*e.t;0<=--i;)t[i]=0;for(i=0;i<e.t-1;++i){var n=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,n,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}0<t.t&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()}function R(t,e,i){var n=t.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t)return null!=e&&e.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=v());var r=v(),s=this.s,l=t.s,t=this.DB-N(n[n.t-1]);0<t?(n.lShiftTo(t,r),o.lShiftTo(t,i)):(n.copyTo(r),o.copyTo(i));var p=r.t,u=r[p-1];if(0!=u){var o=u*(1<<this.F1)+(1<p?r[p-2]>>this.F2:0),h=this.FV/o,a=(1<<this.F1)/o,f=1<<this.F2,d=i.t,P=d-p,m=null==e?v():e;for(r.dlShiftTo(P,m),0<=i.compareTo(m)&&(i[i.t++]=1,i.subTo(m,i)),c.ONE.dlShiftTo(p,m),m.subTo(r,r);r.t<p;)r[r.t++]=0;for(;0<=--P;){var y=i[--d]==u?this.DM:Math.floor(i[d]*h+(i[d-1]+f)*a);if((i[d]+=r.am(0,y,i,P,0,p))<y)for(r.dlShiftTo(P,m),i.subTo(m,i);i[d]<--y;)i.subTo(m,i)}null!=e&&(i.drShiftTo(p,e),s!=l&&c.ZERO.subTo(e,e)),i.t=p,i.clamp(),0<t&&i.rShiftTo(t,i),s<0&&c.ZERO.subTo(i,i)}}}function w(t){var e=v();return this.abs().divRemTo(t,null,e),this.s<0&&0<e.compareTo(c.ZERO)&&t.subTo(e,e),e}function F(t){this.m=t}function W(t){return t.s<0||0<=t.compareTo(this.m)?t.mod(this.m):t}function Z(t){return t}function q(t){t.divRemTo(this.m,null,t)}function z(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function H(t,e){t.squareTo(e),this.reduce(e)}function k(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t,e;return 0<(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)?this.DV-e:-e}function U(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function J(t){var e=v();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&0<e.compareTo(c.ZERO)&&this.m.subTo(e,e),e}function j(t){var e=v();return t.copyTo(e),this.reduce(e),e}function G(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],n=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM,i;for(t[i=e+this.m.t]+=this.m.am(0,n,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),0<=t.compareTo(this.m)&&t.subTo(this.m,t)}function V(t,e){t.squareTo(e),this.reduce(e)}function $(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function K(){return 0==(0<this.t?1&this[0]:this.s)}function Q(t,e){if(4294967295<t||t<1)return c.ONE;var i=v(),n=v(),o=e.convert(this),r=N(t)-1,s,i,n;for(o.copyTo(i);0<=--r;){e.sqrTo(i,n),0<(t&1<<r)?e.mulTo(n,o,i):(s=i,i=n,n=s)}return e.revert(i)}function tt(t,e){var e,e=new(t<256||e.isEven()?F:U)(e);return this.exp(t,e)}function et(){var t=v();return this.copyTo(t),t}function it(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function nt(){return 0==this.t?this.s:this[0]<<24>>24}function ot(){return 0==this.t?this.s:this[0]<<16>>16}function rt(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function st(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1}function lt(t){if(null==t&&(t=10),0==this.signum()||t<2||36<t)return"0";var e=this.chunkSize(t),i=Math.pow(t,e),n=I(i),o=v(),r=v(),s="";for(this.divRemTo(n,o,r);0<o.signum();)s=(i+r.intValue()).toString(t).substr(1)+s,o.divRemTo(n,o,r);return r.intValue().toString(t)+s}function pt(t,e){this.fromInt(0);for(var i=this.chunkSize(e=null==e?10:e),n=Math.pow(e,i),o=!1,r=0,s=0,l=0;l<t.length;++l){var p=m(t,l);p<0?"-"==t.charAt(l)&&0==this.signum()&&(o=!0):(s=e*s+p,++r>=i&&(this.dMultiply(n),this.dAddOffset(s,0),s=r=0))}0<r&&(this.dMultiply(Math.pow(e,r)),this.dAddOffset(s,0)),o&&c.ZERO.subTo(this,this)}function ut(t,e,i){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,i),this.testBit(t-1)||this.bitwiseTo(c.ONE.shiftLeft(t-1),ct,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(c.ONE.shiftLeft(t-1),this);else{var n=new Array,i=7&t;n.length=1+(t>>3),e.nextBytes(n),0<i?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}}function ht(){var t=this.t,e=new Array;e[0]=this.s;var i=this.DB-t*this.DB%8,n,o=0;if(0<t--)for(i<this.DB&&(n=this[t]>>i)!=(this.s&this.DM)>>i&&(e[o++]=n|this.s<<this.DB-i);0<=t;)i<8?(n=(this[t]&(1<<i)-1)<<8-i,n|=this[--t]>>(i+=this.DB-8)):(n=this[t]>>(i-=8)&255,i<=0&&(i+=this.DB,--t)),0!=(128&n)&&(n|=-256),0==o&&(128&this.s)!=(128&n)&&++o,(0<o||n!=this.s)&&(e[o++]=n);return e}function at(t){return 0==this.compareTo(t)}function ft(t){return this.compareTo(t)<0?this:t}function dt(t){return 0<this.compareTo(t)?this:t}function Pt(t,e,i){for(var n,o,r=Math.min(t.t,this.t),n=0;n<r;++n)i[n]=e(this[n],t[n]);if(t.t<this.t){for(o=t.s&this.DM,n=r;n<this.t;++n)i[n]=e(this[n],o);i.t=this.t}else{for(o=this.s&this.DM,n=r;n<t.t;++n)i[n]=e(o,t[n]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()}function mt(t,e){return t&e}function yt(t){var e=v();return this.bitwiseTo(t,mt,e),e}function ct(t,e){return t|e}function vt(t){var e=v();return this.bitwiseTo(t,ct,e),e}function Ct(t,e){return t^e}function It(t){var e=v();return this.bitwiseTo(t,Ct,e),e}function xt(t,e){return t&~e}function _t(t){var e=v();return this.bitwiseTo(t,xt,e),e}function Lt(){for(var t=v(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function Et(t){var e=v();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function Tt(t){var e=v();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function gt(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function Xt(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+gt(this[t]);return this.s<0?this.t*this.DB:-1}function Nt(t){for(var e=0;0!=t;)t&=t-1,++e;return e}function Ot(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=Nt(this[i]^e);return t}function Yt(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)}function St(t,e){var t=c.ONE.shiftLeft(t);return this.bitwiseTo(t,e,t),t}function At(t){return this.changeBit(t,ct)}function Bt(t){return this.changeBit(t,xt)}function Dt(t){return this.changeBit(t,Ct)}function bt(t,e){for(var i=0,n=0,o=Math.min(t.t,this.t);i<o;)n+=this[i]+t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n+=t[i],e[i++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=n<0?-1:0,0<n?e[i++]=n:n<-1&&(e[i++]=this.DV+n),e.t=i,e.clamp()}function Mt(t){var e=v();return this.addTo(t,e),e}function Rt(t){var e=v();return this.subTo(t,e),e}function wt(t){var e=v();return this.multiplyTo(t,e),e}function Ft(){var t=v();return this.squareTo(t),t}function Wt(t){var e=v();return this.divRemTo(t,e,null),e}function Zt(t){var e=v();return this.divRemTo(t,null,e),e}function qt(t){var e=v(),i=v();return this.divRemTo(t,e,i),new Array(e,i)}function zt(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function Ht(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function kt(){}function Ut(t){return t}function Jt(t,e,i){t.multiplyTo(e,i)}function jt(t,e){t.squareTo(e)}function Gt(t){return this.exp(t,new kt)}function Vt(t,e,i){var n=Math.min(this.t+t.t,e),o;for(i.s=0,i.t=n;0<n;)i[--n]=0;for(o=i.t-this.t;n<o;++n)i[n+this.t]=this.am(0,t[n],i,n,0,this.t);for(o=Math.min(t.t,e);n<o;++n)this.am(0,t[n],i,n,0,e-n);i.clamp()}function $t(t,e,i){var n=i.t=this.t+t.t- --e;for(i.s=0;0<=--n;)i[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)i[this.t+n-e]=this.am(e-n,t[n],i,0,0,this.t+n-e);i.clamp(),i.drShiftTo(1,i)}function Kt(t){this.r2=v(),this.q3=v(),c.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function Qt(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=v();return t.copyTo(e),this.reduce(e),e}function te(t){return t}function ee(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);0<=t.compareTo(this.m);)t.subTo(this.m,t)}function ie(t,e){t.squareTo(e),this.reduce(e)}function ne(t,e,i){t.multiplyTo(e,i),this.reduce(i)}function oe(t,e){var i=t.bitLength(),n,o=I(1),r;if(i<=0)return o;var n=i<18?1:i<48?3:i<144?4:i<768?5:6,r=new(i<8?F:e.isEven()?Kt:U)(e),s=new Array,l=3,p=n-1,u=(1<<n)-1;if(s[1]=r.convert(this),1<n){var h=v();for(r.sqrTo(s[1],h);l<=u;)s[l]=v(),r.mulTo(h,s[l-2],s[l]),l+=2}for(var a=t.t-1,f,d=!0,P=v(),m,i=N(t[a])-1;0<=a;){for(p<=i?f=t[a]>>i-p&u:(f=(t[a]&(1<<i+1)-1)<<p-i,0<a&&(f|=t[a-1]>>this.DB+i-p)),l=n;0==(1&f);)f>>=1,--l;if((i-=l)<0&&(i+=this.DB,--a),d)s[f].copyTo(o),d=!1;else{for(;1<l;)r.sqrTo(o,P),r.sqrTo(P,o),l-=2;0<l?r.sqrTo(o,P):(m=o,o=P,P=m),r.mulTo(P,s[f],o)}for(;0<=a&&0==(t[a]&1<<i);)r.sqrTo(o,P),m=o,o=P,P=m,--i<0&&(i=this.DB-1,--a)}return r.revert(o)}function re(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone(),n,e,i;e.compareTo(i)<0&&(n=e,e=i,i=n);var o=e.getLowestSetBit(),n=i.getLowestSetBit();if(n<0)return e;for(0<(n=o<n?o:n)&&(e.rShiftTo(n,e),i.rShiftTo(n,i));0<e.signum();)0<(o=e.getLowestSetBit())&&e.rShiftTo(o,e),0<(o=i.getLowestSetBit())&&i.rShiftTo(o,i),0<=e.compareTo(i)?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return 0<n&&i.lShiftTo(n,i),i}function se(t){if(t<=0)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(0<this.t)if(0==e)i=this[0]%t;else for(var n=this.t-1;0<=n;--n)i=(e*i+this[n])%t;return i}function le(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return c.ZERO;for(var i=t.clone(),n=this.clone(),o=I(1),r=I(0),s=I(0),l=I(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),e?(o.isEven()&&r.isEven()||(o.addTo(this,o),r.subTo(t,r)),o.rShiftTo(1,o)):r.isEven()||r.subTo(t,r),r.rShiftTo(1,r);for(;n.isEven();)n.rShiftTo(1,n),e?(s.isEven()&&l.isEven()||(s.addTo(this,s),l.subTo(t,l)),s.rShiftTo(1,s)):l.isEven()||l.subTo(t,l),l.rShiftTo(1,l);0<=i.compareTo(n)?(i.subTo(n,i),e&&o.subTo(s,o),r.subTo(l,r)):(n.subTo(i,n),e&&s.subTo(o,s),l.subTo(r,l))}return 0!=n.compareTo(c.ONE)?c.ZERO:0<=l.compareTo(t)?l.subtract(t):l.signum()<0?(l.addTo(t,l),l.signum()<0?l.add(t):l):l}F.prototype.convert=W,F.prototype.revert=Z,F.prototype.reduce=q,F.prototype.mulTo=z,F.prototype.sqrTo=H,U.prototype.convert=J,U.prototype.revert=j,U.prototype.reduce=G,U.prototype.mulTo=$,U.prototype.sqrTo=V,c.prototype.copyTo=y,c.prototype.fromInt=C,c.prototype.fromString=x,c.prototype.clamp=L,c.prototype.dlShiftTo=Y,c.prototype.drShiftTo=S,c.prototype.lShiftTo=A,c.prototype.rShiftTo=B,c.prototype.subTo=D,c.prototype.multiplyTo=b,c.prototype.squareTo=M,c.prototype.divRemTo=R,c.prototype.invDigit=k,c.prototype.isEven=K,c.prototype.exp=Q,c.prototype.toString=E,c.prototype.negate=T,c.prototype.abs=g,c.prototype.compareTo=X,c.prototype.bitLength=O,c.prototype.mod=w,c.prototype.modPowInt=tt,c.ZERO=I(0),c.ONE=I(1),kt.prototype.convert=Ut,kt.prototype.revert=Ut,kt.prototype.mulTo=Jt,kt.prototype.sqrTo=jt,Kt.prototype.convert=Qt,Kt.prototype.revert=te,Kt.prototype.reduce=ee,Kt.prototype.mulTo=ne,Kt.prototype.sqrTo=ie;var pe=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],ue=(1<<26)/pe[pe.length-1];function he(t){var e,i=this.abs();if(1==i.t&&i[0]<=pe[pe.length-1]){for(e=0;e<pe.length;++e)if(i[0]==pe[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<pe.length;){for(var n=pe[e],o=e+1;o<pe.length&&n<ue;)n*=pe[o++];for(n=i.modInt(n);e<o;)if(n%pe[e++]==0)return!1}return i.millerRabin(t)}function ae(t){var e=this.subtract(c.ONE),i=e.getLowestSetBit();if(i<=0)return!1;var n=e.shiftRight(i);pe.length<(t=t+1>>1)&&(t=pe.length);for(var o=v(),r=0;r<t;++r){o.fromInt(pe[Math.floor(Math.random()*pe.length)]);var s=o.modPow(n,this);if(0!=s.compareTo(c.ONE)&&0!=s.compareTo(e)){for(var l=1;l++<i&&0!=s.compareTo(e);)if(0==(s=s.modPowInt(2,this)).compareTo(c.ONE))return!1;if(0!=s.compareTo(e))return!1}}return!0}c.prototype.chunkSize=rt,c.prototype.toRadix=lt,c.prototype.fromRadix=pt,c.prototype.fromNumber=ut,c.prototype.bitwiseTo=Pt,c.prototype.changeBit=St,c.prototype.addTo=bt,c.prototype.dMultiply=zt,c.prototype.dAddOffset=Ht,c.prototype.multiplyLowerTo=Vt,c.prototype.multiplyUpperTo=$t,c.prototype.modInt=se,c.prototype.millerRabin=ae,c.prototype.clone=et,c.prototype.intValue=it,c.prototype.byteValue=nt,c.prototype.shortValue=ot,c.prototype.signum=st,c.prototype.toByteArray=ht,c.prototype.equals=at,c.prototype.min=ft,c.prototype.max=dt,c.prototype.and=yt,c.prototype.or=vt,c.prototype.xor=It,c.prototype.andNot=_t,c.prototype.not=Lt,c.prototype.shiftLeft=Et,c.prototype.shiftRight=Tt,c.prototype.getLowestSetBit=Xt,c.prototype.bitCount=Ot,c.prototype.testBit=Yt,c.prototype.setBit=At,c.prototype.clearBit=Bt,c.prototype.flipBit=Dt,c.prototype.add=Mt,c.prototype.subtract=Rt,c.prototype.multiply=wt,c.prototype.divide=Wt,c.prototype.remainder=Zt,c.prototype.divideAndRemainder=qt,c.prototype.modPow=oe,c.prototype.modInverse=le,c.prototype.pow=Gt,c.prototype.gcd=re,c.prototype.isProbablePrime=he,c.prototype.square=Ft;var fe=c;fe.prototype.IsNegative=function(){return-1==this.compareTo(fe.ZERO)},fe.op_Equality=function(t,e){return 0==t.compareTo(e)},fe.op_Inequality=function(t,e){return 0!=t.compareTo(e)},fe.op_GreaterThan=function(t,e){return 0<t.compareTo(e)},fe.op_LessThan=function(t,e){return t.compareTo(e)<0},fe.op_Addition=function(t,e){return new fe(t,void 0,void 0).add(new fe(e,void 0,void 0))},fe.op_Subtraction=function(t,e){return new fe(t,void 0,void 0).subtract(new fe(e,void 0,void 0))},fe.Int128Mul=function(t,e){return new fe(t,void 0,void 0).multiply(new fe(e,void 0,void 0))},fe.op_Division=function(t,e){return t.divide(e)},fe.prototype.ToDouble=function(){return parseFloat(this.toString())};var i=function(t,e){var i;if(void 0===Object.getOwnPropertyNames){for(i in e.prototype)void 0!==t.prototype[i]&&t.prototype[i]!==Object.prototype[i]||(t.prototype[i]=e.prototype[i]);for(i in e)void 0===t[i]&&(t[i]=e[i]);t.$baseCtor=e}else{for(var n=Object.getOwnPropertyNames(e.prototype),o=0;o<n.length;o++)void 0===Object.getOwnPropertyDescriptor(t.prototype,n[o])&&Object.defineProperty(t.prototype,n[o],Object.getOwnPropertyDescriptor(e.prototype,n[o]));for(i in e)void 0===t[i]&&(t[i]=e[i]);t.$baseCtor=e}};_.Path=function(){return[]},_.Path.prototype.push=Array.prototype.push,_.Paths=function(){return[]},_.Paths.prototype.push=Array.prototype.push,_.DoublePoint=function(){var t=arguments;this.X=0,this.Y=0,1===t.length?(this.X=t[0].X,this.Y=t[0].Y):2===t.length&&(this.X=t[0],this.Y=t[1])},_.DoublePoint0=function(){this.X=0,this.Y=0},_.DoublePoint0.prototype=_.DoublePoint.prototype,_.DoublePoint1=function(t){this.X=t.X,this.Y=t.Y},_.DoublePoint1.prototype=_.DoublePoint.prototype,_.DoublePoint2=function(t,e){this.X=t,this.Y=e},_.DoublePoint2.prototype=_.DoublePoint.prototype,_.PolyNode=function(){this.m_Parent=null,this.m_polygon=new _.Path,this.m_Index=0,this.m_jointype=0,this.m_endtype=0,this.m_Childs=[],this.IsOpen=!1},_.PolyNode.prototype.IsHoleNode=function(){for(var t=!0,e=this.m_Parent;null!==e;)t=!t,e=e.m_Parent;return t},_.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length},_.PolyNode.prototype.Contour=function(){return this.m_polygon},_.PolyNode.prototype.AddChild=function(t){var e=this.m_Childs.length;this.m_Childs.push(t),t.m_Parent=this,t.m_Index=e},_.PolyNode.prototype.GetNext=function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()},_.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index===this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]},_.PolyNode.prototype.Childs=function(){return this.m_Childs},_.PolyNode.prototype.Parent=function(){return this.m_Parent},_.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()},_.PolyTree=function(){this.m_AllPolys=[],_.PolyNode.call(this)},_.PolyTree.prototype.Clear=function(){for(var t=0,e=this.m_AllPolys.length;t<e;t++)this.m_AllPolys[t]=null;this.m_AllPolys.length=0,this.m_Childs.length=0},_.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null},_.PolyTree.prototype.Total=function(){var t=this.m_AllPolys.length;return 0<t&&this.m_Childs[0]!==this.m_AllPolys[0]&&t--,t},i(_.PolyTree,_.PolyNode),_.Math_Abs_Int64=_.Math_Abs_Int32=_.Math_Abs_Double=function(t){return Math.abs(t)},_.Math_Max_Int32_Int32=function(t,e){return Math.max(t,e)},n.msie||n.opera||n.safari?_.Cast_Int32=function(t){return 0|t}:_.Cast_Int32=function(t){return~~t},void 0===Number.toInteger&&(Number.toInteger=null),n.chrome?_.Cast_Int64=function(t){return t<-2147483648||2147483647<t?t<0?Math.ceil(t):Math.floor(t):~~t}:n.firefox&&"function"==typeof Number.toInteger?_.Cast_Int64=function(t){return Number.toInteger(t)}:n.msie7||n.msie8?_.Cast_Int64=function(t){return parseInt(t,10)}:n.msie?_.Cast_Int64=function(t){return t<-2147483648||2147483647<t?t<0?Math.ceil(t):Math.floor(t):0|t}:_.Cast_Int64=function(t){return t<0?Math.ceil(t):Math.floor(t)},_.Clear=function(t){t.length=0},_.PI=3.141592653589793,_.PI2=6.283185307179586,_.IntPoint=function(){var t=arguments,e=t.length,i,n,i,n;this.X=0,this.Y=0,_.use_xyz?(this.Z=0,3===e?(this.X=t[0],this.Y=t[1],this.Z=t[2]):2===e?(this.X=t[0],this.Y=t[1],this.Z=0):1===e?t[0]instanceof _.DoublePoint?(this.X=_.Clipper.Round((i=t[0]).X),this.Y=_.Clipper.Round(i.Y),this.Z=0):(void 0===(n=t[0]).Z&&(n.Z=0),this.X=n.X,this.Y=n.Y,this.Z=n.Z):(this.X=0,this.Y=0,this.Z=0)):2===e?(this.X=t[0],this.Y=t[1]):1===e?t[0]instanceof _.DoublePoint?(this.X=_.Clipper.Round((i=t[0]).X),this.Y=_.Clipper.Round(i.Y)):(this.X=(n=t[0]).X,this.Y=n.Y):(this.X=0,this.Y=0)},_.IntPoint.op_Equality=function(t,e){return t.X===e.X&&t.Y===e.Y},_.IntPoint.op_Inequality=function(t,e){return t.X!==e.X||t.Y!==e.Y},_.IntPoint0=function(){this.X=0,this.Y=0,_.use_xyz&&(this.Z=0)},_.IntPoint0.prototype=_.IntPoint.prototype,_.IntPoint1=function(t){this.X=t.X,this.Y=t.Y,_.use_xyz&&(void 0===t.Z?this.Z=0:this.Z=t.Z)},_.IntPoint1.prototype=_.IntPoint.prototype,_.IntPoint1dp=function(t){this.X=_.Clipper.Round(t.X),this.Y=_.Clipper.Round(t.Y),_.use_xyz&&(this.Z=0)},_.IntPoint1dp.prototype=_.IntPoint.prototype,_.IntPoint2=function(t,e,i){this.X=t,this.Y=e,_.use_xyz&&(this.Z=void 0===i?0:i)},_.IntPoint2.prototype=_.IntPoint.prototype,_.IntRect=function(){var t=arguments,e=t.length,t;4===e?(this.left=t[0],this.top=t[1],this.right=t[2],this.bottom=t[3]):1===e?(this.left=(t=t[0]).left,this.top=t.top,this.right=t.right,this.bottom=t.bottom):(this.left=0,this.top=0,this.right=0,this.bottom=0)},_.IntRect0=function(){this.left=0,this.top=0,this.right=0,this.bottom=0},_.IntRect0.prototype=_.IntRect.prototype,_.IntRect1=function(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom},_.IntRect1.prototype=_.IntRect.prototype,_.IntRect4=function(t,e,i,n){this.left=t,this.top=e,this.right=i,this.bottom=n},_.IntRect4.prototype=_.IntRect.prototype,_.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3},_.PolyType={ptSubject:0,ptClip:1},_.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3},_.JoinType={jtSquare:0,jtRound:1,jtMiter:2},_.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4},_.EdgeSide={esLeft:0,esRight:1},_.Direction={dRightToLeft:0,dLeftToRight:1},_.TEdge=function(){this.Bot=new _.IntPoint0,this.Curr=new _.IntPoint0,this.Top=new _.IntPoint0,this.Delta=new _.IntPoint0,this.Dx=0,this.PolyTyp=_.PolyType.ptSubject,this.Side=_.EdgeSide.esLeft,this.WindDelta=0,this.WindCnt=0,this.WindCnt2=0,this.OutIdx=0,this.Next=null,this.Prev=null,this.NextInLML=null,this.NextInAEL=null,this.PrevInAEL=null,this.NextInSEL=null,this.PrevInSEL=null},_.IntersectNode=function(){this.Edge1=null,this.Edge2=null,this.Pt=new _.IntPoint0},_.MyIntersectNodeSort=function(){},_.MyIntersectNodeSort.Compare=function(t,e){var t=e.Pt.Y-t.Pt.Y;return 0<t?1:t<0?-1:0},_.LocalMinima=function(){this.Y=0,this.LeftBound=null,this.RightBound=null,this.Next=null},_.Scanbeam=function(){this.Y=0,this.Next=null},_.Maxima=function(){this.X=0,this.Next=null,this.Prev=null},_.OutRec=function(){this.Idx=0,this.IsHole=!1,this.IsOpen=!1,this.FirstLeft=null,this.Pts=null,this.BottomPt=null,this.PolyNode=null},_.OutPt=function(){this.Idx=0,this.Pt=new _.IntPoint0,this.Next=null,this.Prev=null},_.Join=function(){this.OutPt1=null,this.OutPt2=null,this.OffPt=new _.IntPoint0},_.ClipperBase=function(){this.m_MinimaList=null,this.m_CurrentLM=null,this.m_edges=new Array,this.m_UseFullRange=!1,this.m_HasOpenPaths=!1,this.PreserveCollinear=!1,this.m_Scanbeam=null,this.m_PolyOuts=null,this.m_ActiveEdges=null},_.ClipperBase.horizontal=-9007199254740992,_.ClipperBase.Skip=-2,_.ClipperBase.Unassigned=-1,_.ClipperBase.tolerance=1e-20,_.ClipperBase.loRange=47453132,_.ClipperBase.hiRange=0xfffffffffffff,_.ClipperBase.near_zero=function(t){return t>-_.ClipperBase.tolerance&&t<_.ClipperBase.tolerance},_.ClipperBase.IsHorizontal=function(t){return 0===t.Delta.Y},_.ClipperBase.prototype.PointIsVertex=function(t,e){var i=e;do{if(_.IntPoint.op_Equality(i.Pt,t))return!0}while((i=i.Next)!==e);return!1},_.ClipperBase.prototype.PointOnLineSegment=function(t,e,i,n){return n?t.X===e.X&&t.Y===e.Y||t.X===i.X&&t.Y===i.Y||t.X>e.X==t.X<i.X&&t.Y>e.Y==t.Y<i.Y&&fe.op_Equality(fe.Int128Mul(t.X-e.X,i.Y-e.Y),fe.Int128Mul(i.X-e.X,t.Y-e.Y)):t.X===e.X&&t.Y===e.Y||t.X===i.X&&t.Y===i.Y||t.X>e.X==t.X<i.X&&t.Y>e.Y==t.Y<i.Y&&(t.X-e.X)*(i.Y-e.Y)==(i.X-e.X)*(t.Y-e.Y)},_.ClipperBase.prototype.PointOnPolygon=function(t,e,i){for(var n=e;;){if(this.PointOnLineSegment(t,n.Pt,n.Next.Pt,i))return!0;if((n=n.Next)===e)break}return!1},_.ClipperBase.prototype.SlopesEqual=_.ClipperBase.SlopesEqual=function(){var t=arguments,e=t.length,i,n,o,r,s,e,l;return 3===e?(i=t[0],n=t[1],(l=t[2])?fe.op_Equality(fe.Int128Mul(i.Delta.Y,n.Delta.X),fe.Int128Mul(i.Delta.X,n.Delta.Y)):_.Cast_Int64(i.Delta.Y*n.Delta.X)===_.Cast_Int64(i.Delta.X*n.Delta.Y)):4===e?(o=t[0],r=t[1],s=t[2],(l=t[3])?fe.op_Equality(fe.Int128Mul(o.Y-r.Y,r.X-s.X),fe.Int128Mul(o.X-r.X,r.Y-s.Y)):_.Cast_Int64((o.Y-r.Y)*(r.X-s.X))-_.Cast_Int64((o.X-r.X)*(r.Y-s.Y))==0):(o=t[0],r=t[1],s=t[2],e=t[3],(l=t[4])?fe.op_Equality(fe.Int128Mul(o.Y-r.Y,s.X-e.X),fe.Int128Mul(o.X-r.X,s.Y-e.Y)):_.Cast_Int64((o.Y-r.Y)*(s.X-e.X))-_.Cast_Int64((o.X-r.X)*(s.Y-e.Y))==0)},_.ClipperBase.SlopesEqual3=function(t,e,i){return i?fe.op_Equality(fe.Int128Mul(t.Delta.Y,e.Delta.X),fe.Int128Mul(t.Delta.X,e.Delta.Y)):_.Cast_Int64(t.Delta.Y*e.Delta.X)===_.Cast_Int64(t.Delta.X*e.Delta.Y)},_.ClipperBase.SlopesEqual4=function(t,e,i,n){return n?fe.op_Equality(fe.Int128Mul(t.Y-e.Y,e.X-i.X),fe.Int128Mul(t.X-e.X,e.Y-i.Y)):_.Cast_Int64((t.Y-e.Y)*(e.X-i.X))-_.Cast_Int64((t.X-e.X)*(e.Y-i.Y))==0},_.ClipperBase.SlopesEqual5=function(t,e,i,n,o){return o?fe.op_Equality(fe.Int128Mul(t.Y-e.Y,i.X-n.X),fe.Int128Mul(t.X-e.X,i.Y-n.Y)):_.Cast_Int64((t.Y-e.Y)*(i.X-n.X))-_.Cast_Int64((t.X-e.X)*(i.Y-n.Y))==0},_.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var t=0,e=this.m_edges.length;t<e;++t){for(var i=0,n=this.m_edges[t].length;i<n;++i)this.m_edges[t][i]=null;_.Clear(this.m_edges[t])}_.Clear(this.m_edges),this.m_UseFullRange=!1,this.m_HasOpenPaths=!1},_.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var t=this.m_MinimaList.Next;this.m_MinimaList=null,this.m_MinimaList=t}this.m_CurrentLM=null},_.ClipperBase.prototype.RangeTest=function(t,e){e.Value?(t.X>_.ClipperBase.hiRange||t.Y>_.ClipperBase.hiRange||-t.X>_.ClipperBase.hiRange||-t.Y>_.ClipperBase.hiRange)&&_.Error("Coordinate outside allowed range in RangeTest()."):(t.X>_.ClipperBase.loRange||t.Y>_.ClipperBase.loRange||-t.X>_.ClipperBase.loRange||-t.Y>_.ClipperBase.loRange)&&(e.Value=!0,this.RangeTest(t,e))},_.ClipperBase.prototype.InitEdge=function(t,e,i,n){t.Next=e,t.Prev=i,t.Curr.X=n.X,t.Curr.Y=n.Y,_.use_xyz&&(t.Curr.Z=n.Z),t.OutIdx=-1},_.ClipperBase.prototype.InitEdge2=function(t,e){t.Curr.Y>=t.Next.Curr.Y?(t.Bot.X=t.Curr.X,t.Bot.Y=t.Curr.Y,_.use_xyz&&(t.Bot.Z=t.Curr.Z),t.Top.X=t.Next.Curr.X,t.Top.Y=t.Next.Curr.Y,_.use_xyz&&(t.Top.Z=t.Next.Curr.Z)):(t.Top.X=t.Curr.X,t.Top.Y=t.Curr.Y,_.use_xyz&&(t.Top.Z=t.Curr.Z),t.Bot.X=t.Next.Curr.X,t.Bot.Y=t.Next.Curr.Y,_.use_xyz&&(t.Bot.Z=t.Next.Curr.Z)),this.SetDx(t),t.PolyTyp=e},_.ClipperBase.prototype.FindNextLocMin=function(t){for(var e;;){for(;_.IntPoint.op_Inequality(t.Bot,t.Prev.Bot)||_.IntPoint.op_Equality(t.Curr,t.Top);)t=t.Next;if(t.Dx!==_.ClipperBase.horizontal&&t.Prev.Dx!==_.ClipperBase.horizontal)break;for(;t.Prev.Dx===_.ClipperBase.horizontal;)t=t.Prev;for(e=t;t.Dx===_.ClipperBase.horizontal;)t=t.Next;if(t.Top.Y!==t.Prev.Bot.Y){e.Prev.Bot.X<t.Bot.X&&(t=e);break}}return t},_.ClipperBase.prototype.ProcessBound=function(t,e){var i,n=t,o,r;if(n.OutIdx===_.ClipperBase.Skip){if(t=n,e){for(;t.Top.Y===t.Next.Bot.Y;)t=t.Next;for(;t!==n&&t.Dx===_.ClipperBase.horizontal;)t=t.Prev}else{for(;t.Top.Y===t.Prev.Bot.Y;)t=t.Prev;for(;t!==n&&t.Dx===_.ClipperBase.horizontal;)t=t.Next}return t===n?n=e?t.Next:t.Prev:(t=e?n.Next:n.Prev,(r=new _.LocalMinima).Next=null,r.Y=t.Bot.Y,r.LeftBound=null,(r.RightBound=t).WindDelta=0,n=this.ProcessBound(t,e),this.InsertLocalMinima(r)),n}if(t.Dx===_.ClipperBase.horizontal&&((i=e?t.Prev:t.Next).Dx===_.ClipperBase.horizontal?i.Bot.X!==t.Bot.X&&i.Top.X!==t.Bot.X&&this.ReverseHorizontal(t):i.Bot.X!==t.Bot.X&&this.ReverseHorizontal(t)),i=t,e){for(;n.Top.Y===n.Next.Bot.Y&&n.Next.OutIdx!==_.ClipperBase.Skip;)n=n.Next;if(n.Dx===_.ClipperBase.horizontal&&n.Next.OutIdx!==_.ClipperBase.Skip){for(o=n;o.Prev.Dx===_.ClipperBase.horizontal;)o=o.Prev;o.Prev.Top.X>n.Next.Top.X&&(n=o.Prev)}for(;t!==n;)t.NextInLML=t.Next,t.Dx===_.ClipperBase.horizontal&&t!==i&&t.Bot.X!==t.Prev.Top.X&&this.ReverseHorizontal(t),t=t.Next;t.Dx===_.ClipperBase.horizontal&&t!==i&&t.Bot.X!==t.Prev.Top.X&&this.ReverseHorizontal(t),n=n.Next}else{for(;n.Top.Y===n.Prev.Bot.Y&&n.Prev.OutIdx!==_.ClipperBase.Skip;)n=n.Prev;if(n.Dx===_.ClipperBase.horizontal&&n.Prev.OutIdx!==_.ClipperBase.Skip){for(o=n;o.Next.Dx===_.ClipperBase.horizontal;)o=o.Next;(o.Next.Top.X===n.Prev.Top.X||o.Next.Top.X>n.Prev.Top.X)&&(n=o.Next)}for(;t!==n;)t.NextInLML=t.Prev,t.Dx===_.ClipperBase.horizontal&&t!==i&&t.Bot.X!==t.Next.Top.X&&this.ReverseHorizontal(t),t=t.Prev;t.Dx===_.ClipperBase.horizontal&&t!==i&&t.Bot.X!==t.Next.Top.X&&this.ReverseHorizontal(t),n=n.Prev}return n},_.ClipperBase.prototype.AddPath=function(t,e,i){_.use_lines?i||e!==_.PolyType.ptClip||_.Error("AddPath: Open paths must be subject."):i||_.Error("AddPath: Open paths have been disabled.");var n=t.length-1;if(i)for(;0<n&&_.IntPoint.op_Equality(t[n],t[0]);)--n;for(;0<n&&_.IntPoint.op_Equality(t[n],t[n-1]);)--n;if(i&&n<2||!i&&n<1)return!1;for(var o=new Array,r=0;r<=n;r++)o.push(new _.TEdge);var s=!0;o[1].Curr.X=t[1].X,o[1].Curr.Y=t[1].Y,_.use_xyz&&(o[1].Curr.Z=t[1].Z);var l={Value:this.m_UseFullRange};this.RangeTest(t[0],l),this.m_UseFullRange=l.Value,l.Value=this.m_UseFullRange,this.RangeTest(t[n],l),this.m_UseFullRange=l.Value,this.InitEdge(o[0],o[1],o[n],t[0]),this.InitEdge(o[n],o[0],o[n-1],t[n]);for(var r=n-1;1<=r;--r)l.Value=this.m_UseFullRange,this.RangeTest(t[r],l),this.m_UseFullRange=l.Value,this.InitEdge(o[r],o[r+1],o[r-1],t[r]);for(var p=o[0],u=p,h=p,a,f;;)if(u.Curr!==u.Next.Curr||!i&&u.Next===p){if(u.Prev===u.Next)break;if(!i||!_.ClipperBase.SlopesEqual4(u.Prev.Curr,u.Curr,u.Next.Curr,this.m_UseFullRange)||this.PreserveCollinear&&this.Pt2IsBetweenPt1AndPt3(u.Prev.Curr,u.Curr,u.Next.Curr)){if((u=u.Next)===h||!i&&u.Next===p)break}else u===p&&(p=u.Next),h=u=(u=this.RemoveEdge(u)).Prev}else{if(u===u.Next)break;u===p&&(p=u.Next),h=u=this.RemoveEdge(u)}if(!i&&u===u.Next||i&&u.Prev===u.Next)return!1;for(i||(this.m_HasOpenPaths=!0,p.Prev.OutIdx=_.ClipperBase.Skip),u=p;this.InitEdge2(u,e),u=u.Next,s&&u.Curr.Y!==p.Curr.Y&&(s=!1),u!==p;);if(s){if(i)return!1;for(u.Prev.OutIdx=_.ClipperBase.Skip,(a=new _.LocalMinima).Next=null,a.Y=u.Bot.Y,a.LeftBound=null,a.RightBound=u,a.RightBound.Side=_.EdgeSide.esRight,a.RightBound.WindDelta=0;u.Bot.X!==u.Prev.Top.X&&this.ReverseHorizontal(u),u.Next.OutIdx!==_.ClipperBase.Skip;)u.NextInLML=u.Next,u=u.Next;return this.InsertLocalMinima(a),this.m_edges.push(o),!0}this.m_edges.push(o);var d=null,a;for(_.IntPoint.op_Equality(u.Prev.Bot,u.Prev.Top)&&(u=u.Next);(u=this.FindNextLocMin(u))!==d;){null===d&&(d=u),(a=new _.LocalMinima).Next=null,a.Y=u.Bot.Y,f=u.Dx<u.Prev.Dx?(a.LeftBound=u.Prev,a.RightBound=u,!1):(a.LeftBound=u,a.RightBound=u.Prev,!0),a.LeftBound.Side=_.EdgeSide.esLeft,a.RightBound.Side=_.EdgeSide.esRight,i?a.LeftBound.Next===a.RightBound?a.LeftBound.WindDelta=-1:a.LeftBound.WindDelta=1:a.LeftBound.WindDelta=0,a.RightBound.WindDelta=-a.LeftBound.WindDelta,(u=this.ProcessBound(a.LeftBound,f)).OutIdx===_.ClipperBase.Skip&&(u=this.ProcessBound(u,f));var P=this.ProcessBound(a.RightBound,!f);P.OutIdx===_.ClipperBase.Skip&&(P=this.ProcessBound(P,!f)),a.LeftBound.OutIdx===_.ClipperBase.Skip?a.LeftBound=null:a.RightBound.OutIdx===_.ClipperBase.Skip&&(a.RightBound=null),this.InsertLocalMinima(a),f||(u=P)}return!0},_.ClipperBase.prototype.AddPaths=function(t,e,i){for(var n=!1,o=0,r=t.length;o<r;++o)this.AddPath(t[o],e,i)&&(n=!0);return n},_.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(t,e,i){return!(_.IntPoint.op_Equality(t,i)||_.IntPoint.op_Equality(t,e)||_.IntPoint.op_Equality(i,e))&&(t.X!==i.X?e.X>t.X==e.X<i.X:e.Y>t.Y==e.Y<i.Y)},_.ClipperBase.prototype.RemoveEdge=function(t){t.Prev.Next=t.Next,t.Next.Prev=t.Prev;var e=t.Next;return t.Prev=null,e},_.ClipperBase.prototype.SetDx=function(t){t.Delta.X=t.Top.X-t.Bot.X,t.Delta.Y=t.Top.Y-t.Bot.Y,0===t.Delta.Y?t.Dx=_.ClipperBase.horizontal:t.Dx=t.Delta.X/t.Delta.Y},_.ClipperBase.prototype.InsertLocalMinima=function(t){if(null===this.m_MinimaList)this.m_MinimaList=t;else if(t.Y>=this.m_MinimaList.Y)t.Next=this.m_MinimaList,this.m_MinimaList=t;else{for(var e=this.m_MinimaList;null!==e.Next&&t.Y<e.Next.Y;)e=e.Next;t.Next=e.Next,e.Next=t}},_.ClipperBase.prototype.PopLocalMinima=function(t,e){return e.v=this.m_CurrentLM,null!==this.m_CurrentLM&&this.m_CurrentLM.Y===t&&(this.m_CurrentLM=this.m_CurrentLM.Next,!0)},_.ClipperBase.prototype.ReverseHorizontal=function(t){var e=t.Top.X;t.Top.X=t.Bot.X,t.Bot.X=e,_.use_xyz&&(e=t.Top.Z,t.Top.Z=t.Bot.Z,t.Bot.Z=e)},_.ClipperBase.prototype.Reset=function(){if(this.m_CurrentLM=this.m_MinimaList,null!==this.m_CurrentLM){this.m_Scanbeam=null;for(var t=this.m_MinimaList;null!==t;){this.InsertScanbeam(t.Y);var e=t.LeftBound;null!==e&&(e.Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,_.use_xyz&&(e.Curr.Z=e.Bot.Z),e.OutIdx=_.ClipperBase.Unassigned),null!==(e=t.RightBound)&&(e.Curr.X=e.Bot.X,e.Curr.Y=e.Bot.Y,_.use_xyz&&(e.Curr.Z=e.Bot.Z),e.OutIdx=_.ClipperBase.Unassigned),t=t.Next}this.m_ActiveEdges=null}},_.ClipperBase.prototype.InsertScanbeam=function(t){if(null===this.m_Scanbeam)this.m_Scanbeam=new _.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=t;else if(t>this.m_Scanbeam.Y){var e=new _.Scanbeam;e.Y=t,e.Next=this.m_Scanbeam,this.m_Scanbeam=e}else{for(var i=this.m_Scanbeam,e;null!==i.Next&&t<=i.Next.Y;)i=i.Next;t!==i.Y&&((e=new _.Scanbeam).Y=t,e.Next=i.Next,i.Next=e)}},_.ClipperBase.prototype.PopScanbeam=function(t){return null===this.m_Scanbeam?(t.v=0,!1):(t.v=this.m_Scanbeam.Y,this.m_Scanbeam=this.m_Scanbeam.Next,!0)},_.ClipperBase.prototype.LocalMinimaPending=function(){return null!==this.m_CurrentLM},_.ClipperBase.prototype.CreateOutRec=function(){var t=new _.OutRec;return t.Idx=_.ClipperBase.Unassigned,t.IsHole=!1,t.IsOpen=!1,t.FirstLeft=null,t.Pts=null,t.BottomPt=null,t.PolyNode=null,this.m_PolyOuts.push(t),t.Idx=this.m_PolyOuts.length-1,t},_.ClipperBase.prototype.DisposeOutRec=function(t){var e;(e=this.m_PolyOuts[t]).Pts=null,this.m_PolyOuts[t]=e=null},_.ClipperBase.prototype.UpdateEdgeIntoAEL=function(t){null===t.NextInLML&&_.Error("UpdateEdgeIntoAEL: invalid call");var e=t.PrevInAEL,i=t.NextInAEL;return t.NextInLML.OutIdx=t.OutIdx,null!==e?e.NextInAEL=t.NextInLML:this.m_ActiveEdges=t.NextInLML,null!==i&&(i.PrevInAEL=t.NextInLML),t.NextInLML.Side=t.Side,t.NextInLML.WindDelta=t.WindDelta,t.NextInLML.WindCnt=t.WindCnt,t.NextInLML.WindCnt2=t.WindCnt2,(t=t.NextInLML).Curr.X=t.Bot.X,t.Curr.Y=t.Bot.Y,t.PrevInAEL=e,t.NextInAEL=i,_.ClipperBase.IsHorizontal(t)||this.InsertScanbeam(t.Top.Y),t},_.ClipperBase.prototype.SwapPositionsInAEL=function(t,e){var i,n,o,r,r,o;t.NextInAEL!==t.PrevInAEL&&e.NextInAEL!==e.PrevInAEL&&(t.NextInAEL===e?(null!==(i=e.NextInAEL)&&(i.PrevInAEL=t),null!==(n=t.PrevInAEL)&&(n.NextInAEL=e),e.PrevInAEL=n,(e.NextInAEL=t).PrevInAEL=e,t.NextInAEL=i):e.NextInAEL===t?(null!==(o=t.NextInAEL)&&(o.PrevInAEL=e),null!==(r=e.PrevInAEL)&&(r.NextInAEL=t),t.PrevInAEL=r,(t.NextInAEL=e).PrevInAEL=t,e.NextInAEL=o):(r=t.NextInAEL,o=t.PrevInAEL,t.NextInAEL=e.NextInAEL,null!==t.NextInAEL&&(t.NextInAEL.PrevInAEL=t),t.PrevInAEL=e.PrevInAEL,null!==t.PrevInAEL&&(t.PrevInAEL.NextInAEL=t),e.NextInAEL=r,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=e),e.PrevInAEL=o,null!==e.PrevInAEL&&(e.PrevInAEL.NextInAEL=e)),null===t.PrevInAEL?this.m_ActiveEdges=t:null===e.PrevInAEL&&(this.m_ActiveEdges=e))},_.ClipperBase.prototype.DeleteFromAEL=function(t){var e=t.PrevInAEL,i=t.NextInAEL;null===e&&null===i&&t!==this.m_ActiveEdges||(null!==e?e.NextInAEL=i:this.m_ActiveEdges=i,null!==i&&(i.PrevInAEL=e),t.NextInAEL=null,t.PrevInAEL=null)},_.Clipper=function(t){void 0===t&&(t=0),this.m_PolyOuts=null,this.m_ClipType=_.ClipType.ctIntersection,this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=null,this.m_IntersectNodeComparer=null,this.m_ExecuteLocked=!1,this.m_ClipFillType=_.PolyFillType.pftEvenOdd,this.m_SubjFillType=_.PolyFillType.pftEvenOdd,this.m_Joins=null,this.m_GhostJoins=null,this.m_UsingPolyTree=!1,this.ReverseSolution=!1,this.StrictlySimple=!1,_.ClipperBase.call(this),this.m_Scanbeam=null,this.m_Maxima=null,this.m_ActiveEdges=null,this.m_SortedEdges=null,this.m_IntersectList=new Array,this.m_IntersectNodeComparer=_.MyIntersectNodeSort.Compare,this.m_ExecuteLocked=!1,this.m_UsingPolyTree=!1,this.m_PolyOuts=new Array,this.m_Joins=new Array,this.m_GhostJoins=new Array,this.ReverseSolution=0!=(1&t),this.StrictlySimple=0!=(2&t),this.PreserveCollinear=0!=(4&t),_.use_xyz&&(this.ZFillFunction=null)},_.Clipper.ioReverseSolution=1,_.Clipper.ioStrictlySimple=2,_.Clipper.ioPreserveCollinear=4,_.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),_.ClipperBase.prototype.Clear.call(this))},_.Clipper.prototype.InsertMaxima=function(t){var e=new _.Maxima;if(e.X=t,null===this.m_Maxima)this.m_Maxima=e,this.m_Maxima.Next=null,this.m_Maxima.Prev=null;else if(t<this.m_Maxima.X)e.Next=this.m_Maxima,e.Prev=null,this.m_Maxima=e;else{for(var i=this.m_Maxima;null!==i.Next&&t>=i.Next.X;)i=i.Next;t!==i.X&&(e.Next=i.Next,null!==(e.Prev=i).Next&&(i.Next.Prev=e),i.Next=e)}},_.Clipper.prototype.Execute=function(){var t=arguments,e=t.length,i=t[1]instanceof _.PolyTree;if(4===e&&!i){var n=t[0],o=t[1],r=t[2],s=t[3],l;if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&_.Error("Error: PolyTree struct is needed for open path clipping."),this.m_ExecuteLocked=!0,_.Clear(o),this.m_SubjFillType=r,this.m_ClipFillType=s,this.m_ClipType=n,this.m_UsingPolyTree=!1;try{(l=this.ExecuteInternal())&&this.BuildResult(o)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return l}if(4===e&&i){var n=t[0],p=t[1],r=t[2],s=t[3],l;if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0,this.m_SubjFillType=r,this.m_ClipFillType=s,this.m_ClipType=n,this.m_UsingPolyTree=!0;try{(l=this.ExecuteInternal())&&this.BuildResult2(p)}finally{this.DisposeAllPolyPts(),this.m_ExecuteLocked=!1}return l}if(2===e&&!i){var n=t[0],o=t[1];return this.Execute(n,o,_.PolyFillType.pftEvenOdd,_.PolyFillType.pftEvenOdd)}if(2===e&&i){var n=t[0],p=t[1];return this.Execute(n,p,_.PolyFillType.pftEvenOdd,_.PolyFillType.pftEvenOdd)}},_.Clipper.prototype.FixHoleLinkage=function(t){if(null!==t.FirstLeft&&(t.IsHole===t.FirstLeft.IsHole||null===t.FirstLeft.Pts)){for(var e=t.FirstLeft;null!==e&&(e.IsHole===t.IsHole||null===e.Pts);)e=e.FirstLeft;t.FirstLeft=e}},_.Clipper.prototype.ExecuteInternal=function(){try{this.Reset(),this.m_SortedEdges=null,this.m_Maxima=null;var t={},e={},i,n,o;if(!this.PopScanbeam(t))return!1;for(this.InsertLocalMinimaIntoAEL(t.v);this.PopScanbeam(e)||this.LocalMinimaPending();){if(this.ProcessHorizontals(),this.m_GhostJoins.length=0,!this.ProcessIntersections(e.v))return!1;this.ProcessEdgesAtTopOfScanbeam(e.v),t.v=e.v,this.InsertLocalMinimaIntoAEL(t.v)}for(n=0,o=this.m_PolyOuts.length;n<o;n++)null===(i=this.m_PolyOuts[n]).Pts||i.IsOpen||(i.IsHole^this.ReverseSolution)==0<this.Area$1(i)&&this.ReversePolyPtLinks(i.Pts);for(this.JoinCommonEdges(),n=0,o=this.m_PolyOuts.length;n<o;n++)null!==(i=this.m_PolyOuts[n]).Pts&&(i.IsOpen?this.FixupOutPolyline(i):this.FixupOutPolygon(i));return this.StrictlySimple&&this.DoSimplePolygons(),!0}finally{this.m_Joins.length=0,this.m_GhostJoins.length=0}},_.Clipper.prototype.DisposeAllPolyPts=function(){for(var t=0,e=this.m_PolyOuts.length;t<e;++t)this.DisposeOutRec(t);_.Clear(this.m_PolyOuts)},_.Clipper.prototype.AddJoin=function(t,e,i){var n=new _.Join;n.OutPt1=t,n.OutPt2=e,n.OffPt.X=i.X,n.OffPt.Y=i.Y,_.use_xyz&&(n.OffPt.Z=i.Z),this.m_Joins.push(n)},_.Clipper.prototype.AddGhostJoin=function(t,e){var i=new _.Join;i.OutPt1=t,i.OffPt.X=e.X,i.OffPt.Y=e.Y,_.use_xyz&&(i.OffPt.Z=e.Z),this.m_GhostJoins.push(i)},_.Clipper.prototype.SetZ=function(t,e,i){null!==this.ZFillFunction&&0===t.Z&&null!==this.ZFillFunction&&(_.IntPoint.op_Equality(t,e.Bot)?t.Z=e.Bot.Z:_.IntPoint.op_Equality(t,e.Top)?t.Z=e.Top.Z:_.IntPoint.op_Equality(t,i.Bot)?t.Z=i.Bot.Z:_.IntPoint.op_Equality(t,i.Top)?t.Z=i.Top.Z:this.ZFillFunction(e.Bot,e.Top,i.Bot,i.Top,t))},_.Clipper.prototype.InsertLocalMinimaIntoAEL=function(t){for(var e={},i,n;this.PopLocalMinima(t,e);){var i=e.v.LeftBound,n=e.v.RightBound,o=null,r,r;if(null===i?(this.InsertEdgeIntoAEL(n,null),this.SetWindingCount(n),this.IsContributing(n)&&(o=this.AddOutPt(n,n.Bot))):(null===n?(this.InsertEdgeIntoAEL(i,null),this.SetWindingCount(i),this.IsContributing(i)&&(o=this.AddOutPt(i,i.Bot))):(this.InsertEdgeIntoAEL(i,null),this.InsertEdgeIntoAEL(n,i),this.SetWindingCount(i),n.WindCnt=i.WindCnt,n.WindCnt2=i.WindCnt2,this.IsContributing(i)&&(o=this.AddLocalMinPoly(i,n,i.Bot))),this.InsertScanbeam(i.Top.Y)),null!==n&&(_.ClipperBase.IsHorizontal(n)?(null!==n.NextInLML&&this.InsertScanbeam(n.NextInLML.Top.Y),this.AddEdgeToSEL(n)):this.InsertScanbeam(n.Top.Y)),null!==i&&null!==n){if(null!==o&&_.ClipperBase.IsHorizontal(n)&&0<this.m_GhostJoins.length&&0!==n.WindDelta)for(var s=0,l=this.m_GhostJoins.length;s<l;s++){var p=this.m_GhostJoins[s];this.HorzSegmentsOverlap(p.OutPt1.Pt.X,p.OffPt.X,n.Bot.X,n.Top.X)&&this.AddJoin(p.OutPt1,o,p.OffPt)}if(0<=i.OutIdx&&null!==i.PrevInAEL&&i.PrevInAEL.Curr.X===i.Bot.X&&0<=i.PrevInAEL.OutIdx&&_.ClipperBase.SlopesEqual5(i.PrevInAEL.Curr,i.PrevInAEL.Top,i.Curr,i.Top,this.m_UseFullRange)&&0!==i.WindDelta&&0!==i.PrevInAEL.WindDelta&&(r=this.AddOutPt(i.PrevInAEL,i.Bot),this.AddJoin(o,r,i.Top)),i.NextInAEL!==n){0<=n.OutIdx&&0<=n.PrevInAEL.OutIdx&&_.ClipperBase.SlopesEqual5(n.PrevInAEL.Curr,n.PrevInAEL.Top,n.Curr,n.Top,this.m_UseFullRange)&&0!==n.WindDelta&&0!==n.PrevInAEL.WindDelta&&(r=this.AddOutPt(n.PrevInAEL,n.Bot),this.AddJoin(o,r,n.Top));var u=i.NextInAEL;if(null!==u)for(;u!==n;)this.IntersectEdges(n,u,i.Curr),u=u.NextInAEL}}}},_.Clipper.prototype.InsertEdgeIntoAEL=function(t,e){if(null===this.m_ActiveEdges)t.PrevInAEL=null,t.NextInAEL=null,this.m_ActiveEdges=t;else if(null===e&&this.E2InsertsBeforeE1(this.m_ActiveEdges,t))t.PrevInAEL=null,t.NextInAEL=this.m_ActiveEdges,this.m_ActiveEdges.PrevInAEL=t,this.m_ActiveEdges=t;else{for(null===e&&(e=this.m_ActiveEdges);null!==e.NextInAEL&&!this.E2InsertsBeforeE1(e.NextInAEL,t);)e=e.NextInAEL;t.NextInAEL=e.NextInAEL,null!==e.NextInAEL&&(e.NextInAEL.PrevInAEL=t),(t.PrevInAEL=e).NextInAEL=t}},_.Clipper.prototype.E2InsertsBeforeE1=function(t,e){return e.Curr.X===t.Curr.X?e.Top.Y>t.Top.Y?e.Top.X<_.Clipper.TopX(t,e.Top.Y):t.Top.X>_.Clipper.TopX(e,t.Top.Y):e.Curr.X<t.Curr.X},_.Clipper.prototype.IsEvenOddFillType=function(t){return t.PolyTyp===_.PolyType.ptSubject?this.m_SubjFillType===_.PolyFillType.pftEvenOdd:this.m_ClipFillType===_.PolyFillType.pftEvenOdd},_.Clipper.prototype.IsEvenOddAltFillType=function(t){return t.PolyTyp===_.PolyType.ptSubject?this.m_ClipFillType===_.PolyFillType.pftEvenOdd:this.m_SubjFillType===_.PolyFillType.pftEvenOdd},_.Clipper.prototype.IsContributing=function(t){var e,i,i=t.PolyTyp===_.PolyType.ptSubject?(e=this.m_SubjFillType,this.m_ClipFillType):(e=this.m_ClipFillType,this.m_SubjFillType);switch(e){case _.PolyFillType.pftEvenOdd:if(0===t.WindDelta&&1!==t.WindCnt)return!1;break;case _.PolyFillType.pftNonZero:if(1!==Math.abs(t.WindCnt))return!1;break;case _.PolyFillType.pftPositive:if(1!==t.WindCnt)return!1;break;default:if(-1!==t.WindCnt)return!1}switch(this.m_ClipType){case _.ClipType.ctIntersection:switch(i){case _.PolyFillType.pftEvenOdd:case _.PolyFillType.pftNonZero:return 0!==t.WindCnt2;case _.PolyFillType.pftPositive:return 0<t.WindCnt2;default:return t.WindCnt2<0}case _.ClipType.ctUnion:switch(i){case _.PolyFillType.pftEvenOdd:case _.PolyFillType.pftNonZero:return 0===t.WindCnt2;case _.PolyFillType.pftPositive:return t.WindCnt2<=0;default:return 0<=t.WindCnt2}case _.ClipType.ctDifference:if(t.PolyTyp===_.PolyType.ptSubject)switch(i){case _.PolyFillType.pftEvenOdd:case _.PolyFillType.pftNonZero:return 0===t.WindCnt2;case _.PolyFillType.pftPositive:return t.WindCnt2<=0;default:return 0<=t.WindCnt2}else switch(i){case _.PolyFillType.pftEvenOdd:case _.PolyFillType.pftNonZero:return 0!==t.WindCnt2;case _.PolyFillType.pftPositive:return 0<t.WindCnt2;default:return t.WindCnt2<0}case _.ClipType.ctXor:if(0!==t.WindDelta)return!0;switch(i){case _.PolyFillType.pftEvenOdd:case _.PolyFillType.pftNonZero:return 0===t.WindCnt2;case _.PolyFillType.pftPositive:return t.WindCnt2<=0;default:return 0<=t.WindCnt2}}return!0},_.Clipper.prototype.SetWindingCount=function(t){for(var e=t.PrevInAEL;null!==e&&(e.PolyTyp!==t.PolyTyp||0===e.WindDelta);)e=e.PrevInAEL;if(null===e){var i=t.PolyTyp===_.PolyType.ptSubject?this.m_SubjFillType:this.m_ClipFillType;0===t.WindDelta?t.WindCnt=i===_.PolyFillType.pftNegative?-1:1:t.WindCnt=t.WindDelta,t.WindCnt2=0,e=this.m_ActiveEdges}else if(0===t.WindDelta&&this.m_ClipType!==_.ClipType.ctUnion)t.WindCnt=1,t.WindCnt2=e.WindCnt2,e=e.NextInAEL;else if(this.IsEvenOddFillType(t)){if(0===t.WindDelta){for(var n=!0,o=e.PrevInAEL;null!==o;)o.PolyTyp===e.PolyTyp&&0!==o.WindDelta&&(n=!n),o=o.PrevInAEL;t.WindCnt=n?0:1}else t.WindCnt=t.WindDelta;t.WindCnt2=e.WindCnt2,e=e.NextInAEL}else e.WindCnt*e.WindDelta<0?1<Math.abs(e.WindCnt)?e.WindDelta*t.WindDelta<0?t.WindCnt=e.WindCnt:t.WindCnt=e.WindCnt+t.WindDelta:t.WindCnt=0===t.WindDelta?1:t.WindDelta:0===t.WindDelta?t.WindCnt=e.WindCnt<0?e.WindCnt-1:e.WindCnt+1:e.WindDelta*t.WindDelta<0?t.WindCnt=e.WindCnt:t.WindCnt=e.WindCnt+t.WindDelta,t.WindCnt2=e.WindCnt2,e=e.NextInAEL;if(this.IsEvenOddAltFillType(t))for(;e!==t;)0!==e.WindDelta&&(t.WindCnt2=0===t.WindCnt2?1:0),e=e.NextInAEL;else for(;e!==t;)t.WindCnt2+=e.WindDelta,e=e.NextInAEL},_.Clipper.prototype.AddEdgeToSEL=function(t){null===this.m_SortedEdges?((this.m_SortedEdges=t).PrevInSEL=null,t.NextInSEL=null):(t.NextInSEL=this.m_SortedEdges,t.PrevInSEL=null,this.m_SortedEdges.PrevInSEL=t,this.m_SortedEdges=t)},_.Clipper.prototype.PopEdgeFromSEL=function(t){if(t.v=this.m_SortedEdges,null===t.v)return!1;var e=t.v;return this.m_SortedEdges=t.v.NextInSEL,null!==this.m_SortedEdges&&(this.m_SortedEdges.PrevInSEL=null),e.NextInSEL=null,!(e.PrevInSEL=null)},_.Clipper.prototype.CopyAELToSEL=function(){var t=this.m_ActiveEdges;for(this.m_SortedEdges=t;null!==t;)t.PrevInSEL=t.PrevInAEL,t.NextInSEL=t.NextInAEL,t=t.NextInAEL},_.Clipper.prototype.SwapPositionsInSEL=function(t,e){var i,n,i,n,i,n;null===t.NextInSEL&&null===t.PrevInSEL||null===e.NextInSEL&&null===e.PrevInSEL||(t.NextInSEL===e?(null!==(i=e.NextInSEL)&&(i.PrevInSEL=t),null!==(n=t.PrevInSEL)&&(n.NextInSEL=e),e.PrevInSEL=n,(e.NextInSEL=t).PrevInSEL=e,t.NextInSEL=i):e.NextInSEL===t?(null!==(i=t.NextInSEL)&&(i.PrevInSEL=e),null!==(n=e.PrevInSEL)&&(n.NextInSEL=t),t.PrevInSEL=n,(t.NextInSEL=e).PrevInSEL=t,e.NextInSEL=i):(i=t.NextInSEL,n=t.PrevInSEL,t.NextInSEL=e.NextInSEL,null!==t.NextInSEL&&(t.NextInSEL.PrevInSEL=t),t.PrevInSEL=e.PrevInSEL,null!==t.PrevInSEL&&(t.PrevInSEL.NextInSEL=t),e.NextInSEL=i,null!==e.NextInSEL&&(e.NextInSEL.PrevInSEL=e),e.PrevInSEL=n,null!==e.PrevInSEL&&(e.PrevInSEL.NextInSEL=e)),null===t.PrevInSEL?this.m_SortedEdges=t:null===e.PrevInSEL&&(this.m_SortedEdges=e))},_.Clipper.prototype.AddLocalMaxPoly=function(t,e,i){this.AddOutPt(t,i),0===e.WindDelta&&this.AddOutPt(e,i),t.OutIdx===e.OutIdx?(t.OutIdx=-1,e.OutIdx=-1):t.OutIdx<e.OutIdx?this.AppendPolygon(t,e):this.AppendPolygon(e,t)},_.Clipper.prototype.AddLocalMinPoly=function(t,e,i){var n,o,r,e,t,i,r=_.ClipperBase.IsHorizontal(e)||t.Dx>e.Dx?(n=this.AddOutPt(t,i),e.OutIdx=t.OutIdx,t.Side=_.EdgeSide.esLeft,e.Side=_.EdgeSide.esRight,((o=t).PrevInAEL===e?e:o).PrevInAEL):(n=this.AddOutPt(e,i),t.OutIdx=e.OutIdx,t.Side=_.EdgeSide.esRight,e.Side=_.EdgeSide.esLeft,((o=e).PrevInAEL===t?t:o).PrevInAEL);return null!==r&&0<=r.OutIdx&&r.Top.Y<i.Y&&o.Top.Y<i.Y&&((e=_.Clipper.TopX(r,i.Y))===(t=_.Clipper.TopX(o,i.Y))&&0!==o.WindDelta&&0!==r.WindDelta&&_.ClipperBase.SlopesEqual5(new _.IntPoint2(e,i.Y),r.Top,new _.IntPoint2(t,i.Y),o.Top,this.m_UseFullRange)&&(i=this.AddOutPt(r,i),this.AddJoin(n,i,o.Top))),n},_.Clipper.prototype.AddOutPt=function(t,e){if(t.OutIdx<0){var i;(i=this.CreateOutRec()).IsOpen=0===t.WindDelta;var n=new _.OutPt;return(i.Pts=n).Idx=i.Idx,n.Pt.X=e.X,n.Pt.Y=e.Y,_.use_xyz&&(n.Pt.Z=e.Z),(n.Next=n).Prev=n,i.IsOpen||this.SetHoleState(t,i),t.OutIdx=i.Idx,n}var i,o=(i=this.m_PolyOuts[t.OutIdx]).Pts,t=t.Side===_.EdgeSide.esLeft,n;return t&&_.IntPoint.op_Equality(e,o.Pt)?o:!t&&_.IntPoint.op_Equality(e,o.Prev.Pt)?o.Prev:((n=new _.OutPt).Idx=i.Idx,n.Pt.X=e.X,n.Pt.Y=e.Y,_.use_xyz&&(n.Pt.Z=e.Z),n.Next=o,n.Prev=o.Prev,n.Prev.Next=n,o.Prev=n,t&&(i.Pts=n),n)},_.Clipper.prototype.GetLastOutPt=function(t){var e=this.m_PolyOuts[t.OutIdx];return t.Side===_.EdgeSide.esLeft?e.Pts:e.Pts.Prev},_.Clipper.prototype.SwapPoints=function(t,e){var i=new _.IntPoint1(t.Value);t.Value.X=e.Value.X,t.Value.Y=e.Value.Y,_.use_xyz&&(t.Value.Z=e.Value.Z),e.Value.X=i.X,e.Value.Y=i.Y,_.use_xyz&&(e.Value.Z=i.Z)},_.Clipper.prototype.HorzSegmentsOverlap=function(t,e,i,n){var o;return e<t&&(o=t,t=e,e=o),n<i&&(o=i,i=n,n=o),t<n&&i<e},_.Clipper.prototype.SetHoleState=function(t,e){for(var i=t.PrevInAEL,n=null;null!==i;)0<=i.OutIdx&&0!==i.WindDelta&&(null===n?n=i:n.OutIdx===i.OutIdx&&(n=null)),i=i.PrevInAEL;null===n?(e.FirstLeft=null,e.IsHole=!1):(e.FirstLeft=this.m_PolyOuts[n.OutIdx],e.IsHole=!e.FirstLeft.IsHole)},_.Clipper.prototype.GetDx=function(t,e){return t.Y===e.Y?_.ClipperBase.horizontal:(e.X-t.X)/(e.Y-t.Y)},_.Clipper.prototype.FirstIsBottomPt=function(t,e){for(var i=t.Prev;_.IntPoint.op_Equality(i.Pt,t.Pt)&&i!==t;)i=i.Prev;for(var n=Math.abs(this.GetDx(t.Pt,i.Pt)),i=t.Next;_.IntPoint.op_Equality(i.Pt,t.Pt)&&i!==t;)i=i.Next;var o=Math.abs(this.GetDx(t.Pt,i.Pt));for(i=e.Prev;_.IntPoint.op_Equality(i.Pt,e.Pt)&&i!==e;)i=i.Prev;var r=Math.abs(this.GetDx(e.Pt,i.Pt));for(i=e.Next;_.IntPoint.op_Equality(i.Pt,e.Pt)&&i!==e;)i=i.Next;var s=Math.abs(this.GetDx(e.Pt,i.Pt));return Math.max(n,o)===Math.max(r,s)&&Math.min(n,o)===Math.min(r,s)?0<this.Area(t):r<=n&&s<=n||r<=o&&s<=o},_.Clipper.prototype.GetBottomPt=function(t){for(var e=null,i=t.Next;i!==t;)i.Pt.Y>t.Pt.Y?(t=i,e=null):i.Pt.Y===t.Pt.Y&&i.Pt.X<=t.Pt.X&&(i.Pt.X<t.Pt.X?(e=null,t=i):i.Next!==t&&i.Prev!==t&&(e=i)),i=i.Next;if(null!==e)for(;e!==i;)for(this.FirstIsBottomPt(i,e)||(t=e),e=e.Next;_.IntPoint.op_Inequality(e.Pt,t.Pt);)e=e.Next;return t},_.Clipper.prototype.GetLowermostRec=function(t,e){null===t.BottomPt&&(t.BottomPt=this.GetBottomPt(t.Pts)),null===e.BottomPt&&(e.BottomPt=this.GetBottomPt(e.Pts));var i=t.BottomPt,n=e.BottomPt;return i.Pt.Y>n.Pt.Y||!(i.Pt.Y<n.Pt.Y)&&(i.Pt.X<n.Pt.X||!(i.Pt.X>n.Pt.X)&&i.Next!==i&&(n.Next===n||this.FirstIsBottomPt(i,n)))?t:e},_.Clipper.prototype.OutRec1RightOfOutRec2=function(t,e){do{if((t=t.FirstLeft)===e)return!0}while(null!==t);return!1},_.Clipper.prototype.GetOutRec=function(t){for(var e=this.m_PolyOuts[t];e!==this.m_PolyOuts[e.Idx];)e=this.m_PolyOuts[e.Idx];return e},_.Clipper.prototype.AppendPolygon=function(t,e){var i=this.m_PolyOuts[t.OutIdx],n=this.m_PolyOuts[e.OutIdx],o,o=this.OutRec1RightOfOutRec2(i,n)?n:this.OutRec1RightOfOutRec2(n,i)?i:this.GetLowermostRec(i,n),r=i.Pts,s=r.Prev,l=n.Pts,p=l.Prev;t.Side===_.EdgeSide.esLeft?e.Side===_.EdgeSide.esLeft?(this.ReversePolyPtLinks(l),(l.Next=r).Prev=l,(s.Next=p).Prev=s,i.Pts=p):((p.Next=r).Prev=p,(l.Prev=s).Next=l,i.Pts=l):e.Side===_.EdgeSide.esRight?(this.ReversePolyPtLinks(l),(s.Next=p).Prev=s,(l.Next=r).Prev=l):((s.Next=l).Prev=s,(r.Prev=p).Next=r),i.BottomPt=null,o===n&&(n.FirstLeft!==i&&(i.FirstLeft=n.FirstLeft),i.IsHole=n.IsHole),n.Pts=null,n.BottomPt=null,n.FirstLeft=i;var u=t.OutIdx,h=e.OutIdx;t.OutIdx=-1,e.OutIdx=-1;for(var a=this.m_ActiveEdges;null!==a;){if(a.OutIdx===h){a.OutIdx=u,a.Side=t.Side;break}a=a.NextInAEL}n.Idx=i.Idx},_.Clipper.prototype.ReversePolyPtLinks=function(t){if(null!==t)for(var e,i,e=t;i=e.Next,e.Next=e.Prev,e.Prev=i,(e=i)!==t;);},_.Clipper.SwapSides=function(t,e){var i=t.Side;t.Side=e.Side,e.Side=i},_.Clipper.SwapPolyIndexes=function(t,e){var i=t.OutIdx;t.OutIdx=e.OutIdx,e.OutIdx=i},_.Clipper.prototype.IntersectEdges=function(t,e,i){var n=0<=t.OutIdx,o=0<=e.OutIdx,r,s,l,p,r,u,h,a,f;if(_.use_xyz&&this.SetZ(i,t,e),_.use_lines&&(0===t.WindDelta||0===e.WindDelta))return 0===t.WindDelta&&0===e.WindDelta?void 0:void(t.PolyTyp===e.PolyTyp&&t.WindDelta!==e.WindDelta&&this.m_ClipType===_.ClipType.ctUnion?0===t.WindDelta?o&&(this.AddOutPt(t,i),n&&(t.OutIdx=-1)):n&&(this.AddOutPt(e,i),o&&(e.OutIdx=-1)):t.PolyTyp!==e.PolyTyp&&(0!==t.WindDelta||1!==Math.abs(e.WindCnt)||this.m_ClipType===_.ClipType.ctUnion&&0!==e.WindCnt2?0!==e.WindDelta||1!==Math.abs(t.WindCnt)||this.m_ClipType===_.ClipType.ctUnion&&0!==t.WindCnt2||(this.AddOutPt(e,i),o&&(e.OutIdx=-1)):(this.AddOutPt(t,i),n&&(t.OutIdx=-1))));switch(t.PolyTyp===e.PolyTyp?this.IsEvenOddFillType(t)?(r=t.WindCnt,t.WindCnt=e.WindCnt,e.WindCnt=r):(t.WindCnt+e.WindDelta===0?t.WindCnt=-t.WindCnt:t.WindCnt+=e.WindDelta,e.WindCnt-t.WindDelta==0?e.WindCnt=-e.WindCnt:e.WindCnt-=t.WindDelta):(this.IsEvenOddFillType(e)?t.WindCnt2=0===t.WindCnt2?1:0:t.WindCnt2+=e.WindDelta,this.IsEvenOddFillType(t)?e.WindCnt2=0===e.WindCnt2?1:0:e.WindCnt2-=t.WindDelta),p=t.PolyTyp===_.PolyType.ptSubject?(s=this.m_SubjFillType,this.m_ClipFillType):(s=this.m_ClipFillType,this.m_SubjFillType),r=e.PolyTyp===_.PolyType.ptSubject?(l=this.m_SubjFillType,this.m_ClipFillType):(l=this.m_ClipFillType,this.m_SubjFillType),s){case _.PolyFillType.pftPositive:u=t.WindCnt;break;case _.PolyFillType.pftNegative:u=-t.WindCnt;break;default:u=Math.abs(t.WindCnt)}switch(l){case _.PolyFillType.pftPositive:h=e.WindCnt;break;case _.PolyFillType.pftNegative:h=-e.WindCnt;break;default:h=Math.abs(e.WindCnt)}if(n&&o)0!==u&&1!==u||0!==h&&1!==h||t.PolyTyp!==e.PolyTyp&&this.m_ClipType!==_.ClipType.ctXor?this.AddLocalMaxPoly(t,e,i):(this.AddOutPt(t,i),this.AddOutPt(e,i),_.Clipper.SwapSides(t,e),_.Clipper.SwapPolyIndexes(t,e));else if(n)0!==h&&1!==h||(this.AddOutPt(t,i),_.Clipper.SwapSides(t,e),_.Clipper.SwapPolyIndexes(t,e));else if(o)0!==u&&1!==u||(this.AddOutPt(e,i),_.Clipper.SwapSides(t,e),_.Clipper.SwapPolyIndexes(t,e));else if(!(0!==u&&1!==u||0!==h&&1!==h)){switch(p){case _.PolyFillType.pftPositive:a=t.WindCnt2;break;case _.PolyFillType.pftNegative:a=-t.WindCnt2;break;default:a=Math.abs(t.WindCnt2)}switch(r){case _.PolyFillType.pftPositive:f=e.WindCnt2;break;case _.PolyFillType.pftNegative:f=-e.WindCnt2;break;default:f=Math.abs(e.WindCnt2)}if(t.PolyTyp!==e.PolyTyp)this.AddLocalMinPoly(t,e,i);else if(1===u&&1===h)switch(this.m_ClipType){case _.ClipType.ctIntersection:0<a&&0<f&&this.AddLocalMinPoly(t,e,i);break;case _.ClipType.ctUnion:a<=0&&f<=0&&this.AddLocalMinPoly(t,e,i);break;case _.ClipType.ctDifference:(t.PolyTyp===_.PolyType.ptClip&&0<a&&0<f||t.PolyTyp===_.PolyType.ptSubject&&a<=0&&f<=0)&&this.AddLocalMinPoly(t,e,i);break;case _.ClipType.ctXor:this.AddLocalMinPoly(t,e,i)}else _.Clipper.SwapSides(t,e)}},_.Clipper.prototype.DeleteFromSEL=function(t){var e=t.PrevInSEL,i=t.NextInSEL;null===e&&null===i&&t!==this.m_SortedEdges||(null!==e?e.NextInSEL=i:this.m_SortedEdges=i,null!==i&&(i.PrevInSEL=e),t.NextInSEL=null,t.PrevInSEL=null)},_.Clipper.prototype.ProcessHorizontals=function(){for(var t={};this.PopEdgeFromSEL(t);)this.ProcessHorizontal(t.v)},_.Clipper.prototype.GetHorzDirection=function(t,e){t.Bot.X<t.Top.X?(e.Left=t.Bot.X,e.Right=t.Top.X,e.Dir=_.Direction.dLeftToRight):(e.Left=t.Top.X,e.Right=t.Bot.X,e.Dir=_.Direction.dRightToLeft)},_.Clipper.prototype.ProcessHorizontal=function(t){var e={Dir:null,Left:null,Right:null};this.GetHorzDirection(t,e);for(var i=e.Dir,n=e.Left,o=e.Right,r=0===t.WindDelta,s=t,l=null;null!==s.NextInLML&&_.ClipperBase.IsHorizontal(s.NextInLML);)s=s.NextInLML;null===s.NextInLML&&(l=this.GetMaximaPair(s));var p=this.m_Maxima;if(null!==p)if(i===_.Direction.dLeftToRight){for(;null!==p&&p.X<=t.Bot.X;)p=p.Next;null!==p&&p.X>=s.Top.X&&(p=null)}else{for(;null!==p.Next&&p.Next.X<t.Bot.X;)p=p.Next;p.X<=s.Top.X&&(p=null)}for(var u=null,h,a,f,f;;){for(var d=t===s,P=this.GetNextInAEL(t,i),m,m;null!==P;){if(null!==p)if(i===_.Direction.dLeftToRight)for(;null!==p&&p.X<P.Curr.X;)0<=t.OutIdx&&!r&&this.AddOutPt(t,new _.IntPoint2(p.X,t.Bot.Y)),p=p.Next;else for(;null!==p&&p.X>P.Curr.X;)0<=t.OutIdx&&!r&&this.AddOutPt(t,new _.IntPoint2(p.X,t.Bot.Y)),p=p.Prev;if(i===_.Direction.dLeftToRight&&P.Curr.X>o||i===_.Direction.dRightToLeft&&P.Curr.X<n)break;if(P.Curr.X===t.Top.X&&null!==t.NextInLML&&P.Dx<t.NextInLML.Dx)break;if(0<=t.OutIdx&&!r){_.use_xyz&&(i===_.Direction.dLeftToRight?this.SetZ(P.Curr,t,P):this.SetZ(P.Curr,P,t));for(var u=this.AddOutPt(t,P.Curr),y=this.m_SortedEdges,f;null!==y;){0<=y.OutIdx&&this.HorzSegmentsOverlap(t.Bot.X,t.Top.X,y.Bot.X,y.Top.X)&&(f=this.GetLastOutPt(y),this.AddJoin(f,u,y.Top)),y=y.NextInSEL}this.AddGhostJoin(u,t.Bot)}if(P===l&&d)return 0<=t.OutIdx&&this.AddLocalMaxPoly(t,l,t.Top),this.DeleteFromAEL(t),void this.DeleteFromAEL(l);i===_.Direction.dLeftToRight?(m=new _.IntPoint2(P.Curr.X,t.Curr.Y),this.IntersectEdges(t,P,m)):(m=new _.IntPoint2(P.Curr.X,t.Curr.Y),this.IntersectEdges(P,t,m));var a=this.GetNextInAEL(P,i);this.SwapPositionsInAEL(t,P),P=a}if(null===t.NextInLML||!_.ClipperBase.IsHorizontal(t.NextInLML))break;0<=(t=this.UpdateEdgeIntoAEL(t)).OutIdx&&this.AddOutPt(t,t.Bot),this.GetHorzDirection(t,e={Dir:i,Left:n,Right:o}),i=e.Dir,n=e.Left,o=e.Right}if(0<=t.OutIdx&&null===u){u=this.GetLastOutPt(t);for(var y=this.m_SortedEdges,f;null!==y;){0<=y.OutIdx&&this.HorzSegmentsOverlap(t.Bot.X,t.Top.X,y.Bot.X,y.Top.X)&&(f=this.GetLastOutPt(y),this.AddJoin(f,u,y.Top)),y=y.NextInSEL}this.AddGhostJoin(u,t.Top)}null!==t.NextInLML?0<=t.OutIdx?(u=this.AddOutPt(t,t.Top),0!==(t=this.UpdateEdgeIntoAEL(t)).WindDelta&&(h=t.PrevInAEL,a=t.NextInAEL,null!==h&&h.Curr.X===t.Bot.X&&h.Curr.Y===t.Bot.Y&&0===h.WindDelta&&0<=h.OutIdx&&h.Curr.Y>h.Top.Y&&_.ClipperBase.SlopesEqual3(t,h,this.m_UseFullRange)?(f=this.AddOutPt(h,t.Bot),this.AddJoin(u,f,t.Top)):null!==a&&a.Curr.X===t.Bot.X&&a.Curr.Y===t.Bot.Y&&0!==a.WindDelta&&0<=a.OutIdx&&a.Curr.Y>a.Top.Y&&_.ClipperBase.SlopesEqual3(t,a,this.m_UseFullRange)&&(f=this.AddOutPt(a,t.Bot),this.AddJoin(u,f,t.Top)))):this.UpdateEdgeIntoAEL(t):(0<=t.OutIdx&&this.AddOutPt(t,t.Top),this.DeleteFromAEL(t))},_.Clipper.prototype.GetNextInAEL=function(t,e){return e===_.Direction.dLeftToRight?t.NextInAEL:t.PrevInAEL},_.Clipper.prototype.IsMinima=function(t){return null!==t&&t.Prev.NextInLML!==t&&t.Next.NextInLML!==t},_.Clipper.prototype.IsMaxima=function(t,e){return null!==t&&t.Top.Y===e&&null===t.NextInLML},_.Clipper.prototype.IsIntermediate=function(t,e){return t.Top.Y===e&&null!==t.NextInLML},_.Clipper.prototype.GetMaximaPair=function(t){return _.IntPoint.op_Equality(t.Next.Top,t.Top)&&null===t.Next.NextInLML?t.Next:_.IntPoint.op_Equality(t.Prev.Top,t.Top)&&null===t.Prev.NextInLML?t.Prev:null},_.Clipper.prototype.GetMaximaPairEx=function(t){var t=this.GetMaximaPair(t);return null===t||t.OutIdx===_.ClipperBase.Skip||t.NextInAEL===t.PrevInAEL&&!_.ClipperBase.IsHorizontal(t)?null:t},_.Clipper.prototype.ProcessIntersections=function(t){if(null===this.m_ActiveEdges)return!0;try{if(this.BuildIntersectList(t),0===this.m_IntersectList.length)return!0;if(1!==this.m_IntersectList.length&&!this.FixupIntersectionOrder())return!1;this.ProcessIntersectList()}catch(t){this.m_SortedEdges=null,this.m_IntersectList.length=0,_.Error("ProcessIntersections error")}return!(this.m_SortedEdges=null)},_.Clipper.prototype.BuildIntersectList=function(t){if(null!==this.m_ActiveEdges){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e.Curr.X=_.Clipper.TopX(e,t),e=e.NextInAEL;for(var i=!0;i&&null!==this.m_SortedEdges;){for(i=!1,e=this.m_SortedEdges;null!==e.NextInSEL;){var n=e.NextInSEL,o=new _.IntPoint0,r;e.Curr.X>n.Curr.X?(this.IntersectPoint(e,n,o),o.Y<t&&(o=new _.IntPoint2(_.Clipper.TopX(e,t),t)),(r=new _.IntersectNode).Edge1=e,r.Edge2=n,r.Pt.X=o.X,r.Pt.Y=o.Y,_.use_xyz&&(r.Pt.Z=o.Z),this.m_IntersectList.push(r),this.SwapPositionsInSEL(e,n),i=!0):e=n}if(null===e.PrevInSEL)break;e.PrevInSEL.NextInSEL=null}this.m_SortedEdges=null}},_.Clipper.prototype.EdgesAdjacent=function(t){return t.Edge1.NextInSEL===t.Edge2||t.Edge1.PrevInSEL===t.Edge2},_.Clipper.IntersectNodeSort=function(t,e){return e.Pt.Y-t.Pt.Y},_.Clipper.prototype.FixupIntersectionOrder=function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer),this.CopyAELToSEL();for(var t=this.m_IntersectList.length,e=0;e<t;e++){if(!this.EdgesAdjacent(this.m_IntersectList[e])){for(var i=e+1;i<t&&!this.EdgesAdjacent(this.m_IntersectList[i]);)i++;if(i===t)return!1;var n=this.m_IntersectList[e];this.m_IntersectList[e]=this.m_IntersectList[i],this.m_IntersectList[i]=n}this.SwapPositionsInSEL(this.m_IntersectList[e].Edge1,this.m_IntersectList[e].Edge2)}return!0},_.Clipper.prototype.ProcessIntersectList=function(){for(var t=0,e=this.m_IntersectList.length;t<e;t++){var i=this.m_IntersectList[t];this.IntersectEdges(i.Edge1,i.Edge2,i.Pt),this.SwapPositionsInAEL(i.Edge1,i.Edge2)}this.m_IntersectList.length=0};var de,e=function(t){return t<0?Math.ceil(t-.5):Math.floor(t+.5)},o=function(t){return t<0?-Math.round(Math.abs(t)):Math.round(t)},t=function(t){return t<0?(t-=.5)<-2147483648?Math.ceil(t):0|t:2147483647<(t+=.5)?Math.floor(t):0|t};n.msie?_.Clipper.Round=function(t){return t<0?Math.ceil(t-.5):Math.round(t)}:n.chromium?_.Clipper.Round=o:n.safari?_.Clipper.Round=t:_.Clipper.Round=e,_.Clipper.TopX=function(t,e){return e===t.Top.Y?t.Top.X:t.Bot.X+_.Clipper.Round(t.Dx*(e-t.Bot.Y))},_.Clipper.prototype.IntersectPoint=function(t,e,i){var n,o,n,o,r;if(i.X=0,i.Y=0,t.Dx===e.Dx)return i.Y=t.Curr.Y,void(i.X=_.Clipper.TopX(t,i.Y));if(0===t.Delta.X?(i.X=t.Bot.X,_.ClipperBase.IsHorizontal(e)?i.Y=e.Bot.Y:(o=e.Bot.Y-e.Bot.X/e.Dx,i.Y=_.Clipper.Round(i.X/e.Dx+o))):0===e.Delta.X?(i.X=e.Bot.X,_.ClipperBase.IsHorizontal(t)?i.Y=t.Bot.Y:(n=t.Bot.Y-t.Bot.X/t.Dx,i.Y=_.Clipper.Round(i.X/t.Dx+n))):(n=t.Bot.X-t.Bot.Y*t.Dx,r=((o=e.Bot.X-e.Bot.Y*e.Dx)-n)/(t.Dx-e.Dx),i.Y=_.Clipper.Round(r),Math.abs(t.Dx)<Math.abs(e.Dx)?i.X=_.Clipper.Round(t.Dx*r+n):i.X=_.Clipper.Round(e.Dx*r+o)),i.Y<t.Top.Y||i.Y<e.Top.Y){if(t.Top.Y>e.Top.Y)return i.Y=t.Top.Y,i.X=_.Clipper.TopX(e,t.Top.Y),i.X<t.Top.X;i.Y=e.Top.Y,Math.abs(t.Dx)<Math.abs(e.Dx)?i.X=_.Clipper.TopX(t,i.Y):i.X=_.Clipper.TopX(e,i.Y)}i.Y>t.Curr.Y&&(i.Y=t.Curr.Y,Math.abs(t.Dx)>Math.abs(e.Dx)?i.X=_.Clipper.TopX(e,i.Y):i.X=_.Clipper.TopX(t,i.Y))},_.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(t){for(var e=this.m_ActiveEdges,i,n,o,r,r;null!==e;)var s=this.IsMaxima(e,t),l,s,n,n,s,i,r,e=(s=s?null===(l=this.GetMaximaPairEx(e))||!_.ClipperBase.IsHorizontal(l):s)?(this.StrictlySimple&&this.InsertMaxima(e.Top.X),n=e.PrevInAEL,this.DoMaxima(e),null===n?this.m_ActiveEdges:n.NextInAEL):(this.IsIntermediate(e,t)&&_.ClipperBase.IsHorizontal(e.NextInLML)?(0<=(e=this.UpdateEdgeIntoAEL(e)).OutIdx&&this.AddOutPt(e,e.Bot),this.AddEdgeToSEL(e)):(e.Curr.X=_.Clipper.TopX(e,t),e.Curr.Y=t),_.use_xyz&&(e.Top.Y===t?e.Curr.Z=e.Top.Z:e.Bot.Y===t?e.Curr.Z=e.Bot.Z:e.Curr.Z=0),this.StrictlySimple&&(n=e.PrevInAEL,0<=e.OutIdx&&0!==e.WindDelta&&null!==n&&0<=n.OutIdx&&n.Curr.X===e.Curr.X&&0!==n.WindDelta&&(s=new _.IntPoint1(e.Curr),_.use_xyz&&this.SetZ(s,n,e),i=this.AddOutPt(n,s),r=this.AddOutPt(e,s),this.AddJoin(i,r,s))),e.NextInAEL);for(this.ProcessHorizontals(),this.m_Maxima=null,e=this.m_ActiveEdges;null!==e;){this.IsIntermediate(e,t)&&(i=null,0<=e.OutIdx&&(i=this.AddOutPt(e,e.Top)),n=(e=this.UpdateEdgeIntoAEL(e)).PrevInAEL,o=e.NextInAEL,null!==n&&n.Curr.X===e.Bot.X&&n.Curr.Y===e.Bot.Y&&null!==i&&0<=n.OutIdx&&n.Curr.Y===n.Top.Y&&_.ClipperBase.SlopesEqual5(e.Curr,e.Top,n.Curr,n.Top,this.m_UseFullRange)&&0!==e.WindDelta&&0!==n.WindDelta?(r=this.AddOutPt(ePrev2,e.Bot),this.AddJoin(i,r,e.Top)):null!==o&&o.Curr.X===e.Bot.X&&o.Curr.Y===e.Bot.Y&&null!==i&&0<=o.OutIdx&&o.Curr.Y===o.Top.Y&&_.ClipperBase.SlopesEqual5(e.Curr,e.Top,o.Curr,o.Top,this.m_UseFullRange)&&0!==e.WindDelta&&0!==o.WindDelta&&(r=this.AddOutPt(o,e.Bot),this.AddJoin(i,r,e.Top))),e=e.NextInAEL}},_.Clipper.prototype.DoMaxima=function(t){var e=this.GetMaximaPairEx(t);if(null===e)return 0<=t.OutIdx&&this.AddOutPt(t,t.Top),void this.DeleteFromAEL(t);for(var i=t.NextInAEL;null!==i&&i!==e;)this.IntersectEdges(t,i,t.Top),this.SwapPositionsInAEL(t,i),i=t.NextInAEL;-1===t.OutIdx&&-1===e.OutIdx?(this.DeleteFromAEL(t),this.DeleteFromAEL(e)):0<=t.OutIdx&&0<=e.OutIdx?(0<=t.OutIdx&&this.AddLocalMaxPoly(t,e,t.Top),this.DeleteFromAEL(t),this.DeleteFromAEL(e)):_.use_lines&&0===t.WindDelta?(0<=t.OutIdx&&(this.AddOutPt(t,t.Top),t.OutIdx=_.ClipperBase.Unassigned),this.DeleteFromAEL(t),0<=e.OutIdx&&(this.AddOutPt(e,t.Top),e.OutIdx=_.ClipperBase.Unassigned),this.DeleteFromAEL(e)):_.Error("DoMaxima error")},_.Clipper.ReversePaths=function(t){for(var e=0,i=t.length;e<i;e++)t[e].reverse()},_.Clipper.Orientation=function(t){return 0<=_.Clipper.Area(t)},_.Clipper.prototype.PointCount=function(t){if(null===t)return 0;for(var e=0,i=t;e++,(i=i.Next)!==t;);return e},_.Clipper.prototype.BuildResult=function(t){_.Clear(t);for(var e=0,i=this.m_PolyOuts.length;e<i;e++){var n=this.m_PolyOuts[e];if(null!==n.Pts){var o=n.Pts.Prev,r=this.PointCount(o);if(!(r<2)){for(var s=new Array(r),l=0;l<r;l++)s[l]=o.Pt,o=o.Prev;t.push(s)}}}},_.Clipper.prototype.BuildResult2=function(t){t.Clear();for(var e=0,i=this.m_PolyOuts.length;e<i;e++){var n=this.m_PolyOuts[e],o=this.PointCount(n.Pts);if(!(n.IsOpen&&o<2||!n.IsOpen&&o<3)){this.FixHoleLinkage(n);var r=new _.PolyNode;t.m_AllPolys.push(r),(n.PolyNode=r).m_polygon.length=o;for(var s=n.Pts.Prev,l=0;l<o;l++)r.m_polygon[l]=s.Pt,s=s.Prev}}for(var e=0,i=this.m_PolyOuts.length,n;e<i;e++){null!==(n=this.m_PolyOuts[e]).PolyNode&&(n.IsOpen?(n.PolyNode.IsOpen=!0,t.AddChild(n.PolyNode)):(null!==n.FirstLeft&&null!==n.FirstLeft.PolyNode?n.FirstLeft.PolyNode:t).AddChild(n.PolyNode))}},_.Clipper.prototype.FixupOutPolyline=function(t){for(var e,i=(e=t.Pts).Prev;e!==i;){var n,e=e.Next;_.IntPoint.op_Equality(e.Pt,e.Prev.Pt)&&(e===i&&(i=e.Prev),(n=e.Prev).Next=e.Next,e.Next.Prev=n,e=n)}e===e.Prev&&(t.Pts=null)},_.Clipper.prototype.FixupOutPolygon=function(t){var e=null;t.BottomPt=null;for(var i=t.Pts,n=this.PreserveCollinear||this.StrictlySimple;;){if(i.Prev===i||i.Prev===i.Next)return void(t.Pts=null);if(_.IntPoint.op_Equality(i.Pt,i.Next.Pt)||_.IntPoint.op_Equality(i.Pt,i.Prev.Pt)||_.ClipperBase.SlopesEqual4(i.Prev.Pt,i.Pt,i.Next.Pt,this.m_UseFullRange)&&(!n||!this.Pt2IsBetweenPt1AndPt3(i.Prev.Pt,i.Pt,i.Next.Pt)))e=null,i.Prev.Next=i.Next,i.Next.Prev=i.Prev,i=i.Prev;else{if(i===e)break;null===e&&(e=i),i=i.Next}}t.Pts=i},_.Clipper.prototype.DupOutPt=function(t,e){var i=new _.OutPt;return i.Pt.X=t.Pt.X,i.Pt.Y=t.Pt.Y,_.use_xyz&&(i.Pt.Z=t.Pt.Z),i.Idx=t.Idx,e?(i.Next=t.Next,(i.Prev=t).Next.Prev=i,t.Next=i):(i.Prev=t.Prev,(i.Next=t).Prev.Next=i,t.Prev=i),i},_.Clipper.prototype.GetOverlap=function(t,e,i,n,o){return t<e?i<n?(o.Left=Math.max(t,i),o.Right=Math.min(e,n)):(o.Left=Math.max(t,n),o.Right=Math.min(e,i)):i<n?(o.Left=Math.max(e,i),o.Right=Math.min(t,n)):(o.Left=Math.max(e,n),o.Right=Math.min(t,i)),o.Left<o.Right},_.Clipper.prototype.JoinHorz=function(t,e,i,n,o,r){var s=t.Pt.X>e.Pt.X?_.Direction.dRightToLeft:_.Direction.dLeftToRight,l=i.Pt.X>n.Pt.X?_.Direction.dRightToLeft:_.Direction.dLeftToRight;if(s===l)return!1;if(s===_.Direction.dLeftToRight){for(;t.Next.Pt.X<=o.X&&t.Next.Pt.X>=t.Pt.X&&t.Next.Pt.Y===o.Y;)t=t.Next;r&&t.Pt.X!==o.X&&(t=t.Next),e=this.DupOutPt(t,!r),_.IntPoint.op_Inequality(e.Pt,o)&&((t=e).Pt.X=o.X,t.Pt.Y=o.Y,_.use_xyz&&(t.Pt.Z=o.Z),e=this.DupOutPt(t,!r))}else{for(;t.Next.Pt.X>=o.X&&t.Next.Pt.X<=t.Pt.X&&t.Next.Pt.Y===o.Y;)t=t.Next;r||t.Pt.X===o.X||(t=t.Next),e=this.DupOutPt(t,r),_.IntPoint.op_Inequality(e.Pt,o)&&((t=e).Pt.X=o.X,t.Pt.Y=o.Y,_.use_xyz&&(t.Pt.Z=o.Z),e=this.DupOutPt(t,r))}if(l===_.Direction.dLeftToRight){for(;i.Next.Pt.X<=o.X&&i.Next.Pt.X>=i.Pt.X&&i.Next.Pt.Y===o.Y;)i=i.Next;r&&i.Pt.X!==o.X&&(i=i.Next),n=this.DupOutPt(i,!r),_.IntPoint.op_Inequality(n.Pt,o)&&((i=n).Pt.X=o.X,i.Pt.Y=o.Y,_.use_xyz&&(i.Pt.Z=o.Z),n=this.DupOutPt(i,!r))}else{for(;i.Next.Pt.X>=o.X&&i.Next.Pt.X<=i.Pt.X&&i.Next.Pt.Y===o.Y;)i=i.Next;r||i.Pt.X===o.X||(i=i.Next),n=this.DupOutPt(i,r),_.IntPoint.op_Inequality(n.Pt,o)&&((i=n).Pt.X=o.X,i.Pt.Y=o.Y,_.use_xyz&&(i.Pt.Z=o.Z),n=this.DupOutPt(i,r))}return s===_.Direction.dLeftToRight===r?((t.Prev=i).Next=t,(e.Next=n).Prev=e):((t.Next=i).Prev=t,(e.Prev=n).Next=e),!0},_.Clipper.prototype.JoinPoints=function(t,e,i){var n=t.OutPt1,o=new _.OutPt,r=t.OutPt2,s=new _.OutPt,l=t.OutPt1.Pt.Y===t.OffPt.Y;if(l&&_.IntPoint.op_Equality(t.OffPt,t.OutPt1.Pt)&&_.IntPoint.op_Equality(t.OffPt,t.OutPt2.Pt)){if(e!==i)return!1;for(o=t.OutPt1.Next;o!==n&&_.IntPoint.op_Equality(o.Pt,t.OffPt);)o=o.Next;for(var p=o.Pt.Y>t.OffPt.Y,s=t.OutPt2.Next,u;s!==r&&_.IntPoint.op_Equality(s.Pt,t.OffPt);)s=s.Next;return p==s.Pt.Y>t.OffPt.Y?!1:(p?(o=this.DupOutPt(n,!1),s=this.DupOutPt(r,!0),(n.Prev=r).Next=n,(o.Next=s).Prev=o):(o=this.DupOutPt(n,!0),s=this.DupOutPt(r,!1),(n.Next=r).Prev=n,(o.Prev=s).Next=o),t.OutPt1=n,t.OutPt2=o,!0)}if(l){for(o=n;n.Prev.Pt.Y===n.Pt.Y&&n.Prev!==o&&n.Prev!==r;)n=n.Prev;for(;o.Next.Pt.Y===o.Pt.Y&&o.Next!==n&&o.Next!==r;)o=o.Next;if(o.Next===n||o.Next===r)return!1;for(s=r;r.Prev.Pt.Y===r.Pt.Y&&r.Prev!==s&&r.Prev!==o;)r=r.Prev;for(;s.Next.Pt.Y===s.Pt.Y&&s.Next!==r&&s.Next!==n;)s=s.Next;if(s.Next===r||s.Next===n)return!1;var h={Left:null,Right:null};if(!this.GetOverlap(n.Pt.X,o.Pt.X,r.Pt.X,s.Pt.X,h))return!1;var l=h.Left,a=h.Right,h=new _.IntPoint0,a,a=n.Pt.X>=l&&n.Pt.X<=a?(h.X=n.Pt.X,h.Y=n.Pt.Y,_.use_xyz&&(h.Z=n.Pt.Z),n.Pt.X>o.Pt.X):r.Pt.X>=l&&r.Pt.X<=a?(h.X=r.Pt.X,h.Y=r.Pt.Y,_.use_xyz&&(h.Z=r.Pt.Z),r.Pt.X>s.Pt.X):o.Pt.X>=l&&o.Pt.X<=a?(h.X=o.Pt.X,h.Y=o.Pt.Y,_.use_xyz&&(h.Z=o.Pt.Z),o.Pt.X>n.Pt.X):(h.X=s.Pt.X,h.Y=s.Pt.Y,_.use_xyz&&(h.Z=s.Pt.Z),s.Pt.X>r.Pt.X);return t.OutPt1=n,t.OutPt2=r,this.JoinHorz(n,o,r,s,h,a)}for(o=n.Next;_.IntPoint.op_Equality(o.Pt,n.Pt)&&o!==n;)o=o.Next;var h=o.Pt.Y>n.Pt.Y||!_.ClipperBase.SlopesEqual4(n.Pt,o.Pt,t.OffPt,this.m_UseFullRange);if(h){for(o=n.Prev;_.IntPoint.op_Equality(o.Pt,n.Pt)&&o!==n;)o=o.Prev;if(o.Pt.Y>n.Pt.Y||!_.ClipperBase.SlopesEqual4(n.Pt,o.Pt,t.OffPt,this.m_UseFullRange))return!1}for(s=r.Next;_.IntPoint.op_Equality(s.Pt,r.Pt)&&s!==r;)s=s.Next;var a=s.Pt.Y>r.Pt.Y||!_.ClipperBase.SlopesEqual4(r.Pt,s.Pt,t.OffPt,this.m_UseFullRange);if(a){for(s=r.Prev;_.IntPoint.op_Equality(s.Pt,r.Pt)&&s!==r;)s=s.Prev;if(s.Pt.Y>r.Pt.Y||!_.ClipperBase.SlopesEqual4(r.Pt,s.Pt,t.OffPt,this.m_UseFullRange))return!1}return o!==n&&s!==r&&o!==s&&(e!==i||h!=a)&&(h?(o=this.DupOutPt(n,!1),s=this.DupOutPt(r,!0),(n.Prev=r).Next=n,(o.Next=s).Prev=o):(o=this.DupOutPt(n,!0),s=this.DupOutPt(r,!1),(n.Next=r).Prev=n,(o.Prev=s).Next=o),t.OutPt1=n,t.OutPt2=o,!0)},_.Clipper.GetBounds=function(t){for(var e=0,i=t.length;e<i&&0===t[e].length;)e++;if(e===i)return new _.IntRect(0,0,0,0);var n=new _.IntRect;for(n.left=t[e][0].X,n.right=n.left,n.top=t[e][0].Y,n.bottom=n.top;e<i;e++)for(var o=0,r=t[e].length;o<r;o++)t[e][o].X<n.left?n.left=t[e][o].X:t[e][o].X>n.right&&(n.right=t[e][o].X),t[e][o].Y<n.top?n.top=t[e][o].Y:t[e][o].Y>n.bottom&&(n.bottom=t[e][o].Y);return n},_.Clipper.prototype.GetBounds2=function(t){var e=t,i=new _.IntRect;for(i.left=t.Pt.X,i.right=t.Pt.X,i.top=t.Pt.Y,i.bottom=t.Pt.Y,t=t.Next;t!==e;)t.Pt.X<i.left&&(i.left=t.Pt.X),t.Pt.X>i.right&&(i.right=t.Pt.X),t.Pt.Y<i.top&&(i.top=t.Pt.Y),t.Pt.Y>i.bottom&&(i.bottom=t.Pt.Y),t=t.Next;return i},_.Clipper.PointInPolygon=function(t,e){var i=0,n=e.length;if(n<3)return 0;for(var o=e[0],r=1;r<=n;++r){var s=r===n?e[0]:e[r],l,l;if(s.Y===t.Y&&(s.X===t.X||o.Y===t.Y&&s.X>t.X==o.X<t.X))return-1;if(o.Y<t.Y!=s.Y<t.Y)if(o.X>=t.X)if(s.X>t.X)i=1-i;else{if(0===(l=(o.X-t.X)*(s.Y-t.Y)-(s.X-t.X)*(o.Y-t.Y)))return-1;0<l==s.Y>o.Y&&(i=1-i)}else if(s.X>t.X){if(0===(l=(o.X-t.X)*(s.Y-t.Y)-(s.X-t.X)*(o.Y-t.Y)))return-1;0<l==s.Y>o.Y&&(i=1-i)}o=s}return i},_.Clipper.prototype.PointInPolygon=function(t,e){var i=0,n=e,o=t.X,r=t.Y,s=e.Pt.X,l=e.Pt.Y;do{var p=(e=e.Next).Pt.X,u=e.Pt.Y,h,h;if(u===r&&(p===o||l===r&&o<p==s<o))return-1;if(l<r!=u<r)if(o<=s)if(o<p)i=1-i;else{if(0===(h=(s-o)*(u-r)-(p-o)*(l-r)))return-1;0<h==l<u&&(i=1-i)}else if(o<p){if(0===(h=(s-o)*(u-r)-(p-o)*(l-r)))return-1;0<h==l<u&&(i=1-i)}}while(s=p,l=u,n!==e);return i},_.Clipper.prototype.Poly2ContainsPoly1=function(t,e){var i=t;do{var n=this.PointInPolygon(i.Pt,e);if(0<=n)return 0<n}while((i=i.Next)!==t);return!0},_.Clipper.prototype.FixupFirstLefts1=function(t,e){for(var i,n,o=0,r=this.m_PolyOuts.length;o<r;o++)i=this.m_PolyOuts[o],n=_.Clipper.ParseFirstLeft(i.FirstLeft),null!==i.Pts&&n===t&&this.Poly2ContainsPoly1(i.Pts,e.Pts)&&(i.FirstLeft=e)},_.Clipper.prototype.FixupFirstLefts2=function(t,e){for(var i=e.FirstLeft,n,o,r=0,s=this.m_PolyOuts.length;r<s;r++)null!==(n=this.m_PolyOuts[r]).Pts&&n!==e&&n!==t&&((o=_.Clipper.ParseFirstLeft(n.FirstLeft))!==i&&o!==t&&o!==e||(this.Poly2ContainsPoly1(n.Pts,t.Pts)?n.FirstLeft=t:this.Poly2ContainsPoly1(n.Pts,e.Pts)?n.FirstLeft=e:n.FirstLeft!==t&&n.FirstLeft!==e||(n.FirstLeft=i)))},_.Clipper.prototype.FixupFirstLefts3=function(t,e){for(var i,n,o=0,r=this.m_PolyOuts.length;o<r;o++)i=this.m_PolyOuts[o],n=_.Clipper.ParseFirstLeft(i.FirstLeft),null!==i.Pts&&n===t&&(i.FirstLeft=e)},_.Clipper.ParseFirstLeft=function(t){for(;null!==t&&null===t.Pts;)t=t.FirstLeft;return t},_.Clipper.prototype.JoinCommonEdges=function(){for(var t=0,e=this.m_Joins.length;t<e;t++){var i=this.m_Joins[t],n=this.GetOutRec(i.OutPt1.Idx),o=this.GetOutRec(i.OutPt2.Idx),r,r;null!==n.Pts&&null!==o.Pts&&(n.IsOpen||o.IsOpen||(r=n===o?n:this.OutRec1RightOfOutRec2(n,o)?o:this.OutRec1RightOfOutRec2(o,n)?n:this.GetLowermostRec(n,o),this.JoinPoints(i,n,o)&&(n===o?(n.Pts=i.OutPt1,n.BottomPt=null,(o=this.CreateOutRec()).Pts=i.OutPt2,this.UpdateOutPtIdxs(o),this.Poly2ContainsPoly1(o.Pts,n.Pts)?(o.IsHole=!n.IsHole,o.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts2(o,n),(o.IsHole^this.ReverseSolution)==0<this.Area$1(o)&&this.ReversePolyPtLinks(o.Pts)):this.Poly2ContainsPoly1(n.Pts,o.Pts)?(o.IsHole=n.IsHole,n.IsHole=!o.IsHole,o.FirstLeft=n.FirstLeft,n.FirstLeft=o,this.m_UsingPolyTree&&this.FixupFirstLefts2(n,o),(n.IsHole^this.ReverseSolution)==0<this.Area$1(n)&&this.ReversePolyPtLinks(n.Pts)):(o.IsHole=n.IsHole,o.FirstLeft=n.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(n,o))):(o.Pts=null,o.BottomPt=null,o.Idx=n.Idx,n.IsHole=r.IsHole,r===o&&(n.FirstLeft=o.FirstLeft),o.FirstLeft=n,this.m_UsingPolyTree&&this.FixupFirstLefts3(o,n)))))}},_.Clipper.prototype.UpdateOutPtIdxs=function(t){for(var e=t.Pts;e.Idx=t.Idx,(e=e.Prev)!==t.Pts;);},_.Clipper.prototype.DoSimplePolygons=function(){for(var t=0;t<this.m_PolyOuts.length;){var e=this.m_PolyOuts[t++],i=e.Pts;if(null!==i&&!e.IsOpen)do{for(var n=i.Next,o,r,o;n!==e.Pts;){_.IntPoint.op_Equality(i.Pt,n.Pt)&&n.Next!==i&&n.Prev!==i&&(o=i.Prev,r=n.Prev,(i.Prev=r).Next=i,(n.Prev=o).Next=n,e.Pts=i,(o=this.CreateOutRec()).Pts=n,this.UpdateOutPtIdxs(o),this.Poly2ContainsPoly1(o.Pts,e.Pts)?(o.IsHole=!e.IsHole,o.FirstLeft=e,this.m_UsingPolyTree&&this.FixupFirstLefts2(o,e)):this.Poly2ContainsPoly1(e.Pts,o.Pts)?(o.IsHole=e.IsHole,e.IsHole=!o.IsHole,o.FirstLeft=e.FirstLeft,e.FirstLeft=o,this.m_UsingPolyTree&&this.FixupFirstLefts2(e,o)):(o.IsHole=e.IsHole,o.FirstLeft=e.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(e,o)),n=i),n=n.Next}}while((i=i.Next)!==e.Pts)}},_.Clipper.Area=function(t){if(!Array.isArray(t))return 0;var e=t.length;if(e<3)return 0;for(var i=0,n=0,o=e-1;n<e;++n)i+=(t[o].X+t[n].X)*(t[o].Y-t[n].Y),o=n;return.5*-i},_.Clipper.prototype.Area=function(t){var e=t;if(null===t)return 0;for(var i=0;i+=(t.Prev.Pt.X+t.Pt.X)*(t.Prev.Pt.Y-t.Pt.Y),(t=t.Next)!==e;);return.5*i},_.Clipper.prototype.Area$1=function(t){return this.Area(t.Pts)},_.Clipper.SimplifyPolygon=function(t,e){var i=new Array,n=new _.Clipper(0);return n.StrictlySimple=!0,n.AddPath(t,_.PolyType.ptSubject,!0),n.Execute(_.ClipType.ctUnion,i,e,e),i},_.Clipper.SimplifyPolygons=function(t,e){void 0===e&&(e=_.PolyFillType.pftEvenOdd);var i=new Array,n=new _.Clipper(0);return n.StrictlySimple=!0,n.AddPaths(t,_.PolyType.ptSubject,!0),n.Execute(_.ClipType.ctUnion,i,e,e),i},_.Clipper.DistanceSqrd=function(t,e){var i=t.X-e.X,e=t.Y-e.Y;return i*i+e*e},_.Clipper.DistanceFromLineSqrd=function(t,e,i){var n=e.Y-i.Y,i=i.X-e.X,e=n*e.X+i*e.Y,e;return(e=n*t.X+i*t.Y-e)*e/(n*n+i*i)},_.Clipper.SlopesNearCollinear=function(t,e,i,n){return Math.abs(t.X-e.X)>Math.abs(t.Y-e.Y)?t.X>e.X==t.X<i.X?_.Clipper.DistanceFromLineSqrd(t,e,i)<n:e.X>t.X==e.X<i.X?_.Clipper.DistanceFromLineSqrd(e,t,i)<n:_.Clipper.DistanceFromLineSqrd(i,t,e)<n:t.Y>e.Y==t.Y<i.Y?_.Clipper.DistanceFromLineSqrd(t,e,i)<n:e.Y>t.Y==e.Y<i.Y?_.Clipper.DistanceFromLineSqrd(e,t,i)<n:_.Clipper.DistanceFromLineSqrd(i,t,e)<n},_.Clipper.PointsAreClose=function(t,e,i){var n=t.X-e.X,e=t.Y-e.Y;return n*n+e*e<=i},_.Clipper.ExcludeOp=function(t){var e=t.Prev;return e.Next=t.Next,(t.Next.Prev=e).Idx=0,e},_.Clipper.CleanPolygon=function(t,e){void 0===e&&(e=1.415);var i=t.length;if(0===i)return new Array;for(var n=new Array(i),o=0;o<i;++o)n[o]=new _.OutPt;for(var o=0;o<i;++o)n[o].Pt=t[o],n[o].Next=n[(o+1)%i],n[o].Next.Prev=n[o],n[o].Idx=0;for(var r=e*e,s=n[0];0===s.Idx&&s.Next!==s.Prev;)_.Clipper.PointsAreClose(s.Pt,s.Prev.Pt,r)?(s=_.Clipper.ExcludeOp(s),i--):_.Clipper.PointsAreClose(s.Prev.Pt,s.Next.Pt,r)?(_.Clipper.ExcludeOp(s.Next),s=_.Clipper.ExcludeOp(s),i-=2):_.Clipper.SlopesNearCollinear(s.Prev.Pt,s.Pt,s.Next.Pt,r)?(s=_.Clipper.ExcludeOp(s),i--):(s.Idx=1,s=s.Next);i<3&&(i=0);for(var l=new Array(i),o=0;o<i;++o)l[o]=new _.IntPoint1(s.Pt),s=s.Next;return n=null,l},_.Clipper.CleanPolygons=function(t,e){for(var i=new Array(t.length),n=0,o=t.length;n<o;n++)i[n]=_.Clipper.CleanPolygon(t[n],e);return i},_.Clipper.Minkowski=function(t,e,i,n){var o=n?1:0,r=t.length,s=e.length,l=new Array;if(i)for(var p=0;p<s;p++){for(var u=new Array(r),h=0,a=t.length,f=t[h];h<a;f=t[++h])u[h]=new _.IntPoint2(e[p].X+f.X,e[p].Y+f.Y);l.push(u)}else for(var p=0;p<s;p++){for(var u=new Array(r),h=0,a=t.length,f=t[h];h<a;f=t[++h])u[h]=new _.IntPoint2(e[p].X-f.X,e[p].Y-f.Y);l.push(u)}for(var d=new Array,p=0;p<s-1+o;p++)for(var h=0;h<r;h++){var P=new Array;P.push(l[p%s][h%r]),P.push(l[(p+1)%s][h%r]),P.push(l[(p+1)%s][(h+1)%r]),P.push(l[p%s][(h+1)%r]),_.Clipper.Orientation(P)||P.reverse(),d.push(P)}return d},_.Clipper.MinkowskiSum=function(t,e,i){if(e[0]instanceof Array){for(var n=e,o=new _.Paths,r=new _.Clipper,s=0;s<n.length;++s){var l=_.Clipper.Minkowski(t,n[s],!0,i),p;r.AddPaths(l,_.PolyType.ptSubject,!0),i&&(p=_.Clipper.TranslatePath(n[s],t[0]),r.AddPath(p,_.PolyType.ptClip,!0))}return r.Execute(_.ClipType.ctUnion,o,_.PolyFillType.pftNonZero,_.PolyFillType.pftNonZero),o}var p=e,n=_.Clipper.Minkowski(t,p,!0,i),r;return(r=new _.Clipper).AddPaths(n,_.PolyType.ptSubject,!0),r.Execute(_.ClipType.ctUnion,n,_.PolyFillType.pftNonZero,_.PolyFillType.pftNonZero),n},_.Clipper.TranslatePath=function(t,e){for(var i=new _.Path,n=0;n<t.length;n++)i.push(new _.IntPoint2(t[n].X+e.X,t[n].Y+e.Y));return i},_.Clipper.MinkowskiDiff=function(t,e){var t=_.Clipper.Minkowski(t,e,!1,!0),e=new _.Clipper;return e.AddPaths(t,_.PolyType.ptSubject,!0),e.Execute(_.ClipType.ctUnion,t,_.PolyFillType.pftNonZero,_.PolyFillType.pftNonZero),t},_.Clipper.PolyTreeToPaths=function(t){var e=new Array;return _.Clipper.AddPolyNodeToPaths(t,_.Clipper.NodeType.ntAny,e),e},_.Clipper.AddPolyNodeToPaths=function(t,e,i){var n=!0;switch(e){case _.Clipper.NodeType.ntOpen:return;case _.Clipper.NodeType.ntClosed:n=!t.IsOpen}0<t.m_polygon.length&&n&&i.push(t.m_polygon);for(var o=0,r=t.Childs(),s=r.length,l=r[o];o<s;l=r[++o])_.Clipper.AddPolyNodeToPaths(l,e,i)},_.Clipper.OpenPathsFromPolyTree=function(t){for(var e=new _.Paths,i=0,n=t.ChildCount();i<n;i++)t.Childs()[i].IsOpen&&e.push(t.Childs()[i].m_polygon);return e},_.Clipper.ClosedPathsFromPolyTree=function(t){var e=new _.Paths;return _.Clipper.AddPolyNodeToPaths(t,_.Clipper.NodeType.ntClosed,e),e},i(_.Clipper,_.ClipperBase),_.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2},_.ClipperOffset=function(t,e){void 0===t&&(t=2),void 0===e&&(e=_.ClipperOffset.def_arc_tolerance),this.m_destPolys=new _.Paths,this.m_srcPoly=new _.Path,this.m_destPoly=new _.Path,this.m_normals=new Array,this.m_delta=0,this.m_sinA=0,this.m_sin=0,this.m_cos=0,this.m_miterLim=0,this.m_StepsPerRad=0,this.m_lowest=new _.IntPoint0,this.m_polyNodes=new _.PolyNode,this.MiterLimit=t,this.ArcTolerance=e,this.m_lowest.X=-1},_.ClipperOffset.two_pi=6.28318530717959,_.ClipperOffset.def_arc_tolerance=.25,_.ClipperOffset.prototype.Clear=function(){_.Clear(this.m_polyNodes.Childs()),this.m_lowest.X=-1},_.ClipperOffset.Round=_.Clipper.Round,_.ClipperOffset.prototype.AddPath=function(t,e,i){var n=t.length-1;if(!(n<0)){var o=new _.PolyNode;if(o.m_jointype=e,(o.m_endtype=i)===_.EndType.etClosedLine||i===_.EndType.etClosedPolygon)for(;0<n&&_.IntPoint.op_Equality(t[0],t[n]);)n--;o.m_polygon.push(t[0]);for(var r=0,s=0,l=1,i;l<=n;l++)_.IntPoint.op_Inequality(o.m_polygon[r],t[l])&&(r++,o.m_polygon.push(t[l]),(t[l].Y>o.m_polygon[s].Y||t[l].Y===o.m_polygon[s].Y&&t[l].X<o.m_polygon[s].X)&&(s=r));i===_.EndType.etClosedPolygon&&r<2||(this.m_polyNodes.AddChild(o),i===_.EndType.etClosedPolygon&&(this.m_lowest.X<0?this.m_lowest=new _.IntPoint2(this.m_polyNodes.ChildCount()-1,s):(i=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],(o.m_polygon[s].Y>i.Y||o.m_polygon[s].Y===i.Y&&o.m_polygon[s].X<i.X)&&(this.m_lowest=new _.IntPoint2(this.m_polyNodes.ChildCount()-1,s)))))}},_.ClipperOffset.prototype.AddPaths=function(t,e,i){for(var n=0,o=t.length;n<o;n++)this.AddPath(t[n],e,i)},_.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!_.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var t=0,e;t<this.m_polyNodes.ChildCount();t++){((e=this.m_polyNodes.Childs()[t]).m_endtype===_.EndType.etClosedPolygon||e.m_endtype===_.EndType.etClosedLine&&_.Clipper.Orientation(e.m_polygon))&&e.m_polygon.reverse()}else for(var t=0,e;t<this.m_polyNodes.ChildCount();t++){(e=this.m_polyNodes.Childs()[t]).m_endtype!==_.EndType.etClosedLine||_.Clipper.Orientation(e.m_polygon)||e.m_polygon.reverse()}},_.ClipperOffset.GetUnitNormal=function(t,e){var i=e.X-t.X,e=e.Y-t.Y;if(0==i&&0===e)return new _.DoublePoint2(0,0);var t=1/Math.sqrt(i*i+e*e);return new _.DoublePoint2(e*=t,-(i*=t))},_.ClipperOffset.prototype.DoOffset=function(t){if(this.m_destPolys=new Array,this.m_delta=t,_.ClipperBase.near_zero(t))for(var e=0,i;e<this.m_polyNodes.ChildCount();e++){(i=this.m_polyNodes.Childs()[e]).m_endtype===_.EndType.etClosedPolygon&&this.m_destPolys.push(i.m_polygon)}else{var n;2<this.MiterLimit?this.m_miterLim=2/(this.MiterLimit*this.MiterLimit):this.m_miterLim=.5;var n=this.ArcTolerance<=0?_.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(t)*_.ClipperOffset.def_arc_tolerance?Math.abs(t)*_.ClipperOffset.def_arc_tolerance:this.ArcTolerance,o=3.14159265358979/Math.acos(1-n/Math.abs(t));this.m_sin=Math.sin(_.ClipperOffset.two_pi/o),this.m_cos=Math.cos(_.ClipperOffset.two_pi/o),this.m_StepsPerRad=o/_.ClipperOffset.two_pi,t<0&&(this.m_sin=-this.m_sin);for(var e=0;e<this.m_polyNodes.ChildCount();e++){var i=this.m_polyNodes.Childs()[e];this.m_srcPoly=i.m_polygon;var r=this.m_srcPoly.length;if(!(0===r||t<=0&&(r<3||i.m_endtype!==_.EndType.etClosedPolygon)))if(this.m_destPoly=new Array,1!==r){for(var s=this.m_normals.length=0;s<r-1;s++)this.m_normals.push(_.ClipperOffset.GetUnitNormal(this.m_srcPoly[s],this.m_srcPoly[s+1]));if(i.m_endtype===_.EndType.etClosedLine||i.m_endtype===_.EndType.etClosedPolygon?this.m_normals.push(_.ClipperOffset.GetUnitNormal(this.m_srcPoly[r-1],this.m_srcPoly[0])):this.m_normals.push(new _.DoublePoint1(this.m_normals[r-2])),i.m_endtype===_.EndType.etClosedPolygon){for(var l=r-1,s=0;s<r;s++)l=this.OffsetPoint(s,l,i.m_jointype);this.m_destPolys.push(this.m_destPoly)}else if(i.m_endtype===_.EndType.etClosedLine){for(var l=r-1,s=0;s<r;s++)l=this.OffsetPoint(s,l,i.m_jointype);this.m_destPolys.push(this.m_destPoly),this.m_destPoly=new Array;for(var p=this.m_normals[r-1],s=r-1;0<s;s--)this.m_normals[s]=new _.DoublePoint2(-this.m_normals[s-1].X,-this.m_normals[s-1].Y);this.m_normals[0]=new _.DoublePoint2(-p.X,-p.Y),l=0;for(var s=r-1;0<=s;s--)l=this.OffsetPoint(s,l,i.m_jointype);this.m_destPolys.push(this.m_destPoly)}else{for(var l=0,s=1,u,s,u,s;s<r-1;++s)l=this.OffsetPoint(s,l,i.m_jointype);i.m_endtype===_.EndType.etOpenButt?(u=new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[s=r-1].X+this.m_normals[s].X*t),_.ClipperOffset.Round(this.m_srcPoly[s].Y+this.m_normals[s].Y*t)),this.m_destPoly.push(u),u=new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[s].X-this.m_normals[s].X*t),_.ClipperOffset.Round(this.m_srcPoly[s].Y-this.m_normals[s].Y*t)),this.m_destPoly.push(u)):(s=r-1,l=r-2,this.m_sinA=0,this.m_normals[s]=new _.DoublePoint2(-this.m_normals[s].X,-this.m_normals[s].Y),i.m_endtype===_.EndType.etOpenSquare?this.DoSquare(s,l):this.DoRound(s,l));for(var s=r-1;0<s;s--)this.m_normals[s]=new _.DoublePoint2(-this.m_normals[s-1].X,-this.m_normals[s-1].Y);this.m_normals[0]=new _.DoublePoint2(-this.m_normals[1].X,-this.m_normals[1].Y);for(var s=(l=r-1)-1;0<s;--s)l=this.OffsetPoint(s,l,i.m_jointype);i.m_endtype===_.EndType.etOpenButt?(u=new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*t),_.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*t)),this.m_destPoly.push(u),u=new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*t),_.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*t)),this.m_destPoly.push(u)):(l=1,this.m_sinA=0,i.m_endtype===_.EndType.etOpenSquare?this.DoSquare(0,1):this.DoRound(0,1)),this.m_destPolys.push(this.m_destPoly)}}else{if(i.m_jointype===_.JoinType.jtRound)for(var h=1,a=0,s=1;s<=o;s++){this.m_destPoly.push(new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[0].X+h*t),_.ClipperOffset.Round(this.m_srcPoly[0].Y+a*t)));var f=h;h=h*this.m_cos-this.m_sin*a,a=f*this.m_sin+a*this.m_cos}else for(var h=-1,a=-1,s=0;s<4;++s)this.m_destPoly.push(new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[0].X+h*t),_.ClipperOffset.Round(this.m_srcPoly[0].Y+a*t))),h<0?h=1:a<0?a=1:h=-1;this.m_destPolys.push(this.m_destPoly)}}}},_.ClipperOffset.prototype.Execute=function(){var t=arguments,e;if(t[0]instanceof _.PolyTree){var i=t[0],n=t[1],o;if(i.Clear(),this.FixOrientations(),this.DoOffset(n),(o=new _.Clipper(0)).AddPaths(this.m_destPolys,_.PolyType.ptSubject,!0),0<n)o.Execute(_.ClipType.ctUnion,i,_.PolyFillType.pftPositive,_.PolyFillType.pftPositive);else{var r=_.Clipper.GetBounds(this.m_destPolys),s;if((s=new _.Path).push(new _.IntPoint2(r.left-10,r.bottom+10)),s.push(new _.IntPoint2(r.right+10,r.bottom+10)),s.push(new _.IntPoint2(r.right+10,r.top-10)),s.push(new _.IntPoint2(r.left-10,r.top-10)),o.AddPath(s,_.PolyType.ptSubject,!0),o.ReverseSolution=!0,o.Execute(_.ClipType.ctUnion,i,_.PolyFillType.pftNegative,_.PolyFillType.pftNegative),1===i.ChildCount()&&0<i.Childs()[0].ChildCount()){var l=i.Childs()[0];i.Childs()[0]=l.Childs()[0],i.Childs()[0].m_Parent=i;for(var p=1;p<l.ChildCount();p++)i.AddChild(l.Childs()[p])}else i.Clear()}}else{var i=t[0],n=t[1],o,r,s;_.Clear(i),this.FixOrientations(),this.DoOffset(n),(o=new _.Clipper(0)).AddPaths(this.m_destPolys,_.PolyType.ptSubject,!0),0<n?o.Execute(_.ClipType.ctUnion,i,_.PolyFillType.pftPositive,_.PolyFillType.pftPositive):(r=_.Clipper.GetBounds(this.m_destPolys),(s=new _.Path).push(new _.IntPoint2(r.left-10,r.bottom+10)),s.push(new _.IntPoint2(r.right+10,r.bottom+10)),s.push(new _.IntPoint2(r.right+10,r.top-10)),s.push(new _.IntPoint2(r.left-10,r.top-10)),o.AddPath(s,_.PolyType.ptSubject,!0),o.ReverseSolution=!0,o.Execute(_.ClipType.ctUnion,i,_.PolyFillType.pftNegative,_.PolyFillType.pftNegative),0<i.length&&i.splice(0,1))}},_.ClipperOffset.prototype.OffsetPoint=function(t,e,i){var n;if(this.m_sinA=this.m_normals[e].X*this.m_normals[t].Y-this.m_normals[t].X*this.m_normals[e].Y,Math.abs(this.m_sinA*this.m_delta)<1){if(0<this.m_normals[e].X*this.m_normals[t].X+this.m_normals[t].Y*this.m_normals[e].Y)return this.m_destPoly.push(new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[e].X*this.m_delta),_.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[e].Y*this.m_delta))),e}else 1<this.m_sinA?this.m_sinA=1:this.m_sinA<-1&&(this.m_sinA=-1);if(this.m_sinA*this.m_delta<0)this.m_destPoly.push(new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[e].X*this.m_delta),_.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[e].Y*this.m_delta))),this.m_destPoly.push(new _.IntPoint1(this.m_srcPoly[t])),this.m_destPoly.push(new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[t].X*this.m_delta),_.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[t].Y*this.m_delta)));else switch(i){case _.JoinType.jtMiter:var o=this.m_normals[t].X*this.m_normals[e].X+this.m_normals[t].Y*this.m_normals[e].Y+1;o>=this.m_miterLim?this.DoMiter(t,e,o):this.DoSquare(t,e);break;case _.JoinType.jtSquare:this.DoSquare(t,e);break;case _.JoinType.jtRound:this.DoRound(t,e)}return e=t},_.ClipperOffset.prototype.DoSquare=function(t,e){var i=Math.tan(Math.atan2(this.m_sinA,this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y)/4);this.m_destPoly.push(new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_delta*(this.m_normals[e].X-this.m_normals[e].Y*i)),_.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_delta*(this.m_normals[e].Y+this.m_normals[e].X*i)))),this.m_destPoly.push(new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_delta*(this.m_normals[t].X+this.m_normals[t].Y*i)),_.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_delta*(this.m_normals[t].Y-this.m_normals[t].X*i))))},_.ClipperOffset.prototype.DoMiter=function(t,e,i){var i=this.m_delta/i;this.m_destPoly.push(new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[t].X+(this.m_normals[e].X+this.m_normals[t].X)*i),_.ClipperOffset.Round(this.m_srcPoly[t].Y+(this.m_normals[e].Y+this.m_normals[t].Y)*i)))},_.ClipperOffset.prototype.DoRound=function(t,e){for(var i=Math.atan2(this.m_sinA,this.m_normals[e].X*this.m_normals[t].X+this.m_normals[e].Y*this.m_normals[t].Y),n=Math.max(_.Cast_Int32(_.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(i))),1),o=this.m_normals[e].X,r=this.m_normals[e].Y,s,l=0;l<n;++l)this.m_destPoly.push(new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[t].X+o*this.m_delta),_.ClipperOffset.Round(this.m_srcPoly[t].Y+r*this.m_delta))),o=(s=o)*this.m_cos-this.m_sin*r,r=s*this.m_sin+r*this.m_cos;this.m_destPoly.push(new _.IntPoint2(_.ClipperOffset.Round(this.m_srcPoly[t].X+this.m_normals[t].X*this.m_delta),_.ClipperOffset.Round(this.m_srcPoly[t].Y+this.m_normals[t].Y*this.m_delta)))},_.Error=function(t){try{throw new Error(t)}catch(t){alert(t.message)}},_.JS={},_.JS.AreaOfPolygon=function(t,e){return e=e||1,_.Clipper.Area(t)/(e*e)},_.JS.AreaOfPolygons=function(t,e){e=e||1;for(var i=0,n=0;n<t.length;n++)i+=_.Clipper.Area(t[n]);return i/(e*e)},_.JS.BoundsOfPath=function(t,e){return _.JS.BoundsOfPaths([t],e)},_.JS.BoundsOfPaths=function(t,e){e=e||1;var t=_.Clipper.GetBounds(t);return t.left/=e,t.bottom/=e,t.right/=e,t.top/=e,t},_.JS.Clean=function(t,e){if(!(t instanceof Array))return[];var i=t[0]instanceof Array,t=_.JS.Clone(t);if("number"!=typeof e||null===e)return _.Error("Delta is not a number in Clean()."),t;if(0===t.length||1===t.length&&0===t[0].length||e<0)return t;for(var n=(t=!i?[t]:t).length,o,r,s,l,p,u,h,a=[],f=0;f<n;f++)if(0!==(o=(r=t[f]).length))if(o<3)a.push(s=r);else{for(l=e*e,p=(s=r)[0],h=u=1;h<o;h++)(r[h].X-p.X)*(r[h].X-p.X)+(r[h].Y-p.Y)*(r[h].Y-p.Y)<=l||(s[u]=r[h],p=r[h],u++);p=r[u-1],(r[0].X-p.X)*(r[0].X-p.X)+(r[0].Y-p.Y)*(r[0].Y-p.Y)<=l&&u--,u<o&&s.splice(u,o-u),s.length&&a.push(s)}return!i&&a.length?a=a[0]:i||0!==a.length?i&&0===a.length&&(a=[[]]):a=[],a},_.JS.Clone=function(t){if(!(t instanceof Array))return[];if(0===t.length)return[];if(1===t.length&&0===t[0].length)return[[]];for(var e=t[0]instanceof Array,i=(t=!e?[t]:t).length,n,o,r,s,l=new Array(i),o=0;o<i;o++){for(n=t[o].length,s=new Array(n),r=0;r<n;r++)s[r]={X:t[o][r].X,Y:t[o][r].Y};l[o]=s}return l=!e?l[0]:l},_.JS.Lighten=function(t,e){if(!(t instanceof Array))return[];if("number"!=typeof e||null===e)return _.Error("Tolerance is not a number in Lighten()."),_.JS.Clone(t);if(0===t.length||1===t.length&&0===t[0].length||e<0)return _.JS.Clone(t);for(var i=t[0]instanceof Array,n,o,r,s,l,p,u,h,a,f,d,P,m,y,u,c,v,C=(t=!i?[t]:t).length,I=e*e,x=[],n=0;n<C;n++)if(0!==(p=(r=t[n]).length)){for(s=0;s<1e6;s++){for(l=[],r[(p=r.length)-1].X!==r[0].X||r[p-1].Y!==r[0].Y?(P=1,r.push({X:r[0].X,Y:r[0].Y}),p=r.length):P=0,d=[],o=0;o<p-2;o++)u=r[o],a=r[o+1],h=r[o+2],c=u.X,v=u.Y,m=h.X-c,y=h.Y-v,0===m&&0===y||(1<(u=((a.X-c)*m+(a.Y-v)*y)/(m*m+y*y))?(c=h.X,v=h.Y):0<u&&(c+=m*u,v+=y*u)),(f=(m=a.X-c)*m+(y=a.Y-v)*y)<=I&&(d[o+1]=1,o++);for(l.push({X:r[0].X,Y:r[0].Y}),o=1;o<p-1;o++)d[o]||l.push({X:r[o].X,Y:r[o].Y});if(l.push({X:r[p-1].X,Y:r[p-1].Y}),P&&r.pop(),!d.length)break;r=l}l[(p=l.length)-1].X===l[0].X&&l[p-1].Y===l[0].Y&&l.pop(),2<l.length&&x.push(l)}return x=void 0===(x=!i?x[0]:x)?[]:x},_.JS.PerimeterOfPath=function(t,e,i){if(void 0===t)return 0;var n=Math.sqrt,o=0,r,r,s=0,l=0,p=0,u=0,h=t.length;if(h<2)return 0;for(e&&(t[h]=t[0],h++);--h;)s=(r=t[h]).X,l=r.Y,o+=n((s-(p=(r=t[h-1]).X))*(s-p)+(l-(u=r.Y))*(l-u));return e&&t.pop(),o/i},_.JS.PerimeterOfPaths=function(t,e,i){i=i||1;for(var n=0,o=0;o<t.length;o++)n+=_.JS.PerimeterOfPath(t[o],e,i);return n},_.JS.ScaleDownPath=function(t,e){var i,n;for(e=e||1,i=t.length;i--;)(n=t[i]).X=n.X/e,n.Y=n.Y/e},_.JS.ScaleDownPaths=function(t,e){var i,n,o;for(e=e||1,i=t.length;i--;)for(n=t[i].length;n--;)(o=t[i][n]).X=o.X/e,o.Y=o.Y/e},_.JS.ScaleUpPath=function(t,e){var i,n,o=Math.round;for(e=e||1,i=t.length;i--;)(n=t[i]).X=o(n.X*e),n.Y=o(n.Y*e)},_.JS.ScaleUpPaths=function(t,e){var i,n,o,r=Math.round;for(e=e||1,i=t.length;i--;)for(n=t[i].length;n--;)(o=t[i][n]).X=r(o.X*e),o.Y=r(o.Y*e)},_.ExPolygons=function(){return[]},_.ExPolygon=function(){this.outer=null,this.holes=null},_.JS.AddOuterPolyNodeToExPolygons=function(t,e){var i=new _.ExPolygon;i.outer=t.Contour();var n=t.Childs(),o=n.length,r,s,l,p,u,h;for(i.holes=new Array(o),l=0;l<o;l++)for(r=n[l],i.holes[l]=r.Contour(),p=0,h=(u=r.Childs()).length;p<h;p++)s=u[p],_.JS.AddOuterPolyNodeToExPolygons(s,e);e.push(i)},_.JS.ExPolygonsToPaths=function(t){for(var e,i,n,o,r=new _.Paths,e=0,n=t.length;e<n;e++)for(r.push(t[e].outer),i=0,o=t[e].holes.length;i<o;i++)r.push(t[e].holes[i]);return r},_.JS.PolyTreeToExPolygons=function(t){for(var e=new _.ExPolygons,i,n,o,r,n=0,o=t.Childs(),r=o.length;n<r;n++)i=o[n],_.JS.AddOuterPolyNodeToExPolygons(i,e);return e}}();"use strict";function earcut(e,n,r){r=r||2;var t=n&&n.length,i=t?n[0]*r:e.length,x=linkedList(e,0,i,r,!0),a=[],o,u,l,s,v,f,y;if(!x||x.next===x.prev)return a;if(t&&(x=eliminateHoles(e,n,x,r)),e.length>80*r){for(var o=l=e[0],u=s=e[1],p=r;p<i;p+=r)(v=e[p])<o&&(o=v),(f=e[p+1])<u&&(u=f),l<v&&(l=v),s<f&&(s=f);y=0!==(y=Math.max(l-o,s-u))?1/y:0}return earcutLinked(x,a,r,o,u,y),a}function linkedList(e,n,r,t,i){var x,a;if(i===0<signedArea(e,n,r,t))for(x=n;x<r;x+=t)a=insertNode(x,e[x],e[x+1],a);else for(x=r-t;n<=x;x-=t)a=insertNode(x,e[x],e[x+1],a);return a&&equals(a,a.next)&&(removeNode(a),a=a.next),a}function filterPoints(e,n){if(!e)return e;n=n||e;var r=e,t;do{if(t=!1,r.steiner||!equals(r,r.next)&&0!==area(r.prev,r,r.next))r=r.next;else{if(removeNode(r),(r=n=r.prev)===r.next)break;t=!0}}while(t||r!==n);return n}function earcutLinked(e,n,r,t,i,x,a){if(e){!a&&x&&indexCurve(e,t,i,x);for(var o=e,u,l;e.prev!==e.next;)if(u=e.prev,l=e.next,x?isEarHashed(e,t,i,x):isEar(e))n.push(u.i/r),n.push(e.i/r),n.push(l.i/r),removeNode(e),e=l.next,o=l.next;else if((e=l)===o){a?1===a?earcutLinked(e=cureLocalIntersections(filterPoints(e),n,r),n,r,t,i,x,2):2===a&&splitEarcut(e,n,r,t,i,x):earcutLinked(filterPoints(e),n,r,t,i,x,1);break}}}function isEar(e){var n=e.prev,r=e,t=e.next;if(0<=area(n,r,t))return!1;for(var i=e.next.next;i!==e.prev;){if(pointInTriangle(n.x,n.y,r.x,r.y,t.x,t.y,i.x,i.y)&&0<=area(i.prev,i,i.next))return!1;i=i.next}return!0}function isEarHashed(e,n,r,t){var i=e.prev,x=e,a=e.next;if(0<=area(i,x,a))return!1;for(var o=(i.x<x.x?i.x<a.x?i:a:x.x<a.x?x:a).x,u=(i.y<x.y?i.y<a.y?i:a:x.y<a.y?x:a).y,l=(i.x>x.x?i.x>a.x?i:a:x.x>a.x?x:a).x,s=(i.y>x.y?i.y>a.y?i:a:x.y>a.y?x:a).y,v=zOrder(o,u,n,r,t),f=zOrder(l,s,n,r,t),y=e.prevZ,p=e.nextZ;y&&y.z>=v&&p&&p.z<=f;){if(y!==e.prev&&y!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,y.x,y.y)&&0<=area(y.prev,y,y.next))return!1;if(y=y.prevZ,p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.nextZ}for(;y&&y.z>=v;){if(y!==e.prev&&y!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,y.x,y.y)&&0<=area(y.prev,y,y.next))return!1;y=y.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&pointInTriangle(i.x,i.y,x.x,x.y,a.x,a.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.nextZ}return!0}function cureLocalIntersections(e,n,r){var t=e;do{var i=t.prev,x=t.next.next}while(!equals(i,x)&&intersects(i,t,t.next,x)&&locallyInside(i,x)&&locallyInside(x,i)&&(n.push(i.i/r),n.push(t.i/r),n.push(x.i/r),removeNode(t),removeNode(t.next),t=e=x),(t=t.next)!==e);return filterPoints(t)}function splitEarcut(e,n,r,t,i,x){var a=e;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&isValidDiagonal(a,o)){var u=splitPolygon(a,o),a=filterPoints(a,a.next),u=filterPoints(u,u.next);return earcutLinked(a,n,r,t,i,x),void earcutLinked(u,n,r,t,i,x)}o=o.next}}while((a=a.next)!==e)}function eliminateHoles(e,n,r,t){for(var i=[],x,a,o,u,l,x=0,a=n.length;x<a;x++)(l=linkedList(e,o=n[x]*t,u=x<a-1?n[x+1]*t:e.length,t,!1))===l.next&&(l.steiner=!0),i.push(getLeftmost(l));for(i.sort(compareX),x=0;x<i.length;x++)r=filterPoints(r=eliminateHole(i[x],r),r.next);return r}function compareX(e,n){return e.x-n.x}function eliminateHole(e,n){var r=findHoleBridge(e,n);if(!r)return n;var t=splitPolygon(r,e),e=filterPoints(r,r.next);return filterPoints(t,t.next),n===r?e:n}function findHoleBridge(e,n){var r=n,t=e.x,i=e.y,x=-1/0,a;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var o=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=t&&x<o){if((x=o)===t){if(i===r.y)return r;if(i===r.next.y)return r.next}a=r.x<r.next.x?r:r.next}}}while((r=r.next)!==n);if(!a)return null;if(t===x)return a;for(var u=a,l=a.x,s=a.y,v=1/0,f,r=a;t>=r.x&&r.x>=l&&t!==r.x&&pointInTriangle(i<s?t:x,i,l,s,i<s?x:t,i,r.x,r.y)&&(f=Math.abs(i-r.y)/(t-r.x),locallyInside(r,e)&&(f<v||f===v&&(r.x>a.x||r.x===a.x&&sectorContainsSector(a,r)))&&(a=r,v=f)),(r=r.next)!==u;);return a}function sectorContainsSector(e,n){return area(e.prev,e,n.prev)<0&&area(n.next,e,e.next)<0}function indexCurve(e,n,r,t){for(var i=e;null===i.z&&(i.z=zOrder(i.x,i.y,n,r,t)),i.prevZ=i.prev,i.nextZ=i.next,(i=i.next)!==e;);i.prevZ.nextZ=null,i.prevZ=null,sortLinked(i)}function sortLinked(e){var n,r,t,i,x,a,o,u,l=1;do{for(r=e,x=e=null,a=0;r;){for(a++,t=r,n=o=0;n<l&&(o++,t=t.nextZ);n++);for(u=l;0<o||0<u&&t;)0!==o&&(0===u||!t||r.z<=t.z)?(r=(i=r).nextZ,o--):(t=(i=t).nextZ,u--),x?x.nextZ=i:e=i,i.prevZ=x,x=i;r=t}}while(x.nextZ=null,l*=2,1<a);return e}function zOrder(e,n,r,t,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-t)*i)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function getLeftmost(e){for(var n=e,r=e;(n.x<r.x||n.x===r.x&&n.y<r.y)&&(r=n),(n=n.next)!==e;);return r}function pointInTriangle(e,n,r,t,i,x,a,o){return 0<=(i-a)*(n-o)-(e-a)*(x-o)&&0<=(e-a)*(t-o)-(r-a)*(n-o)&&0<=(r-a)*(x-o)-(i-a)*(t-o)}function isValidDiagonal(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!intersectsPolygon(e,n)&&(locallyInside(e,n)&&locallyInside(n,e)&&middleInside(e,n)&&(area(e.prev,e,n.prev)||area(e,n.prev,n))||equals(e,n)&&0<area(e.prev,e,e.next)&&0<area(n.prev,n,n.next))}function area(e,n,r){return(n.y-e.y)*(r.x-n.x)-(n.x-e.x)*(r.y-n.y)}function equals(e,n){return e.x===n.x&&e.y===n.y}function intersects(e,n,r,t){var i=sign(area(e,n,r)),x=sign(area(e,n,t)),a=sign(area(r,t,e)),o=sign(area(r,t,n));return i!==x&&a!==o||(!(0!==i||!onSegment(e,r,n))||(!(0!==x||!onSegment(e,t,n))||(!(0!==a||!onSegment(r,e,t))||!(0!==o||!onSegment(r,n,t)))))}function onSegment(e,n,r){return n.x<=Math.max(e.x,r.x)&&n.x>=Math.min(e.x,r.x)&&n.y<=Math.max(e.y,r.y)&&n.y>=Math.min(e.y,r.y)}function sign(e){return 0<e?1:e<0?-1:0}function intersectsPolygon(e,n){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==n.i&&r.next.i!==n.i&&intersects(r,r.next,e,n))return!0}while((r=r.next)!==e);return!1}function locallyInside(e,n){return area(e.prev,e,e.next)<0?0<=area(e,n,e.next)&&0<=area(e,e.prev,n):area(e,n,e.prev)<0||area(e,e.next,n)<0}function middleInside(e,n){for(var r=e,t=!1,i=(e.x+n.x)/2,x=(e.y+n.y)/2;r.y>x!=r.next.y>x&&r.next.y!==r.y&&i<(r.next.x-r.x)*(x-r.y)/(r.next.y-r.y)+r.x&&(t=!t),(r=r.next)!==e;);return t}function splitPolygon(e,n){var r=new Node(e.i,e.x,e.y),t=new Node(n.i,n.x,n.y),i=e.next,x=n.prev;return(e.next=n).prev=e,(r.next=i).prev=r,(t.next=r).prev=t,(x.next=t).prev=x,t}function insertNode(e,n,r,t){var r=new Node(e,n,r);return t?(r.next=t.next,(r.prev=t).next.prev=r,t.next=r):(r.prev=r).next=r,r}function removeNode(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Node(e,n,r){this.i=e,this.x=n,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(e,n,r,t){for(var i=0,x=n,a=r-t;x<r;x+=t)i+=(e[a]-e[x])*(e[x+1]+e[a+1]),a=x;return i}module.exports=earcut,(module.exports.default=earcut).deviation=function(e,n,r,t){var i=n&&n.length,x=i?n[0]*r:e.length,a=Math.abs(signedArea(e,0,x,r));if(i)for(var o=0,u=n.length;o<u;o++){var l=n[o]*r,s=o<u-1?n[o+1]*r:e.length;a-=Math.abs(signedArea(e,l,s,r))}for(var v=0,o=0;o<t.length;o+=3){var f=t[o]*r,y=t[o+1]*r,p=t[o+2]*r;v+=Math.abs((e[f]-e[p])*(e[1+y]-e[1+f])-(e[f]-e[y])*(e[1+p]-e[1+f]))}return 0===a&&0===v?0:Math.abs((v-a)/a)},earcut.flatten=function(e){for(var n=e[0][0].length,r={vertices:[],holes:[],dimensions:n},t=0,i=0;i<e.length;i++){for(var x=0;x<e[i].length;x++)for(var a=0;a<n;a++)r.vertices.push(e[i][x][a]);0<i&&(t+=e[i-1].length,r.holes.push(t))}return r};!function(t){var e,e;"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):(e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=t()}(function(){var t,e,r;return function n(i,s,a){function o(r,t){if(!s[r]){if(!i[r]){var e="function"==typeof require&&require;if(!t&&e)return e(r,!0);if(h)return h(r,!0);var e=new Error("Cannot find module '"+r+"'");throw e.code="MODULE_NOT_FOUND",e}var e=s[r]={exports:{}};i[r][0].call(e.exports,function(t){var e=i[r][1][t];return o(e||t)},e,e.exports,n,i,s,a)}return s[r].exports}for(var h="function"==typeof require&&require,t=0;t<a.length;t++)o(a[t]);return o}({1:[function(t,e,r){"use strict";var d=t("./utils"),c=t("./support"),p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";r.encode=function(t){for(var e=[],r,n,i,s,a,o,i,h=0,u=t.length,l=u,f="string"!==d.getTypeOf(t);h<t.length;)l=u-h,i=f?(r=t[h++],n=h<u?t[h++]:0,h<u?t[h++]:0):(r=t.charCodeAt(h++),n=h<u?t.charCodeAt(h++):0,h<u?t.charCodeAt(h++):0),a=(3&r)<<4|n>>4,o=1<l?(15&n)<<2|i>>6:64,i=2<l?63&i:64,e.push(p.charAt(s=r>>2)+p.charAt(a)+p.charAt(o)+p.charAt(i));return e.join("")},r.decode=function(t){var e,r,n,i,s,a,o,h=0,u=0,l="data:";if(t.substr(0,l.length)===l)throw new Error("Invalid base64 input, it looks like a data url.");var l=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4,f;if(t.charAt(t.length-1)===p.charAt(64)&&l--,t.charAt(t.length-2)===p.charAt(64)&&l--,l%1!=0)throw new Error("Invalid base64 input, bad content length.");for(f=new(c.uint8array?Uint8Array:Array)(0|l);h<t.length;)i=p.indexOf(t.charAt(h++)),r=(15&(s=p.indexOf(t.charAt(h++))))<<4|(a=p.indexOf(t.charAt(h++)))>>2,n=(3&a)<<6|(o=p.indexOf(t.charAt(h++))),f[u++]=e=i<<2|s>>4,64!==a&&(f[u++]=r),64!==o&&(f[u++]=n);return f}},{"./support":30,"./utils":32}],2:[function(t,e,r){"use strict";var n=t("./external"),i=t("./stream/DataWorker"),s=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function o(t,e,r,n,i){this.compressedSize=t,this.uncompressedSize=e,this.crc32=r,this.compression=n,this.compressedContent=i}o.prototype={getContentWorker:function(){var t=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},o.createWorkerFrom=function(t,e,r){return t.pipe(new s).pipe(new a("uncompressedSize")).pipe(e.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression",e)},e.exports=o},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,r){"use strict";var n=t("./stream/GenericWorker");r.STORE={magic:"\0\0",compressWorker:function(t){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},r.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,r){"use strict";var i=t("./utils");function n(){for(var t,e=[],r=0;r<256;r++){for(var t=r,n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}var o=n();function s(t,e,r,n){var i=o,s=n+r;t^=-1;for(var a=n;a<s;a++)t=t>>>8^i[255&(t^e[a])];return-1^t}function a(t,e,r,n){var i=o,s=n+r;t^=-1;for(var a=n;a<s;a++)t=t>>>8^i[255&(t^e.charCodeAt(a))];return-1^t}e.exports=function t(e,r){return void 0!==e&&e.length?("string"!==i.getTypeOf(e)?s:a)(0|r,e,e.length,0):0;var n}},{"./utils":32}],5:[function(t,e,r){"use strict";r.base64=!1,r.binary=!1,r.dir=!1,r.createFolders=!0,r.date=null,r.compression=null,r.compressionOptions=null,r.comment=null,r.unixPermissions=null,r.dosPermissions=null},{}],6:[function(t,e,r){"use strict";var n=null,n="undefined"!=typeof Promise?Promise:t("lie");e.exports={Promise:n}},{lie:37}],7:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=t("pako"),s=t("./utils"),a=t("./stream/GenericWorker"),o=n?"uint8array":"array";function h(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}r.magic="\b\0",s.inherits(h,a),h.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(o,t.data),!1)},h.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},h.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},h.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},r.compressWorker=function(t){return new h("Deflate",t)},r.uncompressWorker=function(){return new h("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,r){"use strict";var k=t("../utils"),i=t("../stream/GenericWorker"),x=t("../utf8"),S=t("../crc32"),z=t("../signature"),C=function(t,e){for(var r="",n,n=0;n<e;n++)r+=String.fromCharCode(255&t),t>>>=8;return r},E=function(t,e){var r;return(65535&(t?t:e?16893:33204))<<16},A=function(t,e){return 63&(t||0)},n=function(t,e,r,n,i,s){var a=t.file,o=t.compression,h=s!==x.utf8encode,u=k.transformTo("string",s(a.name)),l=k.transformTo("string",x.utf8encode(a.name)),f=a.comment,d=k.transformTo("string",s(f)),c=k.transformTo("string",x.utf8encode(f)),p=l.length!==a.name.length,m=c.length!==f.length,a,_,g="",b="",v="",_=a.dir,s=a.date,f={crc32:0,compressedSize:0,uncompressedSize:0};e&&!r||(f.crc32=t.crc32,f.compressedSize=t.compressedSize,f.uncompressedSize=t.uncompressedSize);var t=0;e&&(t|=8),h||!p&&!m||(t|=2048);var e=0,h=0;_&&(e|=16),"UNIX"===i?(h=798,e|=E(a.unixPermissions,_)):(h=20,e|=A(a.dosPermissions,_)),a=s.getUTCHours(),a<<=6,a|=s.getUTCMinutes(),a<<=5,a|=s.getUTCSeconds()/2,_=s.getUTCFullYear()-1980,_<<=4,_|=s.getUTCMonth()+1,_<<=5,_|=s.getUTCDate(),p&&(b=C(1,1)+C(S(u),4)+l,g+="up"+C(b.length,2)+b),m&&(v=C(1,1)+C(S(d),4)+c,g+="uc"+C(v.length,2)+v);var v="",y,w;return v+="\n\0",v+=C(t,2),v+=o.magic,v+=C(a,2),v+=C(_,2),v+=C(f.crc32,4),v+=C(f.compressedSize,4),v+=C(f.uncompressedSize,4),v+=C(u.length,2),v+=C(g.length,2),{fileRecord:z.LOCAL_FILE_HEADER+v+u+g,dirRecord:z.CENTRAL_FILE_HEADER+C(h,2)+v+C(d.length,2)+"\0\0\0\0"+C(e,4)+C(n,4)+u+g+d}},s=function(t,e,r,n,i){var s="",n=k.transformTo("string",i(n)),s;return z.CENTRAL_DIRECTORY_END+"\0\0\0\0"+C(t,2)+C(t,2)+C(e,4)+C(r,4)+C(n.length,2)+n},a=function(t){var e="",e;return z.DATA_DESCRIPTOR+C(t.crc32,4)+C(t.compressedSize,4)+C(t.uncompressedSize,4)};function o(t,e,r,n){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}k.inherits(o,i),o.prototype.push=function(t){var e=t.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,i.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:r?(e+100*(r-n-1))/r:100}}))},o.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir,e;e?(e=n(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName),this.push({data:e.fileRecord,meta:{percent:0}})):this.accumulate=!0},o.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,r=n(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),e)this.push({data:a(t),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},o.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var r=this.bytesWritten-t,t=s(this.dirRecords.length,r,t,this.zipComment,this.encodeFileName);this.push({data:t,meta:{percent:100}})},o.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},o.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},o.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},o.prototype.error=function(t){var e=this._sources;if(!i.prototype.error.call(this,t))return!1;for(var r=0;r<e.length;r++)try{e[r].error(t)}catch(t){}return!0},o.prototype.lock=function(){i.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},e.exports=o},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,r){"use strict";var n=t("../compressions"),i=t("./ZipFileWorker"),u=function(t,e){var t=t||e,e=n[t];if(!e)throw new Error(t+" is not a valid compression method !");return e};r.generateWorker=function(t,a,e){var o=new i(a.streamFiles,e,a.platform,a.encodeFileName),h=0;try{t.forEach(function(t,e){h++;var r=u(e.options.compression,a.compression),n=e.options.compressionOptions||a.compressionOptions||{},i=e.dir,s=e.date;e._compressWorker(r,n).withStreamInfo("file",{name:t,dir:i,date:s,comment:e.comment||"",unixPermissions:e.unixPermissions,dosPermissions:e.dosPermissions}).pipe(o)}),o.entriesCount=h}catch(t){o.error(t)}return o}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,r){"use strict";function n(){if(!(this instanceof n))return new n;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var t=new n,e;for(e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}(n.prototype=t("./object")).loadAsync=t("./load"),n.support=t("./support"),n.defaults=t("./defaults"),n.version="3.7.1",n.loadAsync=function(t,e){return(new n).loadAsync(t,e)},n.external=t("./external"),e.exports=n},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,r){"use strict";var n=t("./utils"),o=t("./external"),i=t("./utf8"),h=t("./zipEntries"),s=t("./stream/Crc32Probe"),u=t("./nodejsUtils");function l(n){return new o.Promise(function(t,e){var r=n.decompressed.getContentWorker().pipe(new s);r.on("error",function(t){e(t)}).on("end",function(){r.streamInfo.crc32!==n.decompressed.crc32?e(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}e.exports=function(t,s){var a=this;return s=n.extend(s||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:i.utf8decode}),u.isNode&&u.isStream(t)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",t,!0,s.optimizedBinaryString,s.base64).then(function(t){var e=new h(s);return e.load(t),e}).then(function t(e){var r=[o.Promise.resolve(e)],n=e.files;if(s.checkCRC32)for(var i=0;i<n.length;i++)r.push(l(n[i]));return o.Promise.all(r)}).then(function t(e){for(var e=e.shift(),r=e.files,n=0;n<r.length;n++){var i=r[n];a.file(i.fileNameStr,i.decompressed,{binary:!0,optimizedBinaryString:!0,date:i.date,dir:i.dir,comment:i.fileCommentStr.length?i.fileCommentStr:null,unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions,createFolders:s.createFolders})}return e.zipComment.length&&(a.comment=e.zipComment),a})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,r){"use strict";var n=t("../utils"),i=t("../stream/GenericWorker");function s(t,e){i.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}n.inherits(s,i),s.prototype._bindStream=function(t){var e=this;(this._stream=t).pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},s.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,r){"use strict";var i=t("readable-stream").Readable,n;function s(t,e,r){i.call(this,e),this._helper=t;var n=this;t.on("data",function(t,e){n.push(t)||n._helper.pause(),r&&r(e)}).on("error",function(t){n.emit("error",t)}).on("end",function(){n.push(null)})}t("../utils").inherits(s,i),s.prototype._read=function(){this._helper.resume()},e.exports=s},{"../utils":32,"readable-stream":16}],14:[function(t,e,r){"use strict";e.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(t,e){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(t,e);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new Buffer(t,e)},allocBuffer:function(t){if(Buffer.alloc)return Buffer.alloc(t);var t=new Buffer(t);return t.fill(0),t},isBuffer:function(t){return Buffer.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}},{}],15:[function(t,e,r){"use strict";var i=t("./utf8"),o=t("./utils"),h=t("./stream/GenericWorker"),s=t("./stream/StreamHelper"),u=t("./defaults"),l=t("./compressedObject"),f=t("./zipObject"),a=t("./generate"),d=t("./nodejsUtils"),c=t("./nodejs/NodejsStreamInputAdapter"),p=function(t,e,r){var n=o.getTypeOf(e),i,s=o.extend(r||{},u);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(t=_(t)),s.createFolders&&(i=m(t))&&g.call(this,i,!0);var n="string"===n&&!1===s.binary&&!1===s.base64,a;r&&void 0!==r.binary||(s.binary=!n),(e instanceof l&&0===e.uncompressedSize||s.dir||!e||0===e.length)&&(s.base64=!1,s.binary=!0,e="",s.compression="STORE");var n=null,n=e instanceof l||e instanceof h?e:d.isNode&&d.isStream(e)?new c(t,e):o.prepareContent(t,e,s.binary,s.optimizedBinaryString,s.base64),s=new f(t,n,s);this.files[t]=s},m=function(t){var e=(t="/"===t.slice(-1)?t.substring(0,t.length-1):t).lastIndexOf("/");return 0<e?t.substring(0,e):""},_=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},g=function(t,e){return e=void 0!==e?e:u.createFolders,t=_(t),this.files[t]||p.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]},n;function b(t){return"[object RegExp]"===Object.prototype.toString.call(t)}e.exports={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,r,n;for(e in this.files)n=this.files[e],(r=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(r,n)},filter:function(r){var n=[];return this.forEach(function(t,e){r(t,e)&&n.push(e)}),n},file:function(t,e,r){if(1!==arguments.length)return t=this.root+t,p.call(this,t,e,r),this;if(b(t)){var n=t;return this.filter(function(t,e){return!e.dir&&n.test(t)})}var t=this.files[this.root+t];return t&&!t.dir?t:null},folder:function(r){if(!r)return this;if(b(r))return this.filter(function(t,e){return e.dir&&r.test(t)});var t=this.root+r,e=g.call(this,t),t=this.clone();return t.root=e.name,t},remove:function(r){r=this.root+r;var t=this.files[r];if(t||("/"!==r.slice(-1)&&(r+="/"),t=this.files[r]),t&&!t.dir)delete this.files[r];else for(var e=this.filter(function(t,e){return e.name.slice(0,r.length)===r}),n=0;n<e.length;n++)delete this.files[e[n].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,r={};try{if((r=o.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:i.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");o.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var n=r.comment||this.comment||"",e=a.generateWorker(this,r,n)}catch(t){(e=new h("error")).error(t)}return new s(e,r.type||"string",r.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}}},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,r){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,r){"use strict";var n=t("./DataReader"),i;function s(t){n.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}t("../utils").inherits(s,n),s.prototype.byteAt=function(t){return this.data[this.zero+t]},s.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2),i=t.charCodeAt(3),s=this.length-4;0<=s;--s)if(this.data[s]===e&&this.data[s+1]===r&&this.data[s+2]===n&&this.data[s+3]===i)return s-this.zero;return-1},s.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2),i=t.charCodeAt(3),t=this.readData(4);return e===t[0]&&r===t[1]&&n===t[2]&&i===t[3]},s.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./DataReader":18}],18:[function(t,e,r){"use strict";var n=t("../utils");function i(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}i.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e=0,r;for(this.checkOffset(t),r=this.index+t-1;r>=this.index;r--)e=(e<<8)+this.byteAt(r);return this.index+=t,e},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},e.exports=i},{"../utils":32}],19:[function(t,e,r){"use strict";var n=t("./Uint8ArrayReader"),i;function s(t){n.call(this,t)}t("../utils").inherits(s,n),s.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,r){"use strict";var n=t("./DataReader"),i;function s(t){n.call(this,t)}t("../utils").inherits(s,n),s.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},s.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},s.prototype.readAndCheckSignature=function(t){var e;return t===this.readData(4)},s.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./DataReader":18}],21:[function(t,e,r){"use strict";var n=t("./ArrayReader"),i;function s(t){n.call(this,t)}t("../utils").inherits(s,n),s.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},e.exports=s},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,r){"use strict";var n=t("../utils"),i=t("../support"),s=t("./ArrayReader"),a=t("./StringReader"),o=t("./NodeBufferReader"),h=t("./Uint8ArrayReader");e.exports=function(t){var e=n.getTypeOf(t);return n.checkSupport(e),"string"!==e||i.uint8array?"nodebuffer"===e?new o(t):i.uint8array?new h(n.transformTo("uint8array",t)):new s(n.transformTo("array",t)):new a(t)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,r){"use strict";r.LOCAL_FILE_HEADER="PK",r.CENTRAL_FILE_HEADER="PK",r.CENTRAL_DIRECTORY_END="PK",r.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",r.ZIP64_CENTRAL_DIRECTORY_END="PK",r.DATA_DESCRIPTOR="PK\b"},{}],24:[function(t,e,r){"use strict";var n=t("./GenericWorker"),i=t("../utils");function s(t){n.call(this,"ConvertWorker to "+t),this.destType=t}i.inherits(s,n),s.prototype.processChunk=function(t){this.push({data:i.transformTo(this.destType,t.data),meta:t.meta})},e.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,r){"use strict";var n=t("./GenericWorker"),i=t("../crc32"),s;function a(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,n),a.prototype.processChunk=function(t){this.streamInfo.crc32=i(t.data,this.streamInfo.crc32||0),this.push(t)},e.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,r){"use strict";var n=t("../utils"),i=t("./GenericWorker");function s(t){i.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}n.inherits(s,i),s.prototype.processChunk=function(t){var e;t&&(e=this.streamInfo[this.propName]||0,this.streamInfo[this.propName]=e+t.data.length),i.prototype.processChunk.call(this,t)},e.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,r){"use strict";var n=t("../utils"),i=t("./GenericWorker"),s=16384;function a(t){i.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=n.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}n.inherits(a,i),a.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t,e=null,r=Math.min(this.max,this.index+s);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,r);break;case"uint8array":e=this.data.subarray(this.index,r);break;case"array":case"nodebuffer":e=this.data.slice(this.index,r)}return this.index=r,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,r){"use strict";function n(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}n.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var t=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},e.exports=n},{}],29:[function(t,e,r){"use strict";var i=t("../utils"),s=t("./ConvertWorker"),a=t("./GenericWorker"),n=t("../base64"),o=t("../support"),h=t("../external"),u=null;if(o.nodestream)try{u=t("../nodejs/NodejsStreamOutputAdapter")}catch(t){}function l(t,e,r){switch(t){case"blob":return i.newBlob(i.transformTo("arraybuffer",e),r);case"base64":return n.encode(e);default:return i.transformTo(t,e)}}function f(t,e){for(var r,n=0,i=null,s=0,r=0;r<e.length;r++)s+=e[r].length;switch(t){case"string":return e.join("");case"array":return Array.prototype.concat.apply([],e);case"uint8array":for(i=new Uint8Array(s),r=0;r<e.length;r++)i.set(e[r],n),n+=e[r].length;return i;case"nodebuffer":return Buffer.concat(e);default:throw new Error("concat : unsupported type '"+t+"'")}}function d(t,o){return new h.Promise(function(e,r){var n=[],i=t._internalType,s=t._outputType,a=t._mimeType;t.on("data",function(t,e){n.push(t),o&&o(e)}).on("error",function(t){n=[],r(t)}).on("end",function(){try{var t=l(s,f(i,n),a);e(t)}catch(t){r(t)}n=[]}).resume()})}function c(t,e,r){var n=e;switch(e){case"blob":case"arraybuffer":n="uint8array";break;case"base64":n="string"}try{this._internalType=n,this._outputType=e,this._mimeType=r,i.checkSupport(n),this._worker=t.pipe(new s(n)),t.lock()}catch(t){this._worker=new a("error"),this._worker.error(t)}}c.prototype={accumulate:function(t){return d(this,t)},on:function(t,e){var r=this;return"data"===t?this._worker.on(t,function(t){e.call(r,t.data,t.meta)}):this._worker.on(t,function(){i.delay(e,arguments,r)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(i.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},t)}},e.exports=c},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,r){"use strict";if(r.base64=!0,r.array=!0,r.string=!0,r.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,r.nodebuffer="undefined"!=typeof Buffer,r.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)r.blob=!1;else{var n=new ArrayBuffer(0);try{r.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var i,s=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);s.append(n),r.blob=0===s.getBlob("application/zip").size}catch(t){r.blob=!1}}}try{r.nodestream=!!t("readable-stream").Readable}catch(t){r.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,i){"use strict";for(var h=t("./utils"),u=t("./support"),r=t("./nodejsUtils"),n=t("./stream/GenericWorker"),l=new Array(256),s=0;s<256;s++)l[s]=252<=s?6:248<=s?5:240<=s?4:224<=s?3:192<=s?2:1;l[254]=l[254]=1;var a=function(t){for(var e,r,n,i,s,a=t.length,o=0,i=0;i<a;i++)55296==(64512&(r=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=t.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(e=new(u.uint8array?Uint8Array:Array)(o),i=s=0;s<o;i++)55296==(64512&(r=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=t.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?e[s++]=r:(r<2048?e[s++]=192|r>>>6:(r<65536?e[s++]=224|r>>>12:(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63),e[s++]=128|r>>>6&63),e[s++]=128|63&r);return e},o=function(t,e){for(var r,r=(e=(e=e||t.length)>t.length?t.length:e)-1;0<=r&&128==(192&t[r]);)r--;return!(r<0)&&0!==r&&r+l[t[r]]>e?r:e},f=function(t){for(var e,r,n,i,s,a=t.length,o=new Array(2*a),n=0,r=0;r<a;)if((i=t[r++])<128)o[n++]=i;else if(4<(s=l[i]))o[n++]=65533,r+=s-1;else{for(i&=2===s?31:3===s?15:7;1<s&&r<a;)i=i<<6|63&t[r++],s--;1<s?o[n++]=65533:i<65536?o[n++]=i:(i-=65536,o[n++]=55296|i>>10&1023,o[n++]=56320|1023&i)}return o.length!==n&&(o.subarray?o=o.subarray(0,n):o.length=n),h.applyFromCharCode(o)};function d(){n.call(this,"utf-8 decode"),this.leftOver=null}function c(){n.call(this,"utf-8 encode")}i.utf8encode=function t(e){return u.nodebuffer?r.newBufferFrom(e,"utf-8"):a(e)},i.utf8decode=function t(e){return u.nodebuffer?h.transformTo("nodebuffer",e).toString("utf-8"):(e=h.transformTo(u.uint8array?"uint8array":"array",e),f(e))},h.inherits(d,n),d.prototype.processChunk=function(t){var e=h.transformTo(u.uint8array?"uint8array":"array",t.data),r,e;this.leftOver&&this.leftOver.length&&(u.uint8array?(r=e,(e=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),e.set(r,this.leftOver.length)):e=this.leftOver.concat(e),this.leftOver=null);var n=o(e),r=e;n!==e.length&&(u.uint8array?(r=e.subarray(0,n),this.leftOver=e.subarray(n,e.length)):(r=e.slice(0,n),this.leftOver=e.slice(n,e.length))),this.push({data:i.utf8decode(r),meta:t.meta})},d.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=d,h.inherits(c,n),c.prototype.processChunk=function(t){this.push({data:i.utf8encode(t.data),meta:t.meta})},i.Utf8EncodeWorker=c},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,a){"use strict";var o=t("./support"),h=t("./base64"),r=t("./nodejsUtils"),n=t("set-immediate-shim"),u=t("./external");function l(t){var e=null,e;return s(t,e=new(o.uint8array?Uint8Array:Array)(t.length))}function i(t){return t}function s(t,e){for(var r=0;r<t.length;++r)e[r]=255&t.charCodeAt(r);return e}a.newBlob=function(e,r){a.checkSupport("blob");try{return new Blob([e],{type:r})}catch(t){try{var n,i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return i.append(e),i.getBlob(r)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var f={stringifyByChunk:function(t,e,r){var n=[],i=0,s=t.length;if(s<=r)return String.fromCharCode.apply(null,t);for(;i<s;)"array"===e||"nodebuffer"===e?n.push(String.fromCharCode.apply(null,t.slice(i,Math.min(i+r,s)))):n.push(String.fromCharCode.apply(null,t.subarray(i,Math.min(i+r,s)))),i+=r;return n.join("")},stringifyByChar:function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&1===String.fromCharCode.apply(null,r.allocBuffer(1)).length}catch(t){return!1}}()}};function d(t){var e=65536,r=a.getTypeOf(t),n=!0;if("uint8array"===r?n=f.applyCanBeUsed.uint8array:"nodebuffer"===r&&(n=f.applyCanBeUsed.nodebuffer),n)for(;1<e;)try{return f.stringifyByChunk(t,r,e)}catch(t){e=Math.floor(e/2)}return f.stringifyByChar(t)}function c(t,e){for(var r=0;r<t.length;r++)e[r]=t[r];return e}a.applyFromCharCode=d;var p={};p.string={string:i,array:function(t){return s(t,new Array(t.length))},arraybuffer:function(t){return p.string.uint8array(t).buffer},uint8array:function(t){return s(t,new Uint8Array(t.length))},nodebuffer:function(t){return s(t,r.allocBuffer(t.length))}},p.array={string:d,array:i,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return r.newBufferFrom(t)}},p.arraybuffer={string:function(t){return d(new Uint8Array(t))},array:function(t){return c(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:i,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return r.newBufferFrom(new Uint8Array(t))}},p.uint8array={string:d,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:i,nodebuffer:function(t){return r.newBufferFrom(t)}},p.nodebuffer={string:d,array:function(t){return c(t,new Array(t.length))},arraybuffer:function(t){return p.nodebuffer.uint8array(t).buffer},uint8array:function(t){return c(t,new Uint8Array(t.length))},nodebuffer:i},a.transformTo=function(t,e){if(e=e||"",!t)return e;a.checkSupport(t);var r=a.getTypeOf(e),n;return p[r][t](e)},a.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":o.nodebuffer&&r.isBuffer(t)?"nodebuffer":o.uint8array&&t instanceof Uint8Array?"uint8array":o.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},a.checkSupport=function(t){var e;if(!o[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},a.MAX_VALUE_16BITS=65535,a.MAX_VALUE_32BITS=-1,a.pretty=function(t){for(var e="",r,n,n=0;n<(t||"").length;n++)e+="\\x"+((r=t.charCodeAt(n))<16?"0":"")+r.toString(16).toUpperCase();return e},a.delay=function(t,e,r){n(function(){t.apply(r||null,e||[])})},a.inherits=function(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r},a.extend=function(){for(var t={},e,r,e=0;e<arguments.length;e++)for(r in arguments[e])arguments[e].hasOwnProperty(r)&&void 0===t[r]&&(t[r]=arguments[e][r]);return t},a.prepareContent=function(r,t,n,i,s){var e;return u.Promise.resolve(t).then(function(n){var t;return o.blob&&(n instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(n)))&&"undefined"!=typeof FileReader?new u.Promise(function(e,r){var t=new FileReader;t.onload=function(t){e(t.target.result)},t.onerror=function(t){r(t.target.error)},t.readAsArrayBuffer(n)}):n}).then(function(t){var e=a.getTypeOf(t);return e?("arraybuffer"===e?t=a.transformTo("uint8array",t):"string"===e&&(s?t=h.decode(t):n&&!0!==i&&(t=l(t))),t):u.Promise.reject(new Error("Can't read the data of '"+r+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,r){"use strict";var n=t("./reader/readerFor"),i=t("./utils"),s=t("./signature"),a=t("./zipEntry"),o=t("./utf8"),h=t("./support");function u(t){this.files=[],this.loadOptions=t}u.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(e)+", expected "+i.pretty(t)+")")}},isSignature:function(t,e){var r=this.reader.index;this.reader.setIndex(t);var n,e=this.reader.readString(4)===e;return this.reader.setIndex(r),e},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=h.uint8array?"uint8array":"array",t=i.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(t)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t=this.zip64EndOfCentralSize-44,e=0,r,n,i;0<t;)r=this.reader.readInt(2),n=this.reader.readInt(4),i=this.reader.readData(n),this.zip64ExtensibleData[r]={id:r,length:n,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){for(var t,e,t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END),e;if(t<0)throw!this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(t);var r=t;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var t=this.centralDirOffset+this.centralDirSize;this.zip64&&(t+=20,t+=12+this.zip64EndOfCentralSize);var t=r-t;if(0<t)this.isSignature(r,s.CENTRAL_FILE_HEADER)||(this.reader.zero=t);else if(t<0)throw new Error("Corrupted zip: missing "+Math.abs(t)+" bytes.")},prepareReader:function(t){this.reader=n(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=u},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,r){"use strict";var n=t("./reader/readerFor"),i=t("./utils"),s=t("./compressedObject"),a=t("./crc32"),o=t("./utf8"),h=t("./compressions"),u=t("./support"),l=0,f=3,d=function(t){for(var e in h)if(h.hasOwnProperty(e)&&h[e].magic===t)return h[e];return null};function c(t,e){this.options=t,this.loadOptions=e}c.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,e;if(t.skip(22),this.fileNameLength=t.readInt(2),e=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(e),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=d(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0==t&&(this.dosPermissions=63&this.externalFileAttributes),3==t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){var e;this.extraFields[1]&&(e=n(this.extraFields[1].value),this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4)))},readExtraFields:function(t){var e=t.index+this.extraFieldsLength,r,n,i;for(this.extraFields||(this.extraFields={});t.index+4<e;)r=t.readInt(2),n=t.readInt(2),i=t.readData(n),this.extraFields[r]={id:r,length:n,value:i};t.setIndex(e)},handleUTF8:function(){var t=u.uint8array?"uint8array":"array",e,r,r,t;this.useUTF8()?(this.fileNameStr=o.utf8decode(this.fileName),this.fileCommentStr=o.utf8decode(this.fileComment)):(null!==(e=this.findExtraFieldUnicodePath())?this.fileNameStr=e:(r=i.transformTo(t,this.fileName),this.fileNameStr=this.loadOptions.decodeFileName(r)),null!==(r=this.findExtraFieldUnicodeComment())?this.fileCommentStr=r:(t=i.transformTo(t,this.fileComment),this.fileCommentStr=this.loadOptions.decodeFileName(t)))},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:a(this.fileName)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:a(this.fileComment)!==e.readInt(4)?null:o.utf8decode(e.readData(t.length-5))}return null}},e.exports=c},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,r){"use strict";var s=t("./stream/StreamHelper"),n=t("./stream/DataWorker"),a=t("./utf8"),i=t("./compressedObject"),o=t("./stream/GenericWorker"),h=function(t,e,r){this.name=t,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=e,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}};h.prototype={internalStream:function(t){var e=null,r="string";try{if(!t)throw new Error("No output type specified.");var r,n="string"===(r=t.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string");var e=this._decompressWorker(),i=!this._dataBinary;i&&!n&&(e=e.pipe(new a.Utf8EncodeWorker)),!i&&n&&(e=e.pipe(new a.Utf8DecodeWorker))}catch(t){(e=new o("error")).error(t)}return new s(e,r,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof i&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),i.createWorkerFrom(r,t,e)},_decompressWorker:function(){return this._data instanceof i?this._data.getContentWorker():this._data instanceof o?this._data:new n(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},f=0;f<u.length;f++)h.prototype[u[f]]=l;e.exports=h},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,l,e){!function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver,r,n,t,i,s,r=t?(n=0,t=new t(h),i=e.document.createTextNode(""),t.observe(i,{characterData:!0}),function(){i.data=n=++n%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){h(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(h,0)}:((s=new e.MessageChannel).port1.onmessage=h,function(){s.port2.postMessage(0)}),a,o=[];function h(){var t,e;a=!0;for(var r=o.length;r;){for(e=o,o=[],t=-1;++t<r;)e[t]();r=o.length}a=!1}function u(t){1!==o.push(t)||a||r()}l.exports=u}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],37:[function(t,e,r){"use strict";var i=t("immediate");function u(){}var l={},s=["REJECTED"],a=["FULFILLED"],o=["PENDING"];function n(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=o,this.queue=[],this.outcome=void 0,t!==u&&c(this,t)}function h(t,e,r){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function f(e,r,n){i(function(){var t;try{t=r(n)}catch(t){return l.reject(e,t)}t===e?l.reject(e,new TypeError("Cannot resolve promise with itself")):l.resolve(e,t)})}function d(e){var r=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof r)return function t(){r.apply(e,arguments)}}function c(e,t){var r=!1;function n(t){r||(r=!0,l.reject(e,t))}function i(t){r||(r=!0,l.resolve(e,t))}function s(){t(i,n)}var a=p(s);"error"===a.status&&n(a.value)}function p(t,e){var r={};try{r.value=t(e),r.status="success"}catch(t){r.status="error",r.value=t}return r}function m(t){return t instanceof this?t:l.resolve(new this(u),t)}function _(t){var e=new this(u);return l.reject(e,t)}function g(t){var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var i=t.length,s=!1;if(!i)return this.resolve([]);for(var a=new Array(i),o=0,e=-1,h=new this(u);++e<i;)r(t[e],e);return h;function r(t,e){function r(t){a[e]=t,++o!==i||s||(s=!0,l.resolve(h,a))}n.resolve(t).then(r,function(t){s||(s=!0,l.reject(h,t))})}}function b(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,n=!1;if(!r)return this.resolve([]);for(var i=-1,s=new this(u);++i<r;)a(t[i]);return s;function a(t){e.resolve(t).then(function(t){n||(n=!0,l.resolve(s,t))},function(t){n||(n=!0,l.reject(s,t))})}}(e.exports=n).prototype.finally=function(r){if("function"!=typeof r)return this;var n=this.constructor;return this.then(t,e);function t(t){function e(){return t}return n.resolve(r()).then(e)}function e(t){function e(){throw t}return n.resolve(r()).then(e)}},n.prototype.catch=function(t){return this.then(null,t)},n.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===s)return this;var r=new this.constructor(u),n;return this.state!==o?f(r,this.state===a?t:e,this.outcome):this.queue.push(new h(r,t,e)),r},h.prototype.callFulfilled=function(t){l.resolve(this.promise,t)},h.prototype.otherCallFulfilled=function(t){f(this.promise,this.onFulfilled,t)},h.prototype.callRejected=function(t){l.reject(this.promise,t)},h.prototype.otherCallRejected=function(t){f(this.promise,this.onRejected,t)},l.resolve=function(t,e){var r=p(d,e);if("error"===r.status)return l.reject(t,r.value);var r=r.value;if(r)c(t,r);else{t.state=a,t.outcome=e;for(var n=-1,i=t.queue.length;++n<i;)t.queue[n].callFulfilled(e)}return t},l.reject=function(t,e){t.state=s,t.outcome=e;for(var r=-1,n=t.queue.length;++r<n;)t.queue[r].callRejected(e);return t},n.resolve=m,n.reject=_,n.all=g,n.race=b},{immediate:36}],38:[function(t,e,r){"use strict";var n,i,s,a,o={};(0,t("./lib/utils/common").assign)(o,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=o},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,r){"use strict";var a=t("./zlib/deflate"),o=t("./utils/common"),h=t("./utils/strings"),n=t("./zlib/messages"),i=t("./zlib/zstream"),u=Object.prototype.toString,s=0,l=4,f=0,d=1,c=2,p=-1,m=0,_=8;function g(t){if(!(this instanceof g))return new g(t);this.options=o.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options,t;if(e.raw&&0<e.windowBits?e.windowBits=-e.windowBits:e.gzip&&0<e.windowBits&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,(this.strm.avail_out=0)!==(t=a.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy)))throw new Error(n[t]);if(e.header&&a.deflateSetHeader(this.strm,e.header),e.dictionary){var e,e="string"==typeof e.dictionary?h.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,t;if(0!==(t=a.deflateSetDictionary(this.strm,e)))throw new Error(n[t]);this._dict_set=!0}}function b(t,e){var e=new g(e);if(e.push(t,!0),e.err)throw e.msg||n[e.err];return e.result}function v(t,e){return(e=e||{}).raw=!0,b(t,e)}function y(t,e){return(e=e||{}).gzip=!0,b(t,e)}g.prototype.push=function(t,e){var r=this.strm,n=this.options.chunkSize,i,s;if(this.ended)return!1;s=e===~~e?e:!0===e?4:0,"string"==typeof t?r.input=h.string2buf(t):"[object ArrayBuffer]"===u.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new o.Buf8(n),r.next_out=0,r.avail_out=n),1!==(i=a.deflate(r,s))&&0!==i)return this.onEnd(i),!(this.ended=!0)}while(0!==r.avail_out&&(0!==r.avail_in||4!==s&&2!==s)||("string"===this.options.to?this.onData(h.buf2binstring(o.shrinkBuf(r.output,r.next_out))):this.onData(o.shrinkBuf(r.output,r.next_out))),(0<r.avail_in||0===r.avail_out)&&1!==i);return 4===s?(i=a.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,0===i):2!==s||(this.onEnd(0),!(r.avail_out=0))},g.prototype.onData=function(t){this.chunks.push(t)},g.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Deflate=g,r.deflate=b,r.deflateRaw=v,r.gzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,r){"use strict";var f=t("./zlib/inflate"),d=t("./utils/common"),c=t("./utils/strings"),p=t("./zlib/constants"),n=t("./zlib/messages"),i=t("./zlib/zstream"),s=t("./zlib/gzheader"),m=Object.prototype.toString;function a(t){if(!(this instanceof a))return new a(t);this.options=d.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&0<=e.windowBits&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(0<=e.windowBits&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),15<e.windowBits&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var e=f.inflateInit2(this.strm,e.windowBits);if(e!==p.Z_OK)throw new Error(n[e]);this.header=new s,f.inflateGetHeader(this.strm,this.header)}function o(t,e){var e=new a(e);if(e.push(t,!0),e.err)throw e.msg||n[e.err];return e.result}function h(t,e){return(e=e||{}).raw=!0,o(t,e)}a.prototype.push=function(t,e){var r=this.strm,n=this.options.chunkSize,i=this.options.dictionary,s,a,o,h,u,u,l=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?p.Z_FINISH:p.Z_NO_FLUSH,"string"==typeof t?r.input=c.binstring2buf(t):"[object ArrayBuffer]"===m.call(t)?r.input=new Uint8Array(t):r.input=t,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new d.Buf8(n),r.next_out=0,r.avail_out=n),(s=f.inflate(r,p.Z_NO_FLUSH))===p.Z_NEED_DICT&&i&&(u="string"==typeof i?c.string2buf(i):"[object ArrayBuffer]"===m.call(i)?new Uint8Array(i):i,s=f.inflateSetDictionary(this.strm,u)),s===p.Z_BUF_ERROR&&!0===l&&(s=p.Z_OK,l=!1),s!==p.Z_STREAM_END&&s!==p.Z_OK)return this.onEnd(s),!(this.ended=!0)}while(r.next_out&&(0!==r.avail_out&&s!==p.Z_STREAM_END&&(0!==r.avail_in||a!==p.Z_FINISH&&a!==p.Z_SYNC_FLUSH)||("string"===this.options.to?(o=c.utf8border(r.output,r.next_out),h=r.next_out-o,u=c.buf2string(r.output,o),r.next_out=h,r.avail_out=n-h,h&&d.arraySet(r.output,r.output,o,h,0),this.onData(u)):this.onData(d.shrinkBuf(r.output,r.next_out)))),0===r.avail_in&&0===r.avail_out&&(l=!0),(0<r.avail_in||0===r.avail_out)&&s!==p.Z_STREAM_END);return(a=s===p.Z_STREAM_END?p.Z_FINISH:a)===p.Z_FINISH?(s=f.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===p.Z_OK):a!==p.Z_SYNC_FLUSH||(this.onEnd(p.Z_OK),!(r.avail_out=0))},a.prototype.onData=function(t){this.chunks.push(t)},a.prototype.onEnd=function(t){t===p.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=d.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},r.Inflate=a,r.inflate=o,r.inflateRaw=h,r.ungzip=o},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)r.hasOwnProperty(n)&&(t[n]=r[n])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var s=0;s<n;s++)t[i+s]=e[r+s]},flattenChunks:function(t){for(var e,r,n,i,s,a,n=0,e=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),e=i=0,r=t.length;e<r;e++)s=t[e],a.set(s,i),i+=s.length;return a}},s={arraySet:function(t,e,r,n,i){for(var s=0;s<n;s++)t[i+s]=e[r+s]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,i)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,s))},r.setTyped(n)},{}],42:[function(t,e,r){"use strict";var h=t("./common"),i=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){s=!1}for(var u=new h.Buf8(256),n=0;n<256;n++)u[n]=252<=n?6:248<=n?5:240<=n?4:224<=n?3:192<=n?2:1;function l(t,e){if(e<65537&&(t.subarray&&s||!t.subarray&&i))return String.fromCharCode.apply(null,h.shrinkBuf(t,e));for(var r="",n=0;n<e;n++)r+=String.fromCharCode(t[n]);return r}u[254]=u[254]=1,r.string2buf=function(t){for(var e,r,n,i,s,a=t.length,o=0,i=0;i<a;i++)55296==(64512&(r=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=t.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),o+=r<128?1:r<2048?2:r<65536?3:4;for(e=new h.Buf8(o),i=s=0;s<o;i++)55296==(64512&(r=t.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=t.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?e[s++]=r:(r<2048?e[s++]=192|r>>>6:(r<65536?e[s++]=224|r>>>12:(e[s++]=240|r>>>18,e[s++]=128|r>>>12&63),e[s++]=128|r>>>6&63),e[s++]=128|63&r);return e},r.buf2binstring=function(t){return l(t,t.length)},r.binstring2buf=function(t){for(var e=new h.Buf8(t.length),r=0,n=e.length;r<n;r++)e[r]=t.charCodeAt(r);return e},r.buf2string=function(t,e){for(var r,n,i,s,a=e||t.length,o=new Array(2*a),n=0,r=0;r<a;)if((i=t[r++])<128)o[n++]=i;else if(4<(s=u[i]))o[n++]=65533,r+=s-1;else{for(i&=2===s?31:3===s?15:7;1<s&&r<a;)i=i<<6|63&t[r++],s--;1<s?o[n++]=65533:i<65536?o[n++]=i:(i-=65536,o[n++]=55296|i>>10&1023,o[n++]=56320|1023&i)}return l(o,n)},r.utf8border=function(t,e){for(var r,r=(e=(e=e||t.length)>t.length?t.length:e)-1;0<=r&&128==(192&t[r]);)r--;return!(r<0)&&0!==r&&r+u[t[r]]>e?r:e}},{"./common":41}],43:[function(t,e,r){"use strict";function n(t,e,r,n){for(var i=65535&t|0,s=t>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(i=i+e[n++]|0)|0,--a;);i%=65521,s%=65521}return i|s<<16|0}e.exports=n},{}],44:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,r){"use strict";function n(){for(var t,e=[],r=0;r<256;r++){for(var t=r,n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}var o=n();function i(t,e,r,n){var i=o,s=n+r;t^=-1;for(var a=n;a<s;a++)t=t>>>8^i[255&(t^e[a])];return-1^t}e.exports=i},{}],46:[function(t,e,r){"use strict";var l=t("../utils/common"),h=t("./trees"),f=t("./adler32"),u=t("./crc32"),n=t("./messages"),d=0,i=1,s=3,c=4,a=5,p=0,o=1,m=-2,_=-3,g=-5,b=-1,v=1,y=2,w=3,k=4,x=0,S=2,z=8,C=9,E=15,A=8,I=29,O=256,B=286,R=30,T=19,D=2*B+1,F=15,N=3,U=258,P=U+N+1,L=32,j=42,Z=69,W=73,M=91,H=103,G=113,K=666,Y=1,X=2,V=3,q=4,J=3,Q;function $(t,e){return t.msg=n[e],e}function tt(t){return(t<<1)-(4<t?9:0)}function et(t){for(var e=t.length;0<=--e;)t[e]=0}function rt(t){var e=t.state,r=e.pending;0!==(r=r>t.avail_out?t.avail_out:r)&&(l.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function nt(t,e){h._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,rt(t.strm)}function it(t,e){t.pending_buf[t.pending++]=e}function st(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function at(t,e,r,n){var i=t.avail_in;return 0===(i=n<i?n:i)?0:(t.avail_in-=i,l.arraySet(e,t.input,t.next_in,i,r),1===t.state.wrap?t.adler=f(t.adler,e,i,r):2===t.state.wrap&&(t.adler=u(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)}function ot(t,e){var r=t.max_chain_length,n=t.strstart,i,s,a=t.prev_length,o=t.nice_match,h=t.strstart>t.w_size-P?t.strstart-(t.w_size-P):0,u=t.window,l=t.w_mask,f=t.prev,d=t.strstart+U,c=u[n+a-1],p=u[n+a];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(u[(i=e)+a]===p&&u[i+a-1]===c&&u[i]===u[n]&&u[++i]===u[n+1]){for(n+=2,i++;u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&u[++n]===u[++i]&&n<d;);if(s=U-(d-n),n=d-U,a<s){if(t.match_start=e,o<=(a=s))break;c=u[n+a-1],p=u[n+a]}}}while((e=f[e&l])>h&&0!=--r);return a<=t.lookahead?a:t.lookahead}function ht(t){var e=t.w_size,r,n,i,s,a;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-P)){for(l.arraySet(t.window,t.window,e,e,0),t.match_start-=e,t.strstart-=e,t.block_start-=e,r=n=t.hash_size;i=t.head[--r],t.head[r]=e<=i?i-e:0,--n;);for(r=n=e;i=t.prev[--r],t.prev[r]=e<=i?i-e:0,--n;);s+=e}if(0===t.strm.avail_in)break;if(n=at(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=n,t.lookahead+t.insert>=N)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+N-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<N)););}while(t.lookahead<P&&0!==t.strm.avail_in)}function ut(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ht(t),0===t.lookahead&&e===d)return Y;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,nt(t,!1),0===t.strm.avail_out))return Y;if(t.strstart-t.block_start>=t.w_size-P&&(nt(t,!1),0===t.strm.avail_out))return Y}return t.insert=0,e===c?(nt(t,!0),0===t.strm.avail_out?V:q):(t.strstart>t.block_start&&(nt(t,!1),t.strm.avail_out),Y)}function lt(t,e){for(var r,n;;){if(t.lookahead<P){if(ht(t),t.lookahead<P&&e===d)return Y;if(0===t.lookahead)break}if(r=0,t.lookahead>=N&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-P&&(t.match_length=ot(t,r)),t.match_length>=N)if(n=h._tr_tally(t,t.strstart-t.match_start,t.match_length-N),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=N){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(nt(t,!1),0===t.strm.avail_out))return Y}return t.insert=t.strstart<N-1?t.strstart:N-1,e===c?(nt(t,!0),0===t.strm.avail_out?V:q):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?Y:X}function ft(t,e){for(var r,n,i;;){if(t.lookahead<P){if(ht(t),t.lookahead<P&&e===d)return Y;if(0===t.lookahead)break}if(r=0,t.lookahead>=N&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=N-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-P&&(t.match_length=ot(t,r),t.match_length<=5&&(1===t.strategy||t.match_length===N&&4096<t.strstart-t.match_start)&&(t.match_length=N-1)),t.prev_length>=N&&t.match_length<=t.prev_length){for(i=t.strstart+t.lookahead-N,n=h._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-N),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+N-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=N-1,t.strstart++,n&&(nt(t,!1),0===t.strm.avail_out))return Y}else if(t.match_available){if((n=h._tr_tally(t,0,t.window[t.strstart-1]))&&nt(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return Y}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=h._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<N-1?t.strstart:N-1,e===c?(nt(t,!0),0===t.strm.avail_out?V:q):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?Y:X}function dt(t,e){for(var r,n,i,s,a=t.window;;){if(t.lookahead<=U){if(ht(t),t.lookahead<=U&&e===d)return Y;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=N&&0<t.strstart&&(n=a[i=t.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){for(s=t.strstart+U;n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<s;);t.match_length=U-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=N?(r=h._tr_tally(t,1,t.match_length-N),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(nt(t,!1),0===t.strm.avail_out))return Y}return t.insert=0,e===c?(nt(t,!0),0===t.strm.avail_out?V:q):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?Y:X}function ct(t,e){for(var r;;){if(0===t.lookahead&&(ht(t),0===t.lookahead)){if(e===d)return Y;break}if(t.match_length=0,r=h._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(nt(t,!1),0===t.strm.avail_out))return Y}return t.insert=0,e===c?(nt(t,!0),0===t.strm.avail_out?V:q):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?Y:X}function pt(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}function mt(t){t.window_size=2*t.w_size,et(t.head),t.max_lazy_match=Q[t.level].max_lazy,t.good_match=Q[t.level].good_length,t.nice_match=Q[t.level].nice_length,t.max_chain_length=Q[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=N-1,t.match_available=0,t.ins_h=0}function _t(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=z,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new l.Buf16(2*D),this.dyn_dtree=new l.Buf16(2*(2*R+1)),this.bl_tree=new l.Buf16(2*(2*T+1)),et(this.dyn_ltree),et(this.dyn_dtree),et(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new l.Buf16(F+1),this.heap=new l.Buf16(2*B+1),et(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new l.Buf16(2*B+1),et(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function gt(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=S,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?j:G,t.adler=2===e.wrap?0:1,e.last_flush=d,h._tr_init(e),p):$(t,m)}function bt(t){var e=gt(t);return e===p&&mt(t.state),e}function vt(t,e){return!t||!t.state||2!==t.state.wrap?m:(t.state.gzhead=e,p)}function yt(t,e,r,n,i,s){if(!t)return m;var a=1;if(e===b&&(e=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),i<1||C<i||r!==z||n<8||15<n||e<0||9<e||s<0||k<s)return $(t,m);8===n&&(n=9);var o=new _t;return(t.state=o).strm=t,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+N-1)/N),o.window=new l.Buf8(2*o.w_size),o.head=new l.Buf16(o.hash_size),o.prev=new l.Buf16(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new l.Buf8(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=s,o.method=r,bt(t)}function wt(t,e){return yt(t,e,z,15,8,0)}function kt(t,e){var r,n,i,s,a,o,o;if(!t||!t.state||5<e||e<0)return t?$(t,m):m;if(n=t.state,!t.output||!t.input&&0!==t.avail_in||n.status===K&&e!==c)return $(t,0===t.avail_out?-5:m);if(n.strm=t,r=n.last_flush,n.last_flush=e,n.status===j&&(2===n.wrap?(t.adler=0,it(n,31),it(n,139),it(n,8),n.gzhead?(it(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),it(n,255&n.gzhead.time),it(n,n.gzhead.time>>8&255),it(n,n.gzhead.time>>16&255),it(n,n.gzhead.time>>24&255),it(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),it(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(it(n,255&n.gzhead.extra.length),it(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=u(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(it(n,0),it(n,0),it(n,0),it(n,0),it(n,0),it(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),it(n,3),n.status=G)):(a=z+(n.w_bits-8<<4)<<8,o=-1,a|=(o=2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=G,st(n,a),0!==n.strstart&&(st(n,t.adler>>>16),st(n,65535&t.adler)),t.adler=1)),69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(t.adler=u(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending!==n.pending_buf_size));)it(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(t.adler=u(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=u(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}}while(s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,it(n,s),0!==s);n.gzhead.hcrc&&n.pending>i&&(t.adler=u(t.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=u(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}}while(s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,it(n,s),0!==s);n.gzhead.hcrc&&n.pending>i&&(t.adler=u(t.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.status=H)}else n.status=H;if(n.status===H&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&rt(t),n.pending+2<=n.pending_buf_size&&(it(n,255&t.adler),it(n,t.adler>>8&255),t.adler=0,n.status=G)):n.status=G),0!==n.pending){if(rt(t),0===t.avail_out)return n.last_flush=-1,p}else if(0===t.avail_in&&tt(e)<=tt(r)&&e!==c)return $(t,-5);if(n.status===K&&0!==t.avail_in)return $(t,-5);if(0!==t.avail_in||0!==n.lookahead||e!==d&&n.status!==K){var r=2===n.strategy?ct(n,e):3===n.strategy?dt(n,e):Q[n.level].func(n,e);if(r!==V&&r!==q||(n.status=K),r===Y||r===V)return 0===t.avail_out&&(n.last_flush=-1),p;if(r===X&&(1===e?h._tr_align(n):5!==e&&(h._tr_stored_block(n,0,0,!1),3===e&&(et(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),rt(t),0===t.avail_out))return n.last_flush=-1,p}return e!==c?p:n.wrap<=0?1:(2===n.wrap?(it(n,255&t.adler),it(n,t.adler>>8&255),it(n,t.adler>>16&255),it(n,t.adler>>24&255),it(n,255&t.total_in),it(n,t.total_in>>8&255),it(n,t.total_in>>16&255),it(n,t.total_in>>24&255)):(st(n,t.adler>>>16),st(n,65535&t.adler)),rt(t),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?p:1)}function xt(t){var e;return t&&t.state?(e=t.state.status)!==j&&69!==e&&73!==e&&91!==e&&e!==H&&e!==G&&e!==K?$(t,m):(t.state=null,e===G?$(t,-3):p):m}function St(t,e){var r=e.length,n,i,s,a,o,h,u,u;if(!t||!t.state)return m;if(2===(a=(n=t.state).wrap)||1===a&&n.status!==j||n.lookahead)return m;for(1===a&&(t.adler=f(t.adler,e,r,0)),n.wrap=0,r>=n.w_size&&(0===a&&(et(n.head),n.strstart=0,n.block_start=0,n.insert=0),u=new l.Buf8(n.w_size),l.arraySet(u,e,r-n.w_size,n.w_size,0),e=u,r=n.w_size),o=t.avail_in,h=t.next_in,u=t.input,t.avail_in=r,t.next_in=0,t.input=e,ht(n);n.lookahead>=N;){for(i=n.strstart,s=n.lookahead-(N-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+N-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--s;);n.strstart=i,n.lookahead=N-1,ht(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=N-1,n.match_available=0,t.next_in=h,t.input=u,t.avail_in=o,n.wrap=a,p}Q=[new pt(0,0,0,0,ut),new pt(4,4,8,4,lt),new pt(4,5,16,8,lt),new pt(4,6,32,32,lt),new pt(4,4,16,16,ft),new pt(8,16,32,32,ft),new pt(8,16,128,128,ft),new pt(8,32,128,256,ft),new pt(32,128,258,1024,ft),new pt(32,258,258,4096,ft)],r.deflateInit=wt,r.deflateInit2=yt,r.deflateReset=bt,r.deflateResetKeep=gt,r.deflateSetHeader=vt,r.deflate=kt,r.deflateEnd=xt,r.deflateSetDictionary=St,r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,r){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}e.exports=n},{}],48:[function(t,e,r){"use strict";var n=30,i=12;e.exports=function t(e,r){var n,i,s,a,o,h,u,l,f,d,c,p,m,_,g,b,v,y,w,k,x,S,z,C,E,n=e.state,i=e.next_in,C=e.input,s=i+(e.avail_in-5),a=e.next_out,E=e.output,o=a-(r-e.avail_out),h=a+(e.avail_out-257),u=n.dmax,l=n.wsize,f=n.whave,d=n.wnext,c=n.window,p=n.hold,m=n.bits,_=n.lencode,g=n.distcode,b=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;t:do{m<15&&(p+=C[i++]<<m,m+=8,p+=C[i++]<<m,m+=8),y=_[p&b];e:for(;;){if(p>>>=w=y>>>24,m-=w,0===(w=y>>>16&255))E[a++]=65535&y;else{if(!(16&w)){if(0==(64&w)){y=_[(65535&y)+(p&(1<<w)-1)];continue}if(32&w){n.mode=12;break t}e.msg="invalid literal/length code",n.mode=30;break t}k=65535&y,(w&=15)&&(m<w&&(p+=C[i++]<<m,m+=8),k+=p&(1<<w)-1,p>>>=w,m-=w),m<15&&(p+=C[i++]<<m,m+=8,p+=C[i++]<<m,m+=8),y=g[p&v];r:for(;;){if(p>>>=w=y>>>24,m-=w,!(16&(w=y>>>16&255))){if(0==(64&w)){y=g[(65535&y)+(p&(1<<w)-1)];continue}e.msg="invalid distance code",n.mode=30;break t}if(x=65535&y,m<(w&=15)&&(p+=C[i++]<<m,(m+=8)<w&&(p+=C[i++]<<m,m+=8)),u<(x+=p&(1<<w)-1)){e.msg="invalid distance too far back",n.mode=30;break t}if(p>>>=w,m-=w,(w=a-o)<x){if(f<(w=x-w)&&n.sane){e.msg="invalid distance too far back",n.mode=30;break t}if(z=c,(S=0)===d){if(S+=l-w,w<k){for(k-=w;E[a++]=c[S++],--w;);S=a-x,z=E}}else if(d<w){if(S+=l+d-w,(w-=d)<k){for(k-=w;E[a++]=c[S++],--w;);if(S=0,d<k){for(k-=w=d;E[a++]=c[S++],--w;);S=a-x,z=E}}}else if(S+=d-w,w<k){for(k-=w;E[a++]=c[S++],--w;);S=a-x,z=E}for(;2<k;)E[a++]=z[S++],E[a++]=z[S++],E[a++]=z[S++],k-=3;k&&(E[a++]=z[S++],1<k&&(E[a++]=z[S++]))}else{for(S=a-x;E[a++]=E[S++],E[a++]=E[S++],E[a++]=E[S++],2<(k-=3););k&&(E[a++]=E[S++],1<k&&(E[a++]=E[S++]))}break}}break}}while(i<s&&a<h);p&=(1<<(m-=(k=m>>3)<<3))-1,e.next_in=i-=k,e.next_out=a,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=a<h?h-a+257:257-(a-h),n.hold=p,n.bits=m}},{}],49:[function(t,e,r){"use strict";var I=t("../utils/common"),O=t("./adler32"),B=t("./crc32"),R=t("./inffast"),T=t("./inftrees"),n=0,D=1,F=2,i=4,s=5,a=6,N=0,o=1,h=2,U=-2,u=-3,l=-4,f=-5,d=8,P=1,c=2,p=3,m=4,_=5,g=6,b=7,v=8,y=9,w=10,k=11,x=12,S=13,z=14,C=15,E=16,A=17,L=18,j=19,Z=20,W=21,M=22,H=23,G=24,K=25,Y=26,X=27,V=28,q=29,J=30,Q=31,$=32,tt=852,et=592,rt=15,nt=15;function it(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function st(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new I.Buf16(320),this.work=new I.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function at(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=P,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new I.Buf32(tt),e.distcode=e.distdyn=new I.Buf32(et),e.sane=1,e.back=-1,N):U}function ot(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,at(t)):U}function ht(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?U:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,ot(t))):U}function ut(t,e){var e,r;return t?(r=new st,(t.state=r).window=null,(e=ht(t,e))!==N&&(t.state=null),e):U}function lt(t){return ut(t,15)}var ft=!0,dt,ct;function pt(t){if(ft){var e;for(dt=new I.Buf32(512),ct=new I.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(T(D,t.lens,0,288,dt,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;T(F,t.lens,0,32,ct,0,t.work,{bits:5}),ft=!1}t.lencode=dt,t.lenbits=9,t.distcode=ct,t.distbits=5}function mt(t,e,r,n){var t,i=t.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new I.Buf8(i.wsize)),n>=i.wsize?(I.arraySet(i.window,e,r-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):(n<(t=i.wsize-i.wnext)&&(t=n),I.arraySet(i.window,e,r-n,t,i.wnext),(n-=t)?(I.arraySet(i.window,e,r-n,n,0),i.wnext=n,i.whave=i.wsize):(i.wnext+=t,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=t))),0}function _t(t,e){var r,n,i,s,a,o,h,u,l,f,d,c,p,m,_=0,g,b,v,y,w,k,x,S,z=new I.Buf8(4),C,E,A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return U;12===(r=t.state).mode&&(r.mode=13),a=t.next_out,i=t.output,h=t.avail_out,s=t.next_in,n=t.input,o=t.avail_in,u=r.hold,l=r.bits,f=o,d=h,S=N;t:for(;;)switch(r.mode){case P:if(0===r.wrap){r.mode=13;break}for(;l<16;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(2&r.wrap&&35615===u){z[r.check=0]=255&u,z[1]=u>>>8&255,r.check=B(r.check,z,2,0),l=u=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&u)<<8)+(u>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&u)){t.msg="unknown compression method",r.mode=30;break}if(l-=4,x=8+(15&(u>>>=4)),0===r.wbits)r.wbits=x;else if(x>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<x,t.adler=r.check=1,r.mode=512&u?10:12,l=u=0;break;case 2:for(;l<16;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(r.flags=u,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=u>>8&1),512&r.flags&&(z[0]=255&u,z[1]=u>>>8&255,r.check=B(r.check,z,2,0)),l=u=0,r.mode=3;case 3:for(;l<32;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.head&&(r.head.time=u),512&r.flags&&(z[0]=255&u,z[1]=u>>>8&255,z[2]=u>>>16&255,z[3]=u>>>24&255,r.check=B(r.check,z,4,0)),l=u=0,r.mode=4;case 4:for(;l<16;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.head&&(r.head.xflags=255&u,r.head.os=u>>8),512&r.flags&&(z[0]=255&u,z[1]=u>>>8&255,r.check=B(r.check,z,2,0)),l=u=0,r.mode=5;case 5:if(1024&r.flags){for(;l<16;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.length=u,r.head&&(r.head.extra_len=u),512&r.flags&&(z[0]=255&u,z[1]=u>>>8&255,r.check=B(r.check,z,2,0)),l=u=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((c=o<(c=r.length)?o:c)&&(r.head&&(x=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),I.arraySet(r.head.extra,n,s,c,x)),512&r.flags&&(r.check=B(r.check,n,c,s)),o-=c,s+=c,r.length-=c),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break t;for(c=0;x=n[s+c++],r.head&&x&&r.length<65536&&(r.head.name+=String.fromCharCode(x)),x&&c<o;);if(512&r.flags&&(r.check=B(r.check,n,c,s)),o-=c,s+=c,x)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break t;for(c=0;x=n[s+c++],r.head&&x&&r.length<65536&&(r.head.comment+=String.fromCharCode(x)),x&&c<o;);if(512&r.flags&&(r.check=B(r.check,n,c,s)),o-=c,s+=c,x)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;l<16;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(u!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}l=u=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;l<32;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}t.adler=r.check=it(u),l=u=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=a,t.avail_out=h,t.next_in=s,t.avail_in=o,r.hold=u,r.bits=l,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){u>>>=7&l,l-=7&l,r.mode=27;break}for(;l<3;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}switch(r.last=1&u,--l,3&(u>>>=1)){case 0:r.mode=14;break;case 1:if(pt(r),r.mode=20,6!==e)break;u>>>=2,l-=2;break t;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&u,l=u=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(c=r.length){if(0===(c=h<(c=o<c?o:c)?h:c))break t;I.arraySet(i,n,s,c,a),o-=c,s+=c,h-=c,a+=c,r.length-=c;break}r.mode=12;break;case 17:for(;l<14;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(r.nlen=257+(31&u),u>>>=5,l-=5,r.ndist=1+(31&u),u>>>=5,l-=5,r.ncode=4+(15&u),u>>>=4,l-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;l<3;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.lens[A[r.have++]]=7&u,u>>>=3,l-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,C={bits:r.lenbits},S=T(0,r.lens,0,19,r.lencode,0,r.work,C),r.lenbits=C.bits,S){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;b=(_=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,v=65535&_,!((g=_>>>24)<=l);){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(v<16)u>>>=g,l-=g,r.lens[r.have++]=v;else{if(16===v){for(E=g+2;l<E;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(u>>>=g,l-=g,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}x=r.lens[r.have-1],c=3+(3&u),u>>>=2,l-=2}else if(17===v){for(E=g+3;l<E;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}l-=g,x=0,c=3+(7&(u>>>=g)),u>>>=3,l-=3}else{for(E=g+7;l<E;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}l-=g,x=0,c=11+(127&(u>>>=g)),u>>>=7,l-=7}if(r.have+c>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;c--;)r.lens[r.have++]=x}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,C={bits:r.lenbits},S=T(D,r.lens,0,r.nlen,r.lencode,0,r.work,C),r.lenbits=C.bits,S){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,C={bits:r.distbits},S=T(F,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,C),r.distbits=C.bits,S){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=o&&258<=h){t.next_out=a,t.avail_out=h,t.next_in=s,t.avail_in=o,r.hold=u,r.bits=l,R(t,d),a=t.next_out,i=t.output,h=t.avail_out,s=t.next_in,n=t.input,o=t.avail_in,u=r.hold,l=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;b=(_=r.lencode[u&(1<<r.lenbits)-1])>>>16&255,v=65535&_,!((g=_>>>24)<=l);){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(b&&0==(240&b)){for(y=g,w=b,k=v;b=(_=r.lencode[k+((u&(1<<y+w)-1)>>y)])>>>16&255,v=65535&_,!(y+(g=_>>>24)<=l);){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}u>>>=y,l-=y,r.back+=y}if(u>>>=g,l-=g,r.back+=g,r.length=v,0===b){r.mode=26;break}if(32&b){r.back=-1,r.mode=12;break}if(64&b){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&b,r.mode=22;case 22:if(r.extra){for(E=r.extra;l<E;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.length+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;b=(_=r.distcode[u&(1<<r.distbits)-1])>>>16&255,v=65535&_,!((g=_>>>24)<=l);){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(0==(240&b)){for(y=g,w=b,k=v;b=(_=r.distcode[k+((u&(1<<y+w)-1)>>y)])>>>16&255,v=65535&_,!(y+(g=_>>>24)<=l);){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}u>>>=y,l-=y,r.back+=y}if(u>>>=g,l-=g,r.back+=g,64&b){t.msg="invalid distance code",r.mode=30;break}r.offset=v,r.extra=15&b,r.mode=24;case 24:if(r.extra){for(E=r.extra;l<E;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}r.offset+=u&(1<<r.extra)-1,u>>>=r.extra,l-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===h)break t;if(r.offset>(c=d-h)){if((c=r.offset-c)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}p=c>r.wnext?(c-=r.wnext,r.wsize-c):r.wnext-c,c>r.length&&(c=r.length),m=r.window}else m=i,p=a-r.offset,c=r.length;for(h-=c=h<c?h:c,r.length-=c;i[a++]=m[p++],--c;);0===r.length&&(r.mode=21);break;case 26:if(0===h)break t;i[a++]=r.length,h--,r.mode=21;break;case 27:if(r.wrap){for(;l<32;){if(0===o)break t;o--,u|=n[s++]<<l,l+=8}if(d-=h,t.total_out+=d,r.total+=d,d&&(t.adler=r.check=(r.flags?B:O)(r.check,i,d,a-d)),d=h,(r.flags?u:it(u))!==r.check){t.msg="incorrect data check",r.mode=30;break}l=u=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;l<32;){if(0===o)break t;o--,u+=n[s++]<<l,l+=8}if(u!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}l=u=0}r.mode=29;case 29:S=1;break t;case 30:S=-3;break t;case 31:return-4;default:return U}return t.next_out=a,t.avail_out=h,t.next_in=s,t.avail_in=o,r.hold=u,r.bits=l,(r.wsize||d!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&mt(t,t.output,t.next_out,d-t.avail_out)?(r.mode=31,-4):(f-=t.avail_in,d-=t.avail_out,t.total_in+=f,t.total_out+=d,r.total+=d,r.wrap&&d&&(t.adler=r.check=(r.flags?B:O)(r.check,i,d,t.next_out-d)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==f&&0===d||4===e)&&S===N?-5:S)}function gt(t){if(!t||!t.state)return U;var e=t.state;return e.window&&(e.window=null),t.state=null,N}function bt(t,e){var t;return!t||!t.state||0==(2&(t=t.state).wrap)?U:((t.head=e).done=!1,N)}function vt(t,e){var r=e.length,n,i,s;return!t||!t.state||0!==(n=t.state).wrap&&11!==n.mode?U:11===n.mode&&(i=O(i=1,e,r,0))!==n.check?-3:(s=mt(t,e,r,r))?(n.mode=31,-4):(n.havedict=1,N)}r.inflateReset=ot,r.inflateReset2=ht,r.inflateResetKeep=at,r.inflateInit=lt,r.inflateInit2=ut,r.inflate=_t,r.inflateEnd=gt,r.inflateGetHeader=bt,r.inflateSetDictionary=vt,r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,r){"use strict";var F=t("../utils/common"),n=15,N=852,U=592,i=0,s=1,a=2,P=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],L=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Z=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function t(e,r,n,i,s,a,o,h){for(var u=h.bits,l=0,f=0,d=0,c=0,p=0,m=0,_=0,g=0,b=0,v=0,y,w,k,x,S,z=null,C=0,E,A=new F.Buf16(16),I=new F.Buf16(16),O=null,B=0,R,T,D,l=0;l<=15;l++)A[l]=0;for(f=0;f<i;f++)A[r[n+f]]++;for(p=u,c=15;1<=c&&0===A[c];c--);if(c<p&&(p=c),0===c)return s[a++]=20971520,s[a++]=20971520,h.bits=1,0;for(d=1;d<c&&0===A[d];d++);for(p<d&&(p=d),l=g=1;l<=15;l++)if(g<<=1,(g-=A[l])<0)return-1;if(0<g&&(0===e||1!==c))return-1;for(I[1]=0,l=1;l<15;l++)I[l+1]=I[l]+A[l];for(f=0;f<i;f++)0!==r[n+f]&&(o[I[r[n+f]]++]=f);if(E=0===e?(z=O=o,19):1===e?(z=P,C-=257,O=L,B-=257,256):(z=j,O=Z,-1),l=d,S=a,_=f=v=0,k=-1,x=(b=1<<(m=p))-1,1===e&&N<b||2===e&&U<b)return 1;for(;;){for(D=o[f]<E?(T=0,o[f]):o[f]>E?(T=O[B+o[f]],z[C+o[f]]):(T=96,0),y=1<<(R=l-_),d=w=1<<m;s[S+(v>>_)+(w-=y)]=R<<24|T<<16|D|0,0!==w;);for(y=1<<l-1;v&y;)y>>=1;if(0!==y?(v&=y-1,v+=y):v=0,f++,0==--A[l]){if(l===c)break;l=r[n+o[f]]}if(p<l&&(v&x)!==k){for(S+=d,g=1<<(m=l-(_=0===_?p:_));m+_<c&&!((g-=A[m+_])<=0);)m++,g<<=1;if(b+=1<<m,1===e&&N<b||2===e&&U<b)return 1;s[k=v&x]=p<<24|m<<16|S-a|0}}return 0!==v&&(s[S+v]=l-_<<24|64<<16|0),h.bits=p,0}},{"../utils/common":41}],51:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,r){"use strict";var i=t("../utils/common"),n=4,s=0,a=1,o=2;function h(t){for(var e=t.length;0<=--e;)t[e]=0}var u=0,l=1,f=2,d=3,c=258,p=29,m=256,_=m+1+p,g=30,b=19,v=2*_+1,y=15,w=16,k=7,x=256,S=16,z=17,C=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],I=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],t=512,B=new Array(2*(_+2));h(B);var R=new Array(2*g);h(R);var T=new Array(t);h(T);var D=new Array(256);h(D);var F=new Array(p);h(F);var N=new Array(g),U,P,L;function j(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function Z(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function W(t){return t<256?T[t]:T[256+(t>>>7)]}function M(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function H(t,e,r){t.bi_valid>w-r?(t.bi_buf|=e<<t.bi_valid&65535,M(t,t.bi_buf),t.bi_buf=e>>w-t.bi_valid,t.bi_valid+=r-w):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function G(t,e,r){H(t,r[2*e],r[2*e+1])}function K(t,e){for(var r=0;r|=1&t,t>>>=1,r<<=1,0<--e;);return r>>>1}function Y(t){16===t.bi_valid?(M(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function X(t,e){for(var r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,h=e.stat_desc.max_length,u,l,f,d,c,p,m=0,d=0;d<=y;d++)t.bl_count[d]=0;for(r[2*t.heap[t.heap_max]+1]=0,u=t.heap_max+1;u<v;u++)h<(d=r[2*r[2*(l=t.heap[u])+1]+1]+1)&&(d=h,m++),r[2*l+1]=d,n<l||(t.bl_count[d]++,c=0,o<=l&&(c=a[l-o]),p=r[2*l],t.opt_len+=p*(d+c),s&&(t.static_len+=p*(i[2*l+1]+c)));if(0!==m){do{for(d=h-1;0===t.bl_count[d];)d--}while(t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[h]--,0<(m-=2));for(d=h;0!==d;d--)for(l=t.bl_count[d];0!==l;)n<(f=t.heap[--u])||(r[2*f+1]!==d&&(t.opt_len+=(d-r[2*f+1])*r[2*f],r[2*f+1]=d),l--)}}function V(t,e,r){for(var n=new Array(y+1),i=0,s,a,s=1;s<=y;s++)n[s]=i=i+r[s-1]<<1;for(a=0;a<=e;a++){var o=t[2*a+1];0!==o&&(t[2*a]=K(n[o]++,o))}}function q(){for(var t,e,r,n,i,s=new Array(y+1),r=0,n=0;n<p-1;n++)for(F[n]=r,t=0;t<1<<E[n];t++)D[r++]=n;for(D[r-1]=n,n=i=0;n<16;n++)for(N[n]=i,t=0;t<1<<A[n];t++)T[i++]=n;for(i>>=7;n<g;n++)for(N[n]=i<<7,t=0;t<1<<A[n]-7;t++)T[256+i++]=n;for(e=0;e<=y;e++)s[e]=0;for(t=0;t<=143;)B[2*t+1]=8,t++,s[8]++;for(;t<=255;)B[2*t+1]=9,t++,s[9]++;for(;t<=279;)B[2*t+1]=7,t++,s[7]++;for(;t<=287;)B[2*t+1]=8,t++,s[8]++;for(V(B,_+1,s),t=0;t<g;t++)R[2*t+1]=5,R[2*t]=K(t,5);U=new j(B,E,m+1,_,y),P=new j(R,A,0,g,y),L=new j(new Array(0),I,0,b,k)}function J(t){for(var e,e=0;e<_;e++)t.dyn_ltree[2*e]=0;for(e=0;e<g;e++)t.dyn_dtree[2*e]=0;for(e=0;e<b;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*x]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function Q(t){8<t.bi_valid?M(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function $(t,e,r,n){Q(t),n&&(M(t,r),M(t,~r)),i.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}function tt(t,e,r,n){var i=2*e,s=2*r;return t[i]<t[s]||t[i]===t[s]&&n[e]<=n[r]}function et(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&tt(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!tt(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n}function rt(t,e,r){var n,i,s=0,a,o;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],i=t.pending_buf[t.l_buf+s],s++,0==n?G(t,i,e):(G(t,(a=D[i])+m+1,e),0!==(o=E[a])&&H(t,i-=F[a],o),G(t,a=W(--n),r),0!==(o=A[a])&&H(t,n-=N[a],o)),s<t.last_lit;);G(t,x,e)}function nt(t,e){var r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems,a,o,h=-1,u;for(t.heap_len=0,t.heap_max=v,a=0;a<s;a++)0!==r[2*a]?(t.heap[++t.heap_len]=h=a,t.depth[a]=0):r[2*a+1]=0;for(;t.heap_len<2;)r[2*(u=t.heap[++t.heap_len]=h<2?++h:0)]=1,t.depth[u]=0,t.opt_len--,i&&(t.static_len-=n[2*u+1]);for(e.max_code=h,a=t.heap_len>>1;1<=a;a--)et(t,r,a);for(u=s;a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],et(t,r,1),o=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=o,r[2*u]=r[2*a]+r[2*o],t.depth[u]=(t.depth[a]>=t.depth[o]?t.depth[a]:t.depth[o])+1,r[2*a+1]=r[2*o+1]=u,t.heap[1]=u++,et(t,r,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],X(t,e),V(r,h,t.bl_count)}function it(t,e,r){var n,i=-1,s,a=e[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)s=a,a=e[2*(n+1)+1],++o<h&&s===a||(o<u?t.bl_tree[2*s]+=o:0!==s?(s!==i&&t.bl_tree[2*s]++,t.bl_tree[2*S]++):o<=10?t.bl_tree[2*z]++:t.bl_tree[2*C]++,i=s,u=(o=0)===a?(h=138,3):s===a?(h=6,3):(h=7,4))}function st(t,e,r){var n,i=-1,s,a=e[1],o=0,h=7,u=4;for(0===a&&(h=138,u=3),n=0;n<=r;n++)if(s=a,a=e[2*(n+1)+1],!(++o<h&&s===a)){if(o<u)for(;G(t,s,t.bl_tree),0!=--o;);else 0!==s?(s!==i&&(G(t,s,t.bl_tree),o--),G(t,S,t.bl_tree),H(t,o-3,2)):o<=10?(G(t,z,t.bl_tree),H(t,o-3,3)):(G(t,C,t.bl_tree),H(t,o-11,7));i=s,u=(o=0)===a?(h=138,3):s===a?(h=6,3):(h=7,4)}}function at(t){var e;for(it(t,t.dyn_ltree,t.l_desc.max_code),it(t,t.dyn_dtree,t.d_desc.max_code),nt(t,t.bl_desc),e=b-1;3<=e&&0===t.bl_tree[2*O[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function ot(t,e,r,n){var i;for(H(t,e-257,5),H(t,r-1,5),H(t,n-4,4),i=0;i<n;i++)H(t,t.bl_tree[2*O[i]+1],3);st(t,t.dyn_ltree,e-1),st(t,t.dyn_dtree,r-1)}function ht(t){for(var e=4093624447,r,r=0;r<=31;r++,e>>>=1)if(1&e&&0!==t.dyn_ltree[2*r])return s;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(r=32;r<m;r++)if(0!==t.dyn_ltree[2*r])return a;return s}h(N);var ut=!1;function lt(t){ut||(q(),ut=!0),t.l_desc=new Z(t.dyn_ltree,U),t.d_desc=new Z(t.dyn_dtree,P),t.bl_desc=new Z(t.bl_tree,L),t.bi_buf=0,t.bi_valid=0,J(t)}function ft(t,e,r,n){H(t,0+(n?1:0),3),$(t,e,r,!0)}function dt(t){H(t,2,3),G(t,x,B),Y(t)}function ct(t,e,r,n){var i,s,a=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=ht(t)),nt(t,t.l_desc),nt(t,t.d_desc),a=at(t),i=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==e?ft(t,e,r,n):4===t.strategy||s===i?(H(t,2+(n?1:0),3),rt(t,B,R)):(H(t,4+(n?1:0),3),ot(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),rt(t,t.dyn_ltree,t.dyn_dtree)),J(t),n&&Q(t)}function pt(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(D[r]+m+1)]++,t.dyn_dtree[2*W(e)]++),t.last_lit===t.lit_bufsize-1}r._tr_init=lt,r._tr_stored_block=ft,r._tr_flush_block=ct,r._tr_tally=pt,r._tr_align=dt},{"../utils/common":41}],53:[function(t,e,r){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=n},{}],54:[function(t,e,r){"use strict";e.exports="function"==typeof setImmediate?setImmediate:function t(){var e=[].slice.apply(arguments);e.splice(1,0,0),setTimeout.apply(null,e)}},{}]},{},[10])(10)});var Module=(()=>{var Go="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0;return"undefined"!=typeof __filename&&(Go=Go||__filename),function(u){var u,t,i;(u=void 0!==(u=u||{})?u:{}).ready=new Promise(function(r,e){t=r,i=e});var c=!1;u.setup=function(){if(!c){c=!0,u.Manifold.prototype.warp=function(a){var r=Qn(function(r){var e,t,n,o=[br(r,"float"),br(r+4,"float"),br(r+8,"float")];a(o),kr(r,o[0],"float"),kr(r+4,o[1],"float"),kr(r+8,o[2],"float")},"vi"),e=this._Warp(r);return ro(r),e},u.Manifold.prototype.transform=function(r){console.assert(4==r.length,"expects a 3x4 matrix");const e=new u.Vector_f32;for(var t of r){console.assert(3==t.length,"expects a 3x4 matrix");for(var n of t)r.push_back(n)}var o=this._Transform(e);return e.delete(),o},u.Manifold.prototype.translate=function(...r){return this._Translate(t(r))},u.Manifold.prototype.rotate=function(r){return this._Rotate(...r)},u.Manifold.prototype.scale=function(r){return"number"==typeof r?this._Scale({x:r,y:r,z:r}):this._Scale(t([r]))},u.Manifold.prototype.decompose=function(){const r=this._Decompose();var e=i(r);return r.delete(),e},u.Manifold.prototype.getCurvature=function(){const r=this._getCurvature(),e=r.vertMeanCurvature,t=r.vertGaussianCurvature;return r.vertMeanCurvature=i(e),r.vertGaussianCurvature=i(t),e.delete(),t.delete(),r};class e{constructor({triVerts:r=new Uint32Array,vertPos:e=new Float32Array,vertNormal:t,halfedgeTangent:n}={}){this.triVerts=r,this.vertPos=e,this.vertNormal=t,this.halfedgeTangent=n}get numTri(){return this.triVerts.length/3}get numVert(){return this.vertPos.length/3}verts(r){return this.triVerts.subarray(3*r,3*(r+1))}position(r){return this.vertPos.subarray(3*r,3*(r+1))}normal(r){return this.vertNormal.subarray(3*r,3*(r+1))}tangent(r){return this.halfedgeTangent.subarray(4*r,4*(r+1))}}u.Mesh=e,u.Manifold.prototype.getMesh=function(){return new e(this._GetMeshJS())},u.Manifold.prototype.getMeshRelation=function(){const r=this._getMeshRelation(),e=r.barycentric,t=r.triBary;var n;const o=r=>[r[0],r[1],r[2]];var a=r=>({meshID:r.meshID,originalID:r.originalID,tri:r.tri,vertBary:o(r.vertBary)});return r.barycentric=i(e,r=>[r.x,r.y,r.z]),r.triBary=i(t,a),e.delete(),t.delete(),r},u.Manifold.prototype.boundingBox=function(){const e=this._boundingBox();return{min:["x","y","z"].map(r=>e.min[r]),max:["x","y","z"].map(r=>e.max[r])}},u.ManifoldError=function r(e,...t){let n="Unknown error";switch(e){case u.status.NON_FINITE_VERTEX.value:n="Non-finite vertex";break;case u.status.NOT_MANIFOLD.value:n="Not manifold";break;case u.status.VERTEX_INDEX_OUT_OF_BOUNDS.value:n="Vertex index out of bounds";break;case u.status.PROPERTIES_WRONG_LENGTH.value:n="Properties have wrong length";break;case u.status.TRI_PROPERTIES_WRONG_LENGTH.value:n="Tri properties have wrong length";break;case u.status.TRI_PROPERTIES_OUT_OF_BOUNDS.value:n="Tri properties out of bounds"}const o=Error.apply(this,[n,...t]);o.name=this.name="ManifoldError",this.message=o.message,this.stack=o.stack,this.code=e},u.ManifoldError.prototype=Object.create(Error.prototype,{constructor:{value:u.ManifoldError,writable:!0,configurable:!0}});const o=u.Manifold;function n(r,e,t=r=>r){if(e)for(var n of e)r.push_back(t(n));return r}function i(e,t=r=>r){const n=[];var o=e.size();for(let r=0;r<o;r++)n.push(t(e.get(r)));return n}function a(r){return r[0].length<3&&(r=[r]),n(new u.Vector2_vec2,r,r=>n(new u.Vector_vec2,r,r=>r instanceof Array?{x:r[0],y:r[1]}:r))}function s(e){for(let r=0;r<e.size();r++)e.get(r).delete();e.delete()}function t(r){return r[0]instanceof Array?{x:r[0][0],y:r[0][1],z:r[0][2]}:"number"==typeof r[0]?{x:r[0]||0,y:r[1]||0,z:r[2]||0}:r[0]}function r(n){return function(...r){1==r.length&&(r=r[0]);const e=new u.Vector_manifold;for(const t of r)e.push_back(t);var r=u["_"+n+"N"](e);return e.delete(),r}}u.Manifold=function(r){const e=new o(r);var r=e.status();if(0!==r.value)throw new u.ManifoldError(r.value);return e},u.Manifold.prototype=Object.create(o.prototype),u.cube=function(...r){let e=void 0;e=0==r.length?{x:1,y:1,z:1}:"number"==typeof r[0]?{x:r[0],y:r[0],z:r[0]}:t(r);var r=r[1]||!1;return u._Cube(e,r)},u.cylinder=function(r,e,t=-1,n=0,o=!1){return u._Cylinder(r,e,t,n,o)},u.sphere=function(r,e=0){return u._Sphere(r,e)},u.smooth=function(r,e=[]){const t=new u.Vector_smoothness;n(t,e);var r=u._Smooth(r,t);return t.delete(),r},u.extrude=function(r,e,t=0,n=0,o=[1,1]){o instanceof Array&&(o={x:o[0],y:o[1]});var r=a(r),o=u._Extrude(r,e,t,n,o);return s(r),o},u.revolve=function(r,e=0){var r=a(r),e=u._Revolve(r,e);return s(r),e},u.compose=function(r){const e=new u.Vector_manifold;n(e,r);var r=u._Compose(e);return e.delete(),r},u.levelSet=function(o,r,e,t=0){var n={min:{x:r.min[0],y:r.min[1],z:r.min[2]},max:{x:r.max[0],y:r.max[1],z:r.max[2]}},r=Qn(function(r){var e=br(r,"float"),t=br(r+4,"float"),r=br(r+8,"float"),n;return o([e,t,r])},"fi"),t=u._LevelSet(r,n,e,t);return ro(r),t},u.union=r("union"),u.difference=r("difference"),u.intersection=r("intersection")}};var r=Object.assign({},u),n=[],e="./this.program",o=(r,e)=>{throw e},a="object"==typeof window,f="function"==typeof importScripts,s="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,l="",d,p,h,m,v,y,l;function w(r){return u.locateFile?u.locateFile(r,l):l+r}function g(r){var e;r instanceof _r||E("exiting due to exception: "+r)}s?(l=f?require("path").dirname(l)+"/":__dirname+"/","function"==typeof require&&(v=require("fs"),y=require("path")),d=(r,e)=>(r=y.normalize(r),v.readFileSync(r,e?void 0:"utf8")),h=r=>{var r=d(r,!0);return r=!r.buffer?new Uint8Array(r):r},p=(r,t,n)=>{r=y.normalize(r),v.readFile(r,function(r,e){r?n(r):t(e.buffer)})},1<process.argv.length&&(e=process.argv[1].replace(/\\/g,"/")),n=process.argv.slice(2),process.on("uncaughtException",function(r){if(!(r instanceof _r))throw r}),process.on("unhandledRejection",function(r){throw r}),o=(r,e)=>{if(T)throw process.exitCode=r,e;g(e),process.exit(r)},u.inspect=function(){return"[Emscripten Module object]"}):(a||f)&&(f?l=self.location.href:"undefined"!=typeof document&&document.currentScript&&(l=document.currentScript.src),l=0!==(l=Go?Go:l).indexOf("blob:")?l.substr(0,l.replace(/[?#].*/,"").lastIndexOf("/")+1):"",d=r=>{var e=new XMLHttpRequest;return e.open("GET",r,!1),e.send(null),e.responseText},f&&(h=r=>{var e=new XMLHttpRequest;return e.open("GET",r,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}),p=(r,e,t)=>{var n=new XMLHttpRequest;n.open("GET",r,!0),n.responseType="arraybuffer",n.onload=()=>{200==n.status||0==n.status&&n.response?e(n.response):t()},n.onerror=t,n.send(null)},m=r=>document.title=r);var _=u.print||console.log.bind(console),E=u.printErr||console.warn.bind(console);Object.assign(u,r),r=null,u.arguments&&(n=u.arguments),u.thisProgram&&(e=u.thisProgram),u.quit&&(o=u.quit);var b=4,k;u.wasmBinary&&(k=u.wasmBinary);var T=u.noExitRuntime||!0,P;"object"!=typeof WebAssembly&&lr("no native wasm support detected");var D=!1,C;function S(r,e){r||lr(e)}var M="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0,F,A,x,$,O,j,R,N,z;function B(r,e,t){for(var n=e+t,o=e;r[o]&&!(n<=o);)++o;if(16<o-e&&r.buffer&&M)return M.decode(r.subarray(e,o));for(var a="";e<o;){var i=r[e++],s,u,u,i;128&i?(s=63&r[e++],192!=(224&i)?(u=63&r[e++],(i=224==(240&i)?(15&i)<<12|s<<6|u:(7&i)<<18|s<<12|u<<6|63&r[e++])<65536?a+=String.fromCharCode(i):(u=i-65536,a+=String.fromCharCode(55296|u>>10,56320|1023&u))):a+=String.fromCharCode((31&i)<<6|s)):a+=String.fromCharCode(i)}return a}function W(r,e){return r?B(x,r,e):""}function I(r,e,t,n){if(!(0<n))return 0;for(var o=t,a=t+n-1,i=0;i<r.length;++i){var s=r.charCodeAt(i),u,s;if((s=55296<=s&&s<=57343?65536+((1023&s)<<10)|1023&r.charCodeAt(++i):s)<=127){if(a<=t)break;e[t++]=s}else if(s<=2047){if(a<=t+1)break;e[t++]=192|s>>6,e[t++]=128|63&s}else if(s<=65535){if(a<=t+2)break;e[t++]=224|s>>12,e[t++]=128|s>>6&63,e[t++]=128|63&s}else{if(a<=t+3)break;e[t++]=240|s>>18,e[t++]=128|s>>12&63,e[t++]=128|s>>6&63,e[t++]=128|63&s}}return e[t]=0,t-o}function V(r,e,t){return I(r,x,e,t)}function U(r){for(var e=0,t=0;t<r.length;++t){var n=r.charCodeAt(t);n<=127?e++:n<=2047?e+=2:55296<=n&&n<=57343?(e+=4,++t):e+=3}return e}function L(r){F=r,u.HEAP8=A=new Int8Array(r),u.HEAP16=$=new Int16Array(r),u.HEAP32=j=new Int32Array(r),u.HEAPU8=x=new Uint8Array(r),u.HEAPU16=O=new Uint16Array(r),u.HEAPU32=R=new Uint32Array(r),u.HEAPF32=N=new Float32Array(r),u.HEAPF64=z=new Float64Array(r)}var H=u.INITIAL_MEMORY||16777216,q,Y=[],G=[],X=[],K=!1;function J(){return T}function Z(){if(u.preRun)for("function"==typeof u.preRun&&(u.preRun=[u.preRun]);u.preRun.length;)er(u.preRun.shift());Er(Y)}function Q(){K=!0,u.noFSInit||Tn.init.initialized||Tn.init(),Tn.ignorePermissions=!1,_n.init(),Er(G)}function rr(){if(u.postRun)for("function"==typeof u.postRun&&(u.postRun=[u.postRun]);u.postRun.length;)nr(u.postRun.shift());Er(X)}function er(r){Y.unshift(r)}function tr(r){G.unshift(r)}function nr(r){X.unshift(r)}var or=0,ar=null,ir=null;function sr(r){return r}function ur(r){or++,u.monitorRunDependencies&&u.monitorRunDependencies(or)}function cr(r){var e;or--,u.monitorRunDependencies&&u.monitorRunDependencies(or),0==or&&(null!==ar&&(clearInterval(ar),ar=null),ir&&(e=ir,ir=null,e()))}function lr(r){u.onAbort&&u.onAbort(r),E(r="Aborted("+r+")"),D=!0,r+=". Build with -sASSERTIONS for more info.";var r=new WebAssembly.RuntimeError(r);throw i(r),r}var fr="data:application/octet-stream;base64,",dr,pr,hr;function mr(r){return r.startsWith(fr)}function vr(r){return r.startsWith("file://")}function yr(r){try{if(r==dr&&k)return new Uint8Array(k);if(h)return h(r);throw"both async and sync fetching of the wasm failed"}catch(r){lr(r)}}function wr(){if(!k&&(a||f)){if("function"==typeof fetch&&!vr(dr))return fetch(dr,{credentials:"same-origin"}).then(function(r){if(!r.ok)throw"failed to load wasm binary file at '"+dr+"'";return r.arrayBuffer()}).catch(function(){return yr(dr)});if(p)return new Promise(function(e,r){p(dr,function(r){e(new Uint8Array(r))},r)})}return Promise.resolve().then(function(){return yr(dr)})}function gr(){var t={a:no},r;function e(r,e){var r=r.exports;u.asm=r,L((P=u.asm.ta).buffer),q=u.asm.xa,tr(u.asm.ua),cr("wasm-instantiate")}function n(r){e(r.instance)}function o(r){return wr().then(function(r){return WebAssembly.instantiate(r,t)}).then(function(r){return r}).then(r,function(r){E("failed to asynchronously prepare wasm: "+r),lr(r)})}function a(){return k||"function"!=typeof WebAssembly.instantiateStreaming||mr(dr)||vr(dr)||s||"function"!=typeof fetch?o(n):fetch(dr,{credentials:"same-origin"}).then(function(r){var e;return WebAssembly.instantiateStreaming(r,t).then(n,function(r){return E("wasm streaming compile failed: "+r),E("falling back to ArrayBuffer instantiation"),o(n)})})}if(ur("wasm-instantiate"),u.instantiateWasm)try{return u.instantiateWasm(t,e)}catch(r){E("Module.instantiateWasm callback failed with error: "+r),i(r)}return a().catch(i),{}}function _r(r){this.name="ExitStatus",this.message="Program terminated with exit("+r+")",this.status=r}function Er(r){for(;0<r.length;)r.shift()(u)}function br(r,e="i8"){switch(e=e.endsWith("*")?"*":e){case"i1":case"i8":return A[r>>0];case"i16":return $[r>>1];case"i32":case"i64":return j[r>>2];case"float":return N[r>>2];case"double":return z[r>>3];case"*":return R[r>>2];default:lr("invalid type for getValue: "+e)}return null}function kr(r,e,t="i8"){switch(t=t.endsWith("*")?"*":t){case"i1":case"i8":A[r>>0]=e;break;case"i16":$[r>>1]=e;break;case"i32":j[r>>2]=e;break;case"i64":hr=[e>>>0,(pr=e,1<=+Math.abs(pr)?0<pr?(0|Math.min(+Math.floor(pr/4294967296),4294967295))>>>0:~~+Math.ceil((pr-(~~pr>>>0))/4294967296)>>>0:0)],j[r>>2]=hr[0],j[r+4>>2]=hr[1];break;case"float":N[r>>2]=e;break;case"double":z[r>>3]=e;break;case"*":R[r>>2]=e;break;default:lr("invalid type for setValue: "+t)}}function Tr(r){return io(r+24)+24}mr(dr="manifold.wasm")||(dr=w(dr));var Pr=[];function Dr(r){r.add_ref()}var Cr=0;function Sr(r){var r=new Fr(r);return r.get_caught()||(r.set_caught(!0),Cr--),r.set_rethrown(!1),Pr.push(r),Dr(r),r.get_exception_ptr()}var Mr=0;function Fr(r){this.excPtr=r,this.ptr=r-24,this.set_type=function(r){R[this.ptr+4>>2]=r},this.get_type=function(){return R[this.ptr+4>>2]},this.set_destructor=function(r){R[this.ptr+8>>2]=r},this.get_destructor=function(){return R[this.ptr+8>>2]},this.set_refcount=function(r){j[this.ptr>>2]=r},this.set_caught=function(r){A[this.ptr+12>>0]=r=r?1:0},this.get_caught=function(){return 0!=A[this.ptr+12>>0]},this.set_rethrown=function(r){A[this.ptr+13>>0]=r=r?1:0},this.get_rethrown=function(){return 0!=A[this.ptr+13>>0]},this.init=function(r,e){this.set_adjusted_ptr(0),this.set_type(r),this.set_destructor(e),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var r=j[this.ptr>>2];j[this.ptr>>2]=r+1},this.release_ref=function(){var r=j[this.ptr>>2];return j[this.ptr>>2]=r-1,1===r},this.set_adjusted_ptr=function(r){R[this.ptr+16>>2]=r},this.get_adjusted_ptr=function(){return R[this.ptr+16>>2]},this.get_exception_ptr=function(){var r;if(vo(this.get_type()))return R[this.excPtr>>2];var e=this.get_adjusted_ptr();return 0!==e?e:this.excPtr}}function Ar(r){return so(new Fr(r).ptr)}var xr=[];function $r(r){var e=xr[r];return e||(r>=xr.length&&(xr.length=r+1),xr[r]=e=q.get(r)),e}function Or(r){var e;r.release_ref()&&!r.get_rethrown()&&((e=r.get_destructor())&&$r(e)(r.excPtr),Ar(r.excPtr))}function jr(){var r;lo(0),Or(Pr.pop()),Mr=0}function Rr(r){throw Mr=Mr||r,r}function Nr(){var r=Mr;if(!r)return fo(0),0;var e=new Fr(r);e.set_adjusted_ptr(r);var t=e.get_type();if(!t)return fo(0),r;for(var n=0;n<arguments.length;n++){var o=arguments[n];if(0===o||o===t)break;var a=e.ptr+16;if(mo(o,t,a))return fo(o),r}return fo(t),r}function zr(){var r=Mr;if(!r)return fo(0),0;var e=new Fr(r);e.set_adjusted_ptr(r);var t=e.get_type();if(!t)return fo(0),r;for(var n=0;n<arguments.length;n++){var o=arguments[n];if(0===o||o===t)break;var a=e.ptr+16;if(mo(o,t,a))return fo(o),r}return fo(t),r}function Br(r,e,t){var n;throw new Fr(r).init(e,t),Cr++,Mr=r}var Wr={};function Ir(r){for(;r.length;){var e=r.pop(),t;r.pop()(e)}}function Vr(r){return this.fromWireType(j[r>>2])}var Ur={},Lr={},Hr={},qr=48,Yr=57;function Gr(r){if(void 0===r)return"_unknown";var e=(r=r.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return qr<=e&&e<=Yr?"_"+r:r}function Xr(r,e){return r=Gr(r),new Function("body","return function "+r+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(e)}function Kr(r,e){var t=Xr(e,function(r){this.name=e,this.message=r;var r=new Error(r).stack;void 0!==r&&(this.stack=this.toString()+"\n"+r.replace(/^Error(:[^\n]*)?\n/,""))});return t.prototype=Object.create(r.prototype),(t.prototype.constructor=t).prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},t}var Jr=void 0;function Zr(r){throw new Jr(r)}function Qr(n,e,o){function t(r){var e=o(r);e.length!==n.length&&Zr("Mismatched type converter count");for(var t=0;t<n.length;++t)ue(n[t],e[t])}n.forEach(function(r){Hr[r]=e});var a=new Array(e.length),i=[],s=0;e.forEach((r,e)=>{Lr.hasOwnProperty(r)?a[e]=Lr[r]:(i.push(r),Ur.hasOwnProperty(r)||(Ur[r]=[]),Ur[r].push(()=>{a[e]=Lr[r],++s===i.length&&t(a)}))}),0===i.length&&t(a)}function re(r){var e=Wr[r];delete Wr[r];var o=e.rawConstructor,a=e.rawDestructor,f=e.fields,t;Qr([r],f.map(r=>r.getterReturnType).concat(f.map(r=>r.setterArgumentType)),c=>{var l={};return f.forEach((r,e)=>{var t=r.fieldName,n=c[e],o=r.getter,a=r.getterContext,i=c[e+f.length],s=r.setter,u=r.setterContext;l[t]={read:r=>n.fromWireType(o(a,r)),write:(r,e)=>{var t=[];s(u,r,i.toWireType(t,e)),Ir(t)}}}),[{name:e.name,fromWireType:function(r){var e={},t;for(t in l)e[t]=l[t].read(r);return a(r),e},toWireType:function(r,e){for(var t in l)if(!(t in e))throw new TypeError('Missing field:  "'+t+'"');var n=o();for(t in l)l[t].write(n,e[t]);return null!==r&&r.push(a,n),n},argPackAdvance:8,readValueFromPointer:Vr,destructorFunction:a}]})}function ee(r,e,t,n,o){}function te(r){switch(r){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+r)}}function ne(){for(var r=new Array(256),e=0;e<256;++e)r[e]=String.fromCharCode(e);oe=r}var oe=void 0;function ae(r){for(var e="",t=r;x[t];)e+=oe[x[t++]];return e}var ie=void 0;function se(r){throw new ie(r)}function ue(r,e,t={}){if(!("argPackAdvance"in e))throw new TypeError("registerType registeredInstance requires argPackAdvance");var n=e.name,e;if(r||se('type "'+n+'" must have a positive integer typeid pointer'),Lr.hasOwnProperty(r)){if(t.ignoreDuplicateRegistrations)return;se("Cannot register type '"+n+"' twice")}Lr[r]=e,delete Hr[r],Ur.hasOwnProperty(r)&&(e=Ur[r],delete Ur[r],e.forEach(r=>r()))}function ce(r,t,n,o,a){var i=te(n);ue(r,{name:t=ae(t),fromWireType:function(r){return!!r},toWireType:function(r,e){return e?o:a},argPackAdvance:8,readValueFromPointer:function(r){var e;if(1===n)e=A;else if(2===n)e=$;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);e=j}return this.fromWireType(e[r>>i])},destructorFunction:null})}function le(r){if(!(this instanceof Ne))return!1;if(!(r instanceof Ne))return!1;for(var e=this.$$.ptrType.registeredClass,t=this.$$.ptr,n=r.$$.ptrType.registeredClass,o=r.$$.ptr;e.baseClass;)t=e.upcast(t),e=e.baseClass;for(;n.baseClass;)o=n.upcast(o),n=n.baseClass;return e===n&&t===o}function fe(r){return{count:r.count,deleteScheduled:r.deleteScheduled,preservePointerOnDelete:r.preservePointerOnDelete,ptr:r.ptr,ptrType:r.ptrType,smartPtr:r.smartPtr,smartPtrType:r.smartPtrType}}function de(r){function e(r){return r.$$.ptrType.registeredClass.name}se(e(r)+" instance already deleted")}var pe=!1;function he(r){}function me(r){r.smartPtr?r.smartPtrType.rawDestructor(r.smartPtr):r.ptrType.registeredClass.rawDestructor(r.ptr)}function ve(r){var e;--r.count.value,0===r.count.value&&me(r)}function ye(r,e,t){if(e===t)return r;if(void 0===t.baseClass)return null;var e=ye(r,e,t.baseClass);return null===e?null:t.downcast(e)}var we={};function ge(){return Object.keys(De).length}function _e(){var r=[],e;for(e in De)De.hasOwnProperty(e)&&r.push(De[e]);return r}var Ee=[];function be(){for(;Ee.length;){var r=Ee.pop();r.$$.deleteScheduled=!1,r.delete()}}var ke=void 0;function Te(r){ke=r,Ee.length&&ke&&ke(be)}function Pe(){u.getInheritedInstanceCount=ge,u.getLiveInheritedInstances=_e,u.flushPendingDeletes=be,u.setDelayFunction=Te}var De={};function Ce(r,e){for(void 0===e&&se("ptr should not be undefined");r.baseClass;)e=r.upcast(e),r=r.baseClass;return e}function Se(r,e){return e=Ce(r,e),De[e]}function Me(r,e){var t,n;return e.ptrType&&e.ptr||Zr("makeClassHandle requires ptr and ptrType"),!!e.smartPtrType!=!!e.smartPtr&&Zr("Both smartPtrType and smartPtr must be specified"),e.count={value:1},Ae(Object.create(r,{$$:{value:e}}))}function Fe(r){var e=this.getPointee(r);if(!e)return this.destructor(r),null;var t=Se(this.registeredClass,e);if(void 0!==t){if(0===t.$$.count.value)return t.$$.ptr=e,t.$$.smartPtr=r,t.clone();var n=t.clone();return this.destructor(r),n}function o(){return this.isSmartPointer?Me(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:e,smartPtrType:this,smartPtr:r}):Me(this.registeredClass.instancePrototype,{ptrType:this,ptr:r})}var t=this.registeredClass.getActualType(e),n=we[t],t;if(!n)return o.call(this);var t=this.isConst?n.constPointerType:n.pointerType,n=ye(e,this.registeredClass,t.registeredClass);return null===n?o.call(this):this.isSmartPointer?Me(t.registeredClass.instancePrototype,{ptrType:t,ptr:n,smartPtrType:this,smartPtr:r}):Me(t.registeredClass.instancePrototype,{ptrType:t,ptr:n})}function Ae(r){return"undefined"==typeof FinalizationRegistry?(Ae=r=>r,r):(pe=new FinalizationRegistry(r=>{ve(r.$$)}),he=r=>pe.unregister(r),(Ae=r=>{var e=r.$$,t,n;return!!e.smartPtr&&pe.register(r,{$$:e},r),r})(r))}function xe(){if(this.$$.ptr||de(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var r=Ae(Object.create(Object.getPrototypeOf(this),{$$:{value:fe(this.$$)}}));return r.$$.count.value+=1,r.$$.deleteScheduled=!1,r}function $e(){this.$$.ptr||de(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&se("Object already scheduled for deletion"),he(this),ve(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Oe(){return!this.$$.ptr}function je(){return this.$$.ptr||de(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&se("Object already scheduled for deletion"),Ee.push(this),1===Ee.length&&ke&&ke(be),this.$$.deleteScheduled=!0,this}function Re(){Ne.prototype.isAliasOf=le,Ne.prototype.clone=xe,Ne.prototype.delete=$e,Ne.prototype.isDeleted=Oe,Ne.prototype.deleteLater=je}function Ne(){}function ze(r,e,t){var n;void 0===r[e].overloadTable&&(n=r[e],r[e]=function(){return r[e].overloadTable.hasOwnProperty(arguments.length)||se("Function '"+t+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+r[e].overloadTable+")!"),r[e].overloadTable[arguments.length].apply(this,arguments)},r[e].overloadTable=[],r[e].overloadTable[n.argCount]=n)}function Be(r,e,t){u.hasOwnProperty(r)?((void 0===t||void 0!==u[r].overloadTable&&void 0!==u[r].overloadTable[t])&&se("Cannot register public name '"+r+"' twice"),ze(u,r,r),u.hasOwnProperty(t)&&se("Cannot register multiple overloads of a function with the same number of arguments ("+t+")!"),u[r].overloadTable[t]=e):(u[r]=e,void 0!==t&&(u[r].numArguments=t))}function We(r,e,t,n,o,a,i,s){this.name=r,this.constructor=e,this.instancePrototype=t,this.rawDestructor=n,this.baseClass=o,this.getActualType=a,this.upcast=i,this.downcast=s,this.pureVirtualFunctions=[]}function Ie(r,e,t){for(;e!==t;)e.upcast||se("Expected null or instance of "+t.name+", got an instance of "+e.name),r=e.upcast(r),e=e.baseClass;return r}function Ve(r,e){if(null===e)return this.isReference&&se("null is not a valid "+this.name),0;e.$$||se('Cannot pass "'+bt(e)+'" as a '+this.name),e.$$.ptr||se("Cannot pass deleted object as a pointer of type "+this.name);var t=e.$$.ptrType.registeredClass,n;return Ie(e.$$.ptr,t,this.registeredClass)}function Ue(r,e){var t;if(null===e)return this.isReference&&se("null is not a valid "+this.name),this.isSmartPointer?(t=this.rawConstructor(),null!==r&&r.push(this.rawDestructor,t),t):0;e.$$||se('Cannot pass "'+bt(e)+'" as a '+this.name),e.$$.ptr||se("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&e.$$.ptrType.isConst&&se("Cannot convert argument of type "+(e.$$.smartPtrType||e.$$.ptrType).name+" to parameter type "+this.name);var n=e.$$.ptrType.registeredClass,o,t;if(t=Ie(e.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(void 0===e.$$.smartPtr&&se("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:e.$$.smartPtrType===this?t=e.$$.smartPtr:se("Cannot convert argument of type "+(e.$$.smartPtrType||e.$$.ptrType).name+" to parameter type "+this.name);break;case 1:t=e.$$.smartPtr;break;case 2:e.$$.smartPtrType===this?t=e.$$.smartPtr:(o=e.clone(),t=this.rawShare(t,vt.toHandle(function(){o.delete()})),null!==r&&r.push(this.rawDestructor,t));break;default:se("Unsupporting sharing policy")}return t}function Le(r,e){if(null===e)return this.isReference&&se("null is not a valid "+this.name),0;e.$$||se('Cannot pass "'+bt(e)+'" as a '+this.name),e.$$.ptr||se("Cannot pass deleted object as a pointer of type "+this.name),e.$$.ptrType.isConst&&se("Cannot convert argument of type "+e.$$.ptrType.name+" to parameter type "+this.name);var t=e.$$.ptrType.registeredClass,n;return Ie(e.$$.ptr,t,this.registeredClass)}function He(r){return r=this.rawGetPointee?this.rawGetPointee(r):r}function qe(r){this.rawDestructor&&this.rawDestructor(r)}function Ye(r){null!==r&&r.delete()}function Ge(){Xe.prototype.getPointee=He,Xe.prototype.destructor=qe,Xe.prototype.argPackAdvance=8,Xe.prototype.readValueFromPointer=Vr,Xe.prototype.deleteObject=Ye,Xe.prototype.fromWireType=Fe}function Xe(r,e,t,n,o,a,i,s,u,c,l){this.name=r,this.registeredClass=e,this.isReference=t,this.isConst=n,this.isSmartPointer=o,this.pointeeType=a,this.sharingPolicy=i,this.rawGetPointee=s,this.rawConstructor=u,this.rawShare=c,this.rawDestructor=l,o||void 0!==e.baseClass?this.toWireType=Ue:(this.toWireType=n?Ve:Le,this.destructorFunction=null)}function Ke(r,e,t){u.hasOwnProperty(r)||Zr("Replacing nonexistant public symbol"),void 0!==u[r].overloadTable&&void 0!==t?u[r].overloadTable[t]=e:(u[r]=e,u[r].argCount=t)}function Je(r,e,t){var r=u["dynCall_"+r];return t&&t.length?r.apply(null,[e].concat(t)):r.call(null,e)}function Ze(r,e,t){return r.includes("j")?Je(r,e,t):$r(e).apply(null,t);var n}function Qe(r,e){var t=[];return function(){return t.length=0,Object.assign(t,arguments),Ze(r,e,t)}}function rt(r,e){function t(){return r.includes("j")?Qe(r,e):$r(e)}r=ae(r);var n=t();return"function"!=typeof n&&se("unknown function pointer with signature "+r+": "+e),n}var et=void 0;function tt(r){var e=uo(r),r=ae(e);return so(e),r}function nt(r,e){var t=[],n={};function o(r){n[r]||Lr[r]||(Hr[r]?Hr[r].forEach(o):(t.push(r),n[r]=!0))}throw e.forEach(o),new et(r+": "+t.map(tt).join([", "]))}function ot(i,r,e,s,t,u,n,c,o,l,f,a,d){f=ae(f),u=rt(t,u),c=c&&rt(n,c),l=l&&rt(o,l),d=rt(a,d);var p=Gr(f);Be(p,function(){nt("Cannot construct "+f+" due to unbound types",[s])}),Qr([i,r,e],s?[s]:[],function(r){var e,t;r=r[0];var t=s?(e=r.registeredClass).instancePrototype:Ne.prototype,n=Xr(p,function(){if(Object.getPrototypeOf(this)!==o)throw new ie("Use 'new' to construct "+f);if(void 0===a.constructor_body)throw new ie(f+" has no accessible constructor");var r=a.constructor_body[arguments.length];if(void 0===r)throw new ie("Tried to invoke ctor of "+f+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(a.constructor_body).toString()+") parameters instead!");return r.apply(this,arguments)}),o=Object.create(t,{constructor:{value:n}});n.prototype=o;var a=new We(f,n,o,d,e,u,c,l),r=new Xe(f,a,!0,!1,!1),t=new Xe(f+"*",a,!1,!1,!1),e=new Xe(f+" const*",a,!1,!0,!1);return we[i]={pointerType:t,constPointerType:e},Ke(p,n),[r,t,e]})}function at(r,e){for(var t=[],n=0;n<r;n++)t.push(R[e+4*n>>2]);return t}function it(r,e){if(!(r instanceof Function))throw new TypeError("new_ called with constructor type "+typeof r+" which is not a function");var t=Xr(r.name||"unknownFunctionName",function(){});t.prototype=r.prototype;var t=new t,e=r.apply(t,e);return e instanceof Object?e:t}function st(r,e,t,n,o){var a=e.length;a<2&&se("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var i=null!==e[1]&&null!==t,s=!1,u=1;u<e.length;++u)if(null!==e[u]&&void 0===e[u].destructorFunction){s=!0;break}for(var t="void"!==e[0].name,c="",l="",u=0;u<a-2;++u)c+=(0!==u?", ":"")+"arg"+u,l+=(0!==u?", ":"")+"arg"+u+"Wired";var f="return function "+Gr(r)+"("+c+") {\nif (arguments.length !== "+(a-2)+") {\nthrowBindingError('function "+r+" called with ' + arguments.length + ' arguments, expected "+(a-2)+" args!');\n}\n";s&&(f+="var destructors = [];\n");var d=s?"destructors":"null",p=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],h=[se,n,o,Ir,e[0],e[1]];i&&(f+="var thisWired = classParam.toWireType("+d+", this);\n");for(var u=0,m;u<a-2;++u)f+="var arg"+u+"Wired = argType"+u+".toWireType("+d+", arg"+u+"); // "+e[u+2].name+"\n",p.push("argType"+u),h.push(e[u+2]);if(f+=(t?"var rv = ":"")+"invoker(fn"+(0<(l=i?"thisWired"+(0<l.length?", ":"")+l:l).length?", ":"")+l+");\n",s)f+="runDestructors(destructors);\n";else for(var u=i?1:2;u<e.length;++u){var v=1===u?"thisWired":"arg"+(u-2)+"Wired";null!==e[u].destructorFunction&&(f+=v+"_dtor("+v+"); // "+e[u].name+"\n",p.push(v+"_dtor"),h.push(e[u].destructorFunction))}return t&&(f+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),p.push(f+="}\n"),it(Function,p).apply(null,h)}function ut(r,n,e,t,o,a){S(0<n);var i=at(n,e);o=rt(t,o),Qr([],[r],function(e){var t="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[n-1])throw new ie("Cannot register multiple constructors with identical number of parameters ("+(n-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[n-1]=()=>{nt("Cannot construct "+e.name+" due to unbound types",i)},Qr([],i,function(r){return r.splice(1,0,null),e.registeredClass.constructor_body[n-1]=st(t,r,null,o,a),[]}),[]})}function ct(r,a,i,e,t,s,u,c){var l=at(i,e);a=ae(a),s=rt(t,s),Qr([],[r],function(e){var t=(e=e[0]).name+"."+a;function r(){nt("Cannot call "+t+" due to unbound types",l)}a.startsWith("@@")&&(a=Symbol[a.substring(2)]),c&&e.registeredClass.pureVirtualFunctions.push(a);var n=e.registeredClass.instancePrototype,o=n[a];return void 0===o||void 0===o.overloadTable&&o.className!==e.name&&o.argCount===i-2?(r.argCount=i-2,r.className=e.name,n[a]=r):(ze(n,a,t),n[a].overloadTable[i-2]=r),Qr([],l,function(r){var r=st(t,r,e,s,u);return void 0===n[a].overloadTable?(r.argCount=i-2,n[a]=r):n[a].overloadTable[i-2]=r,[]}),[]})}var lt=[],ft=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function dt(r){4<r&&0==--ft[r].refcount&&(ft[r]=void 0,lt.push(r))}function pt(){for(var r=0,e=5;e<ft.length;++e)void 0!==ft[e]&&++r;return r}function ht(){for(var r=5;r<ft.length;++r)if(void 0!==ft[r])return ft[r];return null}function mt(){u.count_emval_handles=pt,u.get_first_emval=ht}var vt={toValue:r=>(r||se("Cannot use deleted val. handle = "+r),ft[r].value),toHandle:r=>{switch(r){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var e=lt.length?lt.pop():ft.length;return ft[e]={refcount:1,value:r},e}}};function yt(r,e){ue(r,{name:e=ae(e),fromWireType:function(r){var e=vt.toValue(r);return dt(r),e},toWireType:function(r,e){return vt.toHandle(e)},argPackAdvance:8,readValueFromPointer:Vr,destructorFunction:null})}function wt(r,e,t){switch(e){case 0:return function(r){var e=t?A:x;return this.fromWireType(e[r])};case 1:return function(r){var e=t?$:O;return this.fromWireType(e[r>>1])};case 2:return function(r){var e=t?j:R;return this.fromWireType(e[r>>2])};default:throw new TypeError("Unknown integer type: "+r)}}function gt(r,e,t,n){var t=te(t);function o(){}e=ae(e),o.values={},ue(r,{name:e,constructor:o,fromWireType:function(r){return this.constructor.values[r]},toWireType:function(r,e){return e.value},argPackAdvance:8,readValueFromPointer:wt(e,t,n),destructorFunction:null}),Be(e,o)}function _t(r,e){var t=Lr[r];return void 0===t&&se(e+" has unknown type "+tt(r)),t}function Et(r,e,t){var n=_t(r,"enum");e=ae(e);var r=n.constructor,n=Object.create(n.constructor.prototype,{value:{value:t},constructor:{value:Xr(n.name+"_"+e,function(){})}});r.values[t]=n,r[e]=n}function bt(r){if(null===r)return"null";var e=typeof r;return"object"==e||"array"==e||"function"==e?r.toString():""+r}function kt(r,e){switch(e){case 2:return function(r){return this.fromWireType(N[r>>2])};case 3:return function(r){return this.fromWireType(z[r>>3])};default:throw new TypeError("Unknown float type: "+r)}}function Tt(r,e,t){var t=te(t);ue(r,{name:e=ae(e),fromWireType:function(r){return r},toWireType:function(r,e){return e},argPackAdvance:8,readValueFromPointer:kt(e,t),destructorFunction:null})}function Pt(e,t,r,n,o,a){var i=at(t,r);e=ae(e),o=rt(n,o),Be(e,function(){nt("Cannot call "+e+" due to unbound types",i)},t-1),Qr([],i,function(r){var r=[r[0],null].concat(r.slice(1));return Ke(e,st(e,r,null,o,a),t-1),[]})}function Dt(r,e,t){switch(e){case 0:return t?function r(e){return A[e]}:function r(e){return x[e]};case 1:return t?function r(e){return $[e>>1]}:function r(e){return O[e>>1]};case 2:return t?function r(e){return j[e>>2]}:function r(e){return R[e>>2]};default:throw new TypeError("Unknown integer type: "+r)}}function Ct(r,e,t,n,o){e=ae(e),-1===o&&(o=4294967295);var a=te(t),o=r=>r,i,o;0===n&&(i=32-8*t,o=r=>r<<i>>>i);var t=e.includes("unsigned"),s=(r,e)=>{},t,t=t?function(r,e){return this.name,e>>>0}:function(r,e){return this.name,e};ue(r,{name:e,fromWireType:o,toWireType:t,argPackAdvance:8,readValueFromPointer:Dt(e,a,0!==n),destructorFunction:null})}function St(r,e,t){var n,o=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][e];function a(r){var e=R,t=e[r>>=2],r=e[r+1];return new o(F,r,t)}ue(r,{name:t=ae(t),fromWireType:a,argPackAdvance:8,readValueFromPointer:a},{ignoreDuplicateRegistrations:!0})}function Mt(r,e){var l="std::string"===(e=ae(e));ue(r,{name:e,fromWireType:function(r){var e=R[r>>2],t=r+4,n;if(l)for(var o=t,a=0;a<=e;++a){var i=t+a,s,u;a!=e&&0!=x[i]||(u=W(o,i-o),void 0===n?n=u:(n+=String.fromCharCode(0),n+=u),o=i+1)}else{for(var c=new Array(e),a=0;a<e;++a)c[a]=String.fromCharCode(x[t+a]);n=c.join("")}return so(r),n},toWireType:function(r,e){var t,n="string"==typeof(e=e instanceof ArrayBuffer?new Uint8Array(e):e);n||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int8Array||se("Cannot pass non-string to std::string");var t=l&&n?U(e):e.length,o=io(4+t+1),a=o+4;if(R[o>>2]=t,l&&n)V(e,a,t+1);else if(n)for(var i=0;i<t;++i){var s=e.charCodeAt(i);255<s&&(so(a),se("String has UTF-16 code units that do not fit in 8 bits")),x[a+i]=s}else for(var i=0;i<t;++i)x[a+i]=e[i];return null!==r&&r.push(so,o),o},argPackAdvance:8,readValueFromPointer:Vr,destructorFunction:function(r){so(r)}})}var Ft="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function At(r,e){for(var t=r,n=r>>1,o=n+e/2;!(o<=n)&&O[n];)++n;if(32<(t=n<<1)-r&&Ft)return Ft.decode(x.subarray(r,t));for(var a="",i=0;!(e/2<=i);++i){var s=$[r+2*i>>1];if(0==s)break;a+=String.fromCharCode(s)}return a}function xt(r,e,t){if((t=void 0===t?2147483647:t)<2)return 0;for(var n=e,o=(t-=2)<2*r.length?t/2:r.length,a=0;a<o;++a){var i=r.charCodeAt(a);$[e>>1]=i,e+=2}return $[e>>1]=0,e-n}function $t(r){return 2*r.length}function Ot(r,e){for(var t=0,n="";!(e/4<=t);){var o=j[r+4*t>>2],a;if(0==o)break;++t,65536<=o?(a=o-65536,n+=String.fromCharCode(55296|a>>10,56320|1023&a)):n+=String.fromCharCode(o)}return n}function jt(r,e,t){if((t=void 0===t?2147483647:t)<4)return 0;for(var n=e,o=n+t-4,a=0;a<r.length;++a){var i=r.charCodeAt(a),s,i;if(55296<=i&&i<=57343&&(i=65536+((1023&i)<<10)|1023&r.charCodeAt(++a)),j[e>>2]=i,o<(e+=4)+4)break}return j[e>>2]=0,e-n}function Rt(r){for(var e=0,t=0;t<r.length;++t){var n=r.charCodeAt(t);55296<=n&&n<=57343&&++t,e+=4}return e}function Nt(r,c,o){var l,a,f,i,d;o=ae(o),2===c?(l=At,a=xt,i=$t,f=()=>O,d=1):4===c&&(l=Ot,a=jt,i=Rt,f=()=>R,d=2),ue(r,{name:o,fromWireType:function(r){for(var e=R[r>>2],t=f(),n,o=r+4,a=0;a<=e;++a){var i=r+4+a*c,s,u;a!=e&&0!=t[i>>d]||(u=l(o,i-o),void 0===n?n=u:(n+=String.fromCharCode(0),n+=u),o=i+c)}return so(r),n},toWireType:function(r,e){"string"!=typeof e&&se("Cannot pass non-string to C++ string type "+o);var t=i(e),n=io(4+t+c);return R[n>>2]=t>>d,a(e,n+4,t+c),null!==r&&r.push(so,n),n},argPackAdvance:8,readValueFromPointer:Vr,destructorFunction:function(r){so(r)}})}function zt(r,e,t,n,o,a){Wr[r]={name:ae(e),rawConstructor:rt(t,n),rawDestructor:rt(o,a),fields:[]}}function Bt(r,e,t,n,o,a,i,s,u,c){Wr[r].fields.push({fieldName:ae(e),getterReturnType:t,getter:rt(n,o),getterContext:a,setterArgumentType:i,setter:rt(s,u),setterContext:c})}function Wt(r,e){ue(r,{isVoid:!0,name:e=ae(e),argPackAdvance:0,fromWireType:function(){},toWireType:function(r,e){}})}function It(r,e,t){r=vt.toValue(r),e=_t(e,"emval::as");var n=[],o=vt.toHandle(n);return R[t>>2]=o,e.toWireType(n,r)}function Vt(r){var e=[];return R[r>>2]=vt.toHandle(e),e}var Ut={};function Lt(r){var e=Ut[r];return void 0===e?ae(r):e}var Ht=[];function qt(r,e,t,n,o){return(r=Ht[r])(e=vt.toValue(e),t=Lt(t),Vt(n),o)}function Yt(r,e,t,n){(r=Ht[r])(e=vt.toValue(e),t=Lt(t),null,n)}function Gt(r,e){return(r=vt.toValue(r))==(e=vt.toValue(e))}function Xt(r){var e=Ht.length;return Ht.push(r),e}function Kt(r,e){for(var t=new Array(r),n=0;n<r;++n)t[n]=_t(R[e+n*b>>2],"parameter "+n);return t}var Jt=[];function Zt(r,e){var t=Kt(r,e),n=t[0],o=n.name+"_$"+t.slice(1).map(function(r){return r.name}).join("_")+"$",e;if(void 0!==(e=Jt[o]))return e;for(var a=["retType"],i=[n],s="",u=0;u<r-1;++u)s+=(0!==u?", ":"")+"arg"+u,a.push("argType"+u),i.push(t[1+u]);for(var c,l="return function "+Gr("methodCaller_"+o)+"(handle, name, destructors, args) {\n",f=0,u=0;u<r-1;++u)l+="    var arg"+u+" = argType"+u+".readValueFromPointer(args"+(f?"+"+f:"")+");\n",f+=t[u+1].argPackAdvance;l+="    var rv = handle[name]("+s+");\n";for(var u=0;u<r-1;++u)t[u+1].deleteObject&&(l+="    argType"+u+".deleteObject(arg"+u+");\n");n.isVoid||(l+="    return retType.toWireType(destructors, rv);\n"),a.push(l+="};\n");var d,e=Xt(it(Function,a).apply(null,i));return Jt[o]=e}function Qt(r,e){return r=vt.toValue(r),e=vt.toValue(e),vt.toHandle(r[e])}function rn(r){4<r&&(ft[r].refcount+=1)}function en(r){return vt.toHandle(Lt(r))}function tn(){return vt.toHandle({})}function nn(r){var e;Ir(vt.toValue(r)),dt(r)}function on(r,e,t){r=vt.toValue(r),e=vt.toValue(e),t=vt.toValue(t),r[e]=t}function an(r,e){var e=(r=_t(r,"_emval_take_value")).readValueFromPointer(e);return vt.toHandle(e)}function sn(){lr("")}function un(r,e,t){x.copyWithin(r,e,e+t)}function cn(){return 2147483648}function ln(r){try{return P.grow(r-F.byteLength+65535>>>16),L(P.buffer),1}catch(r){}}function fn(r){var e=x.length,t=cn();if(t<(r>>>=0))return!1;for(var n=(r,e)=>r+(e-r%e)%e,o=1;o<=4;o*=2){var a=e*(1+.2/o),a=Math.min(a,r+100663296),i,s;if(ln(Math.min(t,n(Math.max(r,a),65536))))return!0}return!1}var dn={};function pn(){return e||"./this.program"}function hn(){if(!hn.strings){var r,e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:pn()},t;for(t in dn)void 0===dn[t]?delete e[t]:e[t]=dn[t];var n=[],t;for(t in e)n.push(t+"="+e[t]);hn.strings=n}return hn.strings}function mn(r,e,t){for(var n=0;n<r.length;++n)A[e++>>0]=r.charCodeAt(n);t||(A[e>>0]=0)}var vn={isAbs:r=>"/"===r.charAt(0),splitPath:r=>{var e;return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(r).slice(1)},normalizeArray:(r,e)=>{for(var t=0,n=r.length-1;0<=n;n--){var o=r[n];"."===o?r.splice(n,1):".."===o?(r.splice(n,1),t++):t&&(r.splice(n,1),t--)}if(e)for(;t;t--)r.unshift("..");return r},normalize:r=>{var e=vn.isAbs(r),t="/"===r.substr(-1);return(r=!(r=vn.normalizeArray(r.split("/").filter(r=>!!r),!e).join("/"))&&!e?".":r)&&t&&(r+="/"),(e?"/":"")+r},dirname:r=>{var e=vn.splitPath(r),r=e[0],e=e[1];return r||e?r+(e=e&&e.substr(0,e.length-1)):"."},basename:r=>{if("/"===r)return"/";var e=(r=(r=vn.normalize(r)).replace(/\/$/,"")).lastIndexOf("/");return-1===e?r:r.substr(e+1)},join:function(){var r=Array.prototype.slice.call(arguments);return vn.normalize(r.join("/"))},join2:(r,e)=>vn.normalize(r+"/"+e)};function yn(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var r=new Uint8Array(1);return()=>(crypto.getRandomValues(r),r[0])}if(s)try{var e=require("crypto");return()=>e.randomBytes(1)[0]}catch(r){}return()=>lr("randomDevice")}var wn={resolve:function(){for(var r="",e=!1,t=arguments.length-1;-1<=t&&!e;t--){var n=0<=t?arguments[t]:Tn.cwd();if("string"!=typeof n)throw new TypeError("Arguments to path.resolve must be strings");if(!n)return"";r=n+"/"+r,e=vn.isAbs(n)}return(e?"/":"")+(r=vn.normalizeArray(r.split("/").filter(r=>!!r),!e).join("/"))||"."},relative:(r,e)=>{function t(r){for(var e=0;e<r.length&&""===r[e];e++);for(var t=r.length-1;0<=t&&""===r[t];t--);return t<e?[]:r.slice(e,t-e+1)}r=wn.resolve(r).substr(1),e=wn.resolve(e).substr(1);for(var n=t(r.split("/")),o=t(e.split("/")),a=Math.min(n.length,o.length),i=a,s=0;s<a;s++)if(n[s]!==o[s]){i=s;break}for(var u=[],s=i;s<n.length;s++)u.push("..");return(u=u.concat(o.slice(i))).join("/")}};function gn(r,e,t){var t=0<t?t:U(r)+1,t=new Array(t),r=I(r,t,0,t.length);return e&&(t.length=r),t}var _n={ttys:[],init:function(){},shutdown:function(){},register:function(r,e){_n.ttys[r]={input:[],output:[],ops:e},Tn.registerDevice(r,_n.stream_ops)},stream_ops:{open:function(r){var e=_n.ttys[r.node.rdev];if(!e)throw new Tn.ErrnoError(43);r.tty=e,r.seekable=!1},close:function(r){r.tty.ops.fsync(r.tty)},fsync:function(r){r.tty.ops.fsync(r.tty)},read:function(r,e,t,n,o){if(!r.tty||!r.tty.ops.get_char)throw new Tn.ErrnoError(60);for(var a=0,i=0,s;i<n;i++){try{s=r.tty.ops.get_char(r.tty)}catch(r){throw new Tn.ErrnoError(29)}if(void 0===s&&0===a)throw new Tn.ErrnoError(6);if(null==s)break;a++,e[t+i]=s}return a&&(r.node.timestamp=Date.now()),a},write:function(r,e,t,n,o){if(!r.tty||!r.tty.ops.put_char)throw new Tn.ErrnoError(60);try{for(var a=0;a<n;a++)r.tty.ops.put_char(r.tty,e[t+a])}catch(r){throw new Tn.ErrnoError(29)}return n&&(r.node.timestamp=Date.now()),a}},default_tty_ops:{get_char:function(r){if(!r.input.length){var e=null;if(s){var t=256,n=Buffer.alloc(t),o=0;try{o=v.readSync(process.stdin.fd,n,0,t,-1)}catch(r){if(!r.toString().includes("EOF"))throw r;o=0}e=0<o?n.slice(0,o).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(e=window.prompt("Input: "))&&(e+="\n"):"function"==typeof readline&&null!==(e=readline())&&(e+="\n");if(!e)return null;r.input=gn(e,!0)}return r.input.shift()},put_char:function(r,e){null===e||10===e?(_(B(r.output,0)),r.output=[]):0!=e&&r.output.push(e)},fsync:function(r){r.output&&0<r.output.length&&(_(B(r.output,0)),r.output=[])}},default_tty1_ops:{put_char:function(r,e){null===e||10===e?(E(B(r.output,0)),r.output=[]):0!=e&&r.output.push(e)},fsync:function(r){r.output&&0<r.output.length&&(E(B(r.output,0)),r.output=[])}}};function En(r){lr()}var bn={ops_table:null,mount:function(r){return bn.createNode(null,"/",16895,0)},createNode:function(r,e,t,n){if(Tn.isBlkdev(t)||Tn.isFIFO(t))throw new Tn.ErrnoError(63);bn.ops_table||(bn.ops_table={dir:{node:{getattr:bn.node_ops.getattr,setattr:bn.node_ops.setattr,lookup:bn.node_ops.lookup,mknod:bn.node_ops.mknod,rename:bn.node_ops.rename,unlink:bn.node_ops.unlink,rmdir:bn.node_ops.rmdir,readdir:bn.node_ops.readdir,symlink:bn.node_ops.symlink},stream:{llseek:bn.stream_ops.llseek}},file:{node:{getattr:bn.node_ops.getattr,setattr:bn.node_ops.setattr},stream:{llseek:bn.stream_ops.llseek,read:bn.stream_ops.read,write:bn.stream_ops.write,allocate:bn.stream_ops.allocate,mmap:bn.stream_ops.mmap,msync:bn.stream_ops.msync}},link:{node:{getattr:bn.node_ops.getattr,setattr:bn.node_ops.setattr,readlink:bn.node_ops.readlink},stream:{}},chrdev:{node:{getattr:bn.node_ops.getattr,setattr:bn.node_ops.setattr},stream:Tn.chrdev_stream_ops}});var n=Tn.createNode(r,e,t,n);return Tn.isDir(n.mode)?(n.node_ops=bn.ops_table.dir.node,n.stream_ops=bn.ops_table.dir.stream,n.contents={}):Tn.isFile(n.mode)?(n.node_ops=bn.ops_table.file.node,n.stream_ops=bn.ops_table.file.stream,n.usedBytes=0,n.contents=null):Tn.isLink(n.mode)?(n.node_ops=bn.ops_table.link.node,n.stream_ops=bn.ops_table.link.stream):Tn.isChrdev(n.mode)&&(n.node_ops=bn.ops_table.chrdev.node,n.stream_ops=bn.ops_table.chrdev.stream),n.timestamp=Date.now(),r&&(r.contents[e]=n,r.timestamp=n.timestamp),n},getFileDataAsTypedArray:function(r){return r.contents?r.contents.subarray?r.contents.subarray(0,r.usedBytes):new Uint8Array(r.contents):new Uint8Array(0)},expandFileStorage:function(r,e){var t=r.contents?r.contents.length:0,n,t;e<=t||(e=Math.max(e,t*(t<1048576?2:1.125)>>>0),0!=t&&(e=Math.max(e,256)),t=r.contents,r.contents=new Uint8Array(e),0<r.usedBytes&&r.contents.set(t.subarray(0,r.usedBytes),0))},resizeFileStorage:function(r,e){var t;r.usedBytes!=e&&(0==e?(r.contents=null,r.usedBytes=0):(t=r.contents,r.contents=new Uint8Array(e),t&&r.contents.set(t.subarray(0,Math.min(e,r.usedBytes))),r.usedBytes=e))},node_ops:{getattr:function(r){var e={};return e.dev=Tn.isChrdev(r.mode)?r.id:1,e.ino=r.id,e.mode=r.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=r.rdev,Tn.isDir(r.mode)?e.size=4096:Tn.isFile(r.mode)?e.size=r.usedBytes:Tn.isLink(r.mode)?e.size=r.link.length:e.size=0,e.atime=new Date(r.timestamp),e.mtime=new Date(r.timestamp),e.ctime=new Date(r.timestamp),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},setattr:function(r,e){void 0!==e.mode&&(r.mode=e.mode),void 0!==e.timestamp&&(r.timestamp=e.timestamp),void 0!==e.size&&bn.resizeFileStorage(r,e.size)},lookup:function(r,e){throw Tn.genericErrors[44]},mknod:function(r,e,t,n){return bn.createNode(r,e,t,n)},rename:function(r,e,t){if(Tn.isDir(r.mode)){var n;try{n=Tn.lookupNode(e,t)}catch(r){}if(n)for(var o in n.contents)throw new Tn.ErrnoError(55)}delete r.parent.contents[r.name],r.parent.timestamp=Date.now(),r.name=t,e.contents[t]=r,e.timestamp=r.parent.timestamp,r.parent=e},unlink:function(r,e){delete r.contents[e],r.timestamp=Date.now()},rmdir:function(r,e){var t,n;for(n in Tn.lookupNode(r,e).contents)throw new Tn.ErrnoError(55);delete r.contents[e],r.timestamp=Date.now()},readdir:function(r){var e=[".",".."],t;for(t in r.contents)r.contents.hasOwnProperty(t)&&e.push(t);return e},symlink:function(r,e,t){var e=bn.createNode(r,e,41471,0);return e.link=t,e},readlink:function(r){if(!Tn.isLink(r.mode))throw new Tn.ErrnoError(28);return r.link}},stream_ops:{read:function(r,e,t,n,o){var a=r.node.contents;if(o>=r.node.usedBytes)return 0;var i=Math.min(r.node.usedBytes-o,n);if(8<i&&a.subarray)e.set(a.subarray(o,o+i),t);else for(var s=0;s<i;s++)e[t+s]=a[o+s];return i},write:function(r,e,t,n,o,a){if(e.buffer===A.buffer&&(a=!1),!n)return 0;var i=r.node;if(i.timestamp=Date.now(),e.subarray&&(!i.contents||i.contents.subarray)){if(a)return i.contents=e.subarray(t,t+n),i.usedBytes=n;if(0===i.usedBytes&&0===o)return i.contents=e.slice(t,t+n),i.usedBytes=n;if(o+n<=i.usedBytes)return i.contents.set(e.subarray(t,t+n),o),n}if(bn.expandFileStorage(i,o+n),i.contents.subarray&&e.subarray)i.contents.set(e.subarray(t,t+n),o);else for(var s=0;s<n;s++)i.contents[o+s]=e[t+s];return i.usedBytes=Math.max(i.usedBytes,o+n),n},llseek:function(r,e,t){var e=e;if(1===t?e+=r.position:2===t&&Tn.isFile(r.node.mode)&&(e+=r.node.usedBytes),e<0)throw new Tn.ErrnoError(28);return e},allocate:function(r,e,t){bn.expandFileStorage(r.node,e+t),r.node.usedBytes=Math.max(r.node.usedBytes,e+t)},mmap:function(r,e,t,n,o){if(!Tn.isFile(r.node.mode))throw new Tn.ErrnoError(43);var a,i,r=r.node.contents;if(2&o||r.buffer!==F){if((0<t||t+e<r.length)&&(r=r.subarray?r.subarray(t,t+e):Array.prototype.slice.call(r,t,t+e)),i=!0,!(a=En(e)))throw new Tn.ErrnoError(48);A.set(r,a)}else i=!1,a=r.byteOffset;return{ptr:a,allocated:i}},msync:function(r,e,t,n,o){return bn.stream_ops.write(r,e,0,n,t,!1),0}}};function kn(e,t,n,r){var o=r?"":"al "+e;p(e,r=>{S(r,'Loading data file "'+e+'" failed (no arrayBuffer).'),t(new Uint8Array(r)),o&&cr(o)},r=>{if(!n)throw'Loading data file "'+e+'" failed.';n()}),o&&ur(o)}var Tn={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(r,e={})=>{if(!(r=wn.resolve(Tn.cwd(),r)))return{path:"",node:null};var t;if(8<(e=Object.assign({follow_mount:!0,recurse_count:0},e)).recurse_count)throw new Tn.ErrnoError(32);for(var n=vn.normalizeArray(r.split("/").filter(r=>!!r),!1),o=Tn.root,a="/",i=0;i<n.length;i++){var s=i===n.length-1;if(s&&e.parent)break;if(o=Tn.lookupNode(o,n[i]),a=vn.join2(a,n[i]),Tn.isMountpoint(o)&&(s&&!e.follow_mount||(o=o.mounted.root)),!s||e.follow)for(var u=0;Tn.isLink(o.mode);){var c=Tn.readlink(a),a=wn.resolve(vn.dirname(a),c),l,o=Tn.lookupPath(a,{recurse_count:e.recurse_count+1}).node;if(40<u++)throw new Tn.ErrnoError(32)}}return{path:a,node:o}},getPath:r=>{for(var e;;){if(Tn.isRoot(r)){var t=r.mount.mountpoint;return e?"/"!==t[t.length-1]?t+"/"+e:t+e:t}e=e?r.name+"/"+e:r.name,r=r.parent}},hashName:(r,e)=>{for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return(r+t>>>0)%Tn.nameTable.length},hashAddNode:r=>{var e=Tn.hashName(r.parent.id,r.name);r.name_next=Tn.nameTable[e],Tn.nameTable[e]=r},hashRemoveNode:r=>{var e=Tn.hashName(r.parent.id,r.name);if(Tn.nameTable[e]===r)Tn.nameTable[e]=r.name_next;else for(var t=Tn.nameTable[e];t;){if(t.name_next===r){t.name_next=r.name_next;break}t=t.name_next}},lookupNode:(r,e)=>{var t=Tn.mayLookup(r);if(t)throw new Tn.ErrnoError(t,r);for(var t=Tn.hashName(r.id,e),n=Tn.nameTable[t];n;n=n.name_next){var o=n.name;if(n.parent.id===r.id&&o===e)return n}return Tn.lookup(r,e)},createNode:(r,e,t,n)=>{var n=new Tn.FSNode(r,e,t,n);return Tn.hashAddNode(n),n},destroyNode:r=>{Tn.hashRemoveNode(r)},isRoot:r=>r===r.parent,isMountpoint:r=>!!r.mounted,isFile:r=>32768==(61440&r),isDir:r=>16384==(61440&r),isLink:r=>40960==(61440&r),isChrdev:r=>8192==(61440&r),isBlkdev:r=>24576==(61440&r),isFIFO:r=>4096==(61440&r),isSocket:r=>49152==(49152&r),flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:r=>{var e=Tn.flagModes[r];if(void 0===e)throw new Error("Unknown file open mode: "+r);return e},flagsToPermissionString:r=>{var e=["r","w","rw"][3&r];return 512&r&&(e+="w"),e},nodePermissions:(r,e)=>Tn.ignorePermissions||(!e.includes("r")||292&r.mode)&&(!e.includes("w")||146&r.mode)&&(!e.includes("x")||73&r.mode)?0:2,mayLookup:r=>{var e=Tn.nodePermissions(r,"x");return e||(r.node_ops.lookup?0:2)},mayCreate:(r,e)=>{try{var t=Tn.lookupNode(r,e);return 20}catch(r){}return Tn.nodePermissions(r,"wx")},mayDelete:(r,e,t)=>{var n;try{n=Tn.lookupNode(r,e)}catch(r){return r.errno}var r=Tn.nodePermissions(r,"wx");if(r)return r;if(t){if(!Tn.isDir(n.mode))return 54;if(Tn.isRoot(n)||Tn.getPath(n)===Tn.cwd())return 10}else if(Tn.isDir(n.mode))return 31;return 0},mayOpen:(r,e)=>r?Tn.isLink(r.mode)?32:Tn.isDir(r.mode)&&("r"!==Tn.flagsToPermissionString(e)||512&e)?31:Tn.nodePermissions(r,Tn.flagsToPermissionString(e)):44,MAX_OPEN_FDS:4096,nextfd:(r=0,e=Tn.MAX_OPEN_FDS)=>{for(var t=r;t<=e;t++)if(!Tn.streams[t])return t;throw new Tn.ErrnoError(33)},getStream:r=>Tn.streams[r],createStream:(r,e,t)=>{Tn.FSStream||(Tn.FSStream=function(){this.shared={}},Tn.FSStream.prototype={},Object.defineProperties(Tn.FSStream.prototype,{object:{get:function(){return this.node},set:function(r){this.node=r}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}},flags:{get:function(){return this.shared.flags},set:function(r){this.shared.flags=r}},position:{get:function(){return this.shared.position},set:function(r){this.shared.position=r}}})),r=Object.assign(new Tn.FSStream,r);var t=Tn.nextfd(e,t);return r.fd=t,Tn.streams[t]=r},closeStream:r=>{Tn.streams[r]=null},chrdev_stream_ops:{open:r=>{var e=Tn.getDevice(r.node.rdev);r.stream_ops=e.stream_ops,r.stream_ops.open&&r.stream_ops.open(r)},llseek:()=>{throw new Tn.ErrnoError(70)}},major:r=>r>>8,minor:r=>255&r,makedev:(r,e)=>r<<8|e,registerDevice:(r,e)=>{Tn.devices[r]={stream_ops:e}},getDevice:r=>Tn.devices[r],getMounts:r=>{for(var e=[],t=[r];t.length;){var n=t.pop();e.push(n),t.push.apply(t,n.mounts)}return e},syncfs:(e,t)=>{"function"==typeof e&&(t=e,e=!1),Tn.syncFSRequests++,1<Tn.syncFSRequests&&E("warning: "+Tn.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var n=Tn.getMounts(Tn.root.mount),o=0;function a(r){return Tn.syncFSRequests--,t(r)}function i(r){if(r)return i.errored?void 0:(i.errored=!0,a(r));++o>=n.length&&a(null)}n.forEach(r=>r.type.syncfs?void r.type.syncfs(r,e,i):i(null))},mount:(r,e,t)=>{var n="/"===t,o=!t,a;if(n&&Tn.root)throw new Tn.ErrnoError(10);if(!n&&!o){var a=Tn.lookupPath(t,{follow_mount:!1});if(t=a.path,a=a.node,Tn.isMountpoint(a))throw new Tn.ErrnoError(10);if(!Tn.isDir(a.mode))throw new Tn.ErrnoError(54)}var t={type:r,opts:e,mountpoint:t,mounts:[]},r=r.mount(t);return(r.mount=t).root=r,n?Tn.root=r:a&&(a.mounted=t,a.mount&&a.mount.mounts.push(t)),r},unmount:r=>{var e=Tn.lookupPath(r,{follow_mount:!1});if(!Tn.isMountpoint(e.node))throw new Tn.ErrnoError(28);var r=e.node,e=r.mounted,n=Tn.getMounts(e);Object.keys(Tn.nameTable).forEach(r=>{for(var e=Tn.nameTable[r];e;){var t=e.name_next;n.includes(e.mount)&&Tn.destroyNode(e),e=t}}),r.mounted=null;var e=r.mount.mounts.indexOf(e);r.mount.mounts.splice(e,1)},lookup:(r,e)=>r.node_ops.lookup(r,e),mknod:(r,e,t)=>{var n,o=Tn.lookupPath(r,{parent:!0}).node,a=vn.basename(r);if(!a||"."===a||".."===a)throw new Tn.ErrnoError(28);var r=Tn.mayCreate(o,a);if(r)throw new Tn.ErrnoError(r);if(!o.node_ops.mknod)throw new Tn.ErrnoError(63);return o.node_ops.mknod(o,a,e,t)},create:(r,e)=>(e=void 0!==e?e:438,e&=4095,Tn.mknod(r,e|=32768,0)),mkdir:(r,e)=>(e=void 0!==e?e:511,e&=1023,Tn.mknod(r,e|=16384,0)),mkdirTree:(r,e)=>{for(var t=r.split("/"),n="",o=0;o<t.length;++o)if(t[o]){n+="/"+t[o];try{Tn.mkdir(n,e)}catch(r){if(20!=r.errno)throw r}}},mkdev:(r,e,t)=>(void 0===t&&(t=e,e=438),Tn.mknod(r,e|=8192,t)),symlink:(r,e)=>{if(!wn.resolve(r))throw new Tn.ErrnoError(44);var t,n=Tn.lookupPath(e,{parent:!0}).node;if(!n)throw new Tn.ErrnoError(44);var o=vn.basename(e),e=Tn.mayCreate(n,o);if(e)throw new Tn.ErrnoError(e);if(!n.node_ops.symlink)throw new Tn.ErrnoError(63);return n.node_ops.symlink(n,o,r)},rename:(r,e)=>{var t=vn.dirname(r),n=vn.dirname(e),o=vn.basename(r),a=vn.basename(e),i,s,u,i=Tn.lookupPath(r,{parent:!0}),s=i.node,u=(i=Tn.lookupPath(e,{parent:!0})).node;if(!s||!u)throw new Tn.ErrnoError(44);if(s.mount!==u.mount)throw new Tn.ErrnoError(75);var i=Tn.lookupNode(s,o),n=wn.relative(r,n),c;if("."!==n.charAt(0))throw new Tn.ErrnoError(28);if("."!==(n=wn.relative(e,t)).charAt(0))throw new Tn.ErrnoError(55);try{c=Tn.lookupNode(u,a)}catch(r){}if(i!==c){var n=Tn.isDir(i.mode),o=Tn.mayDelete(s,o,n);if(o)throw new Tn.ErrnoError(o);if(o=c?Tn.mayDelete(u,a,n):Tn.mayCreate(u,a))throw new Tn.ErrnoError(o);if(!s.node_ops.rename)throw new Tn.ErrnoError(63);if(Tn.isMountpoint(i)||c&&Tn.isMountpoint(c))throw new Tn.ErrnoError(10);if(u!==s&&(o=Tn.nodePermissions(s,"w")))throw new Tn.ErrnoError(o);Tn.hashRemoveNode(i);try{s.node_ops.rename(i,u,a)}catch(r){throw r}finally{Tn.hashAddNode(i)}}},rmdir:r=>{var e,t=Tn.lookupPath(r,{parent:!0}).node,n=vn.basename(r),o=Tn.lookupNode(t,n),r=Tn.mayDelete(t,n,!0);if(r)throw new Tn.ErrnoError(r);if(!t.node_ops.rmdir)throw new Tn.ErrnoError(63);if(Tn.isMountpoint(o))throw new Tn.ErrnoError(10);t.node_ops.rmdir(t,n),Tn.destroyNode(o)},readdir:r=>{var e,r=Tn.lookupPath(r,{follow:!0}).node;if(!r.node_ops.readdir)throw new Tn.ErrnoError(54);return r.node_ops.readdir(r)},unlink:r=>{var e,t=Tn.lookupPath(r,{parent:!0}).node;if(!t)throw new Tn.ErrnoError(44);var n=vn.basename(r),o=Tn.lookupNode(t,n),r=Tn.mayDelete(t,n,!1);if(r)throw new Tn.ErrnoError(r);if(!t.node_ops.unlink)throw new Tn.ErrnoError(63);if(Tn.isMountpoint(o))throw new Tn.ErrnoError(10);t.node_ops.unlink(t,n),Tn.destroyNode(o)},readlink:r=>{var e,r=Tn.lookupPath(r).node;if(!r)throw new Tn.ErrnoError(44);if(!r.node_ops.readlink)throw new Tn.ErrnoError(28);return wn.resolve(Tn.getPath(r.parent),r.node_ops.readlink(r))},stat:(r,e)=>{var t,e=Tn.lookupPath(r,{follow:!e}).node;if(!e)throw new Tn.ErrnoError(44);if(!e.node_ops.getattr)throw new Tn.ErrnoError(63);return e.node_ops.getattr(e)},lstat:r=>Tn.stat(r,!0),chmod:(r,e,t)=>{var r,n,r;if(!(r="string"==typeof r?Tn.lookupPath(r,{follow:!t}).node:r).node_ops.setattr)throw new Tn.ErrnoError(63);r.node_ops.setattr(r,{mode:4095&e|-4096&r.mode,timestamp:Date.now()})},lchmod:(r,e)=>{Tn.chmod(r,e,!0)},fchmod:(r,e)=>{var r=Tn.getStream(r);if(!r)throw new Tn.ErrnoError(8);Tn.chmod(r.node,e)},chown:(r,e,t,n)=>{var r,o,r;if(!(r="string"==typeof r?Tn.lookupPath(r,{follow:!n}).node:r).node_ops.setattr)throw new Tn.ErrnoError(63);r.node_ops.setattr(r,{timestamp:Date.now()})},lchown:(r,e,t)=>{Tn.chown(r,e,t,!0)},fchown:(r,e,t)=>{var r=Tn.getStream(r);if(!r)throw new Tn.ErrnoError(8);Tn.chown(r.node,e,t)},truncate:(r,e)=>{if(e<0)throw new Tn.ErrnoError(28);var t,n,t;if(!(t="string"==typeof r?Tn.lookupPath(r,{follow:!0}).node:r).node_ops.setattr)throw new Tn.ErrnoError(63);if(Tn.isDir(t.mode))throw new Tn.ErrnoError(31);if(!Tn.isFile(t.mode))throw new Tn.ErrnoError(28);var r=Tn.nodePermissions(t,"w");if(r)throw new Tn.ErrnoError(r);t.node_ops.setattr(t,{size:e,timestamp:Date.now()})},ftruncate:(r,e)=>{var r=Tn.getStream(r);if(!r)throw new Tn.ErrnoError(8);if(0==(2097155&r.flags))throw new Tn.ErrnoError(28);Tn.truncate(r.node,e)},utime:(r,e,t)=>{var n,r=Tn.lookupPath(r,{follow:!0}).node;r.node_ops.setattr(r,{timestamp:Math.max(e,t)})},open:(r,e,t)=>{if(""===r)throw new Tn.ErrnoError(44);var n;if(t=void 0===t?438:t,t=64&(e="string"==typeof e?Tn.modeStringToFlags(e):e)?4095&t|32768:0,"object"==typeof r)n=r;else{r=vn.normalize(r);try{var o,n=Tn.lookupPath(r,{follow:!(131072&e)}).node}catch(r){}}var a=!1;if(64&e)if(n){if(128&e)throw new Tn.ErrnoError(20)}else n=Tn.mknod(r,t,0),a=!0;if(!n)throw new Tn.ErrnoError(44);if(Tn.isChrdev(n.mode)&&(e&=-513),65536&e&&!Tn.isDir(n.mode))throw new Tn.ErrnoError(54);if(!a){var t=Tn.mayOpen(n,e);if(t)throw new Tn.ErrnoError(t)}512&e&&!a&&Tn.truncate(n,0),e&=-131713;var n=Tn.createStream({node:n,path:Tn.getPath(n),flags:e,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1});return n.stream_ops.open&&n.stream_ops.open(n),!u.logReadFiles||1&e||(Tn.readFiles||(Tn.readFiles={}),r in Tn.readFiles||(Tn.readFiles[r]=1)),n},close:r=>{if(Tn.isClosed(r))throw new Tn.ErrnoError(8);r.getdents&&(r.getdents=null);try{r.stream_ops.close&&r.stream_ops.close(r)}catch(r){throw r}finally{Tn.closeStream(r.fd)}r.fd=null},isClosed:r=>null===r.fd,llseek:(r,e,t)=>{if(Tn.isClosed(r))throw new Tn.ErrnoError(8);if(!r.seekable||!r.stream_ops.llseek)throw new Tn.ErrnoError(70);if(0!=t&&1!=t&&2!=t)throw new Tn.ErrnoError(28);return r.position=r.stream_ops.llseek(r,e,t),r.ungotten=[],r.position},read:(r,e,t,n,o)=>{if(n<0||o<0)throw new Tn.ErrnoError(28);if(Tn.isClosed(r))throw new Tn.ErrnoError(8);if(1==(2097155&r.flags))throw new Tn.ErrnoError(8);if(Tn.isDir(r.node.mode))throw new Tn.ErrnoError(31);if(!r.stream_ops.read)throw new Tn.ErrnoError(28);var a=void 0!==o;if(a){if(!r.seekable)throw new Tn.ErrnoError(70)}else o=r.position;var o=r.stream_ops.read(r,e,t,n,o);return a||(r.position+=o),o},write:(r,e,t,n,o,a)=>{if(n<0||o<0)throw new Tn.ErrnoError(28);if(Tn.isClosed(r))throw new Tn.ErrnoError(8);if(0==(2097155&r.flags))throw new Tn.ErrnoError(8);if(Tn.isDir(r.node.mode))throw new Tn.ErrnoError(31);if(!r.stream_ops.write)throw new Tn.ErrnoError(28);r.seekable&&1024&r.flags&&Tn.llseek(r,0,2);var i=void 0!==o;if(i){if(!r.seekable)throw new Tn.ErrnoError(70)}else o=r.position;var a=r.stream_ops.write(r,e,t,n,o,a);return i||(r.position+=a),a},allocate:(r,e,t)=>{if(Tn.isClosed(r))throw new Tn.ErrnoError(8);if(e<0||t<=0)throw new Tn.ErrnoError(28);if(0==(2097155&r.flags))throw new Tn.ErrnoError(8);if(!Tn.isFile(r.node.mode)&&!Tn.isDir(r.node.mode))throw new Tn.ErrnoError(43);if(!r.stream_ops.allocate)throw new Tn.ErrnoError(138);r.stream_ops.allocate(r,e,t)},mmap:(r,e,t,n,o)=>{if(0!=(2&n)&&0==(2&o)&&2!=(2097155&r.flags))throw new Tn.ErrnoError(2);if(1==(2097155&r.flags))throw new Tn.ErrnoError(2);if(!r.stream_ops.mmap)throw new Tn.ErrnoError(43);return r.stream_ops.mmap(r,e,t,n,o)},msync:(r,e,t,n,o)=>r.stream_ops.msync?r.stream_ops.msync(r,e,t,n,o):0,munmap:r=>0,ioctl:(r,e,t)=>{if(!r.stream_ops.ioctl)throw new Tn.ErrnoError(59);return r.stream_ops.ioctl(r,e,t)},readFile:(r,e={})=>{if(e.flags=e.flags||0,e.encoding=e.encoding||"binary","utf8"!==e.encoding&&"binary"!==e.encoding)throw new Error('Invalid encoding type "'+e.encoding+'"');var t,n=Tn.open(r,e.flags),o,a=Tn.stat(r).size,r=new Uint8Array(a);return Tn.read(n,r,0,a,0),"utf8"===e.encoding?t=B(r,0):"binary"===e.encoding&&(t=r),Tn.close(n),t},writeFile:(r,e,t={})=>{t.flags=t.flags||577;var n=Tn.open(r,t.flags,t.mode);if("string"==typeof e){var o=new Uint8Array(U(e)+1),r=I(e,o,0,o.length);Tn.write(n,o,0,r,void 0,t.canOwn)}else{if(!ArrayBuffer.isView(e))throw new Error("Unsupported data type");Tn.write(n,e,0,e.byteLength,void 0,t.canOwn)}Tn.close(n)},cwd:()=>Tn.currentPath,chdir:r=>{var e=Tn.lookupPath(r,{follow:!0});if(null===e.node)throw new Tn.ErrnoError(44);if(!Tn.isDir(e.node.mode))throw new Tn.ErrnoError(54);var r=Tn.nodePermissions(e.node,"x");if(r)throw new Tn.ErrnoError(r);Tn.currentPath=e.path},createDefaultDirectories:()=>{Tn.mkdir("/tmp"),Tn.mkdir("/home"),Tn.mkdir("/home/web_user")},createDefaultDevices:()=>{Tn.mkdir("/dev"),Tn.registerDevice(Tn.makedev(1,3),{read:()=>0,write:(r,e,t,n,o)=>n}),Tn.mkdev("/dev/null",Tn.makedev(1,3)),_n.register(Tn.makedev(5,0),_n.default_tty_ops),_n.register(Tn.makedev(6,0),_n.default_tty1_ops),Tn.mkdev("/dev/tty",Tn.makedev(5,0)),Tn.mkdev("/dev/tty1",Tn.makedev(6,0));var r=yn();Tn.createDevice("/dev","random",r),Tn.createDevice("/dev","urandom",r),Tn.mkdir("/dev/shm"),Tn.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{Tn.mkdir("/proc");var e=Tn.mkdir("/proc/self");Tn.mkdir("/proc/self/fd"),Tn.mount({mount:()=>{var r=Tn.createNode(e,"fd",16895,73);return r.node_ops={lookup:(r,e)=>{var t,n=Tn.getStream(+e);if(!n)throw new Tn.ErrnoError(8);var e={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>n.path}};return e.parent=e}},r}},{},"/proc/self/fd")},createStandardStreams:()=>{u.stdin?Tn.createDevice("/dev","stdin",u.stdin):Tn.symlink("/dev/tty","/dev/stdin"),u.stdout?Tn.createDevice("/dev","stdout",null,u.stdout):Tn.symlink("/dev/tty","/dev/stdout"),u.stderr?Tn.createDevice("/dev","stderr",null,u.stderr):Tn.symlink("/dev/tty1","/dev/stderr");var r=Tn.open("/dev/stdin",0),e=Tn.open("/dev/stdout",1),t=Tn.open("/dev/stderr",1)},ensureErrnoError:()=>{Tn.ErrnoError||(Tn.ErrnoError=function r(e,t){this.node=t,this.setErrno=function(r){this.errno=r},this.setErrno(e),this.message="FS error"},Tn.ErrnoError.prototype=new Error,Tn.ErrnoError.prototype.constructor=Tn.ErrnoError,[44].forEach(r=>{Tn.genericErrors[r]=new Tn.ErrnoError(r),Tn.genericErrors[r].stack="<generic error, no stack>"}))},staticInit:()=>{Tn.ensureErrnoError(),Tn.nameTable=new Array(4096),Tn.mount(bn,{},"/"),Tn.createDefaultDirectories(),Tn.createDefaultDevices(),Tn.createSpecialDirectories(),Tn.filesystems={MEMFS:bn}},init:(r,e,t)=>{Tn.init.initialized=!0,Tn.ensureErrnoError(),u.stdin=r||u.stdin,u.stdout=e||u.stdout,u.stderr=t||u.stderr,Tn.createStandardStreams()},quit:()=>{Tn.init.initialized=!1;for(var r=0;r<Tn.streams.length;r++){var e=Tn.streams[r];e&&Tn.close(e)}},getMode:(r,e)=>{var t=0;return r&&(t|=365),e&&(t|=146),t},findObject:(r,e)=>{var e=Tn.analyzePath(r,e);return e.exists?e.object:null},analyzePath:(r,e)=>{try{var t;r=(t=Tn.lookupPath(r,{follow:!e})).path}catch(r){}var n={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var t=Tn.lookupPath(r,{parent:!0});n.parentExists=!0,n.parentPath=t.path,n.parentObject=t.node,n.name=vn.basename(r),t=Tn.lookupPath(r,{follow:!e}),n.exists=!0,n.path=t.path,n.object=t.node,n.name=t.node.name,n.isRoot="/"===t.path}catch(r){n.error=r.errno}return n},createPath:(r,e,t,n)=>{r="string"==typeof r?r:Tn.getPath(r);for(var o=e.split("/").reverse();o.length;){var a=o.pop();if(a){var i=vn.join2(r,a);try{Tn.mkdir(i)}catch(r){}r=i}}return i},createFile:(r,e,t,n,o)=>{var e=vn.join2("string"==typeof r?r:Tn.getPath(r),e),o=Tn.getMode(n,o);return Tn.create(e,o)},createDataFile:(r,e,t,n,o,a)=>{var i=e;r&&(r="string"==typeof r?r:Tn.getPath(r),i=e?vn.join2(r,e):r);var n=Tn.getMode(n,o),o=Tn.create(i,n);if(t){if("string"==typeof t){for(var s=new Array(t.length),u=0,c=t.length;u<c;++u)s[u]=t.charCodeAt(u);t=s}Tn.chmod(o,146|n);var i=Tn.open(o,577);Tn.write(i,t,0,t.length,0,a),Tn.close(i),Tn.chmod(o,n)}return o},createDevice:(r,e,u,i)=>{var t=vn.join2("string"==typeof r?r:Tn.getPath(r),e),r=Tn.getMode(!!u,!!i);Tn.createDevice.major||(Tn.createDevice.major=64);var e=Tn.makedev(Tn.createDevice.major++,0);return Tn.registerDevice(e,{open:r=>{r.seekable=!1},close:r=>{i&&i.buffer&&i.buffer.length&&i(10)},read:(r,e,t,n,o)=>{for(var a=0,i=0,s;i<n;i++){try{s=u()}catch(r){throw new Tn.ErrnoError(29)}if(void 0===s&&0===a)throw new Tn.ErrnoError(6);if(null==s)break;a++,e[t+i]=s}return a&&(r.node.timestamp=Date.now()),a},write:(r,e,t,n,o)=>{for(var a=0;a<n;a++)try{i(e[t+a])}catch(r){throw new Tn.ErrnoError(29)}return n&&(r.node.timestamp=Date.now()),a}}),Tn.mkdev(t,r,e)},forceLoadFile:r=>{if(r.isDevice||r.isFolder||r.link||r.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!d)throw new Error("Cannot load without read() or XMLHttpRequest.");try{r.contents=gn(d(r.url),!0),r.usedBytes=r.contents.length}catch(r){throw new Tn.ErrnoError(29)}},createLazyFile:(r,e,u,t,n)=>{function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function r(e){if(!(e>this.length-1||e<0)){var t=e%this.chunkSize,e=e/this.chunkSize|0;return this.getter(e)[t]}},o.prototype.setDataGetter=function r(e){this.getter=e},o.prototype.cacheLength=function r(){var e=new XMLHttpRequest;if(e.open("HEAD",u,!1),e.send(null),!(200<=e.status&&e.status<300||304===e.status))throw new Error("Couldn't load "+u+". Status: "+e.status);var n=Number(e.getResponseHeader("Content-length")),t,o=(t=e.getResponseHeader("Accept-Ranges"))&&"bytes"===t,t=(t=e.getResponseHeader("Content-Encoding"))&&"gzip"===t,a=1048576;o||(a=n);var i=(r,e)=>{if(e<r)throw new Error("invalid range ("+r+", "+e+") or no bytes requested!");if(n-1<e)throw new Error("only "+n+" bytes available! programmer error!");var t=new XMLHttpRequest;if(t.open("GET",u,!1),n!==a&&t.setRequestHeader("Range","bytes="+r+"-"+e),t.responseType="arraybuffer",t.overrideMimeType&&t.overrideMimeType("text/plain; charset=x-user-defined"),t.send(null),!(200<=t.status&&t.status<300||304===t.status))throw new Error("Couldn't load "+u+". Status: "+t.status);return void 0!==t.response?new Uint8Array(t.response||[]):gn(t.responseText||"",!0)},s=this;s.setDataGetter(r=>{var e=r*a,t=(r+1)*a-1,t=Math.min(t,n-1);if(void 0===s.chunks[r]&&(s.chunks[r]=i(e,t)),void 0===s.chunks[r])throw new Error("doXHR failed!");return s.chunks[r]}),!t&&n||(a=n=1,n=this.getter(0).length,a=n,_("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=n,this._chunkSize=a,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!f)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var a=new o;Object.defineProperties(a,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var a={isDevice:!1,contents:a}}else var a={isDevice:!1,url:u};var i=Tn.createFile(r,e,a,t,n);a.contents?i.contents=a.contents:a.url&&(i.contents=null,i.url=a.url),Object.defineProperties(i,{usedBytes:{get:function(){return this.contents.length}}});var s={},c;function l(r,e,t,n,o){var a=r.node.contents;if(o>=a.length)return 0;var i=Math.min(a.length-o,n);if(a.slice)for(var s=0;s<i;s++)e[t+s]=a[o+s];else for(var s=0;s<i;s++)e[t+s]=a.get(o+s);return i}return Object.keys(i.stream_ops).forEach(r=>{var e=i.stream_ops[r];s[r]=function r(){return Tn.forceLoadFile(i),e.apply(null,arguments)}}),s.read=(r,e,t,n,o)=>(Tn.forceLoadFile(i),l(r,e,t,n,o)),s.mmap=(r,e,t,n,o)=>{Tn.forceLoadFile(i);var a=En(e);throw new Tn.ErrnoError(48)},i.stream_ops=s,i},createPreloadedFile:(t,n,r,o,a,i,s,u,c,l)=>{var f=n?wn.resolve(vn.join2(t,n)):t,d="cp "+f;function e(r){function e(r){l&&l(),u||Tn.createDataFile(t,n,r,o,a,c),i&&i(),cr(d)}Browser.handledByPreloadPlugin(r,f,e,()=>{s&&s(),cr(d)})||e(r)}ur(d),"string"==typeof r?kn(r,r=>e(r),s):e(r)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(s,u,c)=>{u=u||(()=>{}),c=c||(()=>{});var r=Tn.indexedDB();try{var l=r.open(Tn.DB_NAME(),Tn.DB_VERSION)}catch(r){return c(r)}l.onupgradeneeded=()=>{var r;_("creating db"),l.result.createObjectStore(Tn.DB_STORE_NAME)},l.onsuccess=()=>{var r,e=l.result.transaction([Tn.DB_STORE_NAME],"readwrite"),t=e.objectStore(Tn.DB_STORE_NAME),n=0,o=0,a=s.length;function i(){(0==o?u:c)()}s.forEach(r=>{var r=t.put(Tn.analyzePath(r).object.contents,r);r.onsuccess=()=>{++n+o==a&&i()},r.onerror=()=>{n+ ++o==a&&i()}}),e.onerror=c},l.onerror=c},loadFilesFromDB:(s,u,c)=>{u=u||(()=>{}),c=c||(()=>{});var r=Tn.indexedDB();try{var l=r.open(Tn.DB_NAME(),Tn.DB_VERSION)}catch(r){return c(r)}l.onupgradeneeded=c,l.onsuccess=()=>{var r=l.result;try{var e=r.transaction([Tn.DB_STORE_NAME],"readonly")}catch(r){return void c(r)}var t=e.objectStore(Tn.DB_STORE_NAME),n=0,o=0,a=s.length;function i(){(0==o?u:c)()}s.forEach(r=>{var e=t.get(r);e.onsuccess=()=>{Tn.analyzePath(r).exists&&Tn.unlink(r),Tn.createDataFile(vn.dirname(r),vn.basename(r),e.result,!0,!0,!0),++n+o==a&&i()},e.onerror=()=>{n+ ++o==a&&i()}}),e.onerror=c},l.onerror=c}},Pn={DEFAULT_POLLMASK:5,calculateAt:function(r,e,t){if(vn.isAbs(e))return e;var r,n,r;if(r=-100===r?Tn.cwd():Pn.getStreamFromFD(r).path,0!=e.length)return vn.join2(r,e);if(!t)throw new Tn.ErrnoError(44);return r},doStat:function(r,e,t){try{var n=r(e)}catch(r){if(r&&r.node&&vn.normalize(e)!==vn.normalize(Tn.getPath(r.node)))return-54;throw r}return j[t>>2]=n.dev,j[t+8>>2]=n.ino,j[t+12>>2]=n.mode,R[t+16>>2]=n.nlink,j[t+20>>2]=n.uid,j[t+24>>2]=n.gid,j[t+28>>2]=n.rdev,hr=[n.size>>>0,(pr=n.size,1<=+Math.abs(pr)?0<pr?(0|Math.min(+Math.floor(pr/4294967296),4294967295))>>>0:~~+Math.ceil((pr-(~~pr>>>0))/4294967296)>>>0:0)],j[t+40>>2]=hr[0],j[t+44>>2]=hr[1],j[t+48>>2]=4096,j[t+52>>2]=n.blocks,hr=[Math.floor(n.atime.getTime()/1e3)>>>0,(pr=Math.floor(n.atime.getTime()/1e3),1<=+Math.abs(pr)?0<pr?(0|Math.min(+Math.floor(pr/4294967296),4294967295))>>>0:~~+Math.ceil((pr-(~~pr>>>0))/4294967296)>>>0:0)],j[t+56>>2]=hr[0],j[t+60>>2]=hr[1],R[t+64>>2]=0,hr=[Math.floor(n.mtime.getTime()/1e3)>>>0,(pr=Math.floor(n.mtime.getTime()/1e3),1<=+Math.abs(pr)?0<pr?(0|Math.min(+Math.floor(pr/4294967296),4294967295))>>>0:~~+Math.ceil((pr-(~~pr>>>0))/4294967296)>>>0:0)],j[t+72>>2]=hr[0],j[t+76>>2]=hr[1],R[t+80>>2]=0,hr=[Math.floor(n.ctime.getTime()/1e3)>>>0,(pr=Math.floor(n.ctime.getTime()/1e3),1<=+Math.abs(pr)?0<pr?(0|Math.min(+Math.floor(pr/4294967296),4294967295))>>>0:~~+Math.ceil((pr-(~~pr>>>0))/4294967296)>>>0:0)],j[t+88>>2]=hr[0],j[t+92>>2]=hr[1],R[t+96>>2]=0,hr=[n.ino>>>0,(pr=n.ino,1<=+Math.abs(pr)?0<pr?(0|Math.min(+Math.floor(pr/4294967296),4294967295))>>>0:~~+Math.ceil((pr-(~~pr>>>0))/4294967296)>>>0:0)],j[t+104>>2]=hr[0],j[t+108>>2]=hr[1],0},doMsync:function(r,e,t,n,o){if(!Tn.isFile(e.node.mode))throw new Tn.ErrnoError(43);if(2&n)return 0;var r=x.slice(r,r+t);Tn.msync(e,r,o,t,n)},varargs:void 0,get:function(){var r;return Pn.varargs+=4,j[Pn.varargs-4>>2]},getStr:function(r){var e;return W(r)},getStreamFromFD:function(r){var r=Tn.getStream(r);if(!r)throw new Tn.ErrnoError(8);return r}};function Dn(n,o){var a=0;return hn().forEach(function(r,e){var t=o+a;mn(r,R[n+4*e>>2]=t),a+=r.length+1}),0}function Cn(r,e){var t=hn();R[r>>2]=t.length;var n=0;return t.forEach(function(r){n+=r.length+1}),R[e>>2]=n,0}function Sn(r){try{var e=Pn.getStreamFromFD(r);return Tn.close(e),0}catch(r){if(void 0===Tn||!(r instanceof Tn.ErrnoError))throw r;return r.errno}}function Mn(r,e,t,n){for(var o=0,a=0;a<t;a++){var i=R[e>>2],s=R[e+4>>2];e+=8;var i=Tn.read(r,A,i,s,n);if(i<0)return-1;if(o+=i,i<s)break}return o}function Fn(r,e,t,n){try{var o,a=Mn(Pn.getStreamFromFD(r),e,t);return R[n>>2]=a,0}catch(r){if(void 0===Tn||!(r instanceof Tn.ErrnoError))throw r;return r.errno}}function An(r,e){return e+2097152>>>0<4194305-!!r?(r>>>0)+4294967296*e:NaN}function xn(r,e,t,n,o){try{var a=An(e,t);if(isNaN(a))return 61;var i=Pn.getStreamFromFD(r);return Tn.llseek(i,a,n),hr=[i.position>>>0,(pr=i.position,1<=+Math.abs(pr)?0<pr?(0|Math.min(+Math.floor(pr/4294967296),4294967295))>>>0:~~+Math.ceil((pr-(~~pr>>>0))/4294967296)>>>0:0)],j[o>>2]=hr[0],j[o+4>>2]=hr[1],i.getdents&&0===a&&0===n&&(i.getdents=null),0}catch(r){if(void 0===Tn||!(r instanceof Tn.ErrnoError))throw r;return r.errno}}function $n(r,e,t,n){for(var o=0,a=0;a<t;a++){var i=R[e>>2],s=R[e+4>>2];e+=8;var s=Tn.write(r,A,i,s,n);if(s<0)return-1;o+=s}return o}function On(r,e,t,n){try{var o,a=$n(Pn.getStreamFromFD(r),e,t);return R[n>>2]=a,0}catch(r){if(void 0===Tn||!(r instanceof Tn.ErrnoError))throw r;return r.errno}}function jn(r){return r}function Rn(r){return r%4==0&&(r%100!=0||r%400==0)}function Nn(r,e){for(var t=0,n=0;n<=e;t+=r[n++]);return t}var zn=[31,29,31,30,31,30,31,31,30,31,30,31],Bn=[31,28,31,30,31,30,31,31,30,31,30,31];function Wn(r,e){for(var t=new Date(r.getTime());0<e;){var n=Rn(t.getFullYear()),o=t.getMonth(),n=(n?zn:Bn)[o];if(!(e>n-t.getDate()))return t.setDate(t.getDate()+e),t;e-=n-t.getDate()+1,t.setDate(1),o<11?t.setMonth(o+1):(t.setMonth(0),t.setFullYear(t.getFullYear()+1))}return t}function In(r,e){A.set(r,e)}function Vn(r,e,t,n){var o=j[n+40>>2],a={tm_sec:j[n>>2],tm_min:j[n+4>>2],tm_hour:j[n+8>>2],tm_mday:j[n+12>>2],tm_mon:j[n+16>>2],tm_year:j[n+20>>2],tm_wday:j[n+24>>2],tm_yday:j[n+28>>2],tm_isdst:j[n+32>>2],tm_gmtoff:j[n+36>>2],tm_zone:o?W(o):""},i=W(t),s={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"},u;for(u in s)i=i.replace(new RegExp(u,"g"),s[u]);var c=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["January","February","March","April","May","June","July","August","September","October","November","December"];function f(r,e,t){for(var n="number"==typeof r?r.toString():r||"";n.length<e;)n=t[0]+n;return n}function d(r,e){return f(r,e,"0")}function p(r,e){function t(r){return r<0?-1:0<r?1:0}var n;return n=0===(n=t(r.getFullYear()-e.getFullYear()))&&0===(n=t(r.getMonth()-e.getMonth()))?t(r.getDate()-e.getDate()):n}function h(r){switch(r.getDay()){case 0:return new Date(r.getFullYear()-1,11,29);case 1:return r;case 2:return new Date(r.getFullYear(),0,3);case 3:return new Date(r.getFullYear(),0,2);case 4:return new Date(r.getFullYear(),0,1);case 5:return new Date(r.getFullYear()-1,11,31);case 6:return new Date(r.getFullYear()-1,11,30)}}function m(r){var e=Wn(new Date(r.tm_year+1900,0,1),r.tm_yday),t=new Date(e.getFullYear(),0,4),r=new Date(e.getFullYear()+1,0,4),t=h(t),r=h(r);return p(t,e)<=0?p(r,e)<=0?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var v={"%a":function(r){return c[r.tm_wday].substring(0,3)},"%A":function(r){return c[r.tm_wday]},"%b":function(r){return l[r.tm_mon].substring(0,3)},"%B":function(r){return l[r.tm_mon]},"%C":function(r){var e;return d((r.tm_year+1900)/100|0,2)},"%d":function(r){return d(r.tm_mday,2)},"%e":function(r){return f(r.tm_mday,2," ")},"%g":function(r){return m(r).toString().substring(2)},"%G":m,"%H":function(r){return d(r.tm_hour,2)},"%I":function(r){var r=r.tm_hour;return 0==r?r=12:12<r&&(r-=12),d(r,2)},"%j":function(r){return d(r.tm_mday+Nn(Rn(r.tm_year+1900)?zn:Bn,r.tm_mon-1),3)},"%m":function(r){return d(r.tm_mon+1,2)},"%M":function(r){return d(r.tm_min,2)},"%n":function(){return"\n"},"%p":function(r){return 0<=r.tm_hour&&r.tm_hour<12?"AM":"PM"},"%S":function(r){return d(r.tm_sec,2)},"%t":function(){return"\t"},"%u":function(r){return r.tm_wday||7},"%U":function(r){var r=r.tm_yday+7-r.tm_wday;return d(Math.floor(r/7),2)},"%V":function(r){var e=Math.floor((r.tm_yday+7-(r.tm_wday+6)%7)/7),t,e,t;return(r.tm_wday+371-r.tm_yday-2)%7<=2&&e++,e?53==e&&(4==(t=(r.tm_wday+371-r.tm_yday)%7)||3==t&&Rn(r.tm_year)||(e=1)):(e=52,(4==(t=(r.tm_wday+7-r.tm_yday-1)%7)||5==t&&Rn(r.tm_year%400-1))&&e++),d(e,2)},"%w":function(r){return r.tm_wday},"%W":function(r){var r=r.tm_yday+7-(r.tm_wday+6)%7;return d(Math.floor(r/7),2)},"%y":function(r){return(r.tm_year+1900).toString().substring(2)},"%Y":function(r){return r.tm_year+1900},"%z":function(r){var e,r=0<=(e=r.tm_gmtoff),e=Math.abs(e)/60;return(r?"+":"-")+String("0000"+(e=e/60*100+e%60)).slice(-4)},"%Z":function(r){return r.tm_zone},"%%":function(){return"%"}},u,i=i.replace(/%%/g,"\0\0");for(u in v)i.includes(u)&&(i=i.replace(new RegExp(u,"g"),v[u](a)));var t=gn(i=i.replace(/\0\0/g,"%"),!1);return t.length>e?0:(In(t,r),t.length-1)}function Un(r,e,t,n,o){return Vn(r,e,t,n)}function Ln(r,e){r<128?e.push(r):e.push(r%128|128,r>>7)}function Hn(r){for(var e={i:"i32",j:"i32",f:"f32",d:"f64",p:"i32"},t={parameters:[],results:"v"==r[0]?[]:[e[r[0]]]},n=1;n<r.length;++n)t.parameters.push(e[r[n]]),"j"===r[n]&&t.parameters.push("i32");return t}function qn(r,e){var t=r.slice(0,1),n=r.slice(1),o={i:127,p:127,j:126,f:125,d:124};e.push(96),Ln(n.length,e);for(var a=0;a<n.length;++a)e.push(o[n[a]]);"v"==t?e.push(0):e.push(1,o[t])}function Yn(r,e){if("function"==typeof WebAssembly.Function)return new WebAssembly.Function(Hn(e),r);var t=[1];qn(e,t);var e=[0,97,115,109,1,0,0,0,1];Ln(t.length,e),e.push.apply(e,t),e.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0);var e=new WebAssembly.Module(new Uint8Array(e)),n,o;return new WebAssembly.Instance(e,{e:{f:r}}).exports.f}function Gn(r,e){if(Xn)for(var t=r;t<r+e;t++){var n=$r(t);n&&Xn.set(n,t)}}var Xn=void 0,Kn=[];function Jn(){if(Kn.length)return Kn.pop();try{q.grow(1)}catch(r){if(!(r instanceof RangeError))throw r;throw"Unable to grow wasm table. Set ALLOW_TABLE_GROWTH."}return q.length-1}function Zn(r,e){q.set(r,e),xr[r]=q.get(r)}function Qn(e,t){if(Xn||(Xn=new WeakMap,Gn(0,q.length)),Xn.has(e))return Xn.get(e);var n=Jn(),r;try{Zn(n,e)}catch(r){if(!(r instanceof TypeError))throw r;Zn(n,Yn(e,t))}return Xn.set(e,n),n}function ro(r){Xn.delete($r(r)),Kn.push(r)}Jr=u.InternalError=Kr(Error,"InternalError"),ne(),ie=u.BindingError=Kr(Error,"BindingError"),Re(),Pe(),Ge(),et=u.UnboundTypeError=Kr(Error,"UnboundTypeError"),mt();var r=function(r,e,t,n){this.parent=r=r||this,this.mount=r.mount,this.mounted=null,this.id=Tn.nextInode++,this.name=e,this.mode=t,this.node_ops={},this.stream_ops={},this.rdev=n},eo=365,to=146;Object.defineProperties(r.prototype,{read:{get:function(){return(this.mode&eo)==eo},set:function(r){r?this.mode|=eo:this.mode&=~eo}},write:{get:function(){return(this.mode&to)==to},set:function(r){r?this.mode|=to:this.mode&=~to}},isFolder:{get:function(){return Tn.isDir(this.mode)}},isDevice:{get:function(){return Tn.isChrdev(this.mode)}}}),Tn.FSNode=r,Tn.staticInit();var no={w:Tr,N:Sr,M:jr,a:Nr,k:zr,y:Ar,A:Br,c:Rr,ia:re,T:ee,ca:ce,s:ot,r:ut,h:ct,ba:yt,ha:gt,x:Et,I:Tt,n:Pt,v:Ct,m:St,H:Mt,D:Nt,t:zt,ja:Bt,da:Wt,ma:It,sa:qt,ka:Yt,pa:dt,na:Gt,R:Zt,oa:Qt,la:rn,E:en,fa:tn,ra:nn,qa:on,q:an,G:sn,$:un,_:fn,W:Dn,X:Cn,Y:Sn,Z:Fn,S:xn,F:On,Q:Ao,C:Mo,aa:Co,b:Po,e:So,j:Wo,o:jo,B:$o,ga:Io,l:No,d:To,g:Fo,O:zo,P:Oo,f:Do,u:xo,z:Ho,L:Vo,p:Bo,J:Lo,i:Ro,K:Uo,U:qo,ea:jn,V:Un},oo=gr(),ao=u.___wasm_call_ctors=function(){return(ao=u.___wasm_call_ctors=u.asm.ua).apply(null,arguments)},io=u._malloc=function(){return(io=u._malloc=u.asm.va).apply(null,arguments)},so=u._free=function(){return(so=u._free=u.asm.wa).apply(null,arguments)},uo=u.___getTypeName=function(){return(uo=u.___getTypeName=u.asm.ya).apply(null,arguments)},co=u.__embind_initialize_bindings=function(){return(co=u.__embind_initialize_bindings=u.asm.za).apply(null,arguments)},lo=u._setThrew=function(){return(lo=u._setThrew=u.asm.Aa).apply(null,arguments)},fo=u.setTempRet0=function(){return(fo=u.setTempRet0=u.asm.Ba).apply(null,arguments)},po=u.stackSave=function(){return(po=u.stackSave=u.asm.Ca).apply(null,arguments)},ho=u.stackRestore=function(){return(ho=u.stackRestore=u.asm.Da).apply(null,arguments)},mo=u.___cxa_can_catch=function(){return(mo=u.___cxa_can_catch=u.asm.Ea).apply(null,arguments)},vo=u.___cxa_is_pointer_type=function(){return(vo=u.___cxa_is_pointer_type=u.asm.Fa).apply(null,arguments)},yo=u.dynCall_viiji=function(){return(yo=u.dynCall_viiji=u.asm.Ga).apply(null,arguments)},wo=u.dynCall_viijii=function(){return(wo=u.dynCall_viijii=u.asm.Ha).apply(null,arguments)},go=u.dynCall_jiji=function(){return(go=u.dynCall_jiji=u.asm.Ia).apply(null,arguments)},_o=u.dynCall_iiiiij=function(){return(_o=u.dynCall_iiiiij=u.asm.Ja).apply(null,arguments)},Eo=u.dynCall_iiiiijj=function(){return(Eo=u.dynCall_iiiiijj=u.asm.Ka).apply(null,arguments)},bo=u.dynCall_iiiiiijj=function(){return(bo=u.dynCall_iiiiiijj=u.asm.La).apply(null,arguments)},ko;function To(r,e){var t=po();try{$r(r)(e)}catch(r){if(ho(t),r!==r+0)throw r;lo(1,0)}}function Po(r,e){var t=po();try{return $r(r)(e)}catch(r){if(ho(t),r!==r+0)throw r;lo(1,0)}}function Do(r,e,t,n){var o=po();try{$r(r)(e,t,n)}catch(r){if(ho(o),r!==r+0)throw r;lo(1,0)}}function Co(r){var e=po();try{return $r(r)()}catch(r){if(ho(e),r!==r+0)throw r;lo(1,0)}}function So(r,e,t){var n=po();try{return $r(r)(e,t)}catch(r){if(ho(n),r!==r+0)throw r;lo(1,0)}}function Mo(r,e,t,n,o,a){var i=po();try{return $r(r)(e,t,n,o,a)}catch(r){if(ho(i),r!==r+0)throw r;lo(1,0)}}function Fo(r,e,t){var n=po();try{$r(r)(e,t)}catch(r){if(ho(n),r!==r+0)throw r;lo(1,0)}}function Ao(r,e,t,n){var o=po();try{return $r(r)(e,t,n)}catch(r){if(ho(o),r!==r+0)throw r;lo(1,0)}}function xo(r,e,t,n,o){var a=po();try{$r(r)(e,t,n,o)}catch(r){if(ho(a),r!==r+0)throw r;lo(1,0)}}function $o(r,e,t,n,o,a){var i=po();try{return $r(r)(e,t,n,o,a)}catch(r){if(ho(i),r!==r+0)throw r;lo(1,0)}}function Oo(r,e,t,n,o,a,i){var s=po();try{$r(r)(e,t,n,o,a,i)}catch(r){if(ho(s),r!==r+0)throw r;lo(1,0)}}function jo(r,e,t,n,o){var a=po();try{return $r(r)(e,t,n,o)}catch(r){if(ho(a),r!==r+0)throw r;lo(1,0)}}function Ro(r,e,t,n,o,a,i,s,u,c,l){var f=po();try{$r(r)(e,t,n,o,a,i,s,u,c,l)}catch(r){if(ho(f),r!==r+0)throw r;lo(1,0)}}function No(r){var e=po();try{$r(r)()}catch(r){if(ho(e),r!==r+0)throw r;lo(1,0)}}function zo(r,e,t,n){var o=po();try{$r(r)(e,t,n)}catch(r){if(ho(o),r!==r+0)throw r;lo(1,0)}}function Bo(r,e,t,n,o,a,i){var s=po();try{$r(r)(e,t,n,o,a,i)}catch(r){if(ho(s),r!==r+0)throw r;lo(1,0)}}function Wo(r,e,t,n){var o=po();try{return $r(r)(e,t,n)}catch(r){if(ho(o),r!==r+0)throw r;lo(1,0)}}function Io(r,e,t,n,o,a,i){var s=po();try{return $r(r)(e,t,n,o,a,i)}catch(r){if(ho(s),r!==r+0)throw r;lo(1,0)}}function Vo(r,e,t,n,o,a,i,s){var u=po();try{$r(r)(e,t,n,o,a,i,s)}catch(r){if(ho(u),r!==r+0)throw r;lo(1,0)}}function Uo(r,e,t,n,o,a,i,s,u,c,l,f,d){var p=po();try{$r(r)(e,t,n,o,a,i,s,u,c,l,f,d)}catch(r){if(ho(p),r!==r+0)throw r;lo(1,0)}}function Lo(r,e,t,n,o,a,i,s){var u=po();try{$r(r)(e,t,n,o,a,i,s)}catch(r){if(ho(u),r!==r+0)throw r;lo(1,0)}}function Ho(r,e,t,n,o,a){var i=po();try{$r(r)(e,t,n,o,a)}catch(r){if(ho(i),r!==r+0)throw r;lo(1,0)}}function qo(r,e,t,n,o,a){var i=po();try{yo(r,e,t,n,o,a)}catch(r){if(ho(i),r!==r+0)throw r;lo(1,0)}}function Yo(r){function e(){ko||(ko=!0,u.calledRun=!0,D||(Q(),t(u),u.onRuntimeInitialized&&u.onRuntimeInitialized(),rr()))}r=r||n,0<or||(Z(),0<or||(u.setStatus?(u.setStatus("Running..."),setTimeout(function(){setTimeout(function(){u.setStatus("")},1),e()},1)):e()))}if(u.addFunction=Qn,u.removeFunction=ro,ir=function r(){ko||Yo(),ko||(ir=r)},u.preInit)for("function"==typeof u.preInit&&(u.preInit=[u.preInit]);0<u.preInit.length;)u.preInit.pop()();return Yo(),u.ready}})();"object"==typeof exports&&"object"==typeof module?module.exports=Module:"function"==typeof define&&define.amd?define([],function(){return Module}):"object"==typeof exports&&(exports.Module=Module);!function(t){var e,e;"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):(e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).png=t()}(function(){var t,e,r;return l({1:[function(t,e,r){!function(c){"use strict";let d=t("./interlace"),u=[function(){},function(t,e,r,n){if(n===e.length)throw new Error("Ran out of data");var n=e[n];t[r]=n,t[r+1]=n,t[r+2]=n,t[r+3]=255},function(t,e,r,n){if(n+1>=e.length)throw new Error("Ran out of data");var i=e[n];t[r]=i,t[r+1]=i,t[r+2]=i,t[r+3]=e[n+1]},function(t,e,r,n){if(n+2>=e.length)throw new Error("Ran out of data");t[r]=e[n],t[r+1]=e[n+1],t[r+2]=e[n+2],t[r+3]=255},function(t,e,r,n){if(n+3>=e.length)throw new Error("Ran out of data");t[r]=e[n],t[r+1]=e[n+1],t[r+2]=e[n+2],t[r+3]=e[n+3]}],p=[function(){},function(t,e,r,n){var e=e[0];t[r]=e,t[r+1]=e,t[r+2]=e,t[r+3]=n},function(t,e,r){var n=e[0];t[r]=n,t[r+1]=n,t[r+2]=n,t[r+3]=e[1]},function(t,e,r,n){t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=n},function(t,e,r){t[r]=e[0],t[r+1]=e[1],t[r+2]=e[2],t[r+3]=e[3]}];function _(h,f){let u=[],c=0;function r(){if(c===h.length)throw new Error("Ran out of data");var t=h[c];c++;let e,r,n,i,s,a,o,l;switch(f){default:throw new Error("unrecognised depth");case 16:o=h[c],c++,u.push((t<<8)+o);break;case 4:o=15&t,l=t>>4,u.push(l,o);break;case 2:s=3&t,a=t>>2&3,o=t>>4&3,l=t>>6&3,u.push(l,o,a,s);break;case 1:e=1&t,r=t>>1&1,n=t>>2&1,i=t>>3&1,s=t>>4&1,a=t>>5&1,o=t>>6&1,l=t>>7&1,u.push(l,o,a,s,i,n,r,e)}}return{get:function(t){for(;u.length<t;)r();var e=u.slice(0,t);return u=u.slice(t),e},resetAfterLine:function(){u.length=0},end:function(){if(c!==h.length)throw new Error("extra data found")}}}function g(t,r,n,i,s,a){var o=t.width,l=t.height,h=t.index;for(let e=0;e<l;e++)for(let t=0;t<o;t++){var f=n(t,e,h);u[i](r,s,f,a),a+=i}return a}function b(t,r,n,i,s,a){var o=t.width,l=t.height,h=t.index;for(let e=0;e<l;e++){for(let t=0;t<o;t++){var f=s.get(i),u=n(t,e,h);p[i](r,f,u,a)}s.resetAfterLine()}}r.dataToBitMap=function(e,t){var r=t.width,n=t.height,i=t.depth,s=t.bpp,t=t.interlace;let a;8!==i&&(a=_(e,i));let o;o=i<=8?c.alloc(r*n*4):new Uint16Array(r*n*4);var l=Math.pow(2,i)-1;let h=0,f,u;if(t)f=d.getImagePasses(r,n),u=d.getInterlaceIterator(r,n);else{let e=0;u=function(){var t=e;return e+=4,t},f=[{width:r,height:n}]}for(let t=0;t<f.length;t++)8===i?h=g(f[t],o,u,s,e,h):b(f[t],o,u,s,a,l);if(8===i){if(h!==e.length)throw new Error("extra data found")}else a.end();return o}}.call(this,t("buffer").Buffer)},{"./interlace":11,buffer:31}],2:[function(t,e,r){!function(b){"use strict";let m=t("./constants");e.exports=function(t,e,r,i){let s=-1!==[m.COLORTYPE_COLOR_ALPHA,m.COLORTYPE_ALPHA].indexOf(i.colorType);if(i.colorType===i.inputColorType){var n=(n=new ArrayBuffer(2),new DataView(n).setInt16(0,256,!0),256!==new Int16Array(n)[0]);if(8===i.bitDepth||16===i.bitDepth&&n)return t}var n;let a=16!==i.bitDepth?t:new Uint16Array(t.buffer),o=255,l=m.COLORTYPE_TO_BPP_MAP[i.inputColorType];4!==l||i.inputHasAlpha||(l=3);let h=m.COLORTYPE_TO_BPP_MAP[i.colorType];16===i.bitDepth&&(o=65535,h*=2);let f=b.alloc(e*r*h),u=0,c=0,d=i.bgColor||{};function p(){let t,e,r,n=o;switch(i.inputColorType){case m.COLORTYPE_COLOR_ALPHA:n=a[u+3],t=a[u],e=a[u+1],r=a[u+2];break;case m.COLORTYPE_COLOR:t=a[u],e=a[u+1],r=a[u+2];break;case m.COLORTYPE_ALPHA:n=a[u+1],t=a[u],e=t,r=t;break;case m.COLORTYPE_GRAYSCALE:t=a[u],e=t,r=t;break;default:throw new Error("input color type:"+i.inputColorType+" is not supported at present")}return i.inputHasAlpha&&(s||(n/=o,t=Math.min(Math.max(Math.round((1-n)*d.red+n*t),0),o),e=Math.min(Math.max(Math.round((1-n)*d.green+n*e),0),o),r=Math.min(Math.max(Math.round((1-n)*d.blue+n*r),0),o))),{red:t,green:e,blue:r,alpha:n}}void 0===d.red&&(d.red=o),void 0===d.green&&(d.green=o),void 0===d.blue&&(d.blue=o);for(let t=0;t<r;t++)for(let t=0;t<e;t++){var _=p(a,u);switch(i.colorType){case m.COLORTYPE_COLOR_ALPHA:case m.COLORTYPE_COLOR:8===i.bitDepth?(f[c]=_.red,f[c+1]=_.green,f[c+2]=_.blue,s&&(f[c+3]=_.alpha)):(f.writeUInt16BE(_.red,c),f.writeUInt16BE(_.green,c+2),f.writeUInt16BE(_.blue,c+4),s&&f.writeUInt16BE(_.alpha,c+6));break;case m.COLORTYPE_ALPHA:case m.COLORTYPE_GRAYSCALE:var g=(_.red+_.green+_.blue)/3;8===i.bitDepth?(f[c]=g,s&&(f[c+1]=_.alpha)):(f.writeUInt16BE(g,c),s&&f.writeUInt16BE(_.alpha,c+2));break;default:throw new Error("unrecognised color Type "+i.colorType)}u+=l,c+=h}return f}}.call(this,t("buffer").Buffer)},{"./constants":4,buffer:31}],3:[function(i,s,t){!function(r,a){"use strict";let t=i("util"),e=i("stream");var n=s.exports=function(){e.call(this),this._buffers=[],this._buffered=0,this._reads=[],this._paused=!1,this._encoding="utf8",this.writable=!0};t.inherits(n,e),n.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e}),r.nextTick(function(){this._process(),this._paused&&this._reads&&0<this._reads.length&&(this._paused=!1,this.emit("drain"))}.bind(this))},n.prototype.write=function(t,e){if(!this.writable)return this.emit("error",new Error("Stream not writable")),!1;let r;return r=a.isBuffer(t)?t:a.from(t,e||this._encoding),this._buffers.push(r),this._buffered+=r.length,this._process(),this._reads&&0===this._reads.length&&(this._paused=!0),this.writable&&!this._paused},n.prototype.end=function(t,e){t&&this.write(t,e),this.writable=!1,this._buffers&&(0===this._buffers.length?this._end():(this._buffers.push(null),this._process()))},n.prototype.destroySoon=n.prototype.end,n.prototype._end=function(){0<this._reads.length&&this.emit("error",new Error("Unexpected end of input")),this.destroy()},n.prototype.destroy=function(){this._buffers&&(this.writable=!1,this._reads=null,this._buffers=null,this.emit("close"))},n.prototype._processReadAllowingLess=function(t){this._reads.shift();let e=this._buffers[0];e.length>t.length?(this._buffered-=t.length,this._buffers[0]=e.slice(t.length),t.func.call(this,e.slice(0,t.length))):(this._buffered-=e.length,this._buffers.shift(),t.func.call(this,e))},n.prototype._processRead=function(e){this._reads.shift();let r=0,n=0;for(var i=a.alloc(e.length);r<e.length;){let t=this._buffers[n++];var s=Math.min(t.length,e.length-r);t.copy(i,r,0,s),r+=s,s!==t.length&&(this._buffers[--n]=t.slice(s))}0<n&&this._buffers.splice(0,n),this._buffered-=e.length,e.func.call(this,i)},n.prototype._process=function(){try{for(;0<this._buffered&&this._reads&&0<this._reads.length;){var t=this._reads[0];if(t.allowLess)this._processReadAllowingLess(t);else{if(!(this._buffered>=t.length))break;this._processRead(t)}}this._buffers&&!this.writable&&this._end()}catch(t){this.emit("error",t)}}}.call(this,i("_process"),i("buffer").Buffer)},{_process:51,buffer:31,stream:67,util:72}],4:[function(t,e,r){"use strict";e.exports={PNG_SIGNATURE:[137,80,78,71,13,10,26,10],TYPE_IHDR:1229472850,TYPE_IEND:1229278788,TYPE_IDAT:1229209940,TYPE_PLTE:1347179589,TYPE_tRNS:1951551059,TYPE_gAMA:1732332865,COLORTYPE_GRAYSCALE:0,COLORTYPE_PALETTE:1,COLORTYPE_COLOR:2,COLORTYPE_ALPHA:4,COLORTYPE_PALETTE_COLOR:3,COLORTYPE_COLOR_ALPHA:6,COLORTYPE_TO_BPP_MAP:{0:1,2:3,3:1,4:2,6:4},GAMMA_DIVISION:1e5}},{}],5:[function(t,e,r){"use strict";let n=[];!function(){for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=3988292384^e>>>1:e>>>=1;n[t]=e}}();var e=e.exports=function(){this._crc=-1};e.prototype.write=function(e){for(let t=0;t<e.length;t++)this._crc=n[255&(this._crc^e[t])]^this._crc>>>8;return!0},e.prototype.crc32=function(){return-1^this._crc},e.crc32=function(e){let r=-1;for(let t=0;t<e.length;t++)r=n[255&(r^e[t])]^r>>>8;return-1^r}},{}],6:[function(u,_,t){!function(c){"use strict";let f=u("./paeth-predictor");function t(e,r,n,i,s){for(let t=0;t<n;t++)i[s+t]=e[r+t]}function e(e,r,t){let n=0;var i=r+t;for(let t=r;t<i;t++)n+=Math.abs(e[t]);return n}function r(e,r,n,i,s,a){for(let t=0;t<n;t++){var o=t>=a?e[r+t-a]:0,o=e[r+t]-o;i[s+t]=o}}function n(e,r,n,i){let s=0;for(let t=0;t<n;t++){var a=t>=i?e[r+t-i]:0,a=e[r+t]-a;s+=Math.abs(a)}return s}function i(e,r,n,i,s){for(let t=0;t<n;t++){var a=0<r?e[r+t-n]:0,a=e[r+t]-a;i[s+t]=a}}function s(e,r,n){let i=0;var s=r+n;for(let t=r;t<s;t++){var a=0<r?e[t-n]:0,a=e[t]-a;i+=Math.abs(a)}return i}function a(e,r,n,i,s,a){for(let t=0;t<n;t++){var o=t>=a?e[r+t-a]:0,l=0<r?e[r+t-n]:0,l=e[r+t]-(o+l>>1);i[s+t]=l}}function o(e,r,n,i){let s=0;for(let t=0;t<n;t++){var a=t>=i?e[r+t-i]:0,o=0<r?e[r+t-n]:0,o=e[r+t]-(a+o>>1);s+=Math.abs(o)}return s}function l(e,r,n,i,s,a){for(let t=0;t<n;t++){var o=t>=a?e[r+t-a]:0,l=0<r?e[r+t-n]:0,h=0<r&&t>=a?e[r+t-(n+a)]:0,h=e[r+t]-f(o,l,h);i[s+t]=h}}function h(e,r,n,i){let s=0;for(let t=0;t<n;t++){var a=t>=i?e[r+t-i]:0,o=0<r?e[r+t-n]:0,l=0<r&&t>=i?e[r+t-(n+i)]:0,l=e[r+t]-f(a,o,l);s+=Math.abs(l)}return s}let d={0:t,1:r,2:i,3:a,4:l},p={0:e,1:n,2:s,3:o,4:h};_.exports=function(r,t,e,n,i){let s;if("filterType"in n&&-1!==n.filterType){if("number"!=typeof n.filterType)throw new Error("unrecognised filter types");s=[n.filterType]}else s=[0,1,2,3,4];16===n.bitDepth&&(i*=2);var a=t*i;let o=0,l=0,h=c.alloc((1+a)*e),f=s[0];for(let t=0;t<e;t++){if(1<s.length){let e=1/0;for(let t=0;t<s.length;t++){var u=p[s[t]](r,l,a,i);u<e&&(f=s[t],e=u)}}h[o]=f,o++,d[f](r,l,a,h,o,i),o+=a,l+=a}return h}}.call(this,u("buffer").Buffer)},{"./paeth-predictor":15,buffer:31}],7:[function(r,a,t){!function(n){"use strict";let t=r("util"),i=r("./chunkstream"),s=r("./filter-parse");var e=a.exports=function(t){i.call(this);let e=[],r=this;this._filter=new s(t,{read:this.read.bind(this),write:function(t){e.push(t)},complete:function(){r.emit("complete",n.concat(e))}}),this._filter.start()};t.inherits(e,i)}.call(this,r("buffer").Buffer)},{"./chunkstream":3,"./filter-parse":9,buffer:31,util:72}],8:[function(t,e,r){!function(s){"use strict";let a=t("./sync-reader"),o=t("./filter-parse");r.process=function(t,e){let r=[],n=new a(t),i=new o(e,{read:n.read.bind(n),write:function(t){r.push(t)},complete:function(){}});return i.start(),n.process(),s.concat(r)}}.call(this,t("buffer").Buffer)},{"./filter-parse":9,"./sync-reader":22,buffer:31}],9:[function(e,r,t){!function(s){"use strict";let l=e("./interlace"),u=e("./paeth-predictor");function h(t,e,r){let n=t*e;return 8!==r&&(n=Math.ceil(n/(8/r))),n}var t=r.exports=function(t,e){var r=t.width,n=t.height,i=t.interlace,s=t.bpp,a=t.depth;if(this.read=e.read,this.write=e.write,this.complete=e.complete,this._imageIndex=0,this._images=[],i){var o=l.getImagePasses(r,n);for(let t=0;t<o.length;t++)this._images.push({byteWidth:h(o[t].width,s,a),height:o[t].height,lineIndex:0})}else this._images.push({byteWidth:h(r,s,a),height:n,lineIndex:0});this._xComparison=8===a?s:16===a?2*s:1};t.prototype.start=function(){this.read(this._images[this._imageIndex].byteWidth+1,this._reverseFilterLine.bind(this))},t.prototype._unFilterType1=function(e,r,n){var i=this._xComparison,s=i-1;for(let t=0;t<n;t++){var a=e[1+t],o=t>s?r[t-i]:0;r[t]=a+o}},t.prototype._unFilterType2=function(e,r,n){var i=this._lastLine;for(let t=0;t<n;t++){var s=e[1+t],a=i?i[t]:0;r[t]=s+a}},t.prototype._unFilterType3=function(e,r,n){var i=this._xComparison,s=i-1,a=this._lastLine;for(let t=0;t<n;t++){var o=e[1+t],l=a?a[t]:0,h=t>s?r[t-i]:0,l=Math.floor((h+l)/2);r[t]=o+l}},t.prototype._unFilterType4=function(e,r,n){var i=this._xComparison,s=i-1,a=this._lastLine;for(let t=0;t<n;t++){var o=e[1+t],l=a?a[t]:0,h=t>s?r[t-i]:0,f=t>s&&a?a[t-i]:0,f=u(h,l,f);r[t]=o+f}},t.prototype._reverseFilterLine=function(t){var e=t[0];let r,n=this._images[this._imageIndex];var i=n.byteWidth;if(0===e)r=t.slice(1,i+1);else switch(r=s.alloc(i),e){case 1:this._unFilterType1(t,r,i);break;case 2:this._unFilterType2(t,r,i);break;case 3:this._unFilterType3(t,r,i);break;case 4:this._unFilterType4(t,r,i);break;default:throw new Error("Unrecognised filter type - "+e)}this.write(r),n.lineIndex++,n.lineIndex>=n.height?(this._lastLine=null,this._imageIndex++,n=this._images[this._imageIndex]):this._lastLine=r,n?this.read(n.byteWidth+1,this._reverseFilterLine.bind(this)):(this._lastLine=null,this.complete())}}.call(this,e("buffer").Buffer)},{"./interlace":11,"./paeth-predictor":15,buffer:31}],10:[function(t,e,r){!function(l){"use strict";function h(e,r,n,i,s){let a=0;for(let t=0;t<i;t++)for(let t=0;t<n;t++){var o=s[e[a]];if(!o)throw new Error("index "+e[a]+" not in palette");for(let t=0;t<4;t++)r[a+t]=o[t];a+=4}}function f(e,r,n,i,s){let a=0;for(let t=0;t<i;t++)for(let t=0;t<n;t++){let t=!1;if(1===s.length?s[0]===e[a]&&(t=!0):s[0]===e[a]&&s[1]===e[a+1]&&s[2]===e[a+2]&&(t=!0),t)for(let t=0;t<4;t++)r[a+t]=0;a+=4}}function u(e,r,n,i,t){var s=255,a=Math.pow(2,t)-1;let o=0;for(let t=0;t<i;t++)for(let t=0;t<n;t++){for(let t=0;t<4;t++)r[o+t]=Math.floor(e[o+t]*s/a+.5);o+=4}}e.exports=function(t,e){var r=e.depth,n=e.width,i=e.height,s=e.colorType,a=e.transColor,e=e.palette;let o=t;return 3===s?h(t,o,n,i,e):(a&&f(t,o,n,i,a),8!==r&&(16===r&&(o=l.alloc(n*i*4)),u(t,o,n,i,r))),o}}.call(this,t("buffer").Buffer)},{buffer:31}],11:[function(t,e,r){"use strict";let h=[{x:[0],y:[0]},{x:[4],y:[0]},{x:[0,4],y:[4]},{x:[2,6],y:[0,4]},{x:[0,2,4,6],y:[2,6]},{x:[1,3,5,7],y:[0,2,4,6]},{x:[0,1,2,3,4,5,6,7],y:[1,3,5,7]}];r.getImagePasses=function(t,e){let n=[];var i=t%8,s=e%8,a=(t-i)/8,o=(e-s)/8;for(let t=0;t<h.length;t++){var l=h[t];let e=a*l.x.length,r=o*l.y.length;for(let t=0;t<l.x.length&&l.x[t]<i;t++)e++;for(let t=0;t<l.y.length&&l.y[t]<s;t++)r++;0<e&&0<r&&n.push({width:e,height:r,index:t})}return n},r.getInterlaceIterator=function(s){return function(t,e,r){var n=t%h[r].x.length,t=(t-n)/h[r].x.length*8+h[r].x[n],n=e%h[r].y.length,i;return 4*t+((e-n)/h[r].y.length*8+h[r].y[n])*s*4}}},{}],12:[function(a,o,t){!function(i){"use strict";let t=a("util"),e=a("stream"),s=a("./constants"),r=a("./packer");var n=o.exports=function(t){e.call(this);var t=t||{};this._packer=new r(t),this._deflate=this._packer.createDeflate(),this.readable=!0};t.inherits(n,e),n.prototype.pack=function(t,e,r,n){this.emit("data",i.from(s.PNG_SIGNATURE)),this.emit("data",this._packer.packIHDR(e,r)),n&&this.emit("data",this._packer.packGAMA(n));var r=this._packer.filterData(t,e,r);this._deflate.on("error",this.emit.bind(this,"error")),this._deflate.on("data",function(t){this.emit("data",this._packer.packIDAT(t))}.bind(this)),this._deflate.on("end",function(){this.emit("data",this._packer.packIEND()),this.emit("end")}.bind(this)),this._deflate.end(r)}}.call(this,a("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:31,stream:67,util:72}],13:[function(t,e,r){!function(i){"use strict";let s=!0,a=t("zlib");a.deflateSync||(s=!1);let o=t("./constants"),l=t("./packer");e.exports=function(t,e){if(!s)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");var e=e||{};let r=new l(e),n=[];n.push(i.from(o.PNG_SIGNATURE)),n.push(r.packIHDR(t.width,t.height)),t.gamma&&n.push(r.packGAMA(t.gamma));var e=r.filterData(t.data,t.width,t.height),t=a.deflateSync(e,r.getDeflateOptions()),e=null;if(!t||!t.length)throw new Error("bad png - invalid compressed data response");return n.push(r.packIDAT(t)),n.push(r.packIEND()),i.concat(n)}}.call(this,t("buffer").Buffer)},{"./constants":4,"./packer":14,buffer:31,zlib:30}],14:[function(r,n,t){!function(i){"use strict";let s=r("./constants"),a=r("./crc"),o=r("./bitpacker"),l=r("./filter-pack"),e=r("zlib");var t=n.exports=function(t){if((this._options=t).deflateChunkSize=t.deflateChunkSize||32768,t.deflateLevel=null!=t.deflateLevel?t.deflateLevel:9,t.deflateStrategy=null!=t.deflateStrategy?t.deflateStrategy:3,t.inputHasAlpha=null==t.inputHasAlpha||t.inputHasAlpha,t.deflateFactory=t.deflateFactory||e.createDeflate,t.bitDepth=t.bitDepth||8,t.colorType="number"==typeof t.colorType?t.colorType:s.COLORTYPE_COLOR_ALPHA,t.inputColorType="number"==typeof t.inputColorType?t.inputColorType:s.COLORTYPE_COLOR_ALPHA,-1===[s.COLORTYPE_GRAYSCALE,s.COLORTYPE_COLOR,s.COLORTYPE_COLOR_ALPHA,s.COLORTYPE_ALPHA].indexOf(t.colorType))throw new Error("option color type:"+t.colorType+" is not supported at present");if(-1===[s.COLORTYPE_GRAYSCALE,s.COLORTYPE_COLOR,s.COLORTYPE_COLOR_ALPHA,s.COLORTYPE_ALPHA].indexOf(t.inputColorType))throw new Error("option input color type:"+t.inputColorType+" is not supported at present");if(8!==t.bitDepth&&16!==t.bitDepth)throw new Error("option bit depth:"+t.bitDepth+" is not supported at present")};t.prototype.getDeflateOptions=function(){return{chunkSize:this._options.deflateChunkSize,level:this._options.deflateLevel,strategy:this._options.deflateStrategy}},t.prototype.createDeflate=function(){return this._options.deflateFactory(this.getDeflateOptions())},t.prototype.filterData=function(t,e,r){var n=o(t,e,r,this._options),t=s.COLORTYPE_TO_BPP_MAP[this._options.colorType],i;return l(n,e,r,this._options,t)},t.prototype._packChunk=function(t,e){var r=e?e.length:0;let n=i.alloc(r+12);return n.writeUInt32BE(r,0),n.writeUInt32BE(t,4),e&&e.copy(n,8),n.writeInt32BE(a.crc32(n.slice(4,n.length-4)),n.length-4),n},t.prototype.packGAMA=function(t){let e=i.alloc(4);return e.writeUInt32BE(Math.floor(t*s.GAMMA_DIVISION),0),this._packChunk(s.TYPE_gAMA,e)},t.prototype.packIHDR=function(t,e){let r=i.alloc(13);return r.writeUInt32BE(t,0),r.writeUInt32BE(e,4),r[8]=this._options.bitDepth,r[9]=this._options.colorType,r[10]=0,r[11]=0,r[12]=0,this._packChunk(s.TYPE_IHDR,r)},t.prototype.packIDAT=function(t){return this._packChunk(s.TYPE_IDAT,t)},t.prototype.packIEND=function(){return this._packChunk(s.TYPE_IEND,null)}}.call(this,r("buffer").Buffer)},{"./bitpacker":2,"./constants":4,"./crc":5,"./filter-pack":6,buffer:31,zlib:30}],15:[function(t,e,r){"use strict";e.exports=function t(e,r,n){var i=e+r-n,s=Math.abs(i-e),a=Math.abs(i-r),i=Math.abs(i-n);return s<=a&&s<=i?e:a<=i?r:n}},{}],16:[function(t,e,r){"use strict";let n=t("util"),o=t("zlib"),i=t("./chunkstream"),s=t("./filter-parse-async"),a=t("./parser"),l=t("./bitmapper"),h=t("./format-normaliser");var e=e.exports=function(t){i.call(this),this._parser=new a(t,{read:this.read.bind(this),error:this._handleError.bind(this),metadata:this._handleMetaData.bind(this),gamma:this.emit.bind(this,"gamma"),palette:this._handlePalette.bind(this),transColor:this._handleTransColor.bind(this),finished:this._finished.bind(this),inflateData:this._inflateData.bind(this),simpleTransparency:this._simpleTransparency.bind(this),headersFinished:this._headersFinished.bind(this)}),this._options=t,this.writable=!0,this._parser.start()};n.inherits(e,i),e.prototype._handleError=function(t){this.emit("error",t),this.writable=!1,this.destroy(),this._inflate&&this._inflate.destroy&&this._inflate.destroy(),this._filter&&(this._filter.destroy(),this._filter.on("error",function(){})),this.errord=!0},e.prototype._inflateData=function(t){if(!this._inflate)if(this._bitmapInfo.interlace)this._inflate=o.createInflate(),this._inflate.on("error",this.emit.bind(this,"error")),this._filter.on("complete",this._complete.bind(this)),this._inflate.pipe(this._filter);else{var i,s=(1+(this._bitmapInfo.width*this._bitmapInfo.bpp*this._bitmapInfo.depth+7>>3))*this._bitmapInfo.height,a=Math.max(s,o.Z_MIN_CHUNK);this._inflate=o.createInflate({chunkSize:a});let e=s,r=this.emit.bind(this,"error");this._inflate.on("error",function(t){e&&r(t)}),this._filter.on("complete",this._complete.bind(this));let n=this._filter.write.bind(this._filter);this._inflate.on("data",function(t){e&&(t.length>e&&(t=t.slice(0,e)),e-=t.length,n(t))}),this._inflate.on("end",this._filter.end.bind(this._filter))}this._inflate.write(t)},e.prototype._handleMetaData=function(t){this._metaData=t,this._bitmapInfo=Object.create(t),this._filter=new s(this._bitmapInfo)},e.prototype._handleTransColor=function(t){this._bitmapInfo.transColor=t},e.prototype._handlePalette=function(t){this._bitmapInfo.palette=t},e.prototype._simpleTransparency=function(){this._metaData.alpha=!0},e.prototype._headersFinished=function(){this.emit("metadata",this._metaData)},e.prototype._finished=function(){this.errord||(this._inflate?this._inflate.end():this.emit("error","No Inflate block"))},e.prototype._complete=function(e){if(!this.errord){let t;try{var r=l.dataToBitMap(e,this._bitmapInfo);t=h(r,this._bitmapInfo),r=null}catch(t){return void this._handleError(t)}this.emit("parsed",t)}}},{"./bitmapper":1,"./chunkstream":3,"./filter-parse-async":7,"./format-normaliser":10,"./parser":18,util:72,zlib:30}],17:[function(t,e,r){!function(y){"use strict";let w=!0,v=t("zlib"),E=t("./sync-inflate");v.deflateSync||(w=!1);let k=t("./sync-reader"),x=t("./filter-parse-sync"),T=t("./parser"),S=t("./bitmapper"),L=t("./format-normaliser");e.exports=function(t,e){if(!w)throw new Error("To use the sync capability of this library in old node versions, please pin pngjs to v2.3.0");let r;function n(t){r=t}let i;function s(t){i=t}function a(t){i.transColor=t}function o(t){i.palette=t}function l(){i.alpha=!0}let h;function f(t){h=t}let u=[];function c(t){u.push(t)}let d=new k(t),p=new T(e,{read:d.read.bind(d),error:n,metadata:s,gamma:f,palette:o,transColor:a,inflateData:c,simpleTransparency:l});if(p.start(),d.process(),r)throw r;let _=y.concat(u);u.length=0;let g;var b,m;if(g=i.interlace?v.inflateSync(_):(m=(1+(i.width*i.bpp*i.depth+7>>3))*i.height,E(_,{chunkSize:m,maxLength:m})),_=null,!g||!g.length)throw new Error("bad png - invalid inflate data response");var e=x.process(g,i);_=null;var m=S.dataToBitMap(e,i),e=null,m=L(m,i);return i.data=m,i.gamma=h||0,i}}.call(this,t("buffer").Buffer)},{"./bitmapper":1,"./filter-parse-sync":8,"./format-normaliser":10,"./parser":18,"./sync-inflate":21,"./sync-reader":22,buffer:31,zlib:30}],18:[function(e,r,t){!function(s){"use strict";let o=e("./constants"),a=e("./crc");var t=r.exports=function(t,e){(this._options=t).checkCRC=!1!==t.checkCRC,this._hasIHDR=!1,this._hasIEND=!1,this._emittedHeadersFinished=!1,this._palette=[],this._colorType=0,this._chunks={},this._chunks[o.TYPE_IHDR]=this._handleIHDR.bind(this),this._chunks[o.TYPE_IEND]=this._handleIEND.bind(this),this._chunks[o.TYPE_IDAT]=this._handleIDAT.bind(this),this._chunks[o.TYPE_PLTE]=this._handlePLTE.bind(this),this._chunks[o.TYPE_tRNS]=this._handleTRNS.bind(this),this._chunks[o.TYPE_gAMA]=this._handleGAMA.bind(this),this.read=e.read,this.error=e.error,this.metadata=e.metadata,this.gamma=e.gamma,this.transColor=e.transColor,this.palette=e.palette,this.parsed=e.parsed,this.inflateData=e.inflateData,this.finished=e.finished,this.simpleTransparency=e.simpleTransparency,this.headersFinished=e.headersFinished||function(){}};t.prototype.start=function(){this.read(o.PNG_SIGNATURE.length,this._parseSignature.bind(this))},t.prototype._parseSignature=function(e){var r=o.PNG_SIGNATURE;for(let t=0;t<r.length;t++)if(e[t]!==r[t])return void this.error(new Error("Invalid file signature"));this.read(8,this._parseChunkBegin.bind(this))},t.prototype._parseChunkBegin=function(e){var t=e.readUInt32BE(0),r=e.readUInt32BE(4);let n="";for(let t=4;t<8;t++)n+=String.fromCharCode(e[t]);var i=Boolean(32&e[4]);if(this._hasIHDR||r===o.TYPE_IHDR){if(this._crc=new a,this._crc.write(s.from(n)),this._chunks[r])return this._chunks[r](t);i?this.read(t+4,this._skipChunk.bind(this)):this.error(new Error("Unsupported critical chunk type "+n))}else this.error(new Error("Expected IHDR on beggining"))},t.prototype._skipChunk=function(){this.read(8,this._parseChunkBegin.bind(this))},t.prototype._handleChunkEnd=function(){this.read(4,this._parseChunkEnd.bind(this))},t.prototype._parseChunkEnd=function(t){var e=t.readInt32BE(0),t=this._crc.crc32();this._options.checkCRC&&t!==e?this.error(new Error("Crc error - "+e+" - "+t)):this._hasIEND||this.read(8,this._parseChunkBegin.bind(this))},t.prototype._handleIHDR=function(t){this.read(t,this._parseIHDR.bind(this))},t.prototype._parseIHDR=function(t){this._crc.write(t);var e=t.readUInt32BE(0),r=t.readUInt32BE(4),n=t[8],i=t[9],s=t[10],a=t[11],t=t[12],a;8===n||4===n||2===n||1===n||16===n?i in o.COLORTYPE_TO_BPP_MAP?0===s?0===a?0===t||1===t?(this._colorType=i,a=o.COLORTYPE_TO_BPP_MAP[this._colorType],this._hasIHDR=!0,this.metadata({width:e,height:r,depth:n,interlace:Boolean(t),palette:Boolean(i&o.COLORTYPE_PALETTE),color:Boolean(i&o.COLORTYPE_COLOR),alpha:Boolean(i&o.COLORTYPE_ALPHA),bpp:a,colorType:i}),this._handleChunkEnd()):this.error(new Error("Unsupported interlace method")):this.error(new Error("Unsupported filter method")):this.error(new Error("Unsupported compression method")):this.error(new Error("Unsupported color type")):this.error(new Error("Unsupported bit depth "+n))},t.prototype._handlePLTE=function(t){this.read(t,this._parsePLTE.bind(this))},t.prototype._parsePLTE=function(e){this._crc.write(e);var r=Math.floor(e.length/3);for(let t=0;t<r;t++)this._palette.push([e[3*t],e[3*t+1],e[3*t+2],255]);this.palette(this._palette),this._handleChunkEnd()},t.prototype._handleTRNS=function(t){this.simpleTransparency(),this.read(t,this._parseTRNS.bind(this))},t.prototype._parseTRNS=function(e){if(this._crc.write(e),this._colorType===o.COLORTYPE_PALETTE_COLOR){if(0===this._palette.length)return void this.error(new Error("Transparency chunk must be after palette"));if(e.length>this._palette.length)return void this.error(new Error("More transparent colors than palette size"));for(let t=0;t<e.length;t++)this._palette[t][3]=e[t];this.palette(this._palette)}this._colorType===o.COLORTYPE_GRAYSCALE&&this.transColor([e.readUInt16BE(0)]),this._colorType===o.COLORTYPE_COLOR&&this.transColor([e.readUInt16BE(0),e.readUInt16BE(2),e.readUInt16BE(4)]),this._handleChunkEnd()},t.prototype._handleGAMA=function(t){this.read(t,this._parseGAMA.bind(this))},t.prototype._parseGAMA=function(t){this._crc.write(t),this.gamma(t.readUInt32BE(0)/o.GAMMA_DIVISION),this._handleChunkEnd()},t.prototype._handleIDAT=function(t){this._emittedHeadersFinished||(this._emittedHeadersFinished=!0,this.headersFinished()),this.read(-t,this._parseIDAT.bind(this,t))},t.prototype._parseIDAT=function(t,e){if(this._crc.write(e),this._colorType===o.COLORTYPE_PALETTE_COLOR&&0===this._palette.length)throw new Error("Expected palette not found");this.inflateData(e);var e=t-e.length;0<e?this._handleIDAT(e):this._handleChunkEnd()},t.prototype._handleIEND=function(t){this.read(t,this._parseIEND.bind(this))},t.prototype._parseIEND=function(t){this._crc.write(t),this._hasIEND=!0,this._handleChunkEnd(),this.finished&&this.finished()}}.call(this,e("buffer").Buffer)},{"./constants":4,"./crc":5,buffer:31}],19:[function(t,e,r){"use strict";let n=t("./parser-sync"),i=t("./packer-sync");r.read=function(t,e){return n(t,e||{})},r.write=function(t,e){return i(t,e)}},{"./packer-sync":13,"./parser-sync":17}],20:[function(l,t,h){!function(t,e){"use strict";let r=l("util"),n=l("stream"),i=l("./parser-async"),s=l("./packer-async");var a=l("./png-sync");let o=h.PNG=function(t){n.call(this),this.width=0|(t=t||{}).width,this.height=0|t.height,this.data=0<this.width&&0<this.height?e.alloc(4*this.width*this.height):null,t.fill&&this.data&&this.data.fill(0),this.gamma=0,this.readable=this.writable=!0,this._parser=new i(t),this._parser.on("error",this.emit.bind(this,"error")),this._parser.on("close",this._handleClose.bind(this)),this._parser.on("metadata",this._metadata.bind(this)),this._parser.on("gamma",this._gamma.bind(this)),this._parser.on("parsed",function(t){this.data=t,this.emit("parsed",t)}.bind(this)),this._packer=new s(t),this._packer.on("data",this.emit.bind(this,"data")),this._packer.on("end",this.emit.bind(this,"end")),this._parser.on("close",this._handleClose.bind(this)),this._packer.on("error",this.emit.bind(this,"error"))};r.inherits(o,n),o.sync=a,o.prototype.pack=function(){return this.data&&this.data.length?t.nextTick(function(){this._packer.pack(this.data,this.width,this.height,this.gamma)}.bind(this)):this.emit("error","No data provided"),this},o.prototype.parse=function(t,n){if(n){let e,r;e=function(t){this.removeListener("error",r),this.data=t,n(null,this)}.bind(this),r=function(t){this.removeListener("parsed",e),n(t,null)}.bind(this),this.once("parsed",e),this.once("error",r)}return this.end(t),this},o.prototype.write=function(t){return this._parser.write(t),!0},o.prototype.end=function(t){this._parser.end(t)},o.prototype._metadata=function(t){this.width=t.width,this.height=t.height,this.emit("metadata",t)},o.prototype._gamma=function(t){this.gamma=t},o.prototype._handleClose=function(){this._parser.writable||this._packer.readable||this.emit("close")},o.bitblt=function(e,r,n,i,s,a,o,l){if(i|=0,s|=0,a|=0,o|=0,l|=0,(n|=0)>e.width||i>e.height||n+s>e.width||i+a>e.height)throw new Error("bitblt reading outside image");if(o>r.width||l>r.height||o+s>r.width||l+a>r.height)throw new Error("bitblt writing outside image");for(let t=0;t<a;t++)e.data.copy(r.data,(l+t)*r.width+o<<2,(i+t)*e.width+n<<2,(i+t)*e.width+n+s<<2)},o.prototype.bitblt=function(t,e,r,n,i,s,a){return o.bitblt(this,t,e,r,n,i,s,a),this},o.adjustGamma=function(r){if(r.gamma){for(let e=0;e<r.height;e++)for(let t=0;t<r.width;t++){var n=r.width*e+t<<2;for(let t=0;t<3;t++){var i=r.data[n+t]/255,i=Math.pow(i,1/2.2/r.gamma);r.data[n+t]=Math.round(255*i)}}r.gamma=0}},o.prototype.adjustGamma=function(){o.adjustGamma(this)}}.call(this,l("_process"),l("buffer").Buffer)},{"./packer-async":12,"./parser-async":16,"./png-sync":19,_process:51,buffer:31,stream:67,util:72}],21:[function(a,o,l){!function(r,d){"use strict";let p=a("assert").ok,_=a("zlib"),t=a("util"),g=a("buffer").kMaxLength;function n(t){if(!(this instanceof n))return new n(t);t&&t.chunkSize<_.Z_MIN_CHUNK&&(t.chunkSize=_.Z_MIN_CHUNK),_.Inflate.call(this,t),this._offset=void 0===this._offset?this._outOffset:this._offset,this._buffer=this._buffer||this._outBuffer,t&&null!=t.maxLength&&(this._maxLength=t.maxLength)}function e(t){return new n(t)}function b(t,e){e&&r.nextTick(e),t._handle&&(t._handle.close(),t._handle=null)}function i(t,e){if(!((e="string"==typeof e?d.from(e):e)instanceof d))throw new TypeError("Not a string or buffer");let r=t._finishFlushFlag;return null==r&&(r=_.Z_FINISH),t._processChunk(e,r)}function s(t,e){return i(new n(e),t)}n.prototype._processChunk=function(t,e,r){if("function"==typeof r)return _.Inflate._processChunk.call(this,t,e,r);let n=this,i=t&&t.length,s=this._chunkSize-this._offset,a=this._maxLength,o=0,l=[],h=0,f;function u(t,e){if(!n._hadError){var r=s-e;if(p(0<=r,"have should not go down"),0<r){let t=n._buffer.slice(n._offset,n._offset+r);if(n._offset+=r,t.length>a&&(t=t.slice(0,a)),l.push(t),h+=t.length,a-=t.length,0===a)return}return(0===e||n._offset>=n._chunkSize)&&(s=n._chunkSize,n._offset=0,n._buffer=d.allocUnsafe(n._chunkSize)),0===e&&(o+=i-t,i=t,1)}}var c;for(this.on("error",function(t){f=t}),p(this._handle,"zlib binding closed");c=(c=this._handle.writeSync(e,t,o,i,this._buffer,this._offset,s))||this._writeState,!this._hadError&&u(c[0],c[1]););if(this._hadError)throw f;if(h>=g)throw b(this),new RangeError("Cannot create final Buffer. It would be larger than 0x"+g.toString(16)+" bytes");var r=d.concat(l,h);return b(this),r},t.inherits(n,_.Inflate),o.exports=l=s,l.Inflate=n,l.createInflate=e,l.inflateSync=s}.call(this,a("_process"),a("buffer").Buffer)},{_process:51,assert:23,buffer:31,util:72,zlib:30}],22:[function(t,e,r){"use strict";var e=e.exports=function(t){this._buffer=t,this._reads=[]};e.prototype.read=function(t,e){this._reads.push({length:Math.abs(t),allowLess:t<0,func:e})},e.prototype.process=function(){for(;0<this._reads.length&&this._buffer.length;){let e=this._reads[0];if(!this._buffer.length||!(this._buffer.length>=e.length||e.allowLess))break;{this._reads.shift();let t=this._buffer;this._buffer=t.slice(e.length),e.func.call(this,t.slice(0,e.length))}}return 0<this._reads.length?new Error("There are some read requests waitng on finished stream"):0<this._buffer.length?new Error("unrecognised content at end of stream"):void 0}},{}],23:[function(L,A,t){!function(e){"use strict";var t=L("object-assign");function s(t,e){if(t===e)return 0;for(var r=t.length,n=e.length,i=0,s=Math.min(r,n);i<s;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0}function a(t){return e.Buffer&&"function"==typeof e.Buffer.isBuffer?e.Buffer.isBuffer(t):!(null==t||!t._isBuffer)}var f=L("util/"),n=Object.prototype.hasOwnProperty,u=Array.prototype.slice,r="foo"===function t(){}.name;function o(t){return Object.prototype.toString.call(t)}function l(t){return!a(t)&&("function"==typeof e.ArrayBuffer&&("function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&(t instanceof DataView||!!(t.buffer&&t.buffer instanceof ArrayBuffer))))}var h=A.exports=b,i=/\s*function\s+([^\(\s]*)\s*/;function c(t){if(f.isFunction(t)){if(r)return t.name;var e,t=t.toString().match(i);return t&&t[1]}}function d(t,e){return"string"!=typeof t||t.length<e?t:t.slice(0,e)}function p(t){if(r||!f.isFunction(t))return f.inspect(t);var t=c(t),e;return"[Function"+(t?": "+t:"")+"]"}function _(t){return d(p(t.actual),128)+" "+t.operator+" "+d(p(t.expected),128)}function g(t,e,r,n,i){throw new h.AssertionError({message:r,actual:t,expected:e,operator:n,stackStartFunction:i})}function b(t,e){t||g(t,!0,e,"==",h.ok)}function m(t,e,r,n){if(t===e)return!0;if(a(t)&&a(e))return 0===s(t,e);if(f.isDate(t)&&f.isDate(e))return t.getTime()===e.getTime();if(f.isRegExp(t)&&f.isRegExp(e))return t.source===e.source&&t.global===e.global&&t.multiline===e.multiline&&t.lastIndex===e.lastIndex&&t.ignoreCase===e.ignoreCase;if(null!==t&&"object"==typeof t||null!==e&&"object"==typeof e){if(l(t)&&l(e)&&o(t)===o(e)&&!(t instanceof Float32Array||t instanceof Float64Array))return 0===s(new Uint8Array(t.buffer),new Uint8Array(e.buffer));if(a(t)!==a(e))return!1;var i=(n=n||{actual:[],expected:[]}).actual.indexOf(t);return-1!==i&&i===n.expected.indexOf(e)||(n.actual.push(t),n.expected.push(e),w(t,e,r,n))}return r?t===e:t==e}function y(t){return"[object Arguments]"==Object.prototype.toString.call(t)}function w(t,e,r,n){if(null==t||null==e)return!1;if(f.isPrimitive(t)||f.isPrimitive(e))return t===e;if(r&&Object.getPrototypeOf(t)!==Object.getPrototypeOf(e))return!1;var i=y(t),s=y(e);if(i&&!s||!i&&s)return!1;if(i)return m(t=u.call(t),e=u.call(e),r);var a=S(t),o=S(e),l,h;if(a.length!==o.length)return!1;for(a.sort(),o.sort(),h=a.length-1;0<=h;h--)if(a[h]!==o[h])return!1;for(h=a.length-1;0<=h;h--)if(!m(t[l=a[h]],e[l],r,n))return!1;return!0}function v(t,e,r){m(t,e,!0)&&g(t,e,r,"notDeepStrictEqual",v)}function E(t,e){if(t&&e){if("[object RegExp]"==Object.prototype.toString.call(e))return e.test(t);try{if(t instanceof e)return 1}catch(t){}return Error.isPrototypeOf(e)?void 0:!0===e.call({},t)}}function k(t){var e;try{t()}catch(t){e=t}return e}function x(t,e,r,n){var i;if("function"!=typeof e)throw new TypeError('"block" argument must be a function');"string"==typeof r&&(n=r,r=null),i=k(e),n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),t&&!i&&g(i,r,"Missing expected exception"+n);var s="string"==typeof n,a,e=!t&&i&&!r;if((!t&&f.isError(i)&&s&&E(i,r)||e)&&g(i,r,"Got unwanted exception"+n),t&&i&&r&&!E(i,r)||!t&&i)throw i}function T(t,e){t||g(t,!0,e,"==",T)}h.AssertionError=function t(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=_(this),this.generatedMessage=!0);var r=e.stackStartFunction||g,e,e,r,r,r,e;Error.captureStackTrace?Error.captureStackTrace(this,r):(e=new Error).stack&&(e=e.stack,r=c(r),0<=(r=e.indexOf("\n"+r))&&(r=e.indexOf("\n",r+1),e=e.substring(r+1)),this.stack=e)},f.inherits(h.AssertionError,Error),h.fail=g,h.ok=b,h.equal=function t(e,r,n){e!=r&&g(e,r,n,"==",h.equal)},h.notEqual=function t(e,r,n){e==r&&g(e,r,n,"!=",h.notEqual)},h.deepEqual=function t(e,r,n){m(e,r,!1)||g(e,r,n,"deepEqual",h.deepEqual)},h.deepStrictEqual=function t(e,r,n){m(e,r,!0)||g(e,r,n,"deepStrictEqual",h.deepStrictEqual)},h.notDeepEqual=function t(e,r,n){m(e,r,!1)&&g(e,r,n,"notDeepEqual",h.notDeepEqual)},h.notDeepStrictEqual=v,h.strictEqual=function t(e,r,n){e!==r&&g(e,r,n,"===",h.strictEqual)},h.notStrictEqual=function t(e,r,n){e===r&&g(e,r,n,"!==",h.notStrictEqual)},h.throws=function(t,e,r){x(!0,t,e,r)},h.doesNotThrow=function(t,e,r){x(!1,t,e,r)},h.ifError=function(t){if(t)throw t},h.strict=t(T,h,{equal:h.strictEqual,deepEqual:h.deepStrictEqual,notEqual:h.notStrictEqual,notDeepEqual:h.notDeepStrictEqual}),h.strict.strict=h.strict;var S=Object.keys||function(t){var e=[],r;for(r in t)n.call(t,r)&&e.push(r);return e}}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"object-assign":38,"util/":26}],24:[function(t,e,r){"function"==typeof Object.create?e.exports=function t(e,r){e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function t(e,r){e.super_=r;var n=function(){};n.prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],25:[function(t,e,r){e.exports=function t(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],26:[function(M,t,N){!function(i,s){var o=/%[sdj%]/g;N.format=function(t){if(!v(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(l(arguments[r]));return e.join(" ")}for(var r=1,n=arguments,i=n.length,s=String(t).replace(o,function(t){if("%%"===t)return"%";if(i<=r)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}}),a=n[r];r<i;a=n[++r])y(a)||!x(a)?s+=" "+a:s+=" "+l(a);return s},N.deprecate=function(t,e){if(E(s.process))return function(){return N.deprecate(t,e).apply(this,arguments)};if(!0===i.noDeprecation)return t;var r=!1;function n(){if(!r){if(i.throwDeprecation)throw new Error(e);i.traceDeprecation?console.trace(e):console.error(e),r=!0}return t.apply(this,arguments)}return n};var t={},n;function l(t,e){var r={seen:[],stylize:h};return 3<=arguments.length&&(r.depth=arguments[2]),4<=arguments.length&&(r.colors=arguments[3]),m(e)?r.showHidden=e:e&&N._extend(r,e),E(r.showHidden)&&(r.showHidden=!1),E(r.depth)&&(r.depth=2),E(r.colors)&&(r.colors=!1),E(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),u(r,t,r.depth)}function a(t,e){var e=l.styles[e];return e?"["+l.colors[e][0]+"m"+t+"["+l.colors[e][1]+"m":t}function h(t,e){return t}function f(t){var r={};return t.forEach(function(t,e){r[t]=!0}),r}function u(e,r,n){if(e.customInspect&&r&&L(r.inspect)&&r.inspect!==N.inspect&&(!r.constructor||r.constructor.prototype!==r)){var t=r.inspect(n,e);return t=!v(t)?u(e,t,n):t}var i=c(e,r);if(i)return i;var t=Object.keys(r),s=f(t);if(e.showHidden&&(t=Object.getOwnPropertyNames(r)),S(r)&&(0<=t.indexOf("message")||0<=t.indexOf("description")))return d(r);if(0===t.length){if(L(r)){var a=r.name?": "+r.name:"";return e.stylize("[Function"+a+"]","special")}if(k(r))return e.stylize(RegExp.prototype.toString.call(r),"regexp");if(T(r))return e.stylize(Date.prototype.toString.call(r),"date");if(S(r))return d(r)}var i="",o=!1,a=["{","}"],l,i,t;return b(r)&&(o=!0,a=["[","]"]),L(r)&&(i=" [Function"+(r.name?": "+r.name:"")+"]"),k(r)&&(i=" "+RegExp.prototype.toString.call(r)),T(r)&&(i=" "+Date.prototype.toUTCString.call(r)),S(r)&&(i=" "+d(r)),0!==t.length||o&&0!=r.length?n<0?k(r)?e.stylize(RegExp.prototype.toString.call(r),"regexp"):e.stylize("[Object]","special"):(e.seen.push(r),t=o?p(e,r,n,s,t):t.map(function(t){return _(e,r,n,s,t,o)}),e.seen.pop(),g(t,i,a)):a[0]+i+a[1]}function c(t,e){if(E(e))return t.stylize("undefined","undefined");if(v(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}return w(e)?t.stylize(""+e,"number"):m(e)?t.stylize(""+e,"boolean"):y(e)?t.stylize("null","null"):void 0}function d(t){return"["+Error.prototype.toString.call(t)+"]"}function p(e,r,n,i,t){for(var s=[],a=0,o=r.length;a<o;++a)B(r,String(a))?s.push(_(e,r,n,i,String(a),!0)):s.push("");return t.forEach(function(t){t.match(/^\d+$/)||s.push(_(e,r,n,i,t,!0))}),s}function _(t,e,r,n,i,s){var a,o,e,e=Object.getOwnPropertyDescriptor(e,i)||{value:e[i]};if(e.get?o=e.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):e.set&&(o=t.stylize("[Setter]","special")),B(n,i)||(a="["+i+"]"),o||(t.seen.indexOf(e.value)<0?-1<(o=y(r)?u(t,e.value,null):u(t,e.value,r-1)).indexOf("\n")&&(o=s?o.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+o.split("\n").map(function(t){return"   "+t}).join("\n")):o=t.stylize("[Circular]","special")),E(a)){if(s&&i.match(/^\d+$/))return o;a=(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),t.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),t.stylize(a,"string"))}return a+": "+o}function g(t,e,r){var n=0,i;return 60<t.reduce(function(t,e){return n++,0<=e.indexOf("\n")&&n++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)?r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1]:r[0]+e+" "+t.join(", ")+" "+r[1]}function b(t){return Array.isArray(t)}function m(t){return"boolean"==typeof t}function y(t){return null===t}function e(t){return null==t}function w(t){return"number"==typeof t}function v(t){return"string"==typeof t}function r(t){return"symbol"==typeof t}function E(t){return void 0===t}function k(t){return x(t)&&"[object RegExp]"===O(t)}function x(t){return"object"==typeof t&&null!==t}function T(t){return x(t)&&"[object Date]"===O(t)}function S(t){return x(t)&&("[object Error]"===O(t)||t instanceof Error)}function L(t){return"function"==typeof t}function A(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function O(t){return Object.prototype.toString.call(t)}function R(t){return t<10?"0"+t.toString(10):t.toString(10)}N.debuglog=function(e){var r;return E(n)&&(n=i.env.NODE_DEBUG||""),e=e.toUpperCase(),t[e]||(new RegExp("\\b"+e+"\\b","i").test(n)?(r=i.pid,t[e]=function(){var t=N.format.apply(N,arguments);console.error("%s %d: %s",e,r,t)}):t[e]=function(){}),t[e]},(N.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},N.isArray=b,N.isBoolean=m,N.isNull=y,N.isNullOrUndefined=e,N.isNumber=w,N.isString=v,N.isSymbol=r,N.isUndefined=E,N.isRegExp=k,N.isObject=x,N.isDate=T,N.isError=S,N.isFunction=L,N.isPrimitive=A,N.isBuffer=M("./support/isBuffer");var I=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function C(){var t=new Date,e=[R(t.getHours()),R(t.getMinutes()),R(t.getSeconds())].join(":");return[t.getDate(),I[t.getMonth()],e].join(" ")}function B(t,e){return Object.prototype.hasOwnProperty.call(t,e)}N.log=function(){console.log("%s - %s",C(),N.format.apply(N,arguments))},N.inherits=M("inherits"),N._extend=function(t,e){if(!e||!x(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t}}.call(this,M("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":25,_process:51,inherits:24}],27:[function(t,e,r){"use strict";r.byteLength=a,r.toByteArray=o,r.fromByteArray=_;for(var l=[],h=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=n.length;i<s;++i)l[i]=n[i],h[n.charCodeAt(i)]=i;function u(t){var e=t.length;if(0<e%4)throw new Error("Invalid string. Length must be a multiple of 4");var t=t.indexOf("="),r;return[t=-1===t?e:t,t===e?0:4-t%4]}function a(t){var e=u(t),t=e[0],e=e[1];return 3*(t+e)/4-e}function c(t,e,r){return 3*(e+r)/4-r}function o(t){for(var e,r=u(t),n=r[0],r=r[1],i=new f(c(t,n,r)),s=0,a=0<r?n-4:n,o,o=0;o<a;o+=4)e=h[t.charCodeAt(o)]<<18|h[t.charCodeAt(o+1)]<<12|h[t.charCodeAt(o+2)]<<6|h[t.charCodeAt(o+3)],i[s++]=e>>16&255,i[s++]=e>>8&255,i[s++]=255&e;return 2===r&&(e=h[t.charCodeAt(o)]<<2|h[t.charCodeAt(o+1)]>>4,i[s++]=255&e),1===r&&(e=h[t.charCodeAt(o)]<<10|h[t.charCodeAt(o+1)]<<4|h[t.charCodeAt(o+2)]>>2,i[s++]=e>>8&255,i[s++]=255&e),i}function d(t){return l[t>>18&63]+l[t>>12&63]+l[t>>6&63]+l[63&t]}function p(t,e,r){for(var n,i=[],s=e;s<r;s+=3)n=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),i.push(d(n));return i.join("")}function _(t){for(var e,r=t.length,n=r%3,i=[],s=16383,a=0,o=r-n;a<o;a+=s)i.push(p(t,a,o<a+s?o:a+s));return 1==n?(e=t[r-1],i.push(l[e>>2]+l[e<<4&63]+"==")):2==n&&(e=(t[r-2]<<8)+t[r-1],i.push(l[e>>10]+l[e>>4&63]+l[e<<2&63]+"=")),i.join("")}h["-".charCodeAt(0)]=62,h["_".charCodeAt(0)]=63},{}],28:[function(t,e,r){},{}],29:[function(l,t,c){!function(h,f){"use strict";var u=l("assert"),s=l("pako/lib/zlib/zstream"),a=l("pako/lib/zlib/deflate.js"),o=l("pako/lib/zlib/inflate.js"),t=l("pako/lib/zlib/constants"),e;for(e in t)c[e]=t[e];c.NONE=0,c.DEFLATE=1,c.INFLATE=2,c.GZIP=3,c.GUNZIP=4,c.DEFLATERAW=5,c.INFLATERAW=6,c.UNZIP=7;var r=31,n=139;function i(t){if("number"!=typeof t||t<c.DEFLATE||t>c.UNZIP)throw new TypeError("Bad argument");this.dictionary=null,this.err=0,this.flush=0,this.init_done=!1,this.level=0,this.memLevel=0,this.mode=t,this.strategy=0,this.windowBits=0,this.write_in_progress=!1,this.pending_close=!1,this.gzip_id_bytes_read=0}i.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,u(this.init_done,"close before init"),u(this.mode<=c.UNZIP),this.mode===c.DEFLATE||this.mode===c.GZIP||this.mode===c.DEFLATERAW?a.deflateEnd(this.strm):this.mode!==c.INFLATE&&this.mode!==c.GUNZIP&&this.mode!==c.INFLATERAW&&this.mode!==c.UNZIP||o.inflateEnd(this.strm),this.mode=c.NONE,this.dictionary=null)},i.prototype.write=function(t,e,r,n,i,s,a){return this._write(!0,t,e,r,n,i,s,a)},i.prototype.writeSync=function(t,e,r,n,i,s,a){return this._write(!1,t,e,r,n,i,s,a)},i.prototype._write=function(t,e,r,n,i,s,a,o){if(u.equal(arguments.length,8),u(this.init_done,"write before init"),u(this.mode!==c.NONE,"already finalized"),u.equal(!1,this.write_in_progress,"write already in progress"),u.equal(!1,this.pending_close,"close is pending"),this.write_in_progress=!0,u.equal(!1,void 0===e,"must provide flush value"),this.write_in_progress=!0,e!==c.Z_NO_FLUSH&&e!==c.Z_PARTIAL_FLUSH&&e!==c.Z_SYNC_FLUSH&&e!==c.Z_FULL_FLUSH&&e!==c.Z_FINISH&&e!==c.Z_BLOCK)throw new Error("Invalid flush value");if(null==r&&(r=f.alloc(0),n=i=0),this.strm.avail_in=i,this.strm.input=r,this.strm.next_in=n,this.strm.avail_out=o,this.strm.output=s,this.strm.next_out=a,this.flush=e,!t)return this._process(),this._checkError()?this._afterSync():void 0;var l=this;return h.nextTick(function(){l._process(),l._after()}),this},i.prototype._afterSync=function(){var t=this.strm.avail_out,e=this.strm.avail_in;return this.write_in_progress=!1,[e,t]},i.prototype._process=function(){var t=null;switch(this.mode){case c.DEFLATE:case c.GZIP:case c.DEFLATERAW:this.err=a.deflate(this.strm,this.flush);break;case c.UNZIP:switch(0<this.strm.avail_in&&(t=this.strm.next_in),this.gzip_id_bytes_read){case 0:if(null===t)break;if(31!==this.strm.input[t]){this.mode=c.INFLATE;break}if(t++,(this.gzip_id_bytes_read=1)===this.strm.avail_in)break;case 1:if(null===t)break;this.strm.input[t]===n?(this.gzip_id_bytes_read=2,this.mode=c.GUNZIP):this.mode=c.INFLATE;break;default:throw new Error("invalid number of gzip magic number bytes read")}case c.INFLATE:case c.GUNZIP:case c.INFLATERAW:for(this.err=o.inflate(this.strm,this.flush),this.err===c.Z_NEED_DICT&&this.dictionary&&(this.err=o.inflateSetDictionary(this.strm,this.dictionary),this.err===c.Z_OK?this.err=o.inflate(this.strm,this.flush):this.err===c.Z_DATA_ERROR&&(this.err=c.Z_NEED_DICT));0<this.strm.avail_in&&this.mode===c.GUNZIP&&this.err===c.Z_STREAM_END&&0!==this.strm.next_in[0];)this.reset(),this.err=o.inflate(this.strm,this.flush);break;default:throw new Error("Unknown mode "+this.mode)}},i.prototype._checkError=function(){switch(this.err){case c.Z_OK:case c.Z_BUF_ERROR:if(0!==this.strm.avail_out&&this.flush===c.Z_FINISH)return this._error("unexpected end of file"),!1;break;case c.Z_STREAM_END:break;case c.Z_NEED_DICT:return null==this.dictionary?this._error("Missing dictionary"):this._error("Bad dictionary"),!1;default:return this._error("Zlib error"),!1}return!0},i.prototype._after=function(){var t,e;this._checkError()&&(t=this.strm.avail_out,e=this.strm.avail_in,this.write_in_progress=!1,this.callback(e,t),this.pending_close&&this.close())},i.prototype._error=function(t){this.strm.msg&&(t=this.strm.msg),this.onerror(t,this.err),this.write_in_progress=!1,this.pending_close&&this.close()},i.prototype.init=function(t,e,r,n,i){u(4===arguments.length||5===arguments.length,"init(windowBits, level, memLevel, strategy, [dictionary])"),u(8<=t&&t<=15,"invalid windowBits"),u(-1<=e&&e<=9,"invalid compression level"),u(1<=r&&r<=9,"invalid memlevel"),u(n===c.Z_FILTERED||n===c.Z_HUFFMAN_ONLY||n===c.Z_RLE||n===c.Z_FIXED||n===c.Z_DEFAULT_STRATEGY,"invalid strategy"),this._init(e,t,r,n,i),this._setDictionary()},i.prototype.params=function(){throw new Error("deflateParams Not supported")},i.prototype.reset=function(){this._reset(),this._setDictionary()},i.prototype._init=function(t,e,r,n,i){switch(this.level=t,this.windowBits=e,this.memLevel=r,this.strategy=n,this.flush=c.Z_NO_FLUSH,this.err=c.Z_OK,this.mode!==c.GZIP&&this.mode!==c.GUNZIP||(this.windowBits+=16),this.mode===c.UNZIP&&(this.windowBits+=32),this.mode!==c.DEFLATERAW&&this.mode!==c.INFLATERAW||(this.windowBits=-1*this.windowBits),this.strm=new s,this.mode){case c.DEFLATE:case c.GZIP:case c.DEFLATERAW:this.err=a.deflateInit2(this.strm,this.level,c.Z_DEFLATED,this.windowBits,this.memLevel,this.strategy);break;case c.INFLATE:case c.GUNZIP:case c.INFLATERAW:case c.UNZIP:this.err=o.inflateInit2(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}this.err!==c.Z_OK&&this._error("Init error"),this.dictionary=i,this.write_in_progress=!1,this.init_done=!0},i.prototype._setDictionary=function(){if(null!=this.dictionary){switch(this.err=c.Z_OK,this.mode){case c.DEFLATE:case c.DEFLATERAW:this.err=a.deflateSetDictionary(this.strm,this.dictionary)}this.err!==c.Z_OK&&this._error("Failed to set dictionary")}},i.prototype._reset=function(){switch(this.err=c.Z_OK,this.mode){case c.DEFLATE:case c.DEFLATERAW:case c.GZIP:this.err=a.deflateReset(this.strm);break;case c.INFLATE:case c.INFLATERAW:case c.GUNZIP:this.err=o.inflateReset(this.strm)}this.err!==c.Z_OK&&this._error("Failed to reset stream")},c.Zlib=i}.call(this,l("_process"),l("buffer").Buffer)},{_process:51,assert:23,buffer:31,"pako/lib/zlib/constants":41,"pako/lib/zlib/deflate.js":43,"pako/lib/zlib/inflate.js":45,"pako/lib/zlib/zstream":49}],30:[function(A,t,O){!function(i){"use strict";var _=A("buffer").Buffer,s=A("stream").Transform,o=A("./binding"),t=A("util"),g=A("assert").ok,b=A("buffer").kMaxLength,m="Cannot create final Buffer. It would be larger than 0x"+b.toString(16)+" bytes";o.Z_MIN_WINDOWBITS=8,o.Z_MAX_WINDOWBITS=15,o.Z_DEFAULT_WINDOWBITS=15,o.Z_MIN_CHUNK=64,o.Z_MAX_CHUNK=1/0,o.Z_DEFAULT_CHUNK=16384,o.Z_MIN_MEMLEVEL=1,o.Z_MAX_MEMLEVEL=9,o.Z_DEFAULT_MEMLEVEL=8,o.Z_MIN_LEVEL=-1,o.Z_MAX_LEVEL=9,o.Z_DEFAULT_LEVEL=o.Z_DEFAULT_COMPRESSION;for(var e=Object.keys(o),r=0;r<e.length;r++){var n=e[r];n.match(/^Z/)&&Object.defineProperty(O,n,{enumerable:!0,value:o[n],writable:!1})}for(var a={Z_OK:o.Z_OK,Z_STREAM_END:o.Z_STREAM_END,Z_NEED_DICT:o.Z_NEED_DICT,Z_ERRNO:o.Z_ERRNO,Z_STREAM_ERROR:o.Z_STREAM_ERROR,Z_DATA_ERROR:o.Z_DATA_ERROR,Z_MEM_ERROR:o.Z_MEM_ERROR,Z_BUF_ERROR:o.Z_BUF_ERROR,Z_VERSION_ERROR:o.Z_VERSION_ERROR},l=Object.keys(a),h=0;h<l.length;h++){var f=l[h];a[a[f]]=f}function u(r,t,n){var i=[],s=0;function e(){for(var t;null!==(t=r.read());)i.push(t),s+=t.length;r.once("readable",e)}function a(t){r.removeListener("end",o),r.removeListener("readable",e),n(t)}function o(){var t,e=null;b<=s?e=new RangeError(m):t=_.concat(i,s),i=[],r.close(),n(e,t)}r.on("error",a),r.on("end",o),r.end(t),e()}function c(t,e){if("string"==typeof e&&(e=_.from(e)),!_.isBuffer(e))throw new TypeError("Not a string or buffer");var r=t._finishFlushFlag;return t._processChunk(e,r)}function d(t){if(!(this instanceof d))return new d(t);T.call(this,t,o.DEFLATE)}function p(t){if(!(this instanceof p))return new p(t);T.call(this,t,o.INFLATE)}function y(t){if(!(this instanceof y))return new y(t);T.call(this,t,o.GZIP)}function w(t){if(!(this instanceof w))return new w(t);T.call(this,t,o.GUNZIP)}function v(t){if(!(this instanceof v))return new v(t);T.call(this,t,o.DEFLATERAW)}function E(t){if(!(this instanceof E))return new E(t);T.call(this,t,o.INFLATERAW)}function k(t){if(!(this instanceof k))return new k(t);T.call(this,t,o.UNZIP)}function x(t){return t===o.Z_NO_FLUSH||t===o.Z_PARTIAL_FLUSH||t===o.Z_SYNC_FLUSH||t===o.Z_FULL_FLUSH||t===o.Z_FINISH||t===o.Z_BLOCK}function T(t,e){var r=this;if(this._opts=t=t||{},this._chunkSize=t.chunkSize||O.Z_DEFAULT_CHUNK,s.call(this,t),t.flush&&!x(t.flush))throw new Error("Invalid flush flag: "+t.flush);if(t.finishFlush&&!x(t.finishFlush))throw new Error("Invalid flush flag: "+t.finishFlush);if(this._flushFlag=t.flush||o.Z_NO_FLUSH,this._finishFlushFlag=void 0!==t.finishFlush?t.finishFlush:o.Z_FINISH,t.chunkSize&&(t.chunkSize<O.Z_MIN_CHUNK||t.chunkSize>O.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+t.chunkSize);if(t.windowBits&&(t.windowBits<O.Z_MIN_WINDOWBITS||t.windowBits>O.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+t.windowBits);if(t.level&&(t.level<O.Z_MIN_LEVEL||t.level>O.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+t.level);if(t.memLevel&&(t.memLevel<O.Z_MIN_MEMLEVEL||t.memLevel>O.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+t.memLevel);if(t.strategy&&t.strategy!=O.Z_FILTERED&&t.strategy!=O.Z_HUFFMAN_ONLY&&t.strategy!=O.Z_RLE&&t.strategy!=O.Z_FIXED&&t.strategy!=O.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+t.strategy);if(t.dictionary&&!_.isBuffer(t.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._handle=new o.Zlib(e);var n=this;this._hadError=!1,this._handle.onerror=function(t,e){S(n),n._hadError=!0;var t=new Error(t);t.errno=e,t.code=O.codes[e],n.emit("error",t)};var i=O.Z_DEFAULT_COMPRESSION;"number"==typeof t.level&&(i=t.level);var e=O.Z_DEFAULT_STRATEGY;"number"==typeof t.strategy&&(e=t.strategy),this._handle.init(t.windowBits||O.Z_DEFAULT_WINDOWBITS,i,t.memLevel||O.Z_DEFAULT_MEMLEVEL,e,t.dictionary),this._buffer=_.allocUnsafe(this._chunkSize),this._offset=0,this._level=i,this._strategy=e,this.once("end",this.close),Object.defineProperty(this,"_closed",{get:function(){return!r._handle},configurable:!0,enumerable:!0})}function S(t,e){e&&i.nextTick(e),t._handle&&(t._handle.close(),t._handle=null)}function L(t){t.emit("close")}Object.defineProperty(O,"codes",{enumerable:!0,value:Object.freeze(a),writable:!1}),O.Deflate=d,O.Inflate=p,O.Gzip=y,O.Gunzip=w,O.DeflateRaw=v,O.InflateRaw=E,O.Unzip=k,O.createDeflate=function(t){return new d(t)},O.createInflate=function(t){return new p(t)},O.createDeflateRaw=function(t){return new v(t)},O.createInflateRaw=function(t){return new E(t)},O.createGzip=function(t){return new y(t)},O.createGunzip=function(t){return new w(t)},O.createUnzip=function(t){return new k(t)},O.deflate=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new d(e),t,r)},O.deflateSync=function(t,e){return c(new d(e),t)},O.gzip=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new y(e),t,r)},O.gzipSync=function(t,e){return c(new y(e),t)},O.deflateRaw=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new v(e),t,r)},O.deflateRawSync=function(t,e){return c(new v(e),t)},O.unzip=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new k(e),t,r)},O.unzipSync=function(t,e){return c(new k(e),t)},O.inflate=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new p(e),t,r)},O.inflateSync=function(t,e){return c(new p(e),t)},O.gunzip=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new w(e),t,r)},O.gunzipSync=function(t,e){return c(new w(e),t)},O.inflateRaw=function(t,e,r){return"function"==typeof e&&(r=e,e={}),u(new E(e),t,r)},O.inflateRawSync=function(t,e){return c(new E(e),t)},t.inherits(T,s),T.prototype.params=function(t,e,r){if(t<O.Z_MIN_LEVEL||t>O.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+t);if(e!=O.Z_FILTERED&&e!=O.Z_HUFFMAN_ONLY&&e!=O.Z_RLE&&e!=O.Z_FIXED&&e!=O.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+e);var n;this._level!==t||this._strategy!==e?(n=this).flush(o.Z_SYNC_FLUSH,function(){g(n._handle,"zlib binding closed"),n._handle.params(t,e),n._hadError||(n._level=t,n._strategy=e,r&&r())}):i.nextTick(r)},T.prototype.reset=function(){return g(this._handle,"zlib binding closed"),this._handle.reset()},T.prototype._flush=function(t){this._transform(_.alloc(0),"",t)},T.prototype.flush=function(t,e){var r=this,n=this._writableState;"function"!=typeof t&&(void 0!==t||e)||(e=t,t=o.Z_FULL_FLUSH),n.ended?e&&i.nextTick(e):n.ending?e&&this.once("end",e):n.needDrain?e&&this.once("drain",function(){return r.flush(t,e)}):(this._flushFlag=t,this.write(_.alloc(0),"",e))},T.prototype.close=function(t){S(this,t),i.nextTick(L,this)},T.prototype._transform=function(t,e,r){var n,i=this._writableState,s,a=(i.ending||i.ended)&&(!t||i.length===t.length);return null===t||_.isBuffer(t)?this._handle?(a?n=this._finishFlushFlag:(n=this._flushFlag,t.length>=i.length&&(this._flushFlag=this._opts.flush||o.Z_NO_FLUSH)),void this._processChunk(t,n,r)):r(new Error("zlib binding closed")):r(new Error("invalid input"))},T.prototype._processChunk=function(i,s,a){var o=i&&i.length,l=this._chunkSize-this._offset,h=0,f=this,u="function"==typeof a;if(!u){var c=[],d=0,e;this.on("error",function(t){e=t}),g(this._handle,"zlib binding closed");do{var t=this._handle.writeSync(s,i,h,o,this._buffer,this._offset,l)}while(!this._hadError&&p(t[0],t[1]));if(this._hadError)throw e;if(b<=d)throw S(this),new RangeError(m);var r=_.concat(c,d);return S(this),r}g(this._handle,"zlib binding closed");var r=this._handle.write(s,i,h,o,this._buffer,this._offset,l);function p(t,e){if(this&&(this.buffer=null,this.callback=null),!f._hadError){var r=l-e,n;if(g(0<=r,"have should not go down"),0<r&&(n=f._buffer.slice(f._offset,f._offset+r),f._offset+=r,u?f.push(n):(c.push(n),d+=n.length)),(0===e||f._offset>=f._chunkSize)&&(l=f._chunkSize,f._offset=0,f._buffer=_.allocUnsafe(f._chunkSize)),0===e){if(h+=o-t,o=t,!u)return!0;var t=f._handle.write(s,i,h,o,f._buffer,f._offset,f._chunkSize);return t.callback=p,void(t.buffer=i)}if(!u)return!1;a()}}r.buffer=i,r.callback=p},t.inherits(d,T),t.inherits(p,T),t.inherits(y,T),t.inherits(w,T),t.inherits(v,T),t.inherits(E,T),t.inherits(k,T)}.call(this,A("_process"))},{"./binding":29,_process:51,assert:23,buffer:31,stream:67,util:72}],31:[function(X,t,J){!function(c){"use strict";var n=X("base64-js"),s=X("ieee754");J.Buffer=c,J.SlowBuffer=_,J.INSPECT_MAX_BYTES=50;var e=2147483647;function t(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()}catch(t){return!1}}function i(t){if(e<t)throw new RangeError('The value "'+t+'" is invalid for option "size"');var t=new Uint8Array(t);return t.__proto__=c.prototype,t}function c(t,e,r){if("number"!=typeof t)return a(t,e,r);if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return l(t)}function a(t,e,r){if("string"==typeof t)return h(t,e);if(ArrayBuffer.isView(t))return f(t);if(null==t)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(K(t,ArrayBuffer)||t&&K(t.buffer,ArrayBuffer))return u(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return c.from(n,e,r);var n=d(t);if(n)return n;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return c.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function o(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function r(t,e,r){return o(t),!(t<=0)&&void 0!==e?"string"==typeof r?i(t).fill(e,r):i(t).fill(e):i(t)}function l(t){return o(t),i(t<0?0:0|p(t))}function h(t,e){if(!c.isEncoding(e="string"!=typeof e||""===e?"utf8":e))throw new TypeError("Unknown encoding: "+e);var r=0|g(t,e),n=i(r),e=n.write(t,e);return n=e!==r?n.slice(0,e):n}function f(t){for(var e=t.length<0?0:0|p(t.length),r=i(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function u(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var r,r=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r);return r.__proto__=c.prototype,r}function d(t){if(c.isBuffer(t)){var e=0|p(t.length),r=i(e);return 0===r.length?r:(t.copy(r,0,0,e),r)}return void 0!==t.length?"number"!=typeof t.length||V(t.length)?i(0):f(t):"Buffer"===t.type&&Array.isArray(t.data)?f(t.data):void 0}function p(t){if(e<=t)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+e.toString(16)+" bytes");return 0|t}function _(t){return c.alloc(+(t=+t!=t?0:t))}function g(t,e){if(c.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||K(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=2<arguments.length&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return H(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return W(t).length;default:if(i)return n?-1:H(t).length;e=(""+e).toLowerCase(),i=!0}}function b(t,e,r){var n=!1;if((e=void 0===e||e<0?0:e)>this.length)return"";if((r=void 0===r||r>this.length?this.length:r)<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t=t||"utf8";;)switch(t){case"hex":return B(this,e,r);case"utf8":case"utf-8":return A(this,e,r);case"ascii":return I(this,e,r);case"latin1":case"binary":return C(this,e,r);case"base64":return L(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return M(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function m(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function y(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):2147483647<r?r=2147483647:r<-2147483648&&(r=-2147483648),(r=(r=V(r=+r)?i?0:t.length-1:r)<0?t.length+r:r)>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=c.from(e,n)),c.isBuffer(e))return 0===e.length?-1:w(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?(i?Uint8Array.prototype.indexOf:Uint8Array.prototype.lastIndexOf).call(t,e,r):w(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function w(t,e,r,n,i){var s=1,a=t.length,o=e.length,l;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a/=s=2,o/=2,r/=2}function h(t,e){return 1===s?t[e]:t.readUInt16BE(e*s)}if(i)for(var f=-1,l=r;l<a;l++)if(h(t,l)===h(e,-1===f?0:l-f)){if(l-(f=-1===f?l:f)+1===o)return f*s}else-1!==f&&(l-=l-f),f=-1;else for(l=r=a<r+o?a-o:r;0<=l;l--){for(var u=!0,c=0;c<o;c++)if(h(t,l+c)!==h(e,c)){u=!1;break}if(u)return l}return-1}function v(t,e,r,n){r=Number(r)||0;var i=t.length-r;(!n||i<(n=Number(n)))&&(n=i);var i=e.length;i/2<n&&(n=i/2);for(var s=0;s<n;++s){var a=parseInt(e.substr(2*s,2),16);if(V(a))return s;t[r+s]=a}return s}function E(t,e,r,n){return G(H(e,t.length-r),t,r,n)}function k(t,e,r,n){return G(Y(e),t,r,n)}function x(t,e,r,n){return k(t,e,r,n)}function T(t,e,r,n){return G(W(e),t,r,n)}function S(t,e,r,n){return G(q(e,t.length-r),t,r,n)}function L(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function A(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var s=t[i],a=null,o=239<s?4:223<s?3:191<s?2:1,l,h,f,u;if(i+o<=r)switch(o){case 1:s<128&&(a=s);break;case 2:128==(192&(l=t[i+1]))&&127<(u=(31&s)<<6|63&l)&&(a=u);break;case 3:l=t[i+1],h=t[i+2],128==(192&l)&&128==(192&h)&&2047<(u=(15&s)<<12|(63&l)<<6|63&h)&&(u<55296||57343<u)&&(a=u);break;case 4:l=t[i+1],h=t[i+2],f=t[i+3],128==(192&l)&&128==(192&h)&&128==(192&f)&&65535<(u=(15&s)<<18|(63&l)<<12|(63&h)<<6|63&f)&&u<1114112&&(a=u)}null===a?(a=65533,o=1):65535<a&&(a-=65536,n.push(a>>>10&1023|55296),a=56320|1023&a),n.push(a),i+=o}return R(n)}J.kMaxLength=e,(c.TYPED_ARRAY_SUPPORT=t())||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(c.prototype,"parent",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.buffer}}),Object.defineProperty(c.prototype,"offset",{enumerable:!0,get:function(){if(c.isBuffer(this))return this.byteOffset}}),"undefined"!=typeof Symbol&&null!=Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),c.poolSize=8192,c.from=a,c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,c.alloc=r,c.allocUnsafe=l,c.allocUnsafeSlow=l,c.isBuffer=function t(e){return null!=e&&!0===e._isBuffer&&e!==c.prototype},c.compare=function t(e,r){if(K(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),K(r,Uint8Array)&&(r=c.from(r,r.offset,r.byteLength)),!c.isBuffer(e)||!c.isBuffer(r))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===r)return 0;for(var n=e.length,i=r.length,s=0,a=Math.min(n,i);s<a;++s)if(e[s]!==r[s]){n=e[s],i=r[s];break}return n<i?-1:i<n?1:0},c.isEncoding=function t(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function t(e,r){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===r)for(n=r=0;n<e.length;++n)r+=e[n].length;for(var i=c.allocUnsafe(r),s=0,n=0;n<e.length;++n){var a=e[n];if(K(a,Uint8Array)&&(a=c.from(a)),!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(i,s),s+=a.length}return i},c.byteLength=g,c.prototype._isBuffer=!0,c.prototype.swap16=function t(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var r=0;r<e;r+=2)m(this,r,r+1);return this},c.prototype.swap32=function t(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var r=0;r<e;r+=4)m(this,r,r+3),m(this,r+1,r+2);return this},c.prototype.swap64=function t(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var r=0;r<e;r+=8)m(this,r,r+7),m(this,r+1,r+6),m(this,r+2,r+5),m(this,r+3,r+4);return this},c.prototype.toLocaleString=c.prototype.toString=function t(){var e=this.length;return 0===e?"":0===arguments.length?A(this,0,e):b.apply(this,arguments)},c.prototype.equals=function t(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function t(){var e="",r=J.INSPECT_MAX_BYTES,e=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim();return this.length>r&&(e+=" ... "),"<Buffer "+e+">"},c.prototype.compare=function t(e,r,n,i,s){if(K(e,Uint8Array)&&(e=c.from(e,e.offset,e.byteLength)),!c.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===n&&(n=e?e.length:0),void 0===i&&(i=0),void 0===s&&(s=this.length),(r=void 0===r?0:r)<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(s<=i&&n<=r)return 0;if(s<=i)return-1;if(n<=r)return 1;if(this===e)return 0;for(var a=(s>>>=0)-(i>>>=0),o=(n>>>=0)-(r>>>=0),l=Math.min(a,o),h=this.slice(i,s),f=e.slice(r,n),u=0;u<l;++u)if(h[u]!==f[u]){a=h[u],o=f[u];break}return a<o?-1:o<a?1:0},c.prototype.includes=function t(e,r,n){return-1!==this.indexOf(e,r,n)},c.prototype.indexOf=function t(e,r,n){return y(this,e,r,n,!0)},c.prototype.lastIndexOf=function t(e,r,n){return y(this,e,r,n,!1)},c.prototype.write=function t(e,r,n,i){if(void 0===r)i="utf8",n=this.length,r=0;else if(void 0===n&&"string"==typeof r)i=r,n=this.length,r=0;else{if(!isFinite(r))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");r>>>=0,isFinite(n)?(n>>>=0,void 0===i&&(i="utf8")):(i=n,n=void 0)}var s=this.length-r;if((void 0===n||s<n)&&(n=s),0<e.length&&(n<0||r<0)||r>this.length)throw new RangeError("Attempt to write outside buffer bounds");i=i||"utf8";for(var a=!1;;)switch(i){case"hex":return v(this,e,r,n);case"utf8":case"utf-8":return E(this,e,r,n);case"ascii":return k(this,e,r,n);case"latin1":case"binary":return x(this,e,r,n);case"base64":return T(this,e,r,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,r,n);default:if(a)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),a=!0}},c.prototype.toJSON=function t(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var O=4096;function R(t){var e=t.length;if(e<=O)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=O));return r}function I(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function C(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function B(t,e,r){var n=t.length;(!r||r<0||n<r)&&(r=n);for(var i="",s=e=!e||e<0?0:e;s<r;++s)i+=Z(t[s]);return i}function M(t,e,r){for(var n=t.slice(e,r),i="",s=0;s<n.length;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function N(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(r<t+e)throw new RangeError("Trying to access beyond buffer length")}function D(t,e,r,n,i,s){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(i<e||e<s)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function z(t,e,r,n,i,s){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function P(t,e,r,n,i){return e=+e,r>>>=0,i||z(t,e,r,4,34028234663852886e22,-34028234663852886e22),s.write(t,e,r,n,23,4),r+4}function U(t,e,r,n,i){return e=+e,r>>>=0,i||z(t,e,r,8,17976931348623157e292,-17976931348623157e292),s.write(t,e,r,n,52,8),r+8}c.prototype.slice=function t(e,r){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(r=void 0===r?n:~~r)<0?(r+=n)<0&&(r=0):n<r&&(r=n),r<e&&(r=e);var r=this.subarray(e,r);return r.__proto__=c.prototype,r},c.prototype.readUIntLE=function t(e,r,n){e>>>=0,r>>>=0,n||N(e,r,this.length);for(var i=this[e],s=1,a=0;++a<r&&(s*=256);)i+=this[e+a]*s;return i},c.prototype.readUIntBE=function t(e,r,n){e>>>=0,r>>>=0,n||N(e,r,this.length);for(var i=this[e+--r],s=1;0<r&&(s*=256);)i+=this[e+--r]*s;return i},c.prototype.readUInt8=function t(e,r){return e>>>=0,r||N(e,1,this.length),this[e]},c.prototype.readUInt16LE=function t(e,r){return e>>>=0,r||N(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function t(e,r){return e>>>=0,r||N(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function t(e,r){return e>>>=0,r||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function t(e,r){return e>>>=0,r||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function t(e,r,n){e>>>=0,r>>>=0,n||N(e,r,this.length);for(var i=this[e],s=1,a=0;++a<r&&(s*=256);)i+=this[e+a]*s;return(s*=128)<=i&&(i-=Math.pow(2,8*r)),i},c.prototype.readIntBE=function t(e,r,n){e>>>=0,r>>>=0,n||N(e,r,this.length);for(var i=r,s=1,a=this[e+--i];0<i&&(s*=256);)a+=this[e+--i]*s;return(s*=128)<=a&&(a-=Math.pow(2,8*r)),a},c.prototype.readInt8=function t(e,r){return e>>>=0,r||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function t(e,r){e>>>=0,r||N(e,2,this.length);var e=this[e]|this[e+1]<<8;return 32768&e?4294901760|e:e},c.prototype.readInt16BE=function t(e,r){e>>>=0,r||N(e,2,this.length);var e=this[e+1]|this[e]<<8;return 32768&e?4294901760|e:e},c.prototype.readInt32LE=function t(e,r){return e>>>=0,r||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function t(e,r){return e>>>=0,r||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function t(e,r){return e>>>=0,r||N(e,4,this.length),s.read(this,e,!0,23,4)},c.prototype.readFloatBE=function t(e,r){return e>>>=0,r||N(e,4,this.length),s.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function t(e,r){return e>>>=0,r||N(e,8,this.length),s.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function t(e,r){return e>>>=0,r||N(e,8,this.length),s.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function t(e,r,n,i){var s;e=+e,r>>>=0,n>>>=0,i||D(this,e,r,n,Math.pow(2,8*n)-1,0);var a=1,o=0;for(this[r]=255&e;++o<n&&(a*=256);)this[r+o]=e/a&255;return r+n},c.prototype.writeUIntBE=function t(e,r,n,i){var s;e=+e,r>>>=0,n>>>=0,i||D(this,e,r,n,Math.pow(2,8*n)-1,0);var a=n-1,o=1;for(this[r+a]=255&e;0<=--a&&(o*=256);)this[r+a]=e/o&255;return r+n},c.prototype.writeUInt8=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,1,255,0),this[r]=255&e,r+1},c.prototype.writeUInt16LE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,2,65535,0),this[r]=255&e,this[r+1]=e>>>8,r+2},c.prototype.writeUInt16BE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,2,65535,0),this[r]=e>>>8,this[r+1]=255&e,r+2},c.prototype.writeUInt32LE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,4,4294967295,0),this[r+3]=e>>>24,this[r+2]=e>>>16,this[r+1]=e>>>8,this[r]=255&e,r+4},c.prototype.writeUInt32BE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,4,4294967295,0),this[r]=e>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e,r+4},c.prototype.writeIntLE=function t(e,r,n,i){var i;e=+e,r>>>=0,i||D(this,e,r,n,(i=Math.pow(2,8*n-1))-1,-i);var s=0,a=1,o=0;for(this[r]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[r+s-1]&&(o=1),this[r+s]=(e/a>>0)-o&255;return r+n},c.prototype.writeIntBE=function t(e,r,n,i){var i;e=+e,r>>>=0,i||D(this,e,r,n,(i=Math.pow(2,8*n-1))-1,-i);var s=n-1,a=1,o=0;for(this[r+s]=255&e;0<=--s&&(a*=256);)e<0&&0===o&&0!==this[r+s+1]&&(o=1),this[r+s]=(e/a>>0)-o&255;return r+n},c.prototype.writeInt8=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,1,127,-128),this[r]=255&(e=e<0?255+e+1:e),r+1},c.prototype.writeInt16LE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,2,32767,-32768),this[r]=255&e,this[r+1]=e>>>8,r+2},c.prototype.writeInt16BE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,2,32767,-32768),this[r]=e>>>8,this[r+1]=255&e,r+2},c.prototype.writeInt32LE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,4,2147483647,-2147483648),this[r]=255&e,this[r+1]=e>>>8,this[r+2]=e>>>16,this[r+3]=e>>>24,r+4},c.prototype.writeInt32BE=function t(e,r,n){return e=+e,r>>>=0,n||D(this,e,r,4,2147483647,-2147483648),this[r]=(e=e<0?4294967295+e+1:e)>>>24,this[r+1]=e>>>16,this[r+2]=e>>>8,this[r+3]=255&e,r+4},c.prototype.writeFloatLE=function t(e,r,n){return P(this,e,r,!0,n)},c.prototype.writeFloatBE=function t(e,r,n){return P(this,e,r,!1,n)},c.prototype.writeDoubleLE=function t(e,r,n){return U(this,e,r,!0,n)},c.prototype.writeDoubleBE=function t(e,r,n){return U(this,e,r,!1,n)},c.prototype.copy=function t(e,r,n,i){if(!c.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n=n||0,i||0===i||(i=this.length),r>=e.length&&(r=e.length),(i=0<i&&i<n?n:i)===n)return 0;if(0===e.length||0===this.length)return 0;if((r=r||0)<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length);var s=(i=e.length-r<i-n?e.length-r+n:i)-n;if(this===e&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(r,n,i);else if(this===e&&n<r&&r<i)for(var a=s-1;0<=a;--a)e[a+r]=this[a+n];else Uint8Array.prototype.set.call(e,this.subarray(n,i),r);return s},c.prototype.fill=function t(e,r,n,i){if("string"==typeof e){if("string"==typeof r?(i=r,r=0,n=this.length):"string"==typeof n&&(i=n,n=this.length),void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!c.isEncoding(i))throw new TypeError("Unknown encoding: "+i);var s;1===e.length&&(s=e.charCodeAt(0),("utf8"===i&&s<128||"latin1"===i)&&(e=s))}else"number"==typeof e&&(e&=255);if(r<0||this.length<r||this.length<n)throw new RangeError("Out of range index");if(n<=r)return this;var a;if(r>>>=0,n=void 0===n?this.length:n>>>0,"number"==typeof(e=e||0))for(a=r;a<n;++a)this[a]=e;else{var o=c.isBuffer(e)?e:c.from(e,i),l=o.length;if(0===l)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(a=0;a<n-r;++a)this[a+r]=o[a%l]}return this};var j=/[^+/0-9A-Za-z-_]/g;function F(t){if((t=(t=t.split("=")[0]).trim().replace(j,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}function Z(t){return t<16?"0"+t.toString(16):t.toString(16)}function H(t,e){var r;e=e||1/0;for(var n=t.length,i=null,s=[],a=0;a<n;++a){if(55295<(r=t.charCodeAt(a))&&r<57344){if(!i){if(56319<r){-1<(e-=3)&&s.push(239,191,189);continue}if(a+1===n){-1<(e-=3)&&s.push(239,191,189);continue}i=r;continue}if(r<56320){-1<(e-=3)&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&-1<(e-=3)&&s.push(239,191,189);if(i=null,r<128){if(--e<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function Y(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}function q(t,e){for(var r,n,i,s=[],a=0;a<t.length&&!((e-=2)<0);++a)n=(r=t.charCodeAt(a))>>8,s.push(i=r%256),s.push(n);return s}function W(t){return n.toByteArray(F(t))}function G(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function K(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function V(t){return t!=t}}.call(this,X("buffer").Buffer)},{"base64-js":27,buffer:31,ieee754:34}],32:[function(t,e,g){!function(t){function e(t){return Array.isArray?Array.isArray(t):"[object Array]"===_(t)}function r(t){return"boolean"==typeof t}function n(t){return null===t}function i(t){return null==t}function s(t){return"number"==typeof t}function a(t){return"string"==typeof t}function o(t){return"symbol"==typeof t}function l(t){return void 0===t}function h(t){return"[object RegExp]"===_(t)}function f(t){return"object"==typeof t&&null!==t}function u(t){return"[object Date]"===_(t)}function c(t){return"[object Error]"===_(t)||t instanceof Error}function d(t){return"function"==typeof t}function p(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function _(t){return Object.prototype.toString.call(t)}g.isArray=e,g.isBoolean=r,g.isNull=n,g.isNullOrUndefined=i,g.isNumber=s,g.isString=a,g.isSymbol=o,g.isUndefined=l,g.isRegExp=h,g.isObject=f,g.isDate=u,g.isError=c,g.isFunction=d,g.isPrimitive=p,g.isBuffer=t.isBuffer}.call(this,{isBuffer:t("../../is-buffer/index.js")})},{"../../is-buffer/index.js":36}],33:[function(t,e,r){var l=Object.create||x,o=Object.keys||T,n=Function.prototype.bind||S;function i(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=l(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((e.exports=i).EventEmitter=i).prototype._events=void 0,i.prototype._maxListeners=void 0;var s=10,a;try{var h={};Object.defineProperty&&Object.defineProperty(h,"x",{value:0}),a=0===h.x}catch(t){a=!1}function f(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function u(t,e,r){if(e)t.call(r);else for(var n=t.length,i=E(t,n),s=0;s<n;++s)i[s].call(r)}function c(t,e,r,n){if(e)t.call(r,n);else for(var i=t.length,s=E(t,i),a=0;a<i;++a)s[a].call(r,n)}function d(t,e,r,n,i){if(e)t.call(r,n,i);else for(var s=t.length,a=E(t,s),o=0;o<s;++o)a[o].call(r,n,i)}function p(t,e,r,n,i,s){if(e)t.call(r,n,i,s);else for(var a=t.length,o=E(t,a),l=0;l<a;++l)o[l].call(r,n,i,s)}function _(t,e,r,n){if(e)t.apply(r,n);else for(var i=t.length,s=E(t,i),a=0;a<i;++a)s[a].apply(r,n)}function g(t,e,r,n){var n,i,s,n,n;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return(i=t._events)?(i.newListener&&(t.emit("newListener",e,r.listener||r),i=t._events),s=i[e]):(i=t._events=l(null),t._eventsCount=0),s?("function"==typeof s?s=i[e]=n?[r,s]:[s,r]:n?s.unshift(r):s.push(r),s.warned||(n=f(t))&&0<n&&s.length>n&&(s.warned=!0,(n=new Error("Possible EventEmitter memory leak detected. "+s.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.')).name="MaxListenersExceededWarning",n.emitter=t,n.type=e,n.count=s.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",n.name,n.message))):(s=i[e]=r,++t._eventsCount),t}function b(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function m(t,e,r){var t={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},e=n.call(b,t);return e.listener=r,t.wrapFn=e}function y(t,e,r){var t=t._events;if(!t)return[];var e=t[e];return e?"function"==typeof e?r?[e.listener||e]:[e]:r?k(e):E(e,e.length):[]}function w(t){var e=this._events;if(e){var t=e[t];if("function"==typeof t)return 1;if(t)return t.length}return 0}function v(t,e){for(var r=e,n=r+1,i=t.length;n<i;r+=1,n+=1)t[r]=t[n];t.pop()}function E(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}function k(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function x(t){var e=function(){};return e.prototype=t,new e}function T(t){var e=[],r;for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return r}function S(t){var e=this;return function(){return e.apply(t,arguments)}}a?Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');s=t}}):i.defaultMaxListeners=s,i.prototype.setMaxListeners=function t(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},i.prototype.getMaxListeners=function t(){return f(this)},i.prototype.emit=function t(e){var r,n,i,s,a,o,l="error"===e,o=this._events;if(o)l=l&&null==o.error;else if(!l)return!1;if(l){if((r=1<arguments.length?arguments[1]:r)instanceof Error)throw r;var l=new Error('Unhandled "error" event. ('+r+")");throw l.context=r,l}if(!(n=o[e]))return!1;var h="function"==typeof n,i;switch(i=arguments.length){case 1:u(n,h,this);break;case 2:c(n,h,this,arguments[1]);break;case 3:d(n,h,this,arguments[1],arguments[2]);break;case 4:p(n,h,this,arguments[1],arguments[2],arguments[3]);break;default:for(s=new Array(i-1),a=1;a<i;a++)s[a-1]=arguments[a];_(n,h,this,s)}return!0},i.prototype.on=i.prototype.addListener=function t(e,r){return g(this,e,r,!1)},i.prototype.prependListener=function t(e,r){return g(this,e,r,!0)},i.prototype.once=function t(e,r){if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return this.on(e,m(this,e,r)),this},i.prototype.prependOnceListener=function t(e,r){if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,m(this,e,r)),this},i.prototype.removeListener=function t(e,r){var n,i,s,a,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(n=i[e]))return this;if(n===r||n.listener===r)0==--this._eventsCount?this._events=l(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||r));else if("function"!=typeof n){for(s=-1,a=n.length-1;0<=a;a--)if(n[a]===r||n[a].listener===r){o=n[a].listener,s=a;break}if(s<0)return this;0===s?n.shift():v(n,s),1===n.length&&(i[e]=n[0]),i.removeListener&&this.emit("removeListener",e,o||r)}return this},i.prototype.removeAllListeners=function t(e){var r,n,i,n=this._events;if(!n)return this;if(!n.removeListener)return 0===arguments.length?(this._events=l(null),this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=l(null):delete n[e]),this;if(0===arguments.length){for(var s=o(n),a,i=0;i<s.length;++i)"removeListener"!==(a=s[i])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=l(null),this._eventsCount=0,this}if("function"==typeof(r=n[e]))this.removeListener(e,r);else if(r)for(i=r.length-1;0<=i;i--)this.removeListener(e,r[i]);return this},i.prototype.listeners=function t(e){return y(this,e,!0)},i.prototype.rawListeners=function t(e){return y(this,e,!1)},i.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):w.call(t,e)},i.prototype.listenerCount=w,i.prototype.eventNames=function t(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],34:[function(t,e,r){r.read=function(t,e,r,n,i){var s,a,o=8*i-n-1,l=(1<<o)-1,h=l>>1,f=-7,u=r?i-1:0,c=r?-1:1,r=t[e+u];for(u+=c,s=r&(1<<-f)-1,r>>=-f,f+=o;0<f;s=256*s+t[e+u],u+=c,f-=8);for(a=s&(1<<-f)-1,s>>=-f,f+=n;0<f;a=256*a+t[e+u],u+=c,f-=8);if(0===s)s=1-h;else{if(s===l)return a?NaN:1/0*(r?-1:1);a+=Math.pow(2,n),s-=h}return(r?-1:1)*a*Math.pow(2,s-n)},r.write=function(t,e,r,n,i,s){var a,o,n,l=8*s-i-1,h=(1<<l)-1,f=h>>1,u=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,c=n?0:s-1,d=n?1:-1,s=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,a=h):(a=Math.floor(Math.log(e)/Math.LN2),e*(n=Math.pow(2,-a))<1&&(a--,n*=2),2<=(e+=1<=a+f?u/n:u*Math.pow(2,1-f))*n&&(a++,n/=2),h<=a+f?(o=0,a=h):1<=a+f?(o=(e*n-1)*Math.pow(2,i),a+=f):(o=e*Math.pow(2,f-1)*Math.pow(2,i),a=0));8<=i;t[r+c]=255&o,c+=d,o/=256,i-=8);for(a=a<<i|o,l+=i;0<l;t[r+c]=255&a,c+=d,a/=256,l-=8);t[r+c-d]|=128*s}},{}],35:[function(t,e,r){"function"==typeof Object.create?e.exports=function t(e,r){r&&(e.super_=r,e.prototype=Object.create(r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function t(e,r){var n;r&&(e.super_=r,(n=function(){}).prototype=r.prototype,e.prototype=new n,e.prototype.constructor=e)}},{}],36:[function(t,e,r){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function i(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}e.exports=function(t){return null!=t&&(n(t)||i(t)||!!t._isBuffer)}},{}],37:[function(t,e,r){var n={}.toString;e.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},{}],38:[function(t,e,r){"use strict";var l=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,f=Object.prototype.propertyIsEnumerable;function u(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function n(){try{if(!Object.assign)return;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return;for(var e={},r=0,n;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(t){i[t]=t}),"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},i)).join("")?void 0:1}catch(t){return}}e.exports=n()?Object.assign:function(t,e){for(var r,n=u(t),i,s=1;s<arguments.length;s++){for(var a in r=Object(arguments[s]))h.call(r,a)&&(n[a]=r[a]);if(l)for(var i=l(r),o=0;o<i.length;o++)f.call(r,i[o])&&(n[i[o]]=r[i[o]])}return n}},{}],39:[function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function i(t,e){return Object.prototype.hasOwnProperty.call(t,e)}r.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)i(r,n)&&(t[n]=r[n])}}return t},r.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var s={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var s=0;s<n;s++)t[i+s]=e[r+s]},flattenChunks:function(t){for(var e,r,n,i,s,a,n=0,e=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),e=i=0,r=t.length;e<r;e++)s=t[e],a.set(s,i),i+=s.length;return a}},a={arraySet:function(t,e,r,n,i){for(var s=0;s<n;s++)t[i+s]=e[r+s]},flattenChunks:function(t){return[].concat.apply([],t)}};r.setTyped=function(t){t?(r.Buf8=Uint8Array,r.Buf16=Uint16Array,r.Buf32=Int32Array,r.assign(r,s)):(r.Buf8=Array,r.Buf16=Array,r.Buf32=Array,r.assign(r,a))},r.setTyped(n)},{}],40:[function(t,e,r){"use strict";function n(t,e,r,n){for(var i=65535&t|0,s=t>>>16&65535|0,a=0;0!==r;){for(r-=a=2e3<r?2e3:r;s=s+(i=i+e[n++]|0)|0,--a;);i%=65521,s%=65521}return i|s<<16|0}e.exports=n},{}],41:[function(t,e,r){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],42:[function(t,e,r){"use strict";function n(){for(var t,e=[],r=0;r<256;r++){for(var t=r,n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}var o=n();function i(t,e,r,n){var i=o,s=n+r;t^=-1;for(var a=n;a<s;a++)t=t>>>8^i[255&(t^e[a])];return-1^t}e.exports=i},{}],43:[function(t,e,r){"use strict";var f=t("../utils/common"),l=t("./trees"),u=t("./adler32"),h=t("./crc32"),n=t("./messages"),c=0,i=1,s=3,d=4,a=5,p=0,o=1,_=-2,g=-3,b=-5,m=-1,y=1,w=2,v=3,E=4,k=0,x=2,T=8,S=9,L=15,A=8,O=29,R=256,I=286,C=30,B=19,M=2*I+1,N=15,D=3,z=258,P=z+D+1,U=32,j=42,F=69,Z=73,H=91,Y=103,q=113,W=666,G=1,K=2,V=3,X=4,J=3,$;function Q(t,e){return t.msg=n[e],e}function tt(t){return(t<<1)-(4<t?9:0)}function et(t){for(var e=t.length;0<=--e;)t[e]=0}function rt(t){var e=t.state,r=e.pending;0!==(r=r>t.avail_out?t.avail_out:r)&&(f.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function nt(t,e){l._tr_flush_block(t,0<=t.block_start?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,rt(t.strm)}function it(t,e){t.pending_buf[t.pending++]=e}function st(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function at(t,e,r,n){var i=t.avail_in;return 0===(i=n<i?n:i)?0:(t.avail_in-=i,f.arraySet(e,t.input,t.next_in,i,r),1===t.state.wrap?t.adler=u(t.adler,e,i,r):2===t.state.wrap&&(t.adler=h(t.adler,e,i,r)),t.next_in+=i,t.total_in+=i,i)}function ot(t,e){var r=t.max_chain_length,n=t.strstart,i,s,a=t.prev_length,o=t.nice_match,l=t.strstart>t.w_size-P?t.strstart-(t.w_size-P):0,h=t.window,f=t.w_mask,u=t.prev,c=t.strstart+z,d=h[n+a-1],p=h[n+a];t.prev_length>=t.good_match&&(r>>=2),o>t.lookahead&&(o=t.lookahead);do{if(h[(i=e)+a]===p&&h[i+a-1]===d&&h[i]===h[n]&&h[++i]===h[n+1]){for(n+=2,i++;h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&h[++n]===h[++i]&&n<c;);if(s=z-(c-n),n=c-z,a<s){if(t.match_start=e,o<=(a=s))break;d=h[n+a-1],p=h[n+a]}}}while((e=u[e&f])>l&&0!=--r);return a<=t.lookahead?a:t.lookahead}function lt(t){var e=t.w_size,r,n,i,s,a;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-P)){for(f.arraySet(t.window,t.window,e,e,0),t.match_start-=e,t.strstart-=e,t.block_start-=e,r=n=t.hash_size;i=t.head[--r],t.head[r]=e<=i?i-e:0,--n;);for(r=n=e;i=t.prev[--r],t.prev[r]=e<=i?i-e:0,--n;);s+=e}if(0===t.strm.avail_in)break;if(n=at(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=n,t.lookahead+t.insert>=D)for(a=t.strstart-t.insert,t.ins_h=t.window[a],t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[a+D-1])&t.hash_mask,t.prev[a&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=a,a++,t.insert--,!(t.lookahead+t.insert<D)););}while(t.lookahead<P&&0!==t.strm.avail_in)}function ht(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(lt(t),0===t.lookahead&&e===c)return G;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,nt(t,!1),0===t.strm.avail_out))return G;if(t.strstart-t.block_start>=t.w_size-P&&(nt(t,!1),0===t.strm.avail_out))return G}return t.insert=0,e===d?(nt(t,!0),0===t.strm.avail_out?V:X):(t.strstart>t.block_start&&(nt(t,!1),t.strm.avail_out),G)}function ft(t,e){for(var r,n;;){if(t.lookahead<P){if(lt(t),t.lookahead<P&&e===c)return G;if(0===t.lookahead)break}if(r=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-P&&(t.match_length=ot(t,r)),t.match_length>=D)if(n=l._tr_tally(t,t.strstart-t.match_start,t.match_length-D),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=D){for(t.match_length--;t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart,0!=--t.match_length;);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=l._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(nt(t,!1),0===t.strm.avail_out))return G}return t.insert=t.strstart<D-1?t.strstart:D-1,e===d?(nt(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?G:K}function ut(t,e){for(var r,n,i;;){if(t.lookahead<P){if(lt(t),t.lookahead<P&&e===c)return G;if(0===t.lookahead)break}if(r=0,t.lookahead>=D&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=D-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-P&&(t.match_length=ot(t,r),t.match_length<=5&&(1===t.strategy||t.match_length===D&&4096<t.strstart-t.match_start)&&(t.match_length=D-1)),t.prev_length>=D&&t.match_length<=t.prev_length){for(i=t.strstart+t.lookahead-D,n=l._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-D),t.lookahead-=t.prev_length-1,t.prev_length-=2;++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+D-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!=--t.prev_length;);if(t.match_available=0,t.match_length=D-1,t.strstart++,n&&(nt(t,!1),0===t.strm.avail_out))return G}else if(t.match_available){if((n=l._tr_tally(t,0,t.window[t.strstart-1]))&&nt(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return G}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=l._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<D-1?t.strstart:D-1,e===d?(nt(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?G:K}function ct(t,e){for(var r,n,i,s,a=t.window;;){if(t.lookahead<=z){if(lt(t),t.lookahead<=z&&e===c)return G;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=D&&0<t.strstart&&(n=a[i=t.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){for(s=t.strstart+z;n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<s;);t.match_length=z-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=D?(r=l._tr_tally(t,1,t.match_length-D),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=l._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(nt(t,!1),0===t.strm.avail_out))return G}return t.insert=0,e===d?(nt(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?G:K}function dt(t,e){for(var r;;){if(0===t.lookahead&&(lt(t),0===t.lookahead)){if(e===c)return G;break}if(t.match_length=0,r=l._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(nt(t,!1),0===t.strm.avail_out))return G}return t.insert=0,e===d?(nt(t,!0),0===t.strm.avail_out?V:X):t.last_lit&&(nt(t,!1),0===t.strm.avail_out)?G:K}function pt(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}function _t(t){t.window_size=2*t.w_size,et(t.head),t.max_lazy_match=$[t.level].max_lazy,t.good_match=$[t.level].good_length,t.nice_match=$[t.level].nice_length,t.max_chain_length=$[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=D-1,t.match_available=0,t.ins_h=0}function gt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new f.Buf16(2*M),this.dyn_dtree=new f.Buf16(2*(2*C+1)),this.bl_tree=new f.Buf16(2*(2*B+1)),et(this.dyn_ltree),et(this.dyn_dtree),et(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new f.Buf16(N+1),this.heap=new f.Buf16(2*I+1),et(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new f.Buf16(2*I+1),et(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function bt(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=x,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?j:q,t.adler=2===e.wrap?0:1,e.last_flush=c,l._tr_init(e),p):Q(t,_)}function mt(t){var e=bt(t);return e===p&&_t(t.state),e}function yt(t,e){return!t||!t.state||2!==t.state.wrap?_:(t.state.gzhead=e,p)}function wt(t,e,r,n,i,s){if(!t)return _;var a=1;if(e===m&&(e=6),n<0?(a=0,n=-n):15<n&&(a=2,n-=16),i<1||S<i||r!==T||n<8||15<n||e<0||9<e||s<0||E<s)return Q(t,_);8===n&&(n=9);var o=new gt;return(t.state=o).strm=t,o.wrap=a,o.gzhead=null,o.w_bits=n,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+D-1)/D),o.window=new f.Buf8(2*o.w_size),o.head=new f.Buf16(o.hash_size),o.prev=new f.Buf16(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new f.Buf8(o.pending_buf_size),o.d_buf=+o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=e,o.strategy=s,o.method=r,mt(t)}function vt(t,e){return wt(t,e,T,15,8,0)}function Et(t,e){var r,n,i,s,a,o,o;if(!t||!t.state||5<e||e<0)return t?Q(t,_):_;if(n=t.state,!t.output||!t.input&&0!==t.avail_in||n.status===W&&e!==d)return Q(t,0===t.avail_out?-5:_);if(n.strm=t,r=n.last_flush,n.last_flush=e,n.status===j&&(2===n.wrap?(t.adler=0,it(n,31),it(n,139),it(n,8),n.gzhead?(it(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),it(n,255&n.gzhead.time),it(n,n.gzhead.time>>8&255),it(n,n.gzhead.time>>16&255),it(n,n.gzhead.time>>24&255),it(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),it(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(it(n,255&n.gzhead.extra.length),it(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=h(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(it(n,0),it(n,0),it(n,0),it(n,0),it(n,0),it(n,9===n.level?2:2<=n.strategy||n.level<2?4:0),it(n,3),n.status=q)):(a=T+(n.w_bits-8<<4)<<8,o=-1,a|=(o=2<=n.strategy||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=q,st(n,a),0!==n.strstart&&(st(n,t.adler>>>16),st(n,65535&t.adler)),t.adler=1)),69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(t.adler=h(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending!==n.pending_buf_size));)it(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(t.adler=h(t.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=h(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}}while(s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,it(n,s),0!==s);n.gzhead.hcrc&&n.pending>i&&(t.adler=h(t.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(t.adler=h(t.adler,n.pending_buf,n.pending-i,i)),rt(t),i=n.pending,n.pending===n.pending_buf_size)){s=1;break}}while(s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,it(n,s),0!==s);n.gzhead.hcrc&&n.pending>i&&(t.adler=h(t.adler,n.pending_buf,n.pending-i,i)),0===s&&(n.status=Y)}else n.status=Y;if(n.status===Y&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&rt(t),n.pending+2<=n.pending_buf_size&&(it(n,255&t.adler),it(n,t.adler>>8&255),t.adler=0,n.status=q)):n.status=q),0!==n.pending){if(rt(t),0===t.avail_out)return n.last_flush=-1,p}else if(0===t.avail_in&&tt(e)<=tt(r)&&e!==d)return Q(t,-5);if(n.status===W&&0!==t.avail_in)return Q(t,-5);if(0!==t.avail_in||0!==n.lookahead||e!==c&&n.status!==W){var r=2===n.strategy?dt(n,e):3===n.strategy?ct(n,e):$[n.level].func(n,e);if(r!==V&&r!==X||(n.status=W),r===G||r===V)return 0===t.avail_out&&(n.last_flush=-1),p;if(r===K&&(1===e?l._tr_align(n):5!==e&&(l._tr_stored_block(n,0,0,!1),3===e&&(et(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),rt(t),0===t.avail_out))return n.last_flush=-1,p}return e!==d?p:n.wrap<=0?1:(2===n.wrap?(it(n,255&t.adler),it(n,t.adler>>8&255),it(n,t.adler>>16&255),it(n,t.adler>>24&255),it(n,255&t.total_in),it(n,t.total_in>>8&255),it(n,t.total_in>>16&255),it(n,t.total_in>>24&255)):(st(n,t.adler>>>16),st(n,65535&t.adler)),rt(t),0<n.wrap&&(n.wrap=-n.wrap),0!==n.pending?p:1)}function kt(t){var e;return t&&t.state?(e=t.state.status)!==j&&69!==e&&73!==e&&91!==e&&e!==Y&&e!==q&&e!==W?Q(t,_):(t.state=null,e===q?Q(t,-3):p):_}function xt(t,e){var r=e.length,n,i,s,a,o,l,h,h;if(!t||!t.state)return _;if(2===(a=(n=t.state).wrap)||1===a&&n.status!==j||n.lookahead)return _;for(1===a&&(t.adler=u(t.adler,e,r,0)),n.wrap=0,r>=n.w_size&&(0===a&&(et(n.head),n.strstart=0,n.block_start=0,n.insert=0),h=new f.Buf8(n.w_size),f.arraySet(h,e,r-n.w_size,n.w_size,0),e=h,r=n.w_size),o=t.avail_in,l=t.next_in,h=t.input,t.avail_in=r,t.next_in=0,t.input=e,lt(n);n.lookahead>=D;){for(i=n.strstart,s=n.lookahead-(D-1);n.ins_h=(n.ins_h<<n.hash_shift^n.window[i+D-1])&n.hash_mask,n.prev[i&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=i,i++,--s;);n.strstart=i,n.lookahead=D-1,lt(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=D-1,n.match_available=0,t.next_in=l,t.input=h,t.avail_in=o,n.wrap=a,p}$=[new pt(0,0,0,0,ht),new pt(4,4,8,4,ft),new pt(4,5,16,8,ft),new pt(4,6,32,32,ft),new pt(4,4,16,16,ut),new pt(8,16,32,32,ut),new pt(8,16,128,128,ut),new pt(8,32,128,256,ut),new pt(32,128,258,1024,ut),new pt(32,258,258,4096,ut)],r.deflateInit=vt,r.deflateInit2=wt,r.deflateReset=mt,r.deflateResetKeep=bt,r.deflateSetHeader=yt,r.deflate=Et,r.deflateEnd=kt,r.deflateSetDictionary=xt,r.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":39,"./adler32":40,"./crc32":42,"./messages":47,"./trees":48}],44:[function(t,e,r){"use strict";var n=30,i=12;e.exports=function t(e,r){var n,i,s,a,o,l,h,f,u,c,d,p,_,g,b,m,y,w,v,E,k,x,T,S,L,n=e.state,i=e.next_in,S=e.input,s=i+(e.avail_in-5),a=e.next_out,L=e.output,o=a-(r-e.avail_out),l=a+(e.avail_out-257),h=n.dmax,f=n.wsize,u=n.whave,c=n.wnext,d=n.window,p=n.hold,_=n.bits,g=n.lencode,b=n.distcode,m=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;t:do{_<15&&(p+=S[i++]<<_,_+=8,p+=S[i++]<<_,_+=8),w=g[p&m];e:for(;;){if(p>>>=v=w>>>24,_-=v,0===(v=w>>>16&255))L[a++]=65535&w;else{if(!(16&v)){if(0==(64&v)){w=g[(65535&w)+(p&(1<<v)-1)];continue}if(32&v){n.mode=12;break t}e.msg="invalid literal/length code",n.mode=30;break t}E=65535&w,(v&=15)&&(_<v&&(p+=S[i++]<<_,_+=8),E+=p&(1<<v)-1,p>>>=v,_-=v),_<15&&(p+=S[i++]<<_,_+=8,p+=S[i++]<<_,_+=8),w=b[p&y];r:for(;;){if(p>>>=v=w>>>24,_-=v,!(16&(v=w>>>16&255))){if(0==(64&v)){w=b[(65535&w)+(p&(1<<v)-1)];continue}e.msg="invalid distance code",n.mode=30;break t}if(k=65535&w,_<(v&=15)&&(p+=S[i++]<<_,(_+=8)<v&&(p+=S[i++]<<_,_+=8)),h<(k+=p&(1<<v)-1)){e.msg="invalid distance too far back",n.mode=30;break t}if(p>>>=v,_-=v,(v=a-o)<k){if(u<(v=k-v)&&n.sane){e.msg="invalid distance too far back",n.mode=30;break t}if(T=d,(x=0)===c){if(x+=f-v,v<E){for(E-=v;L[a++]=d[x++],--v;);x=a-k,T=L}}else if(c<v){if(x+=f+c-v,(v-=c)<E){for(E-=v;L[a++]=d[x++],--v;);if(x=0,c<E){for(E-=v=c;L[a++]=d[x++],--v;);x=a-k,T=L}}}else if(x+=c-v,v<E){for(E-=v;L[a++]=d[x++],--v;);x=a-k,T=L}for(;2<E;)L[a++]=T[x++],L[a++]=T[x++],L[a++]=T[x++],E-=3;E&&(L[a++]=T[x++],1<E&&(L[a++]=T[x++]))}else{for(x=a-k;L[a++]=L[x++],L[a++]=L[x++],L[a++]=L[x++],2<(E-=3););E&&(L[a++]=L[x++],1<E&&(L[a++]=L[x++]))}break}}break}}while(i<s&&a<l);p&=(1<<(_-=(E=_>>3)<<3))-1,e.next_in=i-=E,e.next_out=a,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=a<l?l-a+257:257-(a-l),n.hold=p,n.bits=_}},{}],45:[function(t,e,r){"use strict";var O=t("../utils/common"),R=t("./adler32"),I=t("./crc32"),C=t("./inffast"),B=t("./inftrees"),n=0,M=1,N=2,i=4,s=5,a=6,D=0,o=1,l=2,z=-2,h=-3,f=-4,u=-5,c=8,P=1,d=2,p=3,_=4,g=5,b=6,m=7,y=8,w=9,v=10,E=11,k=12,x=13,T=14,S=15,L=16,A=17,U=18,j=19,F=20,Z=21,H=22,Y=23,q=24,W=25,G=26,K=27,V=28,X=29,J=30,$=31,Q=32,tt=852,et=592,rt=15,nt=15;function it(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function st(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new O.Buf16(320),this.work=new O.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function at(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=P,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new O.Buf32(tt),e.distcode=e.distdyn=new O.Buf32(et),e.sane=1,e.back=-1,D):z}function ot(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,at(t)):z}function lt(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||15<e)?z:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,ot(t))):z}function ht(t,e){var e,r;return t?(r=new st,(t.state=r).window=null,(e=lt(t,e))!==D&&(t.state=null),e):z}function ft(t){return ht(t,15)}var ut=!0,ct,dt;function pt(t){if(ut){var e;for(ct=new O.Buf32(512),dt=new O.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(B(M,t.lens,0,288,ct,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;B(N,t.lens,0,32,dt,0,t.work,{bits:5}),ut=!1}t.lencode=ct,t.lenbits=9,t.distcode=dt,t.distbits=5}function _t(t,e,r,n){var t,i=t.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new O.Buf8(i.wsize)),n>=i.wsize?(O.arraySet(i.window,e,r-i.wsize,i.wsize,0),i.wnext=0,i.whave=i.wsize):(n<(t=i.wsize-i.wnext)&&(t=n),O.arraySet(i.window,e,r-n,t,i.wnext),(n-=t)?(O.arraySet(i.window,e,r-n,n,0),i.wnext=n,i.whave=i.wsize):(i.wnext+=t,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=t))),0}function gt(t,e){var r,n,i,s,a,o,l,h,f,u,c,d,p,_,g=0,b,m,y,w,v,E,k,x,T=new O.Buf8(4),S,L,A=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return z;12===(r=t.state).mode&&(r.mode=13),a=t.next_out,i=t.output,l=t.avail_out,s=t.next_in,n=t.input,o=t.avail_in,h=r.hold,f=r.bits,u=o,c=l,x=D;t:for(;;)switch(r.mode){case P:if(0===r.wrap){r.mode=13;break}for(;f<16;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(2&r.wrap&&35615===h){T[r.check=0]=255&h,T[1]=h>>>8&255,r.check=I(r.check,T,2,0),f=h=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&h)<<8)+(h>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&h)){t.msg="unknown compression method",r.mode=30;break}if(f-=4,k=8+(15&(h>>>=4)),0===r.wbits)r.wbits=k;else if(k>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<k,t.adler=r.check=1,r.mode=512&h?10:12,f=h=0;break;case 2:for(;f<16;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(r.flags=h,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=h>>8&1),512&r.flags&&(T[0]=255&h,T[1]=h>>>8&255,r.check=I(r.check,T,2,0)),f=h=0,r.mode=3;case 3:for(;f<32;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.head&&(r.head.time=h),512&r.flags&&(T[0]=255&h,T[1]=h>>>8&255,T[2]=h>>>16&255,T[3]=h>>>24&255,r.check=I(r.check,T,4,0)),f=h=0,r.mode=4;case 4:for(;f<16;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.head&&(r.head.xflags=255&h,r.head.os=h>>8),512&r.flags&&(T[0]=255&h,T[1]=h>>>8&255,r.check=I(r.check,T,2,0)),f=h=0,r.mode=5;case 5:if(1024&r.flags){for(;f<16;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.length=h,r.head&&(r.head.extra_len=h),512&r.flags&&(T[0]=255&h,T[1]=h>>>8&255,r.check=I(r.check,T,2,0)),f=h=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((d=o<(d=r.length)?o:d)&&(r.head&&(k=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),O.arraySet(r.head.extra,n,s,d,k)),512&r.flags&&(r.check=I(r.check,n,d,s)),o-=d,s+=d,r.length-=d),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===o)break t;for(d=0;k=n[s+d++],r.head&&k&&r.length<65536&&(r.head.name+=String.fromCharCode(k)),k&&d<o;);if(512&r.flags&&(r.check=I(r.check,n,d,s)),o-=d,s+=d,k)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===o)break t;for(d=0;k=n[s+d++],r.head&&k&&r.length<65536&&(r.head.comment+=String.fromCharCode(k)),k&&d<o;);if(512&r.flags&&(r.check=I(r.check,n,d,s)),o-=d,s+=d,k)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;f<16;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(h!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}f=h=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;f<32;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}t.adler=r.check=it(h),f=h=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=h,r.bits=f,2;t.adler=r.check=1,r.mode=12;case 12:if(5===e||6===e)break t;case 13:if(r.last){h>>>=7&f,f-=7&f,r.mode=27;break}for(;f<3;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}switch(r.last=1&h,--f,3&(h>>>=1)){case 0:r.mode=14;break;case 1:if(pt(r),r.mode=20,6!==e)break;h>>>=2,f-=2;break t;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}h>>>=2,f-=2;break;case 14:for(h>>>=7&f,f-=7&f;f<32;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if((65535&h)!=(h>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&h,f=h=0,r.mode=15,6===e)break t;case 15:r.mode=16;case 16:if(d=r.length){if(0===(d=l<(d=o<d?o:d)?l:d))break t;O.arraySet(i,n,s,d,a),o-=d,s+=d,l-=d,a+=d,r.length-=d;break}r.mode=12;break;case 17:for(;f<14;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(r.nlen=257+(31&h),h>>>=5,f-=5,r.ndist=1+(31&h),h>>>=5,f-=5,r.ncode=4+(15&h),h>>>=4,f-=4,286<r.nlen||30<r.ndist){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;f<3;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.lens[A[r.have++]]=7&h,h>>>=3,f-=3}for(;r.have<19;)r.lens[A[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,S={bits:r.lenbits},x=B(0,r.lens,0,19,r.lencode,0,r.work,S),r.lenbits=S.bits,x){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;m=(g=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,y=65535&g,!((b=g>>>24)<=f);){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(y<16)h>>>=b,f-=b,r.lens[r.have++]=y;else{if(16===y){for(L=b+2;f<L;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(h>>>=b,f-=b,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}k=r.lens[r.have-1],d=3+(3&h),h>>>=2,f-=2}else if(17===y){for(L=b+3;f<L;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}f-=b,k=0,d=3+(7&(h>>>=b)),h>>>=3,f-=3}else{for(L=b+7;f<L;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}f-=b,k=0,d=11+(127&(h>>>=b)),h>>>=7,f-=7}if(r.have+d>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;d--;)r.lens[r.have++]=k}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,S={bits:r.lenbits},x=B(M,r.lens,0,r.nlen,r.lencode,0,r.work,S),r.lenbits=S.bits,x){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,S={bits:r.distbits},x=B(N,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,S),r.distbits=S.bits,x){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===e)break t;case 20:r.mode=21;case 21:if(6<=o&&258<=l){t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=h,r.bits=f,C(t,c),a=t.next_out,i=t.output,l=t.avail_out,s=t.next_in,n=t.input,o=t.avail_in,h=r.hold,f=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;m=(g=r.lencode[h&(1<<r.lenbits)-1])>>>16&255,y=65535&g,!((b=g>>>24)<=f);){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(m&&0==(240&m)){for(w=b,v=m,E=y;m=(g=r.lencode[E+((h&(1<<w+v)-1)>>w)])>>>16&255,y=65535&g,!(w+(b=g>>>24)<=f);){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}h>>>=w,f-=w,r.back+=w}if(h>>>=b,f-=b,r.back+=b,r.length=y,0===m){r.mode=26;break}if(32&m){r.back=-1,r.mode=12;break}if(64&m){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&m,r.mode=22;case 22:if(r.extra){for(L=r.extra;f<L;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.length+=h&(1<<r.extra)-1,h>>>=r.extra,f-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;m=(g=r.distcode[h&(1<<r.distbits)-1])>>>16&255,y=65535&g,!((b=g>>>24)<=f);){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(0==(240&m)){for(w=b,v=m,E=y;m=(g=r.distcode[E+((h&(1<<w+v)-1)>>w)])>>>16&255,y=65535&g,!(w+(b=g>>>24)<=f);){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}h>>>=w,f-=w,r.back+=w}if(h>>>=b,f-=b,r.back+=b,64&m){t.msg="invalid distance code",r.mode=30;break}r.offset=y,r.extra=15&m,r.mode=24;case 24:if(r.extra){for(L=r.extra;f<L;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}r.offset+=h&(1<<r.extra)-1,h>>>=r.extra,f-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===l)break t;if(r.offset>(d=c-l)){if((d=r.offset-d)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}p=d>r.wnext?(d-=r.wnext,r.wsize-d):r.wnext-d,d>r.length&&(d=r.length),_=r.window}else _=i,p=a-r.offset,d=r.length;for(l-=d=l<d?l:d,r.length-=d;i[a++]=_[p++],--d;);0===r.length&&(r.mode=21);break;case 26:if(0===l)break t;i[a++]=r.length,l--,r.mode=21;break;case 27:if(r.wrap){for(;f<32;){if(0===o)break t;o--,h|=n[s++]<<f,f+=8}if(c-=l,t.total_out+=c,r.total+=c,c&&(t.adler=r.check=(r.flags?I:R)(r.check,i,c,a-c)),c=l,(r.flags?h:it(h))!==r.check){t.msg="incorrect data check",r.mode=30;break}f=h=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;f<32;){if(0===o)break t;o--,h+=n[s++]<<f,f+=8}if(h!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}f=h=0}r.mode=29;case 29:x=1;break t;case 30:x=-3;break t;case 31:return-4;default:return z}return t.next_out=a,t.avail_out=l,t.next_in=s,t.avail_in=o,r.hold=h,r.bits=f,(r.wsize||c!==t.avail_out&&r.mode<30&&(r.mode<27||4!==e))&&_t(t,t.output,t.next_out,c-t.avail_out)?(r.mode=31,-4):(u-=t.avail_in,c-=t.avail_out,t.total_in+=u,t.total_out+=c,r.total+=c,r.wrap&&c&&(t.adler=r.check=(r.flags?I:R)(r.check,i,c,t.next_out-c)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0==u&&0===c||4===e)&&x===D?-5:x)}function bt(t){if(!t||!t.state)return z;var e=t.state;return e.window&&(e.window=null),t.state=null,D}function mt(t,e){var t;return!t||!t.state||0==(2&(t=t.state).wrap)?z:((t.head=e).done=!1,D)}function yt(t,e){var r=e.length,n,i,s;return!t||!t.state||0!==(n=t.state).wrap&&11!==n.mode?z:11===n.mode&&(i=R(i=1,e,r,0))!==n.check?-3:(s=_t(t,e,r,r))?(n.mode=31,-4):(n.havedict=1,D)}r.inflateReset=ot,r.inflateReset2=lt,r.inflateResetKeep=at,r.inflateInit=ft,r.inflateInit2=ht,r.inflate=gt,r.inflateEnd=bt,r.inflateGetHeader=mt,r.inflateSetDictionary=yt,r.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":39,"./adler32":40,"./crc32":42,"./inffast":44,"./inftrees":46}],46:[function(t,e,r){"use strict";var N=t("../utils/common"),n=15,D=852,z=592,i=0,s=1,a=2,P=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],U=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],F=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function t(e,r,n,i,s,a,o,l){for(var h=l.bits,f=0,u=0,c=0,d=0,p=0,_=0,g=0,b=0,m=0,y=0,w,v,E,k,x,T=null,S=0,L,A=new N.Buf16(16),O=new N.Buf16(16),R=null,I=0,C,B,M,f=0;f<=15;f++)A[f]=0;for(u=0;u<i;u++)A[r[n+u]]++;for(p=h,d=15;1<=d&&0===A[d];d--);if(d<p&&(p=d),0===d)return s[a++]=20971520,s[a++]=20971520,l.bits=1,0;for(c=1;c<d&&0===A[c];c++);for(p<c&&(p=c),f=b=1;f<=15;f++)if(b<<=1,(b-=A[f])<0)return-1;if(0<b&&(0===e||1!==d))return-1;for(O[1]=0,f=1;f<15;f++)O[f+1]=O[f]+A[f];for(u=0;u<i;u++)0!==r[n+u]&&(o[O[r[n+u]]++]=u);if(L=0===e?(T=R=o,19):1===e?(T=P,S-=257,R=U,I-=257,256):(T=j,R=F,-1),f=c,x=a,g=u=y=0,E=-1,k=(m=1<<(_=p))-1,1===e&&D<m||2===e&&z<m)return 1;for(;;){for(M=o[u]<L?(B=0,o[u]):o[u]>L?(B=R[I+o[u]],T[S+o[u]]):(B=96,0),w=1<<(C=f-g),c=v=1<<_;s[x+(y>>g)+(v-=w)]=C<<24|B<<16|M|0,0!==v;);for(w=1<<f-1;y&w;)w>>=1;if(0!==w?(y&=w-1,y+=w):y=0,u++,0==--A[f]){if(f===d)break;f=r[n+o[u]]}if(p<f&&(y&k)!==E){for(x+=c,b=1<<(_=f-(g=0===g?p:g));_+g<d&&!((b-=A[_+g])<=0);)_++,b<<=1;if(m+=1<<_,1===e&&D<m||2===e&&z<m)return 1;s[E=y&k]=p<<24|_<<16|x-a|0}}return 0!==y&&(s[x+y]=f-g<<24|64<<16|0),l.bits=p,0}},{"../utils/common":39}],47:[function(t,e,r){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],48:[function(t,e,r){"use strict";var i=t("../utils/common"),n=4,s=0,a=1,o=2;function l(t){for(var e=t.length;0<=--e;)t[e]=0}var h=0,f=1,u=2,c=3,d=258,p=29,_=256,g=_+1+p,b=30,m=19,y=2*g+1,w=15,v=16,E=7,k=256,x=16,T=17,S=18,L=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],A=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],O=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],t=512,I=new Array(2*(g+2));l(I);var C=new Array(2*b);l(C);var B=new Array(t);l(B);var M=new Array(256);l(M);var N=new Array(p);l(N);var D=new Array(b),z,P,U;function j(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function F(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function Z(t){return t<256?B[t]:B[256+(t>>>7)]}function H(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function Y(t,e,r){t.bi_valid>v-r?(t.bi_buf|=e<<t.bi_valid&65535,H(t,t.bi_buf),t.bi_buf=e>>v-t.bi_valid,t.bi_valid+=r-v):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function q(t,e,r){Y(t,r[2*e],r[2*e+1])}function W(t,e){for(var r=0;r|=1&t,t>>>=1,r<<=1,0<--e;);return r>>>1}function G(t){16===t.bi_valid?(H(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):8<=t.bi_valid&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}function K(t,e){for(var r=e.dyn_tree,n=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,a=e.stat_desc.extra_bits,o=e.stat_desc.extra_base,l=e.stat_desc.max_length,h,f,u,c,d,p,_=0,c=0;c<=w;c++)t.bl_count[c]=0;for(r[2*t.heap[t.heap_max]+1]=0,h=t.heap_max+1;h<y;h++)l<(c=r[2*r[2*(f=t.heap[h])+1]+1]+1)&&(c=l,_++),r[2*f+1]=c,n<f||(t.bl_count[c]++,d=0,o<=f&&(d=a[f-o]),p=r[2*f],t.opt_len+=p*(c+d),s&&(t.static_len+=p*(i[2*f+1]+d)));if(0!==_){do{for(c=l-1;0===t.bl_count[c];)c--}while(t.bl_count[c]--,t.bl_count[c+1]+=2,t.bl_count[l]--,0<(_-=2));for(c=l;0!==c;c--)for(f=t.bl_count[c];0!==f;)n<(u=t.heap[--h])||(r[2*u+1]!==c&&(t.opt_len+=(c-r[2*u+1])*r[2*u],r[2*u+1]=c),f--)}}function V(t,e,r){for(var n=new Array(w+1),i=0,s,a,s=1;s<=w;s++)n[s]=i=i+r[s-1]<<1;for(a=0;a<=e;a++){var o=t[2*a+1];0!==o&&(t[2*a]=W(n[o]++,o))}}function X(){for(var t,e,r,n,i,s=new Array(w+1),r=0,n=0;n<p-1;n++)for(N[n]=r,t=0;t<1<<L[n];t++)M[r++]=n;for(M[r-1]=n,n=i=0;n<16;n++)for(D[n]=i,t=0;t<1<<A[n];t++)B[i++]=n;for(i>>=7;n<b;n++)for(D[n]=i<<7,t=0;t<1<<A[n]-7;t++)B[256+i++]=n;for(e=0;e<=w;e++)s[e]=0;for(t=0;t<=143;)I[2*t+1]=8,t++,s[8]++;for(;t<=255;)I[2*t+1]=9,t++,s[9]++;for(;t<=279;)I[2*t+1]=7,t++,s[7]++;for(;t<=287;)I[2*t+1]=8,t++,s[8]++;for(V(I,g+1,s),t=0;t<b;t++)C[2*t+1]=5,C[2*t]=W(t,5);z=new j(I,L,_+1,g,w),P=new j(C,A,0,b,w),U=new j(new Array(0),O,0,m,E)}function J(t){for(var e,e=0;e<g;e++)t.dyn_ltree[2*e]=0;for(e=0;e<b;e++)t.dyn_dtree[2*e]=0;for(e=0;e<m;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*k]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function $(t){8<t.bi_valid?H(t,t.bi_buf):0<t.bi_valid&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function Q(t,e,r,n){$(t),n&&(H(t,r),H(t,~r)),i.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}function tt(t,e,r,n){var i=2*e,s=2*r;return t[i]<t[s]||t[i]===t[s]&&n[e]<=n[r]}function et(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&tt(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!tt(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n}function rt(t,e,r){var n,i,s=0,a,o;if(0!==t.last_lit)for(;n=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],i=t.pending_buf[t.l_buf+s],s++,0==n?q(t,i,e):(q(t,(a=M[i])+_+1,e),0!==(o=L[a])&&Y(t,i-=N[a],o),q(t,a=Z(--n),r),0!==(o=A[a])&&Y(t,n-=D[a],o)),s<t.last_lit;);q(t,k,e)}function nt(t,e){var r=e.dyn_tree,n=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems,a,o,l=-1,h;for(t.heap_len=0,t.heap_max=y,a=0;a<s;a++)0!==r[2*a]?(t.heap[++t.heap_len]=l=a,t.depth[a]=0):r[2*a+1]=0;for(;t.heap_len<2;)r[2*(h=t.heap[++t.heap_len]=l<2?++l:0)]=1,t.depth[h]=0,t.opt_len--,i&&(t.static_len-=n[2*h+1]);for(e.max_code=l,a=t.heap_len>>1;1<=a;a--)et(t,r,a);for(h=s;a=t.heap[1],t.heap[1]=t.heap[t.heap_len--],et(t,r,1),o=t.heap[1],t.heap[--t.heap_max]=a,t.heap[--t.heap_max]=o,r[2*h]=r[2*a]+r[2*o],t.depth[h]=(t.depth[a]>=t.depth[o]?t.depth[a]:t.depth[o])+1,r[2*a+1]=r[2*o+1]=h,t.heap[1]=h++,et(t,r,1),2<=t.heap_len;);t.heap[--t.heap_max]=t.heap[1],K(t,e),V(r,l,t.bl_count)}function it(t,e,r){var n,i=-1,s,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)s=a,a=e[2*(n+1)+1],++o<l&&s===a||(o<h?t.bl_tree[2*s]+=o:0!==s?(s!==i&&t.bl_tree[2*s]++,t.bl_tree[2*x]++):o<=10?t.bl_tree[2*T]++:t.bl_tree[2*S]++,i=s,h=(o=0)===a?(l=138,3):s===a?(l=6,3):(l=7,4))}function st(t,e,r){var n,i=-1,s,a=e[1],o=0,l=7,h=4;for(0===a&&(l=138,h=3),n=0;n<=r;n++)if(s=a,a=e[2*(n+1)+1],!(++o<l&&s===a)){if(o<h)for(;q(t,s,t.bl_tree),0!=--o;);else 0!==s?(s!==i&&(q(t,s,t.bl_tree),o--),q(t,x,t.bl_tree),Y(t,o-3,2)):o<=10?(q(t,T,t.bl_tree),Y(t,o-3,3)):(q(t,S,t.bl_tree),Y(t,o-11,7));i=s,h=(o=0)===a?(l=138,3):s===a?(l=6,3):(l=7,4)}}function at(t){var e;for(it(t,t.dyn_ltree,t.l_desc.max_code),it(t,t.dyn_dtree,t.d_desc.max_code),nt(t,t.bl_desc),e=m-1;3<=e&&0===t.bl_tree[2*R[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}function ot(t,e,r,n){var i;for(Y(t,e-257,5),Y(t,r-1,5),Y(t,n-4,4),i=0;i<n;i++)Y(t,t.bl_tree[2*R[i]+1],3);st(t,t.dyn_ltree,e-1),st(t,t.dyn_dtree,r-1)}function lt(t){for(var e=4093624447,r,r=0;r<=31;r++,e>>>=1)if(1&e&&0!==t.dyn_ltree[2*r])return s;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(r=32;r<_;r++)if(0!==t.dyn_ltree[2*r])return a;return s}l(D);var ht=!1;function ft(t){ht||(X(),ht=!0),t.l_desc=new F(t.dyn_ltree,z),t.d_desc=new F(t.dyn_dtree,P),t.bl_desc=new F(t.bl_tree,U),t.bi_buf=0,t.bi_valid=0,J(t)}function ut(t,e,r,n){Y(t,0+(n?1:0),3),Q(t,e,r,!0)}function ct(t){Y(t,2,3),q(t,k,I),G(t)}function dt(t,e,r,n){var i,s,a=0;0<t.level?(2===t.strm.data_type&&(t.strm.data_type=lt(t)),nt(t,t.l_desc),nt(t,t.d_desc),a=at(t),i=t.opt_len+3+7>>>3,(s=t.static_len+3+7>>>3)<=i&&(i=s)):i=s=r+5,r+4<=i&&-1!==e?ut(t,e,r,n):4===t.strategy||s===i?(Y(t,2+(n?1:0),3),rt(t,I,C)):(Y(t,4+(n?1:0),3),ot(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),rt(t,t.dyn_ltree,t.dyn_dtree)),J(t),n&&$(t)}function pt(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(M[r]+_+1)]++,t.dyn_dtree[2*Z(e)]++),t.last_lit===t.lit_bufsize-1}r._tr_init=ft,r._tr_stored_block=ut,r._tr_flush_block=dt,r._tr_tally=pt,r._tr_align=ct},{"../utils/common":39}],49:[function(t,e,r){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}e.exports=n},{}],50:[function(t,e,r){!function(o){"use strict";function t(e,r,n,i){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var t=arguments.length,s,a;switch(t){case 0:case 1:return o.nextTick(e);case 2:return o.nextTick(function t(){e.call(null,r)});case 3:return o.nextTick(function t(){e.call(null,r,n)});case 4:return o.nextTick(function t(){e.call(null,r,n,i)});default:for(s=new Array(t-1),a=0;a<s.length;)s[a++]=arguments[a];return o.nextTick(function t(){e.apply(null,s)})}}void 0===o||!o.version||0===o.version.indexOf("v0.")||0===o.version.indexOf("v1.")&&0!==o.version.indexOf("v1.8.")?e.exports={nextTick:t}:e.exports=o}.call(this,t("_process"))},{_process:51}],51:[function(t,e,r){var e=e.exports={},n,i;function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}function l(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{return i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(t){n=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(t){i=a}}();var h=[],f=!1,u,c=-1;function d(){f&&u&&(f=!1,u.length?h=u.concat(h):c=-1,h.length&&p())}function p(){if(!f){var t=o(d);f=!0;for(var e=h.length;e;){for(u=h,h=[];++c<e;)u&&u[c].run();c=-1,e=h.length}u=null,f=!1,l(t)}}function _(t,e){this.fun=t,this.array=e}function g(){}e.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];h.push(new _(t,e)),1!==h.length||f||o(p)},_.prototype.run=function(){this.fun.apply(null,this.array)},e.title="browser",e.browser=!0,e.env={},e.argv=[],e.version="",e.versions={},e.on=g,e.addListener=g,e.once=g,e.off=g,e.removeListener=g,e.removeAllListeners=g,e.emit=g,e.prependListener=g,e.prependOnceListener=g,e.listeners=function(t){return[]},e.binding=function(t){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(t){throw new Error("process.chdir is not supported")},e.umask=function(){return 0}},{}],52:[function(t,e,r){e.exports=t("./lib/_stream_duplex.js")},{"./lib/_stream_duplex.js":53}],53:[function(t,e,r){"use strict";var n=t("process-nextick-args"),i=Object.keys||function(t){var e=[],r;for(r in t)e.push(r);return e};e.exports=f;var e=Object.create(t("core-util-is"));e.inherits=t("inherits");var s=t("./_stream_readable"),a=t("./_stream_writable");e.inherits(f,s);for(var o=i(a.prototype),l=0;l<o.length;l++){var h=o[l];f.prototype[h]||(f.prototype[h]=a.prototype[h])}function f(t){if(!(this instanceof f))return new f(t);s.call(this,t),a.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",u)}function u(){this.allowHalfOpen||this._writableState.ended||n.nextTick(c,this)}function c(t){t.end()}Object.defineProperty(f.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(f.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),f.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},{"./_stream_readable":55,"./_stream_writable":57,"core-util-is":32,inherits:35,"process-nextick-args":50}],54:[function(t,e,r){"use strict";e.exports=i;var n=t("./_stream_transform"),e=Object.create(t("core-util-is"));function i(t){if(!(this instanceof i))return new i(t);n.call(this,t)}e.inherits=t("inherits"),e.inherits(i,n),i.prototype._transform=function(t,e,r){r(null,t)}},{"./_stream_transform":56,"core-util-is":32,inherits:35}],55:[function(Y,q,t){!function(g,t){"use strict";var b=Y("process-nextick-args");q.exports=p;var n=Y("isarray"),s;p.ReadableState=d;var e=Y("events").EventEmitter,m=function(t,e){return t.listeners(e).length},r=Y("./internal/streams/stream"),o=Y("safe-buffer").Buffer,i=t.Uint8Array||function(){};function l(t){return o.from(t)}function a(t){return o.isBuffer(t)||t instanceof i}var h=Object.create(Y("core-util-is"));h.inherits=Y("inherits");var t=Y("util"),y=void 0,y=t&&t.debuglog?t.debuglog("stream"):function(){},f=Y("./internal/streams/BufferList"),t=Y("./internal/streams/destroy"),u;h.inherits(p,r);var c=["error","close","destroy","pause","resume"];function w(t,e,r){if("function"==typeof t.prependListener)return t.prependListener(e,r);t._events&&t._events[e]?n(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]:t.on(e,r)}function d(t,e){var r=e instanceof(s=s||Y("./_stream_duplex"));this.objectMode=!!(t=t||{}).objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var n=t.highWaterMark,i=t.readableHighWaterMark,e=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(i||0===i)?i:e,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(u=u||Y("string_decoder/").StringDecoder,this.decoder=new u(t.encoding),this.encoding=t.encoding)}function p(t){if(s=s||Y("./_stream_duplex"),!(this instanceof p))return new p(t);this._readableState=new d(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),r.call(this)}function _(t,e,r,n,i){var s=t._readableState,a;return null===e?(s.reading=!1,L(t,s)):(a=!i?E(s,e):a)?t.emit("error",a):s.objectMode||e&&0<e.length?("string"==typeof e||s.objectMode||Object.getPrototypeOf(e)===o.prototype||(e=l(e)),n?s.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):v(t,s,e,!0):s.ended?t.emit("error",new Error("stream.push() after EOF")):(s.reading=!1,s.decoder&&!r?(e=s.decoder.write(e),s.objectMode||0!==e.length?v(t,s,e,!1):R(t,s)):v(t,s,e,!1))):n||(s.reading=!1),k(s)}function v(t,e,r,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",r),t.read(0)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&A(t)),R(t,e)}function E(t,e){var r;return r=!a(e)&&"string"!=typeof e&&void 0!==e&&!t.objectMode?new TypeError("Invalid non-string/buffer chunk"):r}function k(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}Object.defineProperty(p.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),p.prototype.destroy=t.destroy,p.prototype._undestroy=t.undestroy,p.prototype._destroy=function(t,e){this.push(null),e(t)},p.prototype.push=function(t,e){var r=this._readableState,n;return r.objectMode?n=!0:"string"==typeof t&&((e=e||r.defaultEncoding)!==r.encoding&&(t=o.from(t,e),e=""),n=!0),_(this,t,e,!1,n)},p.prototype.unshift=function(t){return _(this,t,null,!0,!1)},p.prototype.isPaused=function(){return!1===this._readableState.flowing},p.prototype.setEncoding=function(t){return u=u||Y("string_decoder/").StringDecoder,this._readableState.decoder=new u(t),this._readableState.encoding=t,this};var x=8388608;function T(t){return x<=t?t=x:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}function S(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?(e.flowing&&e.length?e.buffer.head.data:e).length:(t>e.highWaterMark&&(e.highWaterMark=T(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function L(t,e){var r;e.ended||(!e.decoder||(r=e.decoder.end())&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length),e.ended=!0,A(t))}function A(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(y("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?b.nextTick(O,t):O(t))}function O(t){y("emit readable"),t.emit("readable"),D(t)}function R(t,e){e.readingMore||(e.readingMore=!0,b.nextTick(I,t,e))}function I(t,e){for(var r=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(y("maybeReadMore read 0"),t.read(0),r!==e.length);)r=e.length;e.readingMore=!1}function C(e){return function(){var t=e._readableState;y("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&m(e,"data")&&(t.flowing=!0,D(e))}}function B(t){y("readable nexttick read 0"),t.read(0)}function M(t,e){e.resumeScheduled||(e.resumeScheduled=!0,b.nextTick(N,t,e))}function N(t,e){e.reading||(y("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),D(t),e.flowing&&!e.reading&&t.read(0)}function D(t){var e=t._readableState;for(y("flow",e.flowing);e.flowing&&null!==t.read(););}function z(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):r=P(t,e.buffer,e.decoder),r);var r}function P(t,e,r){var n;return t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():(r?U:j)(t,e),n}function U(t,e){var r=e.head,n=1,i=r.data;for(t-=i.length;r=r.next;){var s=r.data,a=t>s.length?s.length:t;if(a===s.length?i+=s:i+=s.slice(0,t),0===(t-=a)){a===s.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r).data=s.slice(a);break}++n}return e.length-=n,i}function j(t,e){var r=o.allocUnsafe(t),n=e.head,i=1;for(n.data.copy(r),t-=n.data.length;n=n.next;){var s=n.data,a=t>s.length?s.length:t;if(s.copy(r,r.length-t,0,a),0===(t-=a)){a===s.length?(++i,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n).data=s.slice(a);break}++i}return e.length-=i,r}function F(t){var e=t._readableState;if(0<e.length)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,b.nextTick(Z,e,t))}function Z(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function H(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}p.prototype.read=function(t){y("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return y("read: emitReadable",e.length,e.ended),(0===e.length&&e.ended?F:A)(this),null;if(0===(t=S(t,e))&&e.ended)return 0===e.length&&F(this),null;var n=e.needReadable,n;return y("need readable",n),(0===e.length||e.length-t<e.highWaterMark)&&y("length less than watermark",n=!0),e.ended||e.reading?y("reading or ended",n=!1):n&&(y("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=S(r,e))),null===(n=0<t?z(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&F(this)),null!==n&&this.emit("data",n),n},p.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},p.prototype.pipe=function(r,t){var n=this,i=this._readableState;switch(i.pipesCount){case 0:i.pipes=r;break;case 1:i.pipes=[i.pipes,r];break;default:i.pipes.push(r)}i.pipesCount+=1,y("pipe count=%d opts=%j",i.pipesCount,t);var e,t=(!t||!1!==t.end)&&r!==g.stdout&&r!==g.stderr?a:_;function s(t,e){y("onunpipe"),t===n&&e&&!1===e.hasUnpiped&&(e.hasUnpiped=!0,h())}function a(){y("onend"),r.end()}i.endEmitted?b.nextTick(t):n.once("end",t),r.on("unpipe",s);var o=C(n);r.on("drain",o);var l=!1;function h(){y("cleanup"),r.removeListener("close",d),r.removeListener("finish",p),r.removeListener("drain",o),r.removeListener("error",c),r.removeListener("unpipe",s),n.removeListener("end",a),n.removeListener("end",_),n.removeListener("data",u),l=!0,!i.awaitDrain||r._writableState&&!r._writableState.needDrain||o()}var f=!1;function u(t){var e;y("ondata"),(f=!1)!==r.write(t)||f||((1===i.pipesCount&&i.pipes===r||1<i.pipesCount&&-1!==H(i.pipes,r))&&!l&&(y("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,f=!0),n.pause())}function c(t){y("onerror",t),_(),r.removeListener("error",c),0===m(r,"error")&&r.emit("error",t)}function d(){r.removeListener("finish",p),_()}function p(){y("onfinish"),r.removeListener("close",d),_()}function _(){y("unpipe"),n.unpipe(r)}return n.on("data",u),w(r,"error",c),r.once("close",d),r.once("finish",p),r.emit("pipe",n),i.flowing||(y("pipe resume"),n.resume()),r},p.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes||(t=t||e.pipes,e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r)),this;if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var s=0;s<i;s++)n[s].emit("unpipe",this,r);return this}var a=H(e.pipes,t);return-1===a||(e.pipes.splice(a,1),--e.pipesCount,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r)),this},p.prototype.addListener=p.prototype.on=function(t,e){var e=r.prototype.on.call(this,t,e),t;return"data"===t?!1!==this._readableState.flowing&&this.resume():"readable"===t&&((t=this._readableState).endEmitted||t.readableListening||(t.readableListening=t.needReadable=!0,t.emittedReadable=!1,t.reading?t.length&&A(this):b.nextTick(B,this))),e},p.prototype.resume=function(){var t=this._readableState;return t.flowing||(y("resume"),t.flowing=!0,M(this,t)),this},p.prototype.pause=function(){return y("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(y("pause"),this._readableState.flowing=!1,this.emit("pause")),this},p.prototype.wrap=function(r){var n=this,i=this._readableState,s=!1,t;for(t in r.on("end",function(){var t;y("wrapped end"),!i.decoder||i.ended||(t=i.decoder.end())&&t.length&&n.push(t),n.push(null)}),r.on("data",function(t){var e;y("wrapped data"),i.decoder&&(t=i.decoder.write(t)),i.objectMode&&null==t||(i.objectMode||t&&t.length)&&(n.push(t)||(s=!0,r.pause()))}),r)void 0===this[t]&&"function"==typeof r[t]&&(this[t]=function(t){return function(){return r[t].apply(r,arguments)}}(t));for(var e=0;e<c.length;e++)r.on(c[e],this.emit.bind(this,c[e]));return this._read=function(t){y("wrapped _read",t),s&&(s=!1,r.resume())},this},Object.defineProperty(p.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),p._fromList=z}.call(this,Y("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_stream_duplex":53,"./internal/streams/BufferList":58,"./internal/streams/destroy":59,"./internal/streams/stream":60,_process:51,"core-util-is":32,events:33,inherits:35,isarray:37,"process-nextick-args":50,"safe-buffer":61,"string_decoder/":62,util:28}],56:[function(t,e,r){"use strict";e.exports=s;var n=t("./_stream_duplex"),e=Object.create(t("core-util-is"));function i(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,(r.writecb=null)!=e&&this.push(e),n(t);var t=this._readableState;t.reading=!1,(t.needReadable||t.length<t.highWaterMark)&&this._read(t.highWaterMark)}function s(t){if(!(this instanceof s))return new s(t);n.call(this,t),this._transformState={afterTransform:i.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",a)}function a(){var r=this;"function"==typeof this._flush?this._flush(function(t,e){o(r,t,e)}):o(this,null,null)}function o(t,e,r){if(e)return t.emit("error",e);if(null!=r&&t.push(r),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}e.inherits=t("inherits"),e.inherits(s,n),s.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},s.prototype._transform=function(t,e,r){throw new Error("_transform() is not implemented")},s.prototype._write=function(t,e,r){var n=this._transformState,e;n.writecb=r,n.writechunk=t,n.writeencoding=e,n.transforming||(e=this._readableState,(n.needTransform||e.needReadable||e.length<e.highWaterMark)&&this._read(e.highWaterMark))},s.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},s.prototype._destroy=function(t,e){var r=this;n.prototype._destroy.call(this,t,function(t){e(t),r.emit("close")})}},{"./_stream_duplex":53,"core-util-is":32,inherits:35}],57:[function(N,D,t){!function(t,e,r){"use strict";var a=N("process-nextick-args");function n(t,e,r){this.chunk=t,this.encoding=e,this.callback=r,this.next=null}function u(t){var e=this;this.next=null,this.entry=null,this.finish=function(){M(e,t)}}D.exports=b;var s=!t.browser&&-1<["v0.10","v0.9."].indexOf(t.version.slice(0,5))?r:a.nextTick,o;b.WritableState=g;var r=Object.create(N("core-util-is"));r.inherits=N("inherits");var i={deprecate:N("util-deprecate")},l=N("./internal/streams/stream"),h=N("safe-buffer").Buffer,f=e.Uint8Array||function(){};function c(t){return h.from(t)}function d(t){return h.isBuffer(t)||t instanceof f}var e=N("./internal/streams/destroy"),p;function _(){}function g(t,e){o=o||N("./_stream_duplex");var r=e instanceof o;this.objectMode=!!(t=t||{}).objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var n=t.highWaterMark,i=t.writableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:r&&(i||0===i)?i:s,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var s=(this.destroyed=!1)===t.decodeStrings;this.decodeStrings=!s,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){T(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new u(this)}function b(t){if(o=o||N("./_stream_duplex"),!(p.call(b,this)||this instanceof o))return new b(t);this._writableState=new g(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),l.call(this)}function m(t,e){var r=new Error("write after end");t.emit("error",r),a.nextTick(e,r)}function y(t,e,r,n){var i=!0,s=!1;return null===r?s=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||e.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(t.emit("error",s),a.nextTick(n,s),i=!1),i}function w(t,e,r){return e=!t.objectMode&&!1!==t.decodeStrings&&"string"==typeof e?h.from(e,r):e}function v(t,e,r,n,i,s){var a;r||n!==(a=w(e,n,i))&&(r=!0,i="buffer",n=a);var o=e.objectMode?1:n.length;e.length+=o;var l=e.length<e.highWaterMark,a;return l||(e.needDrain=!0),e.writing||e.corked?(a=e.lastBufferedRequest,e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:s,next:null},a?a.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1):E(t,e,!1,o,n,i,s),l}function E(t,e,r,n,i,s,a){e.writelen=n,e.writecb=a,e.writing=!0,e.sync=!0,r?t._writev(i,e.onwrite):t._write(i,s,e.onwrite),e.sync=!1}function k(t,e,r,n,i){--e.pendingcb,r?(a.nextTick(i,n),a.nextTick(C,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(i(n),t._writableState.errorEmitted=!0,t.emit("error",n),C(t,e))}function x(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}function T(t,e){var r=t._writableState,n=r.sync,i=r.writecb,e;x(r),e?k(t,r,n,e,i):((e=O(r))||r.corked||r.bufferProcessing||!r.bufferedRequest||A(t,r),n?s(S,t,r,e,i):S(t,r,e,i))}function S(t,e,r,n){r||L(t,e),e.pendingcb--,n(),C(t,e)}function L(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}function A(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),n=e.corkedRequestsFree;n.entry=r;for(var s=0,a=!0;r;)(i[s]=r).isBuf||(a=!1),r=r.next,s+=1;i.allBuffers=a,E(t,e,!0,e.length,i,"",n.finish),e.pendingcb++,e.lastBufferedRequest=null,n.next?(e.corkedRequestsFree=n.next,n.next=null):e.corkedRequestsFree=new u(e),e.bufferedRequestCount=0}else{for(;r;){var o=r.chunk,l=r.encoding,h=r.callback,f;if(E(t,e,!1,e.objectMode?1:o.length,o,l,h),r=r.next,e.bufferedRequestCount--,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}function O(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function R(e,r){e._final(function(t){r.pendingcb--,t&&e.emit("error",t),r.prefinished=!0,e.emit("prefinish"),C(e,r)})}function I(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,a.nextTick(R,t,e)):(e.prefinished=!0,t.emit("prefinish")))}function C(t,e){var r=O(e);return r&&(I(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),r}function B(t,e,r){e.ending=!0,C(t,e),r&&(e.finished?a.nextTick(r):t.once("finish",r)),e.ended=!0,t.writable=!1}function M(t,e,r){var n=t.entry;for(t.entry=null;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}r.inherits(b,l),g.prototype.getBuffer=function t(){for(var e=this.bufferedRequest,r=[];e;)r.push(e),e=e.next;return r},function(){try{Object.defineProperty(g.prototype,"buffer",{get:i.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(p=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(t){return!!p.call(this,t)||this===b&&(t&&t._writableState instanceof g)}})):p=function(t){return t instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(t,e,r){var n=this._writableState,i=!1,s=!n.objectMode&&d(t);return s&&!h.isBuffer(t)&&(t=c(t)),"function"==typeof e&&(r=e,e=null),e=s?"buffer":e||n.defaultEncoding,"function"!=typeof r&&(r=_),n.ended?m(this,r):(s||y(this,n,t,r))&&(n.pendingcb++,i=v(this,n,s,t,e,r)),i},b.prototype.cork=function(){var t;this._writableState.corked++},b.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||A(this,t))},b.prototype.setDefaultEncoding=function t(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},Object.defineProperty(b.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),b.prototype._write=function(t,e,r){r(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(t,e,r){var n=this._writableState;"function"==typeof t?(r=t,e=t=null):"function"==typeof e&&(r=e,e=null),null!=t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||B(this,n,r)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),b.prototype.destroy=e.destroy,b.prototype._undestroy=e.undestroy,b.prototype._destroy=function(t,e){this.end(),e(t)}}.call(this,N("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},N("timers").setImmediate)},{"./_stream_duplex":53,"./internal/streams/destroy":59,"./internal/streams/stream":60,_process:51,"core-util-is":32,inherits:35,"process-nextick-args":50,"safe-buffer":61,timers:68,"util-deprecate":69}],58:[function(t,e,r){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=t("safe-buffer").Buffer,i=t("util");function a(t,e,r){t.copy(e,r)}function o(){n(this,o),this.head=null,this.tail=null,this.length=0}e.exports=(o.prototype.push=function t(e){var e={data:e,next:null};0<this.length?this.tail.next=e:this.head=e,this.tail=e,++this.length},o.prototype.unshift=function t(e){var e={data:e,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},o.prototype.shift=function t(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},o.prototype.clear=function t(){this.head=this.tail=null,this.length=0},o.prototype.join=function t(e){if(0===this.length)return"";for(var r=this.head,n=""+r.data;r=r.next;)n+=e+r.data;return n},o.prototype.concat=function t(e){if(0===this.length)return s.alloc(0);if(1===this.length)return this.head.data;for(var r=s.allocUnsafe(e>>>0),n=this.head,i=0;n;)a(n.data,r,i),i+=n.data.length,n=n.next;return r},o),i&&i.inspect&&i.inspect.custom&&(e.exports.prototype[i.inspect.custom]=function(){var t=i.inspect({length:this.length});return this.constructor.name+" "+t})},{"safe-buffer":61,util:28}],59:[function(t,e,r){"use strict";var s=t("process-nextick-args");function n(t,e){var r=this,n=this._readableState&&this._readableState.destroyed,i=this._writableState&&this._writableState.destroyed;return n||i?e?e(t):!t||this._writableState&&this._writableState.errorEmitted||s.nextTick(a,this,t):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(s.nextTick(a,r,t),r._writableState&&(r._writableState.errorEmitted=!0)):e&&e(t)})),this}function i(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function a(t,e){t.emit("error",e)}e.exports={destroy:n,undestroy:i}},{"process-nextick-args":50}],60:[function(t,e,r){e.exports=t("events").EventEmitter},{events:33}],61:[function(t,e,r){var n=t("buffer"),i=n.Buffer;function s(t,e){for(var r in t)e[r]=t[r]}function a(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=n:(s(n,r),r.Buffer=a),s(i,a),a.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},a.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var t=i(t);return void 0!==e?"string"==typeof r?t.fill(e,r):t.fill(e):t.fill(0),t},a.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},a.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},{buffer:31}],62:[function(t,e,r){"use strict";var n=t("safe-buffer").Buffer,i=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}function a(t){var e=s(t);if("string"!=typeof e&&(n.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}function o(t){var e;switch(this.encoding=a(t),this.encoding){case"utf16le":this.text=p,this.end=_,e=4;break;case"utf8":this.fillLast=u,e=4;break;case"base64":this.text=g,this.end=b,e=3;break;default:return this.write=m,void(this.end=y)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function l(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function h(t,e,r){var n=e.length-1;if(n<r)return 0;var i=l(e[n]);return 0<=i?(0<i&&(t.lastNeed=i-1),i):--n<r||-2===i?0:0<=(i=l(e[n]))?(0<i&&(t.lastNeed=i-2),i):!(--n<r||-2===i)&&0<=(i=l(e[n]))?(0<i&&(2===i?i=0:t.lastNeed=i-3),i):0}function f(t,e,r){return 128!=(192&e[0])?(t.lastNeed=0,""):1<t.lastNeed&&1<e.length?128!=(192&e[1])?(t.lastNeed=1,""):2<t.lastNeed&&2<e.length&&128!=(192&e[2])?(t.lastNeed=2,""):void 0:void 0}function u(t){var e=this.lastTotal-this.lastNeed,r=f(this,t,e);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function c(t,e){var r=h(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var r=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)}function d(t){var t=t&&t.length?this.write(t):"";return this.lastNeed?t+"":t}function p(t,e){if((t.length-e)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1);var r=t.toString("utf16le",e);if(r){var e=r.charCodeAt(r.length-1);if(55296<=e&&e<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}function _(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var t=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,t)}return e}function g(t,e){var r=(t.length-e)%3;return 0==r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1==r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function b(t){var t=t&&t.length?this.write(t):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function m(t){return t.toString(this.encoding)}function y(t){return t&&t.length?this.write(t):""}(r.StringDecoder=o).prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},o.prototype.end=d,o.prototype.text=c,o.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},{"safe-buffer":61}],63:[function(t,e,r){e.exports=t("./readable").PassThrough},{"./readable":64}],64:[function(t,e,r){(((r=e.exports=t("./lib/_stream_readable.js")).Stream=r).Readable=r).Writable=t("./lib/_stream_writable.js"),r.Duplex=t("./lib/_stream_duplex.js"),r.Transform=t("./lib/_stream_transform.js"),r.PassThrough=t("./lib/_stream_passthrough.js")},{"./lib/_stream_duplex.js":53,"./lib/_stream_passthrough.js":54,"./lib/_stream_readable.js":55,"./lib/_stream_transform.js":56,"./lib/_stream_writable.js":57}],65:[function(t,e,r){e.exports=t("./readable").Transform},{"./readable":64}],66:[function(t,e,r){e.exports=t("./lib/_stream_writable.js")},{"./lib/_stream_writable.js":57}],67:[function(t,e,r){e.exports=i;var f=t("events").EventEmitter,n;function i(){f.call(this)}t("inherits")(i,f),i.Readable=t("readable-stream/readable.js"),i.Writable=t("readable-stream/writable.js"),i.Duplex=t("readable-stream/duplex.js"),i.Transform=t("readable-stream/transform.js"),i.PassThrough=t("readable-stream/passthrough.js"),(i.Stream=i).prototype.pipe=function(e,t){var r=this;function n(t){e.writable&&!1===e.write(t)&&r.pause&&r.pause()}function i(){r.readable&&r.resume&&r.resume()}r.on("data",n),e.on("drain",i),e._isStdio||t&&!1===t.end||(r.on("end",a),r.on("close",o));var s=!1;function a(){s||(s=!0,e.end())}function o(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function l(t){if(h(),0===f.listenerCount(this,"error"))throw t}function h(){r.removeListener("data",n),e.removeListener("drain",i),r.removeListener("end",a),r.removeListener("close",o),r.removeListener("error",l),e.removeListener("error",l),r.removeListener("end",h),r.removeListener("close",h),e.removeListener("close",h)}return r.on("error",l),e.on("error",l),r.on("end",h),r.on("close",h),e.on("close",h),e.emit("pipe",r),e}},{events:33,inherits:35,"readable-stream/duplex.js":52,"readable-stream/passthrough.js":63,"readable-stream/readable.js":64,"readable-stream/transform.js":65,"readable-stream/writable.js":66}],68:[function(l,t,h){!function(t,e){var i=l("process/browser.js").nextTick,r=Function.prototype.apply,s=Array.prototype.slice,a={},o=0;function n(t,e){this._id=t,this._clearFn=e}h.setTimeout=function(){return new n(r.call(setTimeout,window,arguments),clearTimeout)},h.setInterval=function(){return new n(r.call(setInterval,window,arguments),clearInterval)},h.clearTimeout=h.clearInterval=function(t){t.close()},n.prototype.unref=n.prototype.ref=function(){},n.prototype.close=function(){this._clearFn.call(window,this._id)},h.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},h.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},h._unrefActive=h.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function t(){e._onTimeout&&e._onTimeout()},t))},h.setImmediate="function"==typeof t?t:function(e){var r=o++,n=!(arguments.length<2)&&s.call(arguments,1);return a[r]=!0,i(function t(){a[r]&&(n?e.apply(null,n):e.call(null),h.clearImmediate(r))}),r},h.clearImmediate="function"==typeof e?e:function(t){delete a[t]}}.call(this,l("timers").setImmediate,l("timers").clearImmediate)},{"process/browser.js":51,timers:68}],69:[function(t,r,e){!function(e){function t(t,e){if(i("noDeprecation"))return t;var r=!1;function n(){if(!r){if(i("throwDeprecation"))throw new Error(e);i("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}return n}function i(t){try{if(!e.localStorage)return}catch(t){return}var t=e.localStorage[t];return null!=t&&"true"===String(t).toLowerCase()}r.exports=t}.call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],70:[function(t,e,r){arguments[4][24][0].apply(r,arguments)},{dup:24}],71:[function(t,e,r){arguments[4][25][0].apply(r,arguments)},{dup:25}],72:[function(t,e,r){arguments[4][26][0].apply(r,arguments)},{"./support/isBuffer":71,_process:51,dup:26,inherits:70}]},{},[20])(20);function l(n,i,s){function a(r,t){if(!i[r]){if(!n[r]){var e="function"==typeof require&&require;if(!t&&e)return e(r,!0);if(o)return o(r,!0);var e=new Error("Cannot find module '"+r+"'");throw e.code="MODULE_NOT_FOUND",e}var e=i[r]={exports:{}};n[r][0].call(e.exports,function(t){var e;return a(n[r][1][t]||t)},e,e.exports,l,n,i,s)}return i[r].exports}for(var o="function"==typeof require&&require,t=0;t<s.length;t++)a(s[t]);return a}});"use strict";gapp.register("geo.base",[],(e,t)=>{const M=e.base={},r=5;function n(){return Date.now()}function i(e,t,r,n){var i=Math.sign(t-e),t=Math.abs(t-e),o;let a=Math.floor(t/r),l=t/a;t%r&&(a++,l=t/a);let c=n?[e]:[];for(;0<a--;)e+=l*i,c.push(e);return c}async function o(t,r){let n=0;if(r)for(var e of t)e.then(e=>{r(n++,t.length,e)});await Promise.all(t)}function a(r){return new Promise((e,t)=>{setTimeout(e,r)})}function l(e,t){return void 0!==e?e:t}function c(e,t,r,n){let i,o;for(i=0;i<e.length;i++)for(o=e===t?i+1:0;o<t.length;o++)n(e[i],t[o],r);return r}function u(e,t,r){return 0<y(e,t,r)}function s(e,t,r){return y(e,t,r)<0}function f(e,t){return(t.x-e.x)*(t.y+e.y)}function y(e,t,r){return f(e,t)+f(t,r)+f(r,e)}function p(e,t,r){return Math.abs(e-t)<=(r||M.config.precision_merge)}function _(e,t,r){return(p(e,t)||t<=e)&&(p(e,r)||e<=r)}function x(e){return e*e}function h(e,t){return x(t.x-e.x)+x(t.y-e.y)}function g(e,t,r,n){return x(r-e)+x(n-t)}function d(e,t){return Math.abs(e)-t}function m(e,t,r){var e=parseFloat(e);return t<=e&&e<=r}function w(e,t){var t=void 0!==t?t:5;if(0===t)return 0|e;var t=Math.pow(10,t);return Math.round(e*t)/t}function v(e,t,r,n,i,o){var a=M.key,l=e.x,c=e.y,u=t.x,s=t.y,f=r.x,y=r.y,p,x,h=u-l,e=s-c,t=n.x-f,u=n.y-y,s=u*h-t*e;if(Math.abs(s)<1e-4)return i&&!o?null:a.PARALLEL;var y=c-y,u,f=t*y-u*(u=l-f),_,y,u=(h*y-e*u)/s,g,d,s=-1e-4<=(y=f/s)&&y<=1.0001&&(-1e-4<=u&&u<=1.0001),u=0<=y&&0<=u;if(i===a.SEGINT&&!s)return null;if(i===a.RAYINT&&!u)return null;let m=M.newPoint(l+y*h,c+y*e,r.z||n.z,s?a.SEGINT:u?a.RAYINT:a.PROJECT);return m.dist=y,m.p1=r,m.p2=n,m}function E(t,e,r,n,i){var o=M.key,a=t.x,l=t.y,c=e.dx,u=e.dy,s=r.x,f=r.y,y,p,x=n.x-s,h=n.y-f,e=h*c-x*u,f=l-f,s=a-s,x=x*f-h*s,h=c*f-u*s;if(Math.abs(e)<1e-12)return null;if(f=x/e,i||_(s=h/e,0,1)&&0<=f){let e=M.newPoint(a+f*c,l+f*u,n.z||t.z,o.NONE);return e.dist=f,e.p1=r,e.p2=n,e}return null}function P(e,t,r,n){var i=t.x-e.x,t=t.y-e.y,e=n.x-r.x,o;return(n.y-r.y)*i-e*t}function b(e,t,r,n,i){let o=new THREE.Vector3(t.x-e.x,t.y-e.y,t.z-e.z);var r=new THREE.Vector3(r.x-e.x,r.y-e.y,r.z-e.z);if(o.cross(r),0!==o.z)return(o.x*(n-e.x)+o.y*(i-e.y))/-o.z+e.z}function z(e,t,r){var n=2*A([[e.x,e.y,1],[t.x,t.y,1],[r.x,r.y,1]]),i=[[e.x*e.x+e.y*e.y,e.y,1],[t.x*t.x+t.y*t.y,t.y,1],[r.x*r.x+r.y*r.y,r.y,1]],r=[[e.x,e.x*e.x+e.y*e.y,1],[t.x,t.x*t.x+t.y*t.y,1],[r.x,r.x*r.x+r.y*r.y,1]],e={x:A(i)/n,y:A(r)/n,z:e.z};if(0!=n)return e}function A(e){var t,r,n;return e[0][0]*(e[1][1]*e[2][2]-e[1][2]*e[2][1])+-e[0][1]*(e[1][0]*e[2][2]-e[1][2]*e[2][0])+e[0][2]*(e[1][0]*e[2][1]-e[1][1]*e[2][0])}function R(e,t,r,n){let i=z(e,t,r);var n,e;return i&&n&&(n=i.x-e.x,e=i.y-e.y,i.r=Math.sqrt(n*n+e*e)),i}function T(e,t,r,n){let i=e.x,o=t.x,a=e.y,l=t.y,c=Math.sqrt(Math.pow(o-i,2)+Math.pow(l-a,2)),u=(a+l)/2,s=(i+o)/2,f=Math.sqrt(Math.pow(r,2)-Math.pow(c/2,2))*(a-l)/c,y=Math.sqrt(Math.pow(r,2)-Math.pow(c/2,2))*(o-i)/c,p=s+f,x=u+y,h=s-f,_=u-y,g=new THREE.Vector2(o-i,l-a),d=new THREE.Vector2(p-i,x-a),m=new THREE.Vector2(h-i,_-i);return n?0<g.cross(d)?{x:p,y:x}:{x:h,y:_}:g.cross(d)<0?{x:p,y:x}:{x:h,y:_}}function I(e,t,r){let n=t-e;for(;n<-Math.PI;)n+=2*Math.PI;for(;n>Math.PI;)n-=2*Math.PI;return r&&0<n&&(n-=2*Math.PI),!r&&n<0&&(n+=2*Math.PI),n}function q(i,o,a){if(!i.length)return i;let e=new Array(i.length),l=0,c=0;for(a||(a=i[c++],e[l++]=a);;){let t,r,n=1/0;for(let e=c;e<i.length;e++){var u=i[e],s;u&&((s=o(a,u))<n&&(n=s,r=e,t=u))}if(!t)break;i[r]=void 0,a=e[l++]=t}return e}function C(l,e,c,t){let u,s;if(2===c)u=l;else{let n=new Array(c).fill(1/0),i=new Array(c).fill(-1/0);for(let r=0,e=l.length;r<e;)for(let e=0,t;e<c;e++)t=l[r++],n[e]=Math.min(n[e],t),i[e]=Math.max(i[e],t);let t=new Array(c);for(let e=0;e<c;e++)t[e]=i[e]-n[e];let r=0,o,a;for(let e=0;e<c;e++)t[e]>r&&(r=t[e],o=e);s={d1:o,d2:a,dmax:r,delta:t.slice()};for(let e=t[o]=r=0;e<c;e++)t[e]>r&&(r=t[e],a=e);u=new Array(l.length/c*2);for(let e=0,t=0;e<l.length;e+=c)u[t++]=l[e+o],u[t++]=l[e+a]}var i=earcut(u,e,2);if(t)return i;let o=new Array(i.length*c);for(let e=0,t=0,r=i.length,n;e<r;e++){n=i[e]*c;for(let e=0;e<c;e++)o[t++]=l[n+e]}return 0===o.length&&console.log("debug_triangulate",{array:l,oa:o,info:s}),o}function N(e){return e.reduce((e,t)=>Array.isArray(t)?e.concat(N(t)):e.concat(t),[])}function L(e){if(!e)return e;let[t,r]=e.toString().split(".");return t=t.toString().split("").reverse().map((e,t,r)=>t<r.length-1&&t%3==2?","+e:e).reverse().join(""),r?t+"."+r:t}M.key={NONE:"",PROJECT:"project",SEGINT:"segint",RAYINT:"rayint",PARALLEL:"parallel"},M.config={debug_arrow:.25,gcode_decimals:4,bridgeLineGapDistance:.05,bridgeLineGapDistanceMax:25,precision_offset:.05,precision_poly_area:.05,precision_poly_bounds:.01,precision_poly_merge:.05,precision_merge:.005,precision_slice_z:1e-4,precision_merge_sq:25e-6,precision_bounds:1e-4,precision_slope:.02,precision_slope_merge:.25,precision_fill_merge:.001,precision_decimate:.05,decimate_threshold:5e5,precision_point_on_line:.01,precision_circularity:.001,hint_len_min:9,hint_len_max:400,hint_min_circ:.15,precision_mask_tolerance:.001,precision_close_to_poly_sq:1e-6,precision_midpoint_check_dist:1,precision_nested_sq:1e-4,clipper:1e5,clipperClean:250},M.util={sqr:x,lerp:i,time:n,comma:L,round:w,area2:y,pwait:o,ptimer:a,flatten:N,distSq:h,distSqv2:g,center2d:R,center2pr:T,determinant:P,orderClosest:q,doCombinations:c,offsetPrecision:d,numOrDefault:l,thetaDiff:I,intersect:v,inRange:m,isCloseTo:p,inCloseRange:_,isClockwise:u,isCounterClockwise:s,intersectRayLine:E,triangulate:C,zInPlane:b}});"use strict";gapp.register("geo.bounds",[],(i,t)=>{const{base:s}=i,{config:h,util:n}=s;class m{constructor(){this.minx=1e8,this.miny=1e8,this.maxx=-1e8,this.maxy=-1e8}set(i,t,s,h){return this.minx=i,this.miny=s,this.maxx=t,this.maxy=h,this}clone(){let i=new m;return i.minx=this.minx,i.miny=this.miny,i.maxx=this.maxx,i.maxy=this.maxy,i.maxy=this.maxy,i}equals(i,t){return t=t||h.precision_offset,n.isCloseTo(this.minx,i.minx,t)&&n.isCloseTo(this.miny,i.miny,t)&&n.isCloseTo(this.maxx,i.maxx,t)&&n.isCloseTo(this.maxy,i.maxy,t)}delta(i){return 0+Math.abs(this.minx-i.minx)+Math.abs(this.miny-i.miny)+Math.abs(this.maxx-i.maxx)+Math.abs(this.maxy-i.maxy)}merge(i){return this.minx=Math.min(this.minx,i.minx),this.maxx=Math.max(this.maxx,i.maxx),this.miny=Math.min(this.miny,i.miny),this.maxy=Math.max(this.maxy,i.maxy),this}update(i){return this.minx=Math.min(this.minx,i.x),this.maxx=Math.max(this.maxx,i.x),this.miny=Math.min(this.miny,i.y),this.maxy=Math.max(this.maxy,i.y),this}contains(i){return i.isNested(this)}containsXY(i,t){return i>=this.minx&&i<=this.maxx&&t>=this.miny&&t<=this.maxy}containsOffsetXY(i,t,s){return i>=this.minx-s&&i<=this.maxx+s&&t>=this.miny-s&&t<=this.maxy+s}isNested(i,t=h.precision_bounds){return this.minx>=i.minx-t&&this.maxx<=i.maxx+t&&this.miny>=i.miny-t&&this.maxy<=i.maxy+t}overlaps(i,t=h.precision_bounds){return 2*Math.abs(this.centerx()-i.centerx())-t<this.width()+i.width()&&2*Math.abs(this.centery()-i.centery())-t<this.height()+i.height()}width(){return this.maxx-this.minx}height(){return this.maxy-this.miny}center(i){return s.newPoint(this.centerx(),this.centery(),i)}centerx(){return this.minx+this.width()/2}centery(){return this.miny+this.height()/2}}gapp.overlay(s,{Bounds:m,newBounds(){return new m}})});"use strict";gapp.register("geo.csg",[],(e,t)=>{var{base:e}=e,r=!0;const n={union(){return n.moduleOp("manifold.union","union",...arguments)},subtract(){return n.moduleOp("manifold.subtract","difference",...arguments)},intersect(){return n.moduleOp("manifold.intersect","intersection",...arguments)},moduleOp(e,t){mesh.log(e+` ${arguments.length} meshes`);var e=[...arguments].slice(2).map(e=>new s.Manifold(e));if(e.length<2)throw"missing one or more meshes";const r=s[t](...e);var t=r.getMesh(),n;const o=[...e,r].map(e=>e.status().value);for(n of[...e,r])n.delete();if(o.reduce((e,t)=>e+t))throw""+o;return t},toPositionArray(e){var{vertPos:n,triVerts:o}=e;if(n&&o){const i=new Float32Array(3*o.length);for(let e=0,t=0,r=o.length;t<r;t++){var s=3*o[t];i[e++]=n[s++],i[e++]=n[s++],i[e++]=n[s++]}return i}throw"mesh missing required fields"},fromPositionArray(e){const{index:t,vertices:r}=o(e);var n;return new s.Mesh({vertPos:r.toFloat32(),triVerts:t.toUint32()})},toBox3(e){var{min:t,max:e}=e._boundingBox(),t=new THREE.Vector3(t.x,t.y,t.z),e=new THREE.Vector3(e.x,e.y,e.z);return new THREE.Box3(t,e)},indexVertices:o};function o(r){mesh.log(`indexing ${r.length/3} vertices`);let n=0;const o=[],s=[],i={},a={x:0,y:0,z:0};for(let e=0,t=r.length;e<t;){a.x=r[e++],a.y=r[e++],a.z=r[e++];var u=[1e5*a.x|0,1e5*a.y|0,1e5*a.z|0].join(""),l=i[u];0<=l?o.push(l):(o.push(n),i[u]=n++,s.push(a.x,a.y,a.z))}return{index:o,vertices:s}}let s;Module().then(e=>{e.setup(),s=e,n.Instance=()=>s}),gapp.overlay(e,{CSG:n})});"use strict";gapp.register("geo.gyroid",[],(t,l)=>{var{base:t}=t;const I=2*Math.PI;let q={},D,P=0,j=0;function e(t,l,e){var r=Date.now();(l!==P||e!==D||2e4<r-j)&&(q={}),D=e,P=l,j=r;let h=parseInt(l||200),a=I/h;var n=I*t,l=(n%I).round(3),t=q[l];if(t)return t;let s=e||0,o=[],u=[],i=0,p=0,f=0;for(let r=0;r<I;r+=a){let l=[],e=[];o.push(e),u.push(l);for(let t=0;t<I;t+=a)e.push(0),l.push(Math.sin(r)*Math.cos(t)+Math.sin(t)*Math.cos(n)+Math.sin(n)*Math.cos(r))}u.forEach((t,l)=>{let e=o[l],r=t[t.length-1];t.forEach((t,l)=>{(r<=s&&t>=s||r>=s&&t<=s||r<=-s&&t>=-s||r>=-s&&t<=-s)&&(e[l]=1,i++,p++),r=t})});for(let e=0;e<h;e++){let l=u[u.length-1][e];for(let t=0;t<h;t++){var g=u[t][e];(l<=s&&g>=s||l>=s&&g<=s||l<=-s&&g>=-s||l>=-s&&g<=-s)&&(o[t][e]?o[t][e]=3:(o[t][e]=2,i++),f++),l=g}}var v=f>p?"lr":"td";let c=[],d=h/2;o.forEach((t,a)=>{t.forEach((t,l)=>{var e,r;t&&(e=Math.abs(l-d),r=Math.abs(a-d),c.push({x:l/h,y:a/h,val:t,dist:Math.max(e,r)}))})}),c.sort((t,l)=>l.dist-t.dist);let y=[],M,x,b=0;var E=.05;do{M=null;for(let t=0;t<c.length;t++)if(c[t]){M=[c[t]],y.push(M),c[t]=null,b++;break}do{x=!1;var m=M[M.length-1];let l=null,e=null,r=1/0;for(let t=0;t<c.length;t++){var w=c[t],k;w&&(k=A(m,w,v),(null===e||k<r)&&(e=t,l=w,r=k))}if(l){if(r>E)break;c[e]=null,b++,M.push(l),x=!0}}while(x)}while(b<c.length);var e=y.map(t=>z(t,0)).map(t=>z(t,a)),e={edge:o,points:i,dir:v,polys:e};return q[l]=e}function z(l,e){if(l.length<=2)return l;let r=[l[0]],a=l[1],h=null;var n=l.length-2;for(let t=1;t<l.length;t++){var s=l[t],o;(e?A(a,s)<=e:a.x===s.x||a.y===s.y)&&(h=s,t<n)||(h?(r.push({x:(a.x+h.x)/2,y:(a.y+h.y)/2}),h=null):(r.push(a),t===n&&r.push(s)),a=s)}return r.push(l[l.length-1]),r}function A(t,l,e){let r=t.x-l.x,a=t.y-l.y;return"lr"===e&&(r/=2),"td"===e&&(a/=2),Math.sqrt(r*r+a*a)}gapp.overlay(t,{gyroid:{slice:e}})});"use strict";gapp.register("geo.line",[],(t,e)=>{const{base:i}=t;class s{constructor(t,e,i){i=i||[t.key,e.key].join(";"),this.p1=t,this.p2=e,this.key=i}length(){return Math.sqrt(this.length2())}length2(){return this.p1.distToSq2D(this.p2)}slope(){return i.newSlope(this.p1.slopeTo(this.p2))}reverse(){var t=this.p1;return this.p1=this.p2,this.p2=t,this}midpoint(){return this.p1.midPointTo(this.p2)}isCollinear(t){var e=this.p1,i=this.p2,s=t.p1,r=t.p2,t=i.x-e.x,i=i.y-e.y,e=r.x-s.x,s=r.y-s.y;return Math.abs(s*t-e*i)<1e-4}}function r(t,e,i){return new s(t,e,i)}function n(t,e,i){return t.key<e.key?r(t,e,i):r(e,t,i)}gapp.overlay(i,{Line:s,newLine:r,newOrderedLine:n})});"use strict";gapp.register("geo.point",[],(t,i)=>{const{base:x}=t,{util:n,config:e,key:l}=x;var{round:r}=n;class h{constructor(t,i,r,s){this.x=t,this.y=i,this.z=r||0,s&&(this._key=s)}get key(){return this._key||(this._key=[1e5*this.x|0,1e5*this.y|0,1e5*this.z|0].join(""))}toClipper(){return{X:this.x*e.clipper,Y:this.y*e.clipper}}set(t,i,r){return this.x=t,this.y=i,this.z=r,delete this._key,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setA(t){return this.a=t,this}swapXZ(){var t=this,i=t.x;return t.x=t.z,t.z=i,this}swapYZ(){var t=this,i=t.y;return t.y=t.z,t.z=i,this}round(t){return a(this.x.round(t),this.y.round(t),this.z.round(t))}addFacet(t){return this.group||(this.group=[]),this.group.push(t),this}rekey(){this._key=void 0}toString(){return this.key}clone(){let t=a(this.x,this.y,this.z,this._key);return void 0!==this.a&&(t.a=this.a),t}slopeTo(t){return x.newSlope(this,t)}lineTo(t,i){return x.newLine(this,t,i)}isNear(t,i){return n.isCloseTo(this.x,t.x,i)&&n.isCloseTo(this.y,t.y,i)}distToLine(t,i){return Math.sqrt(this.distToLineSq(t,i))}distToLineNew(t,i){return o(this,t,i)}distToLineSq(t,i){var r=this,s=n.distSq(t,i),s=((r.x-t.x)*(i.x-t.x)+(r.y-t.y)*(i.y-t.y))/s;return s<0?n.distSq(r,t):1<s?n.distSq(r,i):n.distSqv2(r.x,r.y,t.x+s*(i.x-t.x),t.y+s*(i.y-t.y))}withinDist2(t,i,r){let s=t.distToSq2D(i),n=this.distToSq2D(t),e=this.distToSq2D(i);return!(s<r&&(s+=r,n>s&&e>s))&&(!(n>s&&e>s)&&this.distToLineSq(t,i)<r)}midPointTo(t){return a((this.x+t.x)/2,(this.y+t.y)/2,this.z)}midPointTo3D(t){return a((this.x+t.x)/2,(this.y+t.y)/2,(this.z+t.z)/2)}projectOnSlope(t,i){return a(this.x+t.dx*i,this.y+t.dy*i,this.z)}followTo(t,i){return this.follow(this.slopeTo(t),i)}offsetPointFrom(t,i){var r=this,s=t.x-r.x,r=t.y-r.y,i=i/Math.sqrt(s*s+r*r),n,e;return a(t.x-s*i,t.y-r*i,t.z,l.NONE)}offsetPointTo(t,i){var r=this,s=t.x-r.x,n=t.y-r.y;if(0==s&&0==n)return this;var i=i/Math.sqrt(s*s+n*n),e,h;return a(r.x+s*i,r.y+n*i,t.z,l.NONE)}offsetLineTo(t,i){let r=this,s=t.x-r.x,n=t.y-r.y,e=i/Math.sqrt(s*s+n*n),h=s*e,o=n*e,y=a(r.x-o,r.y+h,r.z,l.NONE),u=a(t.x-o,t.y+h,t.z,l.NONE);return y.op=r,u.op=t,x.newLine(y,u,l.NONE)}offset(t,i,r){return a(this.x+t,this.y+i,this.z+r)}inPolygon(t){if(!t.bounds.containsXY(this.x,this.y))return!1;let i=t.points,r=i.length,s,n,e,h=!1;for(e=0;e<r;e++)s=i[e],n=i[(e+1)%r],s.y>=this.y!=n.y>=this.y&&this.x<=(n.x-s.x)*(this.y-s.y)/(n.y-s.y)+s.x&&(h=!h);return h}isInPolygon(t){let i=this,r;if(Array.isArray(t)){for(r=0;r<t.length;r++)if(i.isInPolygon(t[r]))return!0;return!1}var s=t.inner;if(i.inPolygon(t)||i.nearPolygon(t,e.precision_merge_sq)){for(r=0;s&&r<s.length;r++)if(i.inPolygon(s[r])&&!i.nearPolygon(s[r],e.precision_merge_sq))return!1;return!0}return!1}isInPolygonOnly(t){let i=this,r;if(Array.isArray(t)){for(r=0;r<t.length;r++)if(i.isInPolygonOnly(t[r]))return!0;return!1}var s=t.inner;if(i.inPolygon(t)){for(r=0;s&&r<s.length;r++)if(i.inPolygon(s[r]))return!1;return!0}return!1}nearPolygon(s,n,t){for(let t=0,i=s.points,r=i.length;t<r;t++)if(this.withinDist2(i[t],i[(t+1)%r],n))return!0;if(t&&s.inner)for(let t=0;t<s.inner.length;t++)if(this.nearPolygon(s.inner[t],n))return!0;return!1}insideOffset(t,i,r){return this.inPolygon(t)===0<i&&!this.nearPolygon(t,r)}follow(t,i){var i=i/Math.sqrt(t.dx*t.dx+t.dy*t.dy);return a(this.x+t.dx*i,this.y+t.dy*i,this.z)}intersectZ(t,i){var r=t.x-this.x,s=t.y-this.y,n=t.z-this.z,i=1-(t.z-i)/n;return a(this.x+r*i,this.y+s*i,this.z+n*i)}isEqual2D(t){return this===t||this.x===t.x&&this.y===t.y}isMergable2D(t){return this.isEqual2D(t)||this.distToSq2D(t)<e.precision_merge_sq}isEqual(t){return this===t||this.x===t.x&&this.y===t.y&&this.z===t.z}isEqual2D(t){return this===t||this.x===t.x&&this.y===t.y}isMergable3D(t){return this.isEqual(t)||this.distToSq3D(t)<e.precision_merge_sq}isInBox(t,i){return Math.abs(this.x-t.x)<i&&Math.abs(this.y-t.y)<i}distToPolySegments(t,r){let s=this,n=1/0;return t.forEachSegment(function(t,i){var i=Math.min(n,s.distToLine(t,i));if(n=Math.min(i,n),n<=r)return!0}),n}distToPolyPoints(t,i){let r=this,s=1/0;return t.forEachPoint(function(t){if(s=Math.min(s,r.distTo2D(t)),s<i)return!0}),s}nearestTo(t,i){if(!i)throw"missing max";let r=1/0,s=null,n,e,h;for(n=0;n<t.length;n++)(e=t[n])===this||e.del||(h=this.distToSq2D(e))<i&&h<r&&(r=h,s=e);return s}averageDistTo(t){let i=0,r=0,s;for(s=0;s<t.length;s++)t[s]!=this&&(i+=this.distToSq2D(t[s]),r++);return i/r}distTo2D(t){var i=this.x-t.x,t=this.y-t.y;return Math.sqrt(i*i+t*t)}distToSq2D(t){var i=this.x-t.x,t=this.y-t.y;return i*i+t*t}distTo3D(t){var i=this.x-t.x,r=this.y-t.y,t=this.z-t.z;return Math.sqrt(i*i+r*r+t*t)}distToSq3D(t){var i=this.x-t.x,r=this.y-t.y,t=this.z-t.z;return i*i+r*r+t*t}inTriangle(t,i,r){var s=this.x-t.x,n=this.y-t.y,e=0<(i.x-t.x)*n-(i.y-t.y)*s;return 0<(r.x-t.x)*n-(r.y-t.y)*s!=e&&0<(r.x-i.x)*(this.y-i.y)-(r.y-i.y)*(this.x-i.x)==e}onLine(t,i){return this.distToLine(t,i)<e.precision_point_on_line}add(t){return a(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return a(this.x-t.x,this.y-t.y,this.z-t.z)}move(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}}function y(t,i){return t.x*i.x+t.y*i.y}function s(t){return Math.sqrt(y(t,t))}function u(t,i){return s({x:t.x-i.x,y:t.y-i.y})}function o(t,i,r){var r={x:r.x-i.x,y:r.y-i.y},s,n,e,h;let o=y({x:t.x-i.x,y:t.y-i.y},r)/y(r,r);return isNaN(o)&&(o=0),u(t,{x:i.x+o*r.x,y:i.y+o*r.y})}function a(t,i,r,s){return new h(t,i,r,s)}function d(t,i){return a(t.X/e.clipper,t.Y/e.clipper,i)}gapp.overlay(x,{Point:h,newPoint:a,pointFromClipper:d})});"use strict";gapp.register("geo.paths",[],(t,s)=>{const{base:e}=t;var{util:t,config:p}=e,{sqr:n,numOrDefault:r}=t,h=Math.PI/180;function o(t,s,e){let p,n,r,h=0;for(;r=null,p=1/0,t.forEach(function(t){t.delete||(n=s.distTo2D(t.first),n<p&&(r={el:t,first:t.first,last:t.last},p=n),n=s.distTo2D(t.last),n<p&&(r={el:t,first:t.last,last:t.first},p=n))}),r;)r.el.delete=!0,s=r.last,e(r.el,r.first,++h);return s}function u(t,n,s,r={}){let e=r.mark||"delete",h,o,u,p=0;for(;;){u=null,h=1/0;for(let p of t)if(!p[e])if(p.isOpen()){var d=n.distTo2D(p.first()),a=n.distTo2D(p.last());d>h&&a>h||(a<h&&a<d&&!1!==r.swapdir?(p.reverse(),u={poly:p,index:0,point:p.first()},h=a):d<h&&(u={poly:p,index:0,point:p.first()},h=d))}else{let e=p.open?1:p.area();p.forEachPoint(function(t,s){o=r.weight?n.distTo3D(t)*e*e:n.distTo2D(t),o<h&&(u={poly:p,index:s,point:t},h=o)})}if(!u||r.term)break;u.poly[e]=!0,n=s(u.poly,u.index,++p,n)||u.point}return!0!==r.perm&&t.forEach(function(t){t[e]=!1}),n}function V(t,s){var e=s.x-t.x,p=s.y-t.y,n=Math.sqrt(e*e+p*p),r=1/n;return{dx:p*=r,dy:-(e*=r),p1:t,p2:s,len:n}}function F(t,s,e,p){let n,r;return r=p?(n=s.dx*e,s.dy*e):(n=t.dx*e,t.dy*e),{dx:n,dy:r,vp:t.p2}}function N(t,s,e,p){let n,r,h,o,u,d;return d=t.dx*s.dx+t.dy*s.dy+1,u=e/d,u===1/0&&(u=0),n=(t.dx+s.dx)*u,r=(t.dy+s.dy)*u,h=t.dx*s.dy-s.dx*t.dy,o=Math.sqrt(n*n+r*r),{dx:n,dy:r,vp:p||t.p2,io:h,vl:o}}function O(t){let s=t.vp.clone();return s.x+=t.dx,s.y+=t.dy,s.vp=t.vp,s}function G(t){let s=t.vp.clone();return s.x-=t.dx,s.y-=t.dy,s.vp=t.vp,s}function d(u,d,a,l=1.5){var y=Math.abs(d);const e=[];var p=u.length;if(2===p&&u[0].isEqual(u[1]))return{};var n=a&&2<p||!a&&3<p;for(let s=0;s<p;s++){let t=u[s];var r=u[(s+1)%p];t.normal=V(t,r),n&&0===t.normal.len&&s!==p-1&&(t.normal=V(t,u[(s+2)%p]),s++),e.push(t)}1===e.length&&console.log({points:u,nupoints:e});const x=[],i=[],c=[],f=[];var t=-1,s,h,o,v;let m,z;for(let h=0,o=(u=e).length;h<o;h++){var g=u[(h+o-1)%o].normal,M=u[(h+o)%o].normal,k=!a||0!==h&&h!==o-1?N(g,M,d):F(g,M,d,0===h);let{p1:e,p2:t}=M,{io:s,vl:p}=k;d<0&&(s=-s);let n=!1,r=!1;0<s?(n=y*l<p,r=p>Math.min(g.len,M.len)+y):(r=y*l<p,n=p>Math.min(g.len,M.len)+y);var E=x.peek(1),T=i.peek(1),w,k,E,T;if(n||r){var P=.1;let t=e.clone().move({x:.1*g.dy,y:.1*-g.dx,z:0}),s=e.clone().move({x:.1*-M.dy,y:.1*M.dx,z:0});var D=t.normal=V(t,s),b=s.normal=e.normal,H=N(g.p1.normal,D,d,t),M=N(D,b,d,s),g,D,b,H,w,M;r?i.push(G(H),G(M)):i.push(G(k)),n?x.push(O(H),O(M)):x.push(O(k)),c&&(g=x.peek(1),D=i.peek(1),b=x.peek(2),H=i.peek(2),w=g.vp.normal,M=D.vp.normal,n&&r?(c.push(g,b,D),c.push(H,D,b),m=m||b,z=z||H,f.push(w.dx,w.dy,-1),f.push(w.dx,w.dy,-1),f.push(-M.dx,-M.dy,-1),f.push(-M.dx,-M.dy,-1),f.push(-M.dx,-M.dy,-1),f.push(w.dx,w.dy,-1)):n?(c.push(g,b,D),m=m||b,z=z||D,f.push(w.dx,w.dy,-1),f.push(w.dx,w.dy,-1),f.push(-M.dx,-M.dy,-1)):(c.push(H,D,g),m=m||g,z=z||H,f.push(-M.dx,-M.dy,-1),f.push(-M.dx,-M.dy,-1),f.push(w.dx,w.dy,-1)))}else x.push(O(k)),i.push(G(k)),m=m||x.peek(1),z=z||i.peek(1);c&&E&&T&&(w=x.peek(n?2:1),k=i.peek(r?2:1),c.push(w,E,k),c.push(T,k,E),E=E.vp.normal,T=T.vp.normal,f.push(E.dx,E.dy,-1),f.push(E.dx,E.dy,-1),f.push(-T.dx,-T.dy,-1),f.push(-T.dx,-T.dy,-1),f.push(-T.dx,-T.dy,-1),f.push(E.dx,E.dy,-1))}if(a){var h=u[0].normal;const I=x[0],R=i[0];var v=.99*d;I.x+=h.dy*v,I.y-=h.dx*v,R.x+=h.dy*v,R.y-=h.dx*v;var o=u.peek(2).normal;const q=x.peek(),A=i.peek();q.x-=o.dy*v,q.y+=o.dx*v,A.x-=o.dy*v,A.y+=o.dx*v}return!a&&c&&(s=x.peek(1),h=i.peek(1),o=s.vp.normal,v=h.vp.normal,c.push(m,s,z),c.push(h,z,s),f.push(o.dx,o.dy,-1),f.push(o.dx,o.dy,-1),f.push(-v.dx,-v.dy,-1),f.push(-v.dx,-v.dy,-1),f.push(-v.dx,-v.dy,-1),f.push(o.dx,o.dy,-1)),{left:x,right:i,faces:c,normals:f,open:a}}function a(t,p,s){const{faces:e,normals:n,left:r,right:h,open:o}=t,u=[],d=[];if(!(e&&r&&h))return[];if(void 0!==s)for(var a of e)a.z=s;for(var l of e)u.push(l.x,l.y,l.z-p);for(var y of e.slice().reverse())u.push(y.x,y.y,y.z+p);d.appendAll(n);for(let t=n.length-1;0<t;t-=3)d.push(n[t-2]),d.push(n[t-1]),d.push(-n[+t]);for(let t=0,s=r.length,e=o?s-1:s;t<e;t++){var x=r[t],i=r[(t+1)%s];u.push(x.x,x.y,x.z+p),u.push(x.x,x.y,x.z-p),u.push(i.x,i.y,i.z-p),u.push(i.x,i.y,i.z-p),u.push(i.x,i.y,i.z+p),u.push(x.x,x.y,x.z+p);var x=x.vp.normal;d.push(x.dx,x.dy,-1),d.push(x.dx,x.dy,1),d.push(x.dx,x.dy,1),d.push(x.dx,x.dy,1),d.push(x.dx,x.dy,-1),d.push(x.dx,x.dy,-1)}for(let t=0,s=h.length,e=o?s-1:s;t<e;t++){var c=h[t],f=h[(t+1)%s];u.push(c.x,c.y,c.z+p),u.push(f.x,f.y,f.z-p),u.push(c.x,c.y,c.z-p),u.push(f.x,f.y,f.z-p),u.push(c.x,c.y,c.z+p),u.push(f.x,f.y,f.z+p);var c=c.vp.normal;d.push(-c.dy,c.dx,1),d.push(-c.dy,c.dx,-1),d.push(-c.dy,c.dx,-1),d.push(-c.dy,c.dx,-1),d.push(-c.dy,c.dx,1),d.push(-c.dy,c.dx,1)}var v,m,t,m,v;return o&&(v=r[0],m=h[0],u.push(v.x,v.y,v.z+p),u.push(m.x,m.y,m.z-p),u.push(v.x,v.y,v.z-p),u.push(m.x,m.y,m.z+p),u.push(m.x,m.y,m.z-p),u.push(v.x,v.y,v.z+p),t=v.vp.normal,d.push(-t.dy,t.dx,1),d.push(-t.dy,t.dx,-1),d.push(-t.dy,t.dx,-1),d.push(-t.dy,t.dx,1),d.push(-t.dy,t.dx,-1),d.push(-t.dy,t.dx,1),m=r.peek(),v=h.peek(),u.push(m.x,m.y,m.z+p),u.push(m.x,m.y,m.z-p),u.push(v.x,v.y,v.z-p),u.push(v.x,v.y,v.z+p),u.push(m.x,m.y,m.z+p),u.push(v.x,v.y,v.z-p),t=v.vp.normal,d.push(-t.dy,t.dx,1),d.push(-t.dy,t.dx,-1),d.push(-t.dy,t.dx,-1),d.push(-t.dy,t.dx,1),d.push(-t.dy,t.dx,1),d.push(-t.dy,t.dx,-1)),{faces:u,normals:d}}function l(t,p,n){n=void 0===n||n;const s=new THREE.ShapeGeometry(t);s.rotateX(.5*Math.PI);const r=s.attributes.position,h=new Float32Array(r.count*p.length*3);for(let e=0;e<p.length;e++){const k=(new THREE.Vector2).subVectors(p[e-1<0?p.length-1:e-1],p[e]),E=(new THREE.Vector2).subVectors(p[e+1==p.length?0:e+1],p[e]);var o,u;let t=.5*(E.angle()-k.angle()),s=E.angle()+.5*Math.PI;n||(0!=e&&e!=p.length-1||(t=.5*Math.PI),e==p.length-1&&(s=k.angle()-.5*Math.PI));var d=Math.tan(t-.5*Math.PI),a=(new THREE.Matrix4).set(1,0,0,0,-d,1,0,0,0,0,1,0,0,0,0,1),l=s,d=(new THREE.Matrix4).set(Math.cos(l),-Math.sin(l),0,0,Math.sin(l),Math.cos(l),0,0,0,0,1,0,0,0,0,1),l=(new THREE.Matrix4).set(1,0,0,p[e].x,0,1,0,p[e].y,0,0,1,0,0,0,0,1);const T=r.clone();T.applyMatrix4(a),T.applyMatrix4(d),T.applyMatrix4(l),h.set(T.array,T.count*e*3)}const e=[];var y=0==n?p.length-1:p.length,x,i,c,t,f,i,x,c,t;for(let s=0;s<y;s++)for(let t=0;t<r.count;t++){var v=s,m=s+1==p.length?0:s+1,z=t,g=t+1==r.count?0:t+1,M=g+r.count*v,v=z+r.count*v,z=z+r.count*m,m=g+r.count*m;e.push(M,v,m),e.push(v,z,m)}return n||(x=0+0*r.count,i=1+0*r.count,c=2+0*r.count,t=3+0*r.count,e.push(x,i,c),e.push(x,c,t),i=0+r.count*y,x=1+r.count*y,c=2+r.count*y,t=3+r.count*y,e.push(c,x,i),e.push(t,c,i)),{index:e,faces:h}}class y{constructor(t,s){this.size=t,this.factor=Math.min(s||1.2,1.1),this.array=new Float32Array(t),this.pos=0}push(){const s=this.array;var e=this.size,p=arguments.length;if(this.pos+p>=e){var e=(e*this.factor|0)+p;let t=new Float32Array(e);t.set(s),this.array=t,this.size=e}for(let t=0;t<p;t++)s[this.pos++]=arguments[t]}finalize(){return.9<=this.pos/this.size?this.array.subarray(0,this.pos):this.array.slice(0,this.pos)}}e.paths={poly2polyEmit:u,tip2tipEmit:o,shapeToPath:l,pointsToPath:d,pathTo3D:a,vertexNormal:N,segmentNormal:V}});"use strict";gapp.register("geo.points",[],(e,o)=>{const{base:m}=e,{config:y}=m;function t(p,e){let n=new Array(p.length/3),r=0,i=0,o=Date.now(),s={},l=0,t=0,a,h=n.length,f,{threshold:g,precision:c,maxpass:d}=e||{};if(g=0<g?g:y.decimate_threshold,c=0<=c?c:y.precision_decimate,d=0<=d?d:0,d)for(;r<p.length;){let e=m.newPoint(p[r++],p[r++],p[r++]),o=e.key,t=s[o];t||(t=e,s[o]=e,l++),n[i++]=t}else for(;r<p.length;)n[i++]=m.newPoint(p[r++],p[r++],p[r++]);if(d&&0<c)for(;n.length>g;){let p=[],e,o=0;for(r=0;r<h;){let e=n[r++],o=n[r++],t=n[r++];p.push({p1:e,p2:o,d:Math.sqrt(e.distToSq3D(o))}),p.push({p1:e,p2:t,d:Math.sqrt(e.distToSq3D(t))}),p.push({p1:o,p2:t,d:Math.sqrt(o.distToSq3D(t))})}for(p.sort(function(e,o){return e.d-o.d}),r=0;r<p.length&&(e=p[r],!(e.d>=c));r++)e.p1.op||e.p2.op||(e.p1.op=e.p2.op=e.p1.midPointTo3D(e.p2),o++);if(0===o)break;for(t++,a=new Array(h),f=0,r=0;r<h;){var u=n[r++],q=n[r++],w=n[r++];u.op&&u.op===q.op||u.op&&u.op===w.op||q.op&&q.op===w.op||(a[f++]=u.op||u,a[f++]=q.op||q,a[f++]=w.op||w)}if(n=a.slice(0,f),h=f,t>=d)break}return t&&console.log({before:p.length/3,after:n.length,unique:l,decimations:t,time:Date.now()-o}),n}function p(e){let o=new Float32Array(3*e.length),t=0,p=0;for(;t<e.length;)o[p++]=e[t].x,o[p++]=e[t].y,o[p++]=e[t++].z;return o}gapp.overlay(m,{verticesToPoints:t,pointsToVertices:p})});"use strict";gapp.register("geo.polygons",[],(e,n)=>{const{base:D}=e,{util:y,paths:w,config:S,newPoint:I}=D,{sqr:r,numOrDefault:P}=y,k=Math.PI/180,L=Math.sqrt,Z=y.sqr,F=Math.abs,q=self.ClipperLib,t=q.Clipper,J=q.ClipType,R=q.PolyType,W=q.PolyFillType;var l=D.polygons={rayIntersect:Y,alignWindings:b,setWinding:T,fillArea:z,subtract:E,flatten:m,offset:N,trimTo:x,expand:M,expand_lines:O,points:h,length:d,route:G,union:C,inset:j,outer:o,inner:i,nest:s,diff:v,setZ:p,filter:u,toClipper:X,fromClipperNode:f,fromClipperTree:A,fromClipperTreeUnion:a,cleanClipperTree:c,fingerprintCompare:U,fingerprint:B};function o(e){for(var n of e)n.inner=void 0;return e}function i(e){const n=[];for(var r of e)r.inner&&n.push(r.inner);return n}function d(e){let n=0;for(var r of e)n+=r.deepLength;return n}function p(e,n){for(var r of e)r.setZ(n);return e}function X(e=[]){var n=[],r;for(r of e)r.toClipper(n);return n}function f(e,n){let r=D.newPolygon();for(var t of e.m_polygon)r.push(D.pointFromClipper(t,n));return r.open=e.IsOpen,r}function A(e,n,r,t,l){let o,i=r||[],p=P(l,.1);for(var a of e.m_Childs)o=f(a,n),!o.open&&o.area()<p||(t?t.addInner(o):i.push(o),a.m_Childs&&A(a,n,i,t?null:o,l));return i}function a(e,n,r,t,l){let o=t||[],i;for(var p of e.m_Childs)i=f(p,n),!i.open&&r&&i.area()<r||(l?l.addInner(i):o.push(i),p.m_Childs&&a(p,n,r,o,l?null:i));return o}function c(e){if(e.m_Childs)for(var n of e.m_Childs)n.m_polygon=t.CleanPolygon(n.m_polygon,S.clipperClean),c(n.m_Childs);return e}function u(e,n,r){for(var t of e)t=r(t),t&&(Array.isArray(t)?n.appendAll(t):n.push(t));return n}function h(e){return e.length?e.map(e=>e.deepLength).reduce((e,n)=>e+n):0}function s(r,e,t){if(!r)return r;r.sort(function(e,n){return e.area()-n.area()});let l,o;for(l=0;l<r.length;l++)o=r[l],o.parent=null,o.inner=null;for(l=0;l<r.length-1;l++){o=r[l];for(let n=l+1;n<r.length;n++){let e=r[n];if((!t||!e.isOpen())&&o.isNested(e)){e.addInner(o);break}}}let n=[],i;for(l=0;l<r.length;l++){for(i=r[l],o=i,o.depth=0;i.parent;)o.depth++,i=i.parent;e?0===o.depth&&n.push(o):o.depth%2==0?n.push(o):o.inner=null}return n}function T(r,t,l){if(r){let e,n=0;for(;n<r.length;)e=r[n++],e.isClockwise()!==t&&e.reverse(),l&&e.inner&&T(e.inner,!t,!1);return r}}function b(e){let n=e.length,r=0,t=0,l=0,o,i;for(;l<n;)i=e[l++],t+=i.length,i.isClockwise()&&(r+=i.length);for(l=0,o=r>t/2;l<n;)i=e[l++],i.isClockwise()!=o&&i.reverse();return o}function g(n,r){for(let e=0;e<n.length;e++)if(n[e].contains(r))return 1}function m(e,n,r){return n=n||[],e.forEach(function(e){e.flattenTo(n),r&&(e.inner=null)}),n}function E(l,o,i,p,a,e,n={}){let f=e||.1,r=[];function u(e,n=[]){return e.forEach(function(e){e.area()>=f&&(n.push(e),r.push(e))}),n}var t,s;n.prof&&(0!==l.length&&0!==o.length||console.log("sub_zero",{setA:l,setB:o}),n.prof.pin=(n.prof.pin||0)+h(l)+h(o),n.prof.call=(n.prof.call||0)+1);{let e=new q.Clipper,n=new q.PolyTree,r=X(l),t=X(o);e.StrictlySimple=!0,i&&(e.AddPaths(r,R.ptSubject,!0),e.AddPaths(t,R.ptClip,!0),e.Execute(J.ctDifference,n,W.pftEvenOdd,W.pftEvenOdd)&&(c(n),u(A(n,a,null,null,f),i))),p&&(i&&(n.Clear(),e.Clear()),e.AddPaths(t,R.ptSubject,!0),e.AddPaths(r,R.ptClip,!0),e.Execute(J.ctDifference,n,W.pftEvenOdd,W.pftEvenOdd)&&(c(n),u(A(n,a,null,null,f),p)))}return n.prof&&(n.prof.pout=(n.prof.pout||0)+h(r)),r}function C(r,t,l,e={}){if(r.length<2)return r;var o=d(r);if(e.wasm&&geo.wasm){let n=t||.01;try{var i=geo.wasm.js.union(r,r[0].getZ()).filter(e=>e.area()>n);return e.changes=d(i)-o,i}catch(e){console.log({union_fail:r,minarea:t,all:l})}}let n=r.slice(),p,a,f,u=[],s,c;e:for(p=0;p<n.length;p++)if(n[p])for(a=p+1;a<n.length;a++)if(n[a]&&(f=n[p].union(n[a],t,l))&&f.length){e.onmerge&&(s=n[p],c=n[a]),n[p]=null,n[a]=null,l?n.appendAll(f):n.push(f),e.onmerge&&e.onmerge(s,c,f);continue e}for(p=0;p<n.length;p++)n[p]&&u.push(n[p]);return e.changes=d(u)-o,u}function v(e,n,r){let t=new q.Clipper,l=new q.PolyTree,o=X(e),i=X(n);return t.AddPaths(o,R.ptSubject,!0),t.AddPaths(i,R.ptClip,!0),t.Execute(J.ctDifference,l,W.pftEvenOdd,W.pftEvenOdd)?A(l,r):null}function x(e,n){if(e===n||null===e||null===n)return null;let r=[],t;return y.doCombinations(e,n,{},function(e,n){(t=e.mask(n))&&r.appendAll(t)}),r}function _(e){let n=0;return e.forEach(function(e){n+=e.circularityDeep()}),n}function O(e,n,r){let t=S.clipper,l=q.JoinType,o=q.EndType,i=new q.ClipperOffset,p=new q.PolyTree;return i.AddPaths(e.toClipper(),l.jtMiter,o.etOpenSquare),i.Execute(p,n*t),A(p,r,null,null,0)}function M(e,n,r,t,l,o,i,p){return N(e,[n,o||n],{z:r,outs:t,call:i,minArea:p,count:l,flat:!0})}function N(r,n,t={}){let e=t.open?r.filter(e=>e.open):[];e.length&&(e=e.map(e=>w.pointsToPath(e.points,n,!0)),e=e.map(e=>D.newPolygon().setOpen().addPoints(e.right))),b(r=r.filter(e=>!e.open));for(var l of r)l.inner&&T(l.inner,!l.isClockwise());var o=r,i=P(t.count,1),p=P(t.depth,0),a=!1!==t.clean,f=!1!==t.simple,u=P(t.fill,q.PolyFillType.pftNonZero),s=P(t.join,q.JoinType.jtMiter),c=P(t.type,q.EndType.etClosedPolygon),d=Array.isArray(n)?1<n.length?n.shift():n[0]:n,h=P(t.minArea,.1),g=t.z||0,m,y,C;if(t.wasm&&geo.wasm)try{r=geo.wasm.js.offset(r,d,g,a?S.clipperClean:0,f?1:0),e.length&&r.appendAll(e)}catch(e){return console.log("wasm error",e.message||e),t.wasm=!1,N(r,n,t)}else{let e=new q.ClipperOffset(t.miter,t.arc),n=new q.PolyTree;for(var v of r)v=v.toClipper(),a&&(v=q.Clipper.CleanPolygons(v,S.clipperClean)),f&&(v=q.Clipper.SimplifyPolygons(v,u)),e.AddPaths(v,s,c);e.Execute(n,d*S.clipper),r=A(n,g,null,null,h)}t.gaps&&r.length&&(y=[],C=E(o,N(r,-d,{fill:t.fill,join:t.join,type:t.type,z:t.z,minArea:h}),y,null,g),t.gaps.append(y,t.flat)),t.gaps&&!r.length&&t.gaps.append(o,t.flat),r.length&&(t.outs=t.outs||[],t.outs.append(r,t.flat),t.call&&t.call(r,i,p),1<i&&(t.count=i-1,t.depth=p+1,N(r,n,t)));let x=t.flat?t.outs:r;return e.length&&x.appendAll(e),x}function j(e,n,r,t,l){var o=r;let i=[],p=e,a=0;for(;0<r--&&p&&p.length;){var f=N(p,-n,{z:t,wasm:l}),u=N(f,n/2,{z:t,wasm:l});let e=N(f,n,{z:t,wasm:l});var s=[],c=p.map(e=>e.areaDeep()).reduce((e,n)=>e+n),d=e.length?e.map(e=>e.areaDeep()).reduce((e,n)=>e+n):0,h;Math.abs(c-d)>1-Math.abs(c/d)/1e3&&E(p,e,s,null,t),i.push({idx:o-r,off:f,mid:u,gap:s});for(h of u)if(h.depth=a++,h.inner)for(var g of h.inner)g.depth=h.depth;p=f}return i}function z(x,w,P,A,T,b){if(0!==x.length){let e=1,n=x[0],r=n.getZ(),t=n.bounds.clone(),l=!1,o;for(1e3<=w&&(l=!0,w-=1e3),w%=180;w<-90;)w+=180;for(;90<w;)w-=180;for(o=D.newSlope(0,0,Math.cos(w*k)*P,Math.sin(w*k)*P);e<x.length;)t.merge(x[e++].bounds);var E,_,E,_,E,_,E,_,O;l&&(E=(E=t.minx/P)-(0|E)+(E<0?1:0),_=(_=t.miny/P)-(0|_)+(_<0?1:0),t.minx-=E*P,t.miny-=_*P,E=(E=t.maxx/P)-(0|E)+(E<0?1:0),_=(_=t.maxy/P)-(0|_)+(_<0?1:0),t.maxx=t.maxx-E*P+P,t.maxy=t.maxy-_*P+P);let i=A||[],p=-o.dy,a=o.dx,f=F(0<F(p)?t.width()/p:0),u=F(0<F(a)?t.height()/a:0),s=L(Z(f*p)+Z(u*a)),c=L(Z(p)+Z(a)),d=s/c,h=w<0?{x:t.minx,y:t.miny,z:r}:{x:t.maxx,y:t.miny,z:r},g=new q.Clipper,m=new q.PolyTree,y=D.config.clipper*(T||0),C=D.config.clipper*(b||0),v=[];for(i.origin=I(h.x,h.y,h.z),e=0;e<d;e++)v.push([{X:(h.x-1e3*o.dx)*S.clipper,Y:(h.y-1e3*o.dy)*S.clipper},{X:(h.x+1e3*o.dx)*S.clipper,Y:(h.y+1e3*o.dy)*S.clipper}]),h.x+=p,h.y+=a;if(g.AddPaths(v,R.ptSubject,!1),g.AddPaths(X(x),R.ptClip,!0),v=[],g.Execute(J.ctIntersection,m,W.pftNonZero,W.pftEvenOdd))for(var M of m.m_AllPolys){if(y||C){var N=q.JS.PerimeterOfPath(M.m_polygon,!1,1);if(y&&N<y)continue;if(C&&C<N)continue}var j=D.pointFromClipper(M.m_polygon[0],r),N=D.pointFromClipper(M.m_polygon[1],r),M=i.origin.distToLineNew(j,N)/P;v.push([j,N,M])}v.sort(function(e,n){return e[2]-n[2]});for(O of v){var z=Math.round(O[2]);O[0].index=z,O[1].index=z,i.push(O[0]),i.push(O[1])}return i}}function Y(l,o,e,n){let r=0,t=[],i=[],p=D.config,a=n?p.precision_fill_merge:p.precision_merge;for(e.forEach(function(e){e.flattenTo(t)}),e=t;r<e.length;){var f=e[r++],u=f.points,s=u.length;for(let r=0;r<s;r++){let e=(r+1)%s,n=y.intersectRayLine(l,o,u[r],u[e]);n&&(n.group=f,i.push(n),n.isNear(u[r],a)?(n.pos=r,n.mod=s):n.isNear(u[e],a)&&(n.pos=e,n.mod=s))}}if(0<i.length){let t=!1;if(i.sort(function(n,r){if(!n.del&&!r.del&&n.isNear(r,a)){let e=[];n.isNear(n.p1,a)||e.push(n.p1),n.isNear(n.p2,a)||e.push(n.p2),r.isNear(r.p1,a)||e.push(r.p1),r.isNear(r.p2,a)||e.push(r.p2),e.length<2?console.log("sliceInt: line common ep fail: "+e.length):2<e.length?(n.del=!0,r.del=!0):y.intersectRayLine(l,o,e[0],e[1])?(t=!0,n.del=!0):(t=!0,n.del=!0,r.del=!0)}return n.dist-r.dist}),n){let e,n;for(r=0,pl=i.length;r<pl;){for(e=i[r++];e&&e.del&&r<pl;)e=i[r++];for(n=i[r++];n&&n.del&&r<pl;)n=i[r++];var c,d,h,g,d;e&&n&&e.group&&e.group&&(c=e.group,d=n.group,h=c.depth%2==0,c.depth===d.depth&&c===d&&e.mod&&n.mod&&(1!==(d=F(e.pos-n.pos))&&d!==e.mod-1||(e.del=!0,n.del=!0,t=!0)))}}if(t){let e=[];for(r=0;r<i.length;r++){var m=i[r];m.del||e.push(m)}i=e}}return i}function B(e){let n=[];return m(e).sort((e,n)=>e.area()>n.area()).forEach(e=>{n.push({c:e.circularityDeep(),p:e.perimeterDeep(),b:e.bounds})}),n}function U(r,t){if(r===t)return!0;if(!r||!t)return!1;if(r.length!==t.length)return!1;for(let n=0;n<r.length;n++){let e=r[n];var l=t[n];if(.001<Math.abs(e.c-l.c))return!1;if(.01<Math.abs(e.p-l.p))return!1;if(.01<e.b.delta(l.b))return!1}return!0}function G(e,n){let r=[],t,l=1/0;for(var o of e){let e=o.average();var i={poly:o,center:e,used:!1},o=e.distTo2D(n);o<l&&(t=i,l=o),r.push(i)}t.used=!0;let p=[t];for(;;){let e,n=1/0;for(var a of r){var f;a.used||(f=a.center.distTo2D(t.center))<n&&(n=f,e=a)}if(!e)break;e.used=!0,p.push(t=e)}return p.map(e=>e.poly)}});"use strict";gapp.register("geo.polygon",[],(t,e)=>{const{base:$}=t,{config:a,util:V,polygons:i,newBounds:n,newPoint:W}=$,p=i,r=new THREE.Vector3(1,0,0),o=Math.PI/180,u=self.ClipperLib,l=u.Clipper,f=u.ClipType,c=u.PolyType,d=u.PolyFillType;let s=Math.round(4294967295*Math.random());class h{constructor(t){this.id=s++,this.open=!1,this.points=[],this.depth=0,t&&this.addPoints(t)}get length(){return this.points.length}get deepLength(){let t=this.length;if(this.inner)for(var e of this.inner)t+=e.length;return t}get bounds(){if(this._bounds)return this._bounds;let t=this._bounds=n();for(var e of this.points)t.update(e);return t}toPath2D(t){return $.paths.pointsToPath(this.points,t,this.open)}toPath3D(t,e,i){return $.paths.pathTo3D(this.toPath2D(t),e,i)}toString(e){let t;return t=this.inner&&this.inner.length?"/"+this.inner.map(t=>t.toString(e)).join(","):"",e?`P[{${this.area().toFixed(2)}}[${this.points.length}](${this.points.map(t=>t.x+","+t.y).join("|")})${t}]`:`P[${this.points.length,this.area().toFixed(2)}${t}]`}toArray(){let i=this.open?1:0;return this.points.map((t,e)=>0===e?[i,t.x,t.y,t.z]:[t.x,t.y,t.z]).flat()}fromArray(e){this.open=1===e[0];for(let t=1;t<e.length;)this.add(e[t++],e[t++],e[t++]);return this}matches(t){var e=Array.isArray(t)?t:t.toArray(),i=this.toArray();if(e.length!==i.length)return!1;for(let t=0;t<e.length;t++)if(1e-4<Math.abs(e[t]-i[t]))return!1;return!0}xray(t){const e={id:this.id,len:this.points.length,open:this.open,depth:this.depth,parent:!!this.parent};return this.inner&&(e.inner=t?this.inner.xray(t):this.inner),e}alignment(){if(this._aligned)return this._aligned;let e={x:!1,y:!1,z:!1},i=void 0;return this.points.forEach(t=>{i&&(e.x=e.x||i.x!==t.x,e.y=e.y||i.y!==t.y,e.z=e.z||i.z!==t.z),i=t}),this._aligned=!1===e.x?"yz":!1===e.y?"xz":"xy"}ensureXY(){if(this._swapped)return this;switch(this.alignment()){case"xy":break;case"yz":this.swap(!0,!1)._swapped=!0;break;case"xz":this.swap(!1,!0)._swapped=!0;break;default:throw"invalid alignment"}return this}restoreXY(){if(!this._swapped)return this;switch(this.alignment()){case"xy":break;case"yz":this.swap(!0,!1)._swapped=!1;break;case"xz":this.swap(!1,!0)._swapped=!1}return this}earcut(){let n=[],e=[];this.points.forEach(t=>{n.push(t.x,t.y,t.z)}),this.inner&&this.inner.forEach(t=>{e.push(n.length/3),t.points.forEach(t=>{n.push(t.x,t.y,t.z)})});var r=self.earcut(n,e,3);let t=[];for(let i=0;i<r.length;i+=3){let e=new h;e._aligned=this._aligned,e._swapped=this._swapped;for(let t=0;t<3;t++){var s=3*r[i+t];e.add(n[s],n[1+s],n[2+s])}t.push(e)}return t}centers(t,r,s,o,e={}){let h=[],i=this.bounds,l=e.lines||!1,n=t/2,p=[this.points];if(this.inner)for(var a of this.inner)p.push(a.points);for(var u of V.lerp(i.miny+n,i.maxy-n,t,!0)){let e=[];for(var f of p){var c=f.length;for(let t=0;t<c;t++){var d=f[t%c],y=f[(t+1)%c];(d.y<=u&&y.y>u||d.y>u&&y.y<=u)&&e.push([d,y])}}let i=[];if(e.length&&e.length%2==0)for(var g of e){let[t,e]=g;var x;e.y<t.y&&(x=t,t=e,e=x);var v=Math.min(t.x,e.x),m=Math.max(t.x,e.x),z=Math.min(t.y,e.y),g=Math.max(t.y,e.y),x=e.x-t.x,_,z=(u-z)/(g-z),x=t.x+z*x;i.push(x)}i.sort((t,e)=>e-t);let t,n=0;for(var C of i){var w=W(C,u,r),C;n++%2?s<=(C=t.distTo2D(w))&&C<=o&&(l?(h.push(t),h.push(w)):h.push(W((t.x+w.x)/2,u,r))):t=w}}for(var P of V.lerp(i.minx+n,i.maxx-n,t,!0)){let e=[];for(var E of p){var T=E.length;for(let t=0;t<T;t++){var b=E[t%T],k=E[(t+1)%T];(b.x<=P&&k.x>P||b.x>P&&k.x<=P)&&e.push([b,k])}}let i=[];if(e.length&&e.length%2==0)for(var A of e){let[t,e]=A;var S;e.x<t.x&&(S=t,t=e,e=S);var M=Math.min(t.x,e.x),A=Math.max(t.x,e.x),D=Math.min(t.y,e.y),Z=Math.max(t.y,e.y),q,S=e.y-t.y,M=(P-M)/(A-M),S=t.y+M*S;i.push(S)}i.sort((t,e)=>e-t);let t,n=0;for(var O of i){var I=W(P,O,r),O;n++%2?s<=(O=t.distTo2D(I))&&O<=o&&(l?(h.push(t),h.push(I)):h.push(W(P,(t.y+I.y)/2,r))):t=I}}if(l)return h;let j=e.mindist||1.5*t;function N(t){var e=t.last(),i;let n,r=1/0;for(i of h){var s=i.distTo2D(e);s<j&&s<r&&(r=s,n=i)}return n&&(h=h.filter(t=>t!==n),t.push(n),1)}let F=[],R=[];for(;h.length;)if(0!==R.length){if(!N(R))if(R.flip){if(!R.length)throw"whoop there it is";R=[]}else R.reverse(),R.flip=!0}else R=[h.shift()],F.push(R);return F.filter(t=>1<t.length).map(t=>{let e=$.newPolygon().setOpen();for(var i of t)e.push(i);return e.last().distTo2D(e.first())<=o&&e.setClosed(),e=e.clean(),e})}debur(t){if(this.len<2)return null;const e=this.points,i=e.length,n=this.open,r=v().copyZ(this.z),s=t||$.config.precision_merge;let o;r.push(o=e[0]);for(let t=1;t<i;t++)o.distTo2D(e[t])>=s&&r.push(o=e[t]);return r.open=n,r.parent=this.parent,r.length<2?null:r}miter(t){if(this.length<3)return this;const e=[],i=this.points,n=i.length,r=this.open;let s;for(let t=1;t<n;t++)e.push(i[t-1].slopeTo(s=i[t]));r||e.push(s.slopeTo(i[0]));const o=new Array(n).fill(0);let h=!1;var l=r?n-1:n;for(let t=1;t<l;t++)o[t]=g(e[t-1],e[t]),h|=90<o[t];if(r||(o[0]=g(e[n-1],e[0]),h|=90<o[n-1],h|=90<o[0]),h){const c=v().copyZ(this.z);c.open=r;for(let t=0;t<n;t++){const d=i[(t+n)%n];var p=o[(t+n)%n],a,p,u;if(179<p){const y=e[(t+n)%n];var a=i[(t+n-1)%n],f=e[(t+n-1)%n];c.push(d.follow(d.slopeTo(a).normal(),.001)),c.push(d.follow(y.clone().normal().invert(),.001))}else{90<p?(a=e[(t+n)%n],p=i[(t+n-1)%n],u=e[(t+n-1)%n],c.push(d.follow(d.slopeTo(p),.001)),c.push(d.follow(a,.001))):(d.parent=c,c.push(d))}}return c}return this}createConvexHull(e){function i(t,e,i){var n=(t.x-e.x)*(i.y-e.y)-(t.y-e.y)*(i.x-e.x),e=(t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y);return n<0||0==n&&e<=0}e.sort(function(t,e){return t.x!=e.x?t.x-e.x:t.y-e.y});var n=e.length;let r=[];for(let t=0;t<2*n;t++){for(var s=t<n?t:2*n-1-t;2<=r.length&&i(r[r.length-2],r[r.length-1],e[s]);)r.pop();r.push(e[s])}return r.pop(),this.addPoints(r),this}stepsFromRoot(){let t=this.parent,e=0;for(;t;)t.inner&&1<t.inner.length&&e++,t=t.parent;return e}first(){return this.points[0]}last(){return this.points[this.length-1]}swap(t,e){if(this._bounds=void 0,t)for(var i of this.points)i.swapXZ();else if(e)for(var n of this.points)n.swapYZ();if(this.inner)for(var r of this.inner)r.swap(t,e);return this}average(){let e=W(0,0,0,null);return this.points.forEach(t=>{e.x+=t.x,e.y+=t.y,e.z+=t.z}),e.x/=this.points.length,e.y/=this.points.length,e.z/=this.points.length,e}center(t){let e=W(0,0,0,null),i=v(),n=this.points;return n.forEach(function(t){e.x+=t.x,e.y+=t.y,e.z+=t.z}),e.x/=n.length,e.y/=n.length,e.z/=n.length,t?e:(n.forEach(function(t){i.push(W(t.x-e.x,t.y-e.y,t.z-e.z))}),i)}circleCenter(){let t=this.perimeter(),e=t/3,i=2*e,n=this.points,r=n.length,s=1,o=0,h=n[0],l=[h];for(;s<r;){var p=n[s++],a=h.distTo2D(p);if(o+=a,1===l.length&&o>=e)l.push(p);else if(2===l.length&&o>=i){l.push(p);break}h=p}var u=V.center2d(...l);return W(u.x,u.y,n[0].z,null)}centerRectangle(t,e,i){return e/=2,i/=2,this.push(W(t.x-e,t.y-i,t.z)),this.push(W(t.x+e,t.y-i,t.z)),this.push(W(t.x+e,t.y+i,t.z)),this.push(W(t.x-e,t.y+i,t.z)),this}centerSpiral(t,e,i,n,r){r*=4,n/=2;let s={x:t.x-e/2,y:t.y+i/2,z:t.z},o={x:1,y:0,i:0},h;for(;0<r--;){switch(this.push(W(s.x,s.y,s.z)),s.x+=o.x*e,s.y+=o.y*i,o.i++){case 0:h=o.x,o.x=o.y,o.y=-h;break;case 1:h=o.x,o.x=o.y,o.y=h;break;case 2:h=o.x,o.x=o.y,o.y=-h;break;case 3:h=o.x,o.x=o.y,o.y=h}e-=n/2,i-=n/2,o.i=o.i%4}return this}centerCircle(t,e,i,n){let r=0,s=360/i;for(n&&(s=-s);0<i--;)this.push(W(V.round(Math.cos(r*o)*e,7)+t.x,V.round(Math.sin(r*o)*e,7)+t.y,t.z)),r+=s;return this}move(e){if(this._bounds=void 0,this.points=this.points.map(t=>t.move(e)),this.inner)for(var t of this.inner)t.move(e);return this}scale(t,e){let i,n,r;if("number"==typeof t?i=n=r=t:(i=t.x,n=t.y,r=t.z),this._bounds=void 0,this.points.forEach(t=>{e?(t.x=(t.x*i).round(e),t.y=(t.y*n).round(e),t.z=(t.z*r).round(e)):(t.x=t.x*i,t.y=t.y*n,t.z=t.z*r)}),this.inner)for(var s of this.inner)s.scale(t,e);return this}hintFillAngle(){let t=0,e=this.points,i=e.length,n,r,s,o,h=a.hint_min_circ,l=a.hint_len_min,p=a.hint_len_max||1/0;for(;t<i;)n=e[t],r=e[++t%i],l<=(s=n.distToSq2D(r))&&s<=p&&(!o||s>o.len)&&(o={p1:n,p2:r,len:s});return o&&this.circularity()>=h&&(this.fillang=o.p1.slopeTo(o.p2).normal()),this.fillang}clone(t){let e=v().copyZ(this.z),i=this.length,n=0;for(;n<i;)e.push(this.points[n++]);return this.fillang&&(e.fillang=this.fillang),e.depth=this.depth,e.open=this.open,t&&this.inner&&(e.inner=this.inner.clone()),e}cloneZ(e,t){let i=v();return i.z=e,i.open=this.open,i.points=this.points,this.inner&&(i.inner=this.inner.map(t=>t.cloneZ(e,!0))),i}copyZ(t){return void 0!==t&&(this.z=t),this}setA(t){for(var e of this.points)e.setA(t);if(this.inner)for(var i of this.inner)i.setA(t);return this}setZ(e){let t=this.points,i=t.length,n=0;for(;n<i;)t[n++].z=e;return this.inner&&this.inner.forEach(function(t){t.setZ(e)}),this}getZ(t){return(void 0!==this.z?this:this.points[t||0]).z}render(t,e,i,n){t.poly(this,e,i,n)}renderSolid(t,e){t.solid(this,e)}add(t,e,i){return this.push(W(t,e,i)),this}addObj(t){if(Array.isArray(t)){for(var e of t)this.addObj(e);return this}return this.add(t.x,t.y,t.z)}addPoints(t){let e=this,i=t.length,n=0;for(;n<i;)e.push(t[n++]);return this}push(t){return((t=t.poly?t.clone():t).poly=this).points.push(t),t}append(t){return this.push(t),this}setClosed(){return this.open=!1,this}setOpen(){return this.open=!0,this}setOpenValue(t){return this.open=t,this}isOpen(){return this.open}isClosed(){return!this.open}appearsClosed(){return this.first().isEqual(this.last())}setClockwise(){return this.isClockwise()||this.reverse(),this}setCounterClockwise(){return this.isClockwise()&&this.reverse(),this}isClockwise(){return 0<this.area(!0)}showKey(){return[this.first().key,this.last().key,this.length].join("~~")}applyRotations(){for(var t of this.points){var e;t.a&&(e=new THREE.Vector3(t.x,t.y,t.z).applyAxisAngle(r,t.a*o),t.x=e.x,t.y=e.y,t.z=e.z)}return this}alignWinding(t,e){e&&this.length>t.length?t.alignWinding(this,!1):this.isClockwise()!==t.isClockwise()&&this.reverse()}opposeWinding(t,e){e&&this.length>t.length?t.opposeWinding(this,!1):this.isClockwise()===t.isClockwise()&&this.reverse()}sameWindings(t){return this.isClockwise()===t.isClockwise()}reverse(){return this.area2&&(this.area2=-this.area2),this.points=this.points.reverse(),this}isNested(t){return!!t.bounds.contains(this.bounds)&&this.isInside(t,a.precision_nested_sq)}forEachPointEaseDown(t,e){let i=this.findClosestPointTo(e).index,n=e.z,r=0,s=this.points,o=s.length,h=-1,l=s[0].z,p,a,u,f;for(;;){var c;if(u=s[i%o],a&&u.z<n?(2*(c=n-u.z)<(p=a.distTo2D(u))?t(a.followTo(u,c).setZ(u.z),r++):c<=p||(u=u.clone().setZ(n-p/2)),n=u.z):0===r&&u.z<n&&(u=u.clone().setZ(n)),a=u,t(u,r++),i%o===h)break;h<0&&u.z<=l&&(h=i%o),i++}return a}forEachPoint(t,e,i){let n=i||0,r=this.points,s=r.length,o=e?s+1:s,h=0,l;for(;0<o--;){if(t(r[l=n%s],l,r,h++))return;n++}}forEachSegment(t,e,i){let n=i||0,r=this.points,s=r.length,o=e?s-1:s,h,l;for(;0<o--;){if(h=n%s,l=(n+1)%s,t(r[h],r[l],h,l))return;n++}}intersections(s,o,t){let h=[];return this.forEachSegment(function(t,e,i,n){var r=V.intersect(s,o,t,e,$.key.SEGINT,!1);r&&(h.push(r),t.pos=i,e.pos=n)}),h.sort(function(t,e){return V.distSq(s,t)-V.distSq(s,e)}),t&&this.inner&&this.inner.forEach(t=>{var t=t.intersections(s,o);t&&h.appendAll(t)}),h}bisect(t,e){if(this.isOpen())return null;let i=this.clone().setClockwise();var e=i.intersections(t,e);return e&&2===e.length?[i.emitSegment(e[0],e[1]),i.emitSegment(e[1],e[0]).reverse()]:null}emitSegment(t,i){let n=v(),e=t.p2.pos,r=i.p1.pos;return n.setOpen(),n.push(t),this.forEachPoint(function(t,e){if(n.push(t),t===i.p1)return!0},!0,e),n.push(i),n}hasPointsInside(i,n){if(!i.overlaps(this))return!1;let r,s=!1;return this.forEachSegment((t,e)=>t.distTo2D(e)>a.precision_midpoint_check_dist&&(r=t.midPointTo(e),r.inPolygon(i)||r.nearPolygon(i,n||a.precision_close_to_poly_sq))||(e.inPolygon(i)||e.nearPolygon(i,n||a.precision_close_to_poly_sq))?s=!0:void 0),s}isNear(i,t,e){const n=a.precision_midpoint_check_dist,r=t||a.precision_close_to_poly_sq;let s=!1,o=e?this.cacheNear=this.cacheNear||{}:void 0;return o&&void 0!==o[i.id]?o[i.id]:(this.forEachSegment((t,e)=>t.distToSq2D(e)>n&&t.midPointTo(e).nearPolygon(i,r)||e.nearPolygon(i,r)?s=!0:void 0),o&&(o[i.id]=s),s)}isInside(i,t){const n=t||a.precision_close_to_poly_sq;if(!this.bounds.isNested(i.bounds,3*n))return!1;let r,s=a.precision_midpoint_check_dist,o=!0;return this.forEachSegment((t,e)=>(!(t.distTo2D(e)>s)||(r=t.midPointTo(e),r.inPolygon(i)||r.nearPolygon(i,n)))&&(e.inPolygon(i)||e.nearPolygon(i,n))?void 0:!(o=!1),this.open),o}containedBySet(e){if(!e)return!1;for(let t=0;t<e.length;t++)if(e[t].contains(this))return!0;return!1}addInner(t){return(t.parent=this).inner?this.inner.push(t):this.inner=[t],this}innerCount(){return this.inner?this.inner.length:0}hasInner(){return this.inner&&0<this.inner.length}clearInner(){return this.inner=null,this}freeParentRefs(){if(this.inner&&0<this.inner.length)for(var t of this.inner)t.freeParentRefs(),delete t.parent;for(var e of this.points)delete e.poly}newUndeleted(){let e=v();return this.forEachPoint(t=>{t.del||e.push(t)}),e}circularity(){return 4*Math.PI*this.area()/V.sqr(this.perimeter())}circularityDeep(){return 4*Math.PI*this.areaDeep()/V.sqr(this.perimeter())}perimeter(){if(this.perim)return this.perim;let i=0;return this.forEachSegment((t,e)=>{i+=Math.sqrt(t.distToSq2D(e))},this.open),this.perim=i}perimeterDeep(){let e=this.perimeter();return this.inner&&this.inner.forEach(t=>{e+=t.perimeter()}),e}area(t){if(this.length<3)return 0;if(void 0===this.area2){this.area2=0;for(let t=this.points,e=t.length,i=0,n,r;i<e;i++)n=t[i],r=t[(i+1)%e],this.area2+=(r.x-n.x)*(r.y+n.y)}return t?this.area2:Math.abs(this.area2/2)}areaDeep(){if(!this.inner)return this.area();let t,e=this.inner,i=this.area();for(t=0;t<e.length;t++)i-=e[t].area();return i}overlaps(t){return this.bounds.overlaps(t.bounds,a.precision_merge)}fromXYArray(t,e){let i=0;for(;i<t.length;)this.add(t[i++],t[i++],e||0);return this}simple(){return this.clean(!0,void 0,Math.min(a.clipper/10,5*a.clipperClean))}clean(t,e,i=a.clipperClean){let n=l.CleanPolygon(this.toClipper()[0],i),r=y(n,this.getZ());if(0===r.length)return this;if(t&&this.inner&&(r.inner=this.inner.map(t=>t.clean(!1,r,i))),r.parent=e||this.parent,r.area2=this.area2,r.open=this.open,this.open){var s=this.points[0];let i=r.points;var o=i.length;let n,e=1/0;for(let t=0;t<o;t++){var h=i[t].distTo2D(s);h<e&&(e=h,n=t)}if(n){let e=[];for(let t=n;t<o;t++)e.push(i[t]);for(let t=0;t<n;t++)e.push(i[t]);r.points=e}}return r}toClipper(t){let e=this,i=[],n=t||[];if(n.push(e.points.map(t=>t.toClipper())),e.inner)for(var r of e.inner)r.toClipper(n);return n}offset(t,e){return p.expand([this],-t,this.getZ(),e)}isEquivalent(o,e,i){var t=Math.abs(this.area()),h=Math.abs(o.area());if(V.isCloseTo(t,h,i||a.precision_poly_area)&&this.bounds.equals(o.bounds,i||a.precision_poly_bounds)){var h=this.circularity(),i=o.circularity();if(Math.abs(h-i)<a.precision_circularity&&1-h<a.precision_circularity)return!0;if(e){let t,e=this.inner,i=o.inner;if(e!==i){if(null===e||null===i||e.length!=i.length)return!1;for(t=0;t<e.length;t++)if(!e[t].isEquivalent(i[t]))return!1}}let t=!0,n,r,s;return this.forEachPoint(i=>{if(n=!1,o.forEachSegment((t,e)=>(r=i.distToLine(t,e))<a.precision_poly_merge?n=!0:void(s=Math.min(s,r))),!n)return!(t=!1)}),t}return!1}findClosestPointTo(i){let n,r,s,o=1/0;return this.forEachPoint((t,e)=>{n=Math.sqrt(t.distToSq2D(i)),n<o&&(r=e,o=n,s=t)}),{point:s,distance:o,index:r}}flattenTo(t){return t.push(this),this.inner&&t.appendAll(this.inner),t}shortestSegmentLength(){let i=1/0;return this.forEachSegment((t,e)=>{i=Math.min(i,t.distTo2D(e))}),i}diff(t){let e=(this.fillang&&this.area()>t.area()?this:t).fillang,i=new u.Clipper,n=new u.PolyTree,r=this.toClipper(),s=t.toClipper();return i.AddPaths(r,c.ptSubject,!0),i.AddPaths(s,c.ptClip,!0),i.Execute(f.ctDifference,n,d.pftEvenOdd,d.pftEvenOdd)?((t=p.fromClipperTree(n,t.getZ())).forEach(t=>{t.fillang=e}),t):null}mask(t,e,i){let n=(this.fillang&&this.area()>t.area()?this:t).fillang,r=new u.Clipper,s=new u.PolyTree,o=this.toClipper(),h=t.toClipper();return r.AddPaths(o,c.ptSubject,!0),r.AddPaths(h,c.ptClip,!0),r.Execute(f.ctIntersection,s,d.pftEvenOdd,d.pftEvenOdd)?((t=p.fromClipperTree(s,this.getZ(),void 0,void 0,i)).forEach(t=>{t.fillang=n}),e&&1===t.length&&t[0].isEquivalent(this)?null:t):null}cut(t,e){let i=this;i.open||(i=this.clone(!0).setOpen(),i.push(i.first()),i.inner&&i.inner.forEach(t=>{t.setOpen(),t.push(t.first())}));let n=new u.Clipper,r=new u.PolyTree,s=e?f.ctIntersection:f.ctDifference,o=i.toClipper(),h=p.toClipper(t);if(n.AddPaths(o,c.ptSubject,!1),n.AddPaths(h,c.ptClip,!0),n.Execute(s,r,d.pftEvenOdd,d.pftEvenOdd)){let t=p.fromClipperTree(r,i.getZ(),null,null,0);return t.forEach(t=>{t.open&&t.first().distTo2D(t.last())<.001&&(t.open=!1,t.points.pop()),t.depth=this.depth}),t}return null}intersect(t,e){if(!this.overlaps(t))return null;let i=new u.Clipper,n=new u.PolyTree,r=this.toClipper(),s=t.toClipper(),o=0<=e?e:.1;return this.isInside(t)?[this]:(i.AddPaths(r,c.ptSubject,!0),i.AddPaths(s,c.ptClip,!0),i.Execute(f.ctIntersection,n,d.pftNonZero,d.pftNonZero)?p.fromClipperTreeUnion(n,t.getZ(),o).filter(t=>t.isInside(this)):null);var h}areaDiff(t){var e=this.area(),t=t.area();return t<e?t/e:e/t}simplify(t={}){let n=this.getZ();if(t.pump){var e=p.offset([this],t.pump,{z:n});return e?e=p.offset(e,-t.pump,{z:n}):null}let i=this.toClipper(),r=u.Clipper.SimplifyPolygons(i,d.pftNonZero);return r&&r.length?r.map(t=>{let e=v();for(var i of t)e.push($.pointFromClipper(i,n));return e}):null}unionMatch(t){return t.filter(t=>t.isEquivalent(this)).length}union(e,t,i){if(!this.overlaps(e))return null;let n=(this.fillang&&this.area()>e.area()?this:e).fillang,r=new u.Clipper,s=new u.PolyTree,o=this.toClipper(),h=e.toClipper(),l=0<=t?t:.1;if(r.AddPaths(o,c.ptSubject,!0),r.AddPaths(h,c.ptClip,!0),r.Execute(f.ctUnion,s,d.pftEvenOdd,d.pftEvenOdd)){let t=p.fromClipperTreeUnion(s,e.getZ(),l);if(i)return 2===t.length?null:t;if(1===t.length)return t=t[0],t.fillang=n,t;console.trace({check_union_call_path:t,this:this,poly:e})}return null}annotate(t={}){return Object.assign(this,t),this}extrude(e=1){var t;let i=[];var n=this.clone().setClockwise().points,r=n.length;for(let t=0;t<r;t++){var s=n[t],o=n[(t+1)%r];i.push(s.x,s.y,s.z),i.push(o.x,o.y,s.z),i.push(o.x,o.y,o.z+e),i.push(s.x,s.y,s.z),i.push(o.x,o.y,o.z+e),i.push(s.x,s.y,s.z+e)}return i}segment(r=1){const s=[];var o=this.points,h=o.length,l=this.open?h-1:h;for(let t=0,e=o,i=h,n=i+1;t<l;t++){var p=e[t],a=e[(t+1)%i],u=a.x-p.x,f=a.y-p.y,c=Math.sqrt(u*u+f*f);if(s.push(p),!(c<r)){var d,c=0|c/r,y=c-1,g=u/c,x=f/c;let e=p.x+g,i=p.y+x;for(let t=0;t<y;t++)s.push(W(e,i,(p.z+a.z)/2)),e+=g,i+=x}}return s.length>h?v().addPoints(s.map(t=>t.clone())).setOpenValue(this.open):this}midpoints(i=.01){const n=[];var r=this.points,s=r.length,o=this.open?s-1:s;let h=0;for(let t=0,e=r;t<o;t++){const f=e[t];var l=e[(t+1)%s],p=l.x-f.x,a=l.y-f.y,u;Math.sqrt(p*p+a*a)<i?(n.push(f.midPointTo(l)),h++):n.push(f)}return h?v().addPoints(n.map(t=>t.clone())).setOpenValue(this.open):this}}function g(t,e){var t=t.angle,i;let n=e.angle-t;for(;n<-180;)n+=360;for(;180<n;)n-=360;return Math.abs(n)}function y(t,e){let i=v(),n=0,r=t.length;for(;n<r;)i.push($.pointFromClipper(t[n++],e));return i}function v(t){return new h(t)}h.fromArray=function(t){return v().fromArray(t)},gapp.overlay($,{Polygon:h,newPolygon:v})});"use strict";gapp.register("geo.slicer",[],(O,e)=>{const{base:w}=O,{config:C,util:G,polygons:t}=w,{newOrderedLine:g,newPolygon:F,newPoint:_}=w,D=w.polygons;function E(e,t){return void 0!==e?e:t}async function n(n,e={}){let t=e.zMin||0,u=e.zMax||0,o=e.zInc||0,r=e.zGen,g=e.indices||[],l=e.minstep||0,s={},i={},a=[],p,h=0,f=[],d=e.overlap||.75,c=e.bucketMax||100,z=e.onupdate||function(){},v=E(e.slicer,Z),{debug:m,flat:M,autoDim:k}=e,y,b,x,w,D;if(!n||!n.length)throw"missing points array";if(M){let e=[];for(y=0,b=n.length;y<b;)e.push(_(n[y++].round(3),n[y++].round(3),n[y++].round(3)));n=e}else for(y=0;y<n.length;y++)n[y]=n[y].round(3);for(y=0;y<n.length;){var P,S;x=n[y++],w=n[y++],D=n[y++],h+=Math.abs(x.z-w.z)+Math.abs(w.z-D.z)+Math.abs(D.z-x.z),x.z===w.z&&w.z===D.z&&x.z>=t?(P=x.z,S=Math.abs(G.area2(x,w,D))/2,s[P]?s[P]+=S:s[P]=S,a[P]=(a[P]||0)+1):x.z===w.z?a[x.z]=(a[x.z]||0)+1:w.z===D.z?a[w.z]=(a[w.z]||0)+1:D.z===x.z&&(a[D.z]=(a[D.z]||0)+1),k&&(t=Math.min(t,x.z,w.z,D.z),u=Math.max(u,x.z,w.z,D.z)),i[x.z]=x.z,i[w.z]=w.z,i[D.z]=D.z}if(o)for(y=t;y<=u;y+=o)g.push(y);else if(!g.length&&(g=Object.values(i).sort((e,t)=>e-t),0<l)){let t;g=g.filter(e=>!(void 0!==t&&e-t<l)&&(t=e,!0))}r&&(g=r({zMin:t,zMax:u,zLine:a,zFlat:s,zIndexes:g,options:e})),g=g.map(e=>e.round(3));var T=u-t,q=h/n.length;let A=!1!==e.bucket?Math.min(c,Math.max(1,Math.floor(T/q))):1;if(p=1/(u/A),m&&console.log({zMin:t,zMax:u,zIndexes:g,zScale:p,zSum:h,zSpanAvg:q,points:n,bucketCount:A,options:e,buckets:f}),0==T||0==h||0==n.length)return{};for(y=0;y<A;y++)f.push({points:[],slices:[]});if(1<A){let e=n.length*d|0,t;e:for(y=0;y<n.length;){x=n[y++],w=n[y++],D=n[y++];var I=Math.min(x.z,w.z,D.z),L=Math.max(x.z,w.z,D.z),I=Math.floor(I*p),O=Math.min(Math.ceil(L*p),A);for(b=I;b<O;b++)if(t=f[b].points,t.push(x),t.push(w),t.push(D),t.length>e){m&&console.log({bucketFail:t.length}),A=1;break e}}}1===A&&(f=[{points:n,slices:[]}]);for(let o=0,e=g.length;o<e;o++){let e=g[o],t=A<=1?0:Math.min(Math.floor(e*p),A-1),n=f[t];n?n.slices.push(e):console.log({missing_bucket:e,index:t}),z(o/g.length*.1)}async function C(){let n=[],o=0;var r={...e,zMin:t,zMax:u,zIndexes:g};let l=[];for(let e=0,t=f.length;e<t;e++){var s,{points:i,slices:a}=f[e];a.length&&l.push(v(a,i,{...r,each(e){n.push(e),z(.1+o++/g.length*.9)}}))}return await Promise.all(l),n}let F=v?await C():[];return F=F.sort((e,t)=>e.z-t.z),{slices:F,points:n,zMin:t,zMax:u,zIndexes:g,zFlat:s}}function P(e,t,n){var t=e.z-t;(Math.abs(t)<C.precision_slice_z?n.on:t<0?n.under:n.over).push(e)}function S(n,o,r){let l=[];for(let t=0;t<n.length;t++)for(let e=0;e<o.length;e++)l.push(n[t].intersectZ(o[e],r));return l}function s(e,t){var n=e[t.key];return n||(e[t.key]=t)}function T(e,t,n,o,r){t=s(e,t),n=s(e,n);let l=g(t,n);return l.coplanar=o||!1,l.edge=r||!1,l}async function Z(n,t,o={}){if(Array.isArray(n))return Promise.all(n.map(e=>Z(e,t,o)));let{zMin:r,zMax:l,under:s,over:i,both:a,each:e}=o,u=E(o.groupr,a?null:q),g={},p=[],h,f,d;s||a||(i=!0);for(let e=0;e<t.length;){h=t[e++],f=t[e++],d=t[e++];var c={under:[],over:[],on:[]},z;if(P(h,n,c),P(f,n,c),P(d,n,c),3!==c.under.length&&3!==c.over.length)if(2===c.on.length){(a||i&&(1===c.over.length||n===l)||s&&(1===c.under.length||n===r))&&p.push(T(g,c.on[0],c.on[1],!1,!0))}else if(3!==c.on.length&&0!==c.under.length&&0!==c.over.length){let e=S(c.over,c.under,n);e.length<2&&1===c.on.length&&e.push(c.on[0]),2===e.length?p.push(T(g,e[0],e[1])):console.log({msg:"invalid ips",line:e,where:c})}}if(0!=p.length||!o.noEmpty){p=A(p);let t={z:n,lines:p};if(u){let e=u(p,n,o);var v,m;o.union&&(v={x:1},m=D.union(D.nest(e),.1,!0,v),t.changes=v.changes,e=D.flatten(m,null,!0)),t.groups=e}if(o.post){let e=w.slicePost[o.post];e&&e(t,o)}var M,k,y,b,x;return e&&e(t),t}}function q(e,t,n={}){let{debug:d,both:o}=n;if(o)return d&&console.log('unable to connect lines sliced with "both" option'),[];let r={},l=[],s=[],u=[],i=0,a=!1,g=!1,p=C.bridgeLineGapDistance,h=C.bridgeLineGapDistanceMax,f,c,z;function v(e){var t=r[e.key];return t||(l.push(e),r[e.key]=e)}function m(e,t){e.group?e.group.push(t):e.group=[t]}function M(e){return e.perimeter||(e.perimeter=F().addPoints(e).perimeter()),e.perimeter}function k(e,t,n,o=1){let r=[];for(t&&t.push(r);;){e.del=!0,r.push(e);var l=e.group.filter(e=>!e.del);if(2!==l.length||1!==o){var s=!t,i,a,u;if(1<l.length){if(s&&(t=[r],n=[]),n.length<500)for(var g of l){n.push(i=t.slice());for(u of k(g,i,n,o+1))u.del=!1}var p=n.map(e=>e.flat()).sort((e,t)=>M(t)-M(e)),h=p[0];if(d&&console.log({root:s,branches:n.slice(),flat:p,path:r,npath:h}),s){for(var f of h)f.del=!0;return h}return r}if(!(e=l[0])||e.del)return r}else e=l[0]}throw"invalid state"}function y(e){i+=e.length,(e=e.clean()).length,s.push(e),d&&console.log("xray",e)}function b(e){var t,n;0<=e[0].group.indexOf(e.peek())&&2<e.length?(d&&console.log({closed:e.length,path:e}),y(F().addPoints(e))):1<e.length&&(n=e[0].distTo2D(e.peek()).round(4),d&&console.log({open:e.length,gap:n,path:e}),u.push(e))}e.forEach(function(e){f=v(e.p1),c=v(e.p2),m(f,c),m(c,f)});for(var x of l)z=x.group.length,a=a||2<z,g=g||z<2;if(d&&(a||g)&&console.log({forks:a,frays:g}),a){d&&console.log("process forks");for(var w of l){var w;!w.del&&2<w.group.length&&((w=k(w))&&b(w))}}if(g){d&&console.log("process frays");for(var D of l){var D;D.del||1!==D.group.length||(D=k(D))&&b(D)}}d&&console.log("process mids");for(var P of l){var P;P.del||(P=k(P))&&b(P)}d&&console.log({points:l,emitted:i,used:l.filter(e=>e.del),free:l.filter(e=>!e.del)}),d&&u.length&&console.log({connect:u}),d&&(u=u.map(e=>e.slice()));let S=1e3,T;do{T=1/0;e:for(let a=0;a<u.length;a++)if(p)t:for(;;){let n=u[a];if(n.delete)break;let o=n[0],r=n.peek(),l=o.distToSq2D(r),s={dist:l};for(let t=a+1;t<u.length;t++){let e=u[t];var q,A;e.delete||(q=e[0],A=e.peek(),l=r.distToSq2D(q),T=Math.min(T,l),l<s.dist&&l<=p&&(s={dist:l,next:e}),l=r.distToSq2D(A),T=Math.min(T,l),l<s.dist&&l<=p&&(s={dist:l,next:e,reverse:e}),l=o.distToSq2D(q),T=Math.min(T,l),l<s.dist&&l<=p&&(s={dist:l,next:e,reverse:n}),l=o.distToSq2D(A),T=Math.min(T,l),l<s.dist&&l<=p&&(s={dist:l,next:e,swap:t}))}let{next:e,reverse:t,swap:i}=s;if(!(e&&s.dist<p))break;d&&console.log({rollup:n.slice(),next:e.slice(),reverse:t,swap:i}),t&&t.reverse(),i?(e.appendAll(n),u[a]=e,u[i]=n,n.delete=!0,e.merged=!0):(n.appendAll(e),e.delete=!0,n.merged=!0)}else y(F().addPoints(O).setOpen())}while(p=T<1/0?Math.max(T+.01,p+.1):p+.1,d&&console.log({iter:S,bridge:p,mingap:T,bridgeMax:h}),0<S--&&p&&p<h&&T<h);d&&console.log({remain:u.filter(e=>!e.delete)});for(var I of u)if(!I.delete){if(d){let e=I[0];var L=I.peek();let t=e.distToSq2D(L);console.log({dist:t.round(4),merged:I.merged||!1,array:I})}y(F().addPoints(I))}return d&&console.log({emitted:i}),d&&i<l.length&&console.log({leftovers:l.length-i}),s}function A(e){let t=[],l=[],n=[],o={};function r(e){var t=o[e.key];return t||(n.push(e),o[e.key]=e)}function s(e,t){r(e),e.group?e.group.push(t):e.group=[t]}e.sort(function(e,t){return e.key===t.key?(e.del=!e.edge,t.del=!t.edge,0):e.key<t.key?-1:1});for(var i of e)i.del||(l.push(i),s(i.p1,i),s(i.p2,i));for(var a of n)if(2==a.group.length){let o=a.group[0],r=a.group[1];if(o.isCollinear(r)){o.del=!0,r.del=!0;let e=o.p1!=a?o.p1:o.p2,t=r.p1!=a?r.p1:r.p2,n=g(e,t);e.group.remove(o),e.group.remove(r),t.group.remove(o),t.group.remove(r),e.group.push(n),t.group.push(n),n.edge=o.edge||r.edge,l.push(n)}}l.sort(function(e,t){return e.key===t.key?(e.del=!0,t.del=!t.edge,0):e.key<t.key?-1:1});for(var u of l)u.del||(t.push(u),u.p1.group=null,u.p2.group=null);return t}gapp.overlay(w,{slice:n,sliceZ:Z,slicePost:{},sliceDedup:A,sliceConnect:q})});"use strict";gapp.register("geo.slope",[],(t,i)=>{var{base:t}=t;const{config:s}=t,e=Math.abs,h=Math.PI/180,n=180/Math.PI;class r{constructor(t,i,s,e){this.dx=t&&i?i.x-t.x:s,this.dy=t&&i?i.y-t.y:e,this.angle=Math.atan2(this.dy,this.dx)*n}toString(){return[this.dx,this.dy,this.angle].join(",")}clone(){return new r(null,null,this.dx,this.dy)}isSame(t){if(e(this.dx)<=s.precision_merge&&e(t.dx)<=s.precision_merge)return!0;if(e(this.dy)<=s.precision_merge&&e(t.dy)<=s.precision_merge)return!0;var i=Math.min(1/Math.sqrt(this.dx*this.dx+this.dy*this.dy),s.precision_slope_merge);return d(this.angle,t.angle,i||s.precision_slope)}normal(){var t=this.dx;return this.dx=-this.dy,this.dy=t,this.angle=Math.atan2(this.dy,this.dx)*n,this}invert(){return this.dx=-this.dx,this.dy=-this.dy,this.angle=Math.atan2(this.dy,this.dx)*n,this}toUnit(){var t=Math.max(e(this.dx),e(this.dy));return this.dx=this.dx/t,this.dy=this.dy/t,this}factor(t){return this.dx*=t,this.dy*=t,this}invert(){return this.dx=-this.dx,this.dy=-this.dy,this.angle=180-this.angle,this}angleDiff(t,i){var s=this.angle,e;let h=t.angle-s;for(;h<-180;)h+=360;for(;180<h;)h-=360;return i?h:Math.abs(h)}}function a(t,i,s){return e(t-i)<s}function d(t,i,s){return e(t-i)<=s||360-e(t-i)<=s}function o(t,i,s,e){return new r(t,i,s,e)}function l(t){return o(0,0,Math.cos(t*h),Math.sin(t*h))}gapp.overlay(t,{Slope:r,newSlope:o,newSlopeFromAngle:l})});"use strict";gapp.register("geo.wasm",[],(e,n)=>{const{base:d}=e,{config:c}=d,u=c.clipper,p={enable:l,disable:m,count:{offset:0,union:0,diff:0}};function t(){console.log(...arguments)}function w(e,n){let t=0;for(var r of n)t+=i(e,r);return t}function i(t,e,n){n?e.setCounterClockwise():e.setClockwise();let r=1;var a=e.points,o=e.inner;t.writeU16(a.length,!0);for(let e=0,n=a.length;e<n;e++){var f=a[e];t.writeI32(f.x*u|0,!0),t.writeI32(f.y*u|0,!0)}if(o)for(let e=0,n=o.length;e<n;e++)r+=i(t,o[e],!0);return r}function a(n,t){let r=n.readU16(!0);if(0!==r){let e=self.base.newPolygon();for(;0<r--;)e.add(n.readI32(!0)/u,n.readI32(!0)/u,t||0);return e}}function h(e,n,t=[]){for(;;){var r=a(e,n);if(!r)break;t.push(r)}return t}function o(e,n,t,r,a){p.count.offset++;let o=d.wasm,f=o.shared,i=w(new DataWriter(o.heap,f),e),s=o.fn.offset(f,i,n*u,r,a),l=h(new DataReader(o.heap,s),t);return g(l)}function f(e,n){p.count.union++;let t=d.wasm,r=t.shared,a=w(new DataWriter(t.heap,r),e),o=t.fn.union(r,a),f=h(new DataReader(t.heap,o),n);return g(f)}function s(e,n,t,r,a){p.count.diff++;let o=d.wasm,f=o.shared,i=new DataWriter(o.heap,f),s=w(i,e),l=w(i,n),u=o.fn.diff(f,s,l,r?1:0,a?1:0,c.clipperClean),m=new DataReader(o.heap,u);r&&r.appendAll(g(h(m,t))),a&&a.appendAll(g(h(m,t)))}function g(r){r.sort((e,n)=>n.bounds.minx-e.bounds.minx);for(let e=0,t=r.length;e<t;e++){var a=r[e];if(!a.inner)for(let n=e+1;n<t;n++){let e=r[n];if(e.bounds.contains(a.bounds)){e.addInner(a);break}}}let t=[];for(let e=0,n=r.length;e<n;e++){var o=r[e];o.parent||t.push(o)}return t}function r(e,n){let t=new DataReader(d.wasm.heap,e),r=[];for(;0<n--;)r.push(String.fromCharCode(t.readU8()));return r.join("")}function l(){d.wasm||d._wasm||(d._wasm="loading",fetch("/wasm/kiri-geo.wasm").then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,{env:{debug_string:(e,n)=>{console.log("wasm",r(n,e))}},wasi_snapshot_preview1:{proc_exit:e=>e}})).then(e=>{delete d._wasm;var{module:n,instance:t}=e,{exports:e}=t,t=new DataView(e.memory.buffer);let r=d.wasm={heap:t,exports:e,memory:e.memory,memmax:e.memory.buffer.byteLength,malloc:e.mem_get,free:e.mem_clr};r.shared=r.malloc(31457280),r.fn={diff:e.poly_diff,union:e.poly_union,offset:e.poly_offset},r.js={diff:s,union:f,offset:o}}))}function m(){d.wasm&&delete d.wasm}gapp.overlay(d,{wasm_ctrl:p})});"use strict";gapp.register("kiri-mode.cam.driver",[],(e,c)=>{const{kiri:o}=e,{driver:s}=o,i=s.CAM={process:{LEVEL:1,ROUGH:2,OUTLINE:3,CONTOUR_X:4,CONTOUR_Y:5,TRACE:6,DRILL:7}};o.load(t=>{o.client&&(i.surface_prep=function(e,c){o.client.sync();var s=t.conf.get();o.client.send("cam_surfaces",{settings:s,index:e},e=>{c(e)})},i.surface_show=function(e){e.selectFaces(Object.values(e._surfaces).flat())},i.surface_toggle=function(c,s,e,r){let t=c._surfaces=c._surfaces||{};for(var[a,n]of Object.entries(t))if(n.contains(s))return delete t[a],i.surface_show(c),void r(Object.keys(t).map(e=>parseInt(e)));o.client.send("cam_surface_find",{id:c.id,face:s,radians:e},e=>{e.length&&(t[s]=e,i.surface_show(c)),r(Object.keys(t).map(e=>parseInt(e)))})},i.surface_clear=function(e){e.selectFaces([]),e._surfaces={}},i.traces=function(s,e){o.client.sync();var c=t.conf.get();const r=t.widgets.map();o.client.send("cam_traces",{settings:c,single:e},e=>{const c=[];o.codec.decode(e).forEach(e=>{c.push(e.id),r[e.id].traces=e.traces}),s(c)})},i.traces_clear=function(e){o.client.send("cam_traces_clear",{},()=>{})}),o.worker&&(i.surface_prep=function(c,s){if(!c.tool){let e=c.tool=new mesh.tool;var r;e.index(c.getGeoVertices({unroll:!0,translate:!!s}))}},i.surface_find=function(e,c,s){return i.surface_prep(e),e.tool.findConnectedSurface(c,s||0,0)},o.worker.cam_surfaces=function(e,c){var{settings:s,index:r}=e,t,a;for(a of Object.values(o.worker.cache))r?(a.setIndexed(!0),a.setAxisIndex(-r)):(a.setIndexed(!1),a.setAxisIndex(0)),i.surface_prep(a,r);c.done({})},o.worker.cam_surface_find=function(e,c){var{id:s,face:r,radians:e}=e,s=o.worker.cache[s],e=i.surface_find(s,[r],e);c.done(e)},o.worker.cam_traces=async function(e,c){var{settings:s,single:r}=e,t,a;const n=[];for(a of Object.values(o.worker.cache))await i.traces(s,a,r)&&n.push(a);c.done(o.codec.encode(n.map(e=>({id:e.id,traces:e.traces}))))},o.worker.cam_traces_clear=function(e,c){for(var s of Object.values(o.worker.cache))delete s.traces,delete s.topo;c.done({})})})});"use strict";gapp.register("kiri-mode.cam.animate2",[],k=>{const{kiri:S}=k;var{driver:e}=S;const{CAM:V}=e;S.load(()=>{if(S.client){let f={},c,t=[0,0,0,0,0],s=[1,2,4,8,32],n=["1x","2x","4x","8x","!!"],i=s.length-1,a=0,o,r,l=0,d,u;var{moto:e}=k;const{space:B}=e,{api:E}=S;function h(e){S.client.animate_cleanup2(),$("layer-animate").innerHTML="",$("layer-toolpos").innerHTML="",Object.keys(f).forEach(e=>y(e))}function p(i,a){let r=i.alerts.show("building animation");S.client.animate_setup2(i.conf.get(),e=>{if(M(e),!e){const t=i.uc,s=$("layer-animate");s.innerHTML="",t.setGroup(s),t.newRow([t.newButton(null,T,{icon:'<i class="fas fa-fast-backward"></i>',title:"restart"}),u=t.newButton(null,w,{icon:'<i class="fas fa-play"></i>',title:"play"}),d=t.newButton(null,g,{icon:'<i class="fas fa-pause"></i>',title:"pause"}),t.newButton(null,b,{icon:'<i class="fas fa-step-forward"></i>',title:"single step"}),t.newButton(null,x,{icon:'<i class="fas fa-forward"></i>',title:"toggle speed"}),o=t.newLabel("speed",{class:"speed"}),c=t.newLabel("0%",{class:"progress"})]),_(),setTimeout(b,a||0);const n=$("layer-toolpos");n.innerHTML="",t.setGroup(n),u.style.display="",d.style.display="none",i.event.emit("animate","CAM"),i.alerts.hide(r),$("render-hide").onclick()}})}function m(e,t,s,n,i){const a=new THREE.BufferGeometry;var i=i?s.subarray(0,3*i):s,n=n?t.subarray(0,n):t;a.setAttribute("position",new THREE.BufferAttribute(i,3)),a.setIndex(new THREE.BufferAttribute(n,1));var n=new THREE.MeshMatcapMaterial({flatShading:!0,transparent:!1,opacity:1,color:8947848,side:THREE.DoubleSide});const r=new THREE.Mesh(a,n);r.pos=s,r.ind=t,B.world.add(r),f[e]=r}function v(e,t,s,n,i){const a=f[e];if(a){const r=a.geometry;a.pos=s||a.pos,a.ind=t||a.ind,r.setAttribute("position",new THREE.BufferAttribute(a.pos.subarray(0,3*i),3)),r.setIndex(new THREE.BufferAttribute(a.ind.subarray(0,n),1)),r.attributes.position.needsUpdate=!0,r.index.needsUpdate=!0,B.update()}}function y(e){B.world.remove(f[e]),delete f[e]}function b(){_(),S.client.animate2({speed:r,steps:1},M)}function w(e){var{steps:e}=e;_(),1!==e&&(u.style.display="none",d.style.display="",$("render-hide").onclick()),S.client.animate2({speed:r,steps:e||1/0,pause:t[a]},M)}function x(e){var{steps:e}=e;_(1),u.style.display="none",d.style.display="",$("render-hide").onclick(),S.client.animate2({speed:r,steps:e||1/0,pause:t[a]},M)}function g(){u.style.display="",d.style.display="none",S.client.animate2({speed:0},M)}function M(e){if(e){var t,s,n,i,a,a,r,o,l,d;if(e.mesh_add&&({id:t,ind:s,pos:n,ilen:i,plen:a}=e.mesh_add,m(t,s,n,i,a),B.refresh()),e.mesh_del&&y(e.mesh_del),e.mesh_move){var{id:r,pos:o}=e.mesh_move;const u=f[r];u&&(u.position.x=o.x,u.position.y=o.y,u.position.z=o.z,B.refresh())}if(e.mesh_index){var{id:l,index:d}=e.mesh_index;const h=f[l];h&&(h.rotation.x=Math.PI/180*d,B.refresh())}e.mesh_update&&({id:a,ind:r,pos:o,ilen:l,plen:d}=e.mesh_update,v(a,r,o,l,d)),e&&e.progress&&(c.innerText=(100*e.progress).toFixed(1)+"%")}}function _(e=0){e===1/0?a=i:0<e&&(a=(a+e)%s.length),r=s[a],o.innerText=n[a]}function T(){h(E),setTimeout(()=>{p(E,50)},250)}gapp.overlay(S.client,{animate2(e,t){S.client.send("animate2",e,t)},animate_setup2(e,t){l=e.controller.dark?8947848:0,S.client.send("animate_setup2",{settings:e},t)},animate_cleanup2(e,t){S.client.send("animate_cleanup2",e,t)}}),gapp.overlay(V,{animate2:p,animate_clear2:h})}});const{CSG:G}=k.base;let n=1;class q{constructor(e,t,s){this.id=n++,this.vbuf=void 0,this.ibuf=void 0,this.ilen=0,this.sends=0,this.newbuf=!0,this.subtracts=0,this.mesh=G.Instance().cube([e,t,s],!0)}send(e){var t=this.newbuf,s=0==this.sends++?"mesh_add":"mesh_update";e.data({[s]:{id:this.id,ind:t?this.ibuf:void 0,pos:t?this.vbuf:void 0,ilen:this.ilen,plen:this.plen}}),this.newbuf=!1,this.sends++}translate(e,t,s){const n=this.mesh;return this.mesh=this.mesh.translate(e,t,s),this.bounds=G.toBox3(this.mesh),n.delete(),this}updateMesh(e){var t,s,n,i;0<this.sends&&0===this.subtracts||(t=this.subtracts,this.subtracts=0,s=Date.now(),n=this.mesh.getMesh(),this.sharedVertexBuffer(3*n.numVert),this.sharedIndexBuffer(3*n.numTri),this.vbuf.set(n.vertPos),this.ibuf.set(n.triVerts),i=Date.now(),e.push(this))}subtractTool(e){const t=this.mesh;this.mesh=this.mesh.subtract(e.mesh),t.delete(),this.subtracts++}sharedVertexBuffer(e){var t=this.vbuf;if(this.plen=e,t&&t.length>=e)return t;var e=new Float32Array(new SharedArrayBuffer(4*e+1048576));return this.newbuf=!0,this.vbuf=e}sharedIndexBuffer(e){var t=this.ibuf;if(this.ilen=e,t&&t.length>=e)return t;var e=new Uint32Array(new SharedArrayBuffer(4*e+1048576));return this.newbuf=!0,this.ibuf=e}}S.load(()=>{if(S.worker){let v,e,y,b,w,x,h,g,f,a=!1,c,p,M,_=-1,l,d,T,B=!1,E=!1,k=0,o=0,z=!1,u=10,I=0,A=0,t=0,m=0;function H(t){if(!z){if(0==I--)return E=!1,void H(t);if(!1===E||B||0===A)return R(t),z=!0,E=!1,B=!1,void t.done();let e=b[w];for(;e&&"laser"===e.type;)g=e,e=b[++w];if(!e)return console.log("animation completed in ",((Date.now()-M)/1e3).round(2)),E=!1,void H(t);var s;w++,!e.tool||x&&x.getID()===e.tool.getID()||(x&&g.point&&(L(g.point={x:g.point.x,y:g.point.y,z:v.z}),t.data(T)),$(e.tool.getID(),t));var n=_,i=2*y;if(g){var a=g.point,r=e.point;if(g=e,!r||!a)return H(t);var o=r.x-a.x,l=r.y-a.y,d=r.z-a.z,r=Math.sqrt(o*o+l*l+d*d);if(k+=r,k<i)H(t);else{var r=Math.max(Math.abs(o),Math.abs(l),Math.abs(d)),u=Math.ceil(r/i),h=o/u,f=l/u,c=d/u,p=Math.sqrt(h*h+f*f+c*c);const m=[];for(let e=0,t=a.x,s=a.y,n=a.z;e<u;e++)m.push({x:t,y:s,z:n,a:a.a,md:p}),t+=h,s+=f,n+=c;k=0,m.push({...e.point,md:p}),D(n,m,t)}}else g=e,x&&L(e.point),H(t)}}function D(s,n,i,e=0){for(let t=e;t<n.length;t++){var a=n[t],r;if(!a)throw`no pos @ ${t} of `+n.length;L(a);let e=0;for(r of c)r.bounds.intersectsBox(l.bounds)&&(r.subtractTool(l),e++);if(o+=a.md,A&&o>=A)return o=0,R(i),void setTimeout(()=>{D(s,n,i,t+1)},u)}H(i)}function R(e){var t=[],s,n;for(s of c)s.updateMesh(t);for(n of t)n.send(e);if(T&&e.data(T),a){for(var i of c)e.data({mesh_index:{id:i.id,index:-p}});a=!1}e.data({progress:w/b.length}),m++}function L(e){var t;T={mesh_move:{id:_,pos:{x:e.x,y:e.y,z:e.z}}},l.mesh&&l.mesh.delete(),l.mesh=l.root.translate(e.x,e.y,e.z),void 0!==e.a&&(t=l.mesh.rotate([e.a,0,0]),l.mesh.delete(),l.mesh=t,e.a!==p&&(a=!0,p=e.a)),l.bounds=G.toBox3(l.mesh)}function $(e,t){x&&t.data({mesh_del:_}),x=new V.Tool({tools:h},e);const s=G.Instance();var n=x.shaftLength()||15,i=x.shaftDiameter()/2,a=x.fluteLength()||15,r=d=x.fluteDiameter()/2,e;let o;o=x.isBallMill()?s.cylinder(a+n-r,r,r,20,!0).add(s.sphere(r,20).translate(0,0,-(a+n-r)/2)):x.isTaperMill()?(e=Math.max(x.tipDiameter()/2,.001),s.cylinder(n,i,i,20,!0).translate(0,0,n/2).add(s.cylinder(a,e,r,20,!0).translate(0,0,-a/2))):s.cylinder(a+n,r,r,20,!0),o=o.translate(0,0,(a+n-f)/2);var a=o.getMesh(),n=a.vertPos,a=a.triVerts;l={root:o,index:a,vertex:n,bounds:G.toBox3(o)},t.data({mesh_add:{id:--_,ind:a,pos:n}})}S.worker.animate_setup2=function(e,s){var{settings:t}=e,{process:n}=t;const i=worker.print;var e=1e3*parseInt(t.controller.animesh),n=n.camStockIndexed;w=0,b=i.output.flat(),h=t.tools,v=t.stock,y=1/Math.sqrt(e/(v.x*v.y)),x=null,g=null,E=!1,B=!1,p=0,M=0,m=0,f=n?0:v.z,c=[];var{x:a,y:r,z:o}=v,l=parseInt(t.controller.animesh||2e3)/100,d=v.x/l;for(let t=0;t<l;t++){var u=-a/2+t*d+d/2;let e=new q(d,r,o).translate(u,0,0);c.push(e),e.updateMesh([]),e.send(s)}s.done()},S.worker.animate2=function(e,t){if(u=e.pause||u,A=e.speed||0,E)return t.done();I=e.steps||1,z=!1,E=0<A,M=M||Date.now(),H(t)},S.worker.animate_cleanup2=function(e,t){E&&(B=!0)}}})});"use strict";gapp.register("kiri-mode.cam.animate",[],(H,e)=>{const{kiri:O}=H;var{driver:t}=O;const{CAM:C}=t,n=!1,a=!1;O.load(()=>{if(O.client){let v={},n=1,r,t=[1,2,4,8,32],a=[30,20,10,5,0],o=["1x","2x","4x","8x","!!"],i=t.length-1,s=0,l,p,d=0,f,c,u={x:0,y:0,z:0};const{moto:E}=H,{space:B}=E,{api:A}=O;function e(e){E.space.platform.showGridBelow(!0),O.client.animate_cleanup(),$("layer-animate").innerHTML="",$("layer-toolpos").innerHTML="",Object.keys(v).forEach(e=>g(e))}function m(o,i){let s=o.alerts.show("building animation");O.client.animate_setup(o.conf.get(),e=>{if(k(e),e&&e.mesh_add){const t=o.uc,n=$("layer-animate");n.innerHTML="",t.setGroup(n),t.newRow([t.newButton(null,T,{icon:'<i class="fas fa-fast-backward"></i>',title:"restart"}),c=t.newButton(null,x,{icon:'<i class="fas fa-play"></i>',title:"play"}),f=t.newButton(null,M,{icon:'<i class="fas fa-pause"></i>',title:"pause"}),t.newButton(null,w,{icon:'<i class="fas fa-step-forward"></i>',title:"single step"}),t.newButton(null,_,{icon:'<i class="fas fa-forward"></i>',title:"toggle speed"}),l=t.newLabel("speed",{class:"speed"}),r=t.newLabel("0%",{class:"progress"})]),z(),setTimeout(w,i||0);const a=$("layer-toolpos");a.innerHTML="",t.setGroup(a),c.style.display="",f.style.display="none",o.event.emit("animate","CAM"),o.alerts.hide(s),E.space.platform.showGridBelow(!1)}})}function h(e,t,n,a){const o=new THREE.BufferGeometry;a&&(n=new Float32Array(a)),o.setAttribute("position",new THREE.BufferAttribute(n,3)),t.length&&o.setIndex(new THREE.BufferAttribute(new Uint32Array(t),1));let i;var s,r,l=120,p=2105376,d=1052688,f=.2,c=.8,u=!0,m=!0,h=.9,y,t=THREE.DoubleSide,t=new THREE.MeshMatcapMaterial({flatShading:!0,transparent:!0,opacity:.9,color:8947848,side:t});i=new THREE.Mesh(o,t),B.world.add(i),v[e]=i}function y(e){const t=v[e];t&&(t.geometry.attributes.position.needsUpdate=!0,B.update())}function g(e){B.world.remove(v[e]),delete v[e]}function w(){z(),O.client.animate({speed:p,steps:1},b)}function x(e){var{steps:e}=e;z(),1!==e&&(c.style.display="none",f.style.display="",$("render-hide").onclick()),O.client.animate({speed:p,steps:e||1/0,pause:a[s]},b)}function _(e){var{steps:e}=e;z(1),c.style.display="none",f.style.display="",$("render-hide").onclick(),O.client.animate({speed:p,steps:e||1/0,pause:a[s]},b)}function M(){c.style.display="",f.style.display="none",O.client.animate({speed:0},b)}function b(e){k(e),e&&e.progress&&(r.innerText=(100*e.progress).toFixed(1)+"%")}function z(e=0){e===1/0?s=i:0<e&&(s=(s+e)%t.length),p=t[s],l.innerText=o[s]}function T(){e(A),setTimeout(()=>{m(A,50)},250)}function k(e){if(e){var t,n,a,o,i;if(e.mesh_add&&({id:t,ind:n,pos:a,offset:o,sab:i}=e.mesh_add,h(t,n,a,i),B.refresh(),o&&(u=o)),e.mesh_del&&g(e.mesh_del),e.mesh_move){var{id:i,pos:o}=e.mesh_move;const s=v[i];s&&(s.position.x=o.x,s.position.y=o.y,s.position.z=o.z,B.update())}e.mesh_update&&y(e.id)}}gapp.overlay(O.client,{animate(e,t){O.client.send("animate",e,t)},animate_setup(e,t){d=e.controller.dark?8947848:0,n="in"===e.controller.units?1/25.4:1,O.client.send("animate_setup",{settings:e},t)},animate_cleanup(e,t){O.client.send("animate_cleanup",e,t)}}),gapp.overlay(C,{animate:m,animate_clear:e})}}),O.load(()=>{if(!O.worker)return;let m,u,h,y,v,g,w,x,_,M,b,z=1;function T(e,a,o,i){var t,n=new SharedArrayBuffer(3*(e*a)*4);const s=new Float32Array(n),r=[];var l=o.x/2,p=o.y/2;for(let t=0,n=0;t<e;t++)for(let e=0;e<a;e++){var d=s[n++]=t*i-l+i/2,f=s[n++]=e*i-p+i/2,c,u,m,h;s[n++]=o.z,0<t&&0<e&&(c=a*(t-1)+e-1,u=a*+t+e-1,m=a*+t+e,h=a*(t-1)+e,r.appendAll([c,u,m,c,m,h]))}return{pos:s,ind:r,sab:n}}O.worker.animate_setup=function(e,t){var{settings:n}=e,{process:a}=n;const o=worker.print;var i=1e3*parseInt(n.controller.animesh);x=0,w=o.output.flat(),M=n.tools,m=n.stock,g=1/Math.sqrt(i/(m.x*m.y));var s=g,r=Math.floor(m.x/s),e=Math.floor(m.y/s),{pos:n,ind:i,sab:s}=T(r,e,m,s),a={x:a.outputOriginCenter?0:m.x/2,y:a.outputOriginCenter?0:m.y/2,z:a.camOriginTop?-m.z:0};h=n,y=r,v=e,_=null,b=null,E=!1,k=!1,u=Object.assign({},m.center),u.z-=m.z/2,t.data({mesh_add:{id:0,ind:i,offset:a,sab:s}},[]),t.data({mesh_move:{id:0,pos:u}}),t.done()},O.worker.animate=function(e,t){if(s=e.pause||s,L=e.speed||0,E)return t.done();H=e.steps||1,A=!1,E=0<L,$(t)};let k=!(O.worker.animate_cleanup=function(e,t){E&&(k=!0)}),E=!1,B=0,A=!1,s=10,H=0,L=0;var e=null;let D,r=0;function R(e){D&&e.data(D),e.data({progress:x/w.length,id:0,mesh_update:1})}function $(t){if(!A){if(0==H--)return E=!1,void $(t);if(!1===E||k||0===L)return R(t),A=!0,E=!1,k=!1,void t.done();let e=w[x];for(;e&&"laser"===e.type;)b=e,e=w[++x];if(!e)return E=!1,void $(t);x++;var n=!_&&e.tool,a=!n&&_.getID()!==e.tool.getID(),o;(n||a)&&(_&&b.point&&(o=b.point={x:b.point.x,y:b.point.y,z:m.z},t.data({mesh_move:{toolID:z,pos:o}})),G(e.tool,t));var i=z,s=g;if(b){var r=b.point,l=e.point;if(b=e,!l||!r)return $(t);var n=l.x-r.x,a=l.y-r.y,o=l.z-r.z,l=Math.sqrt(n*n+a*a+o*o);if(B+=l,B<s)$(t);else{var l=Math.max(Math.abs(n),Math.abs(a),Math.abs(o)),p=Math.ceil(l/s),d=n/p,f=a/p,c=o/p;const u=[];for(let e=0,t=r.x,n=r.y,a=r.z;e<p;e++)u.push({x:t,y:n,z:a}),t+=d,n+=f,a+=c;u.push(e.point),I(i,u,t)}}else b=e,_&&(_.pos=e.point,D={mesh_move:{id:i,pos:e.point}}),$(t)}}function I(t,n,a,o=0){for(let e=o;e<n.length;e++){var i=n[e];if(!i)throw`no pos @ ${e} of `+n.length;if(l(_.pos=i,a),D={mesh_move:{id:t,pos:i}},L&&B>=L||600<r)return B=r=0,R(a),void setTimeout(()=>{I(t,n,a,e)},s)}r++,$(a)}function l(e,t){var n=_.profile,{size:a,pix:o}=_.profileDim,i=Math.floor(o/2),s=Math.floor((e.x+m.x/2-a/2-u.x)/g),r=Math.floor((e.y+m.y/2-a/2-u.y)/g);let l=0;for(let e=0,t=n.length;e<t;){var p=i+n[e++],d=i+n[e++],f=n[e++],p=s+p,d=r+d,c,p,d,f;p<0||d<0||p>y-1||d>v-1||(p=3*(p*v+d)+2,d=h[p],(f=_.pos.z-f)<d&&(l++,h[p]=f))}}function G(e,t){_&&t.data({mesh_del:z}),_=new C.Tool({tools:M},e.getID()),_.generateProfile(g);var n=_.fluteLength()||15,a=_.shaftLength()||15,o=_.profile,{size:e,pix:i}=_.profileDim;const{pos:s,ind:r,sab:l}=T(i,i,{x:e,y:e,z:n+a},g);var p=Math.floor(i/2);for(let e=0,t=o.length;e<t;){var d=p+o[e++],f=p+o[e++],c=o[e++];s[3*(d*i+f)+2]=-c}t.data({mesh_add:{id:++z,ind:r,sab:l}})}})});"use strict";gapp.register("kiri-mode.cam.export",[],(e,t)=>{const{base:le,kiri:xe}=e,{polygons:o,util:me}=le;var{driver:e}=xe;const{CAM:n}=e;var i=o,a=n.process;n.export=function(L,U){const W=L.widgets[0];if(W){var{settings:q}=L,J,K;const{device:de,tools:pe}=q;let o,g=0,i=0,a=0,e=0,u=1,d=[],z=0,h=0,v=0,M=de.spindleMax,t=q.origin||{x:0,y:0,z:0},b=de.gcodeSpace?" ":"",O="rml"===de.gcodeFExt.toLowerCase(),n=de.gcodeStrip||!1,S=de.gcodeChange||["M6 T{tool}"],_=de.gcodeSpindle||["M3 S{speed}"],E=de.gcodeDwell||["G4 P{time}"],p=q.device,A=q.process,C=A.camFastFeedZ,T=A.camFastFeed,F=le.config.gcode_decimals||3,k={x:null,y:null,z:null,a:void 0,f:null,t:null,emit:null},r,s,l,x,w=0,D="",m=!1,I=!1,P=!1,Z,c=q.stock||{},y=c.z-W.track.top,f=W.getBoundingBox(),$=c.z,G={max:{x:-1/0,y:-1/0,z:-1/0},min:{x:1/0,y:1/0,z:1/0}},N={x:-t.x,y:t.y},X={x:1,y:1,z:1},Y={tool:0,tool_name:"unknown",top:(N,p.bedDepth),left:(N,0),right:(N,p.bedWidth),bottom:(N,0),time_sec:0,time_ms:0,time:0},j=[];for(J of de.gcodePre)if(0===J.indexOf(";; SCALE "))try{var V=JSON.parse(J.substring(9));V.X&&(X.x=V.X),V.Y&&(X.y=V.Y),V.Z&&(X.z=V.Z),void 0!==V.DEC&&(F=parseInt(V.DEC)),console.log("export scaling applied",V)}catch(e){console.log("malformed scale directive",J)}else 0===J.indexOf(";; REWRITE-COMMENTS-PARENS")?m=!0:0===J.indexOf(";; DECIMALS")?F=parseInt(J.split("=")[1].trim()||3)||3:0===J.indexOf(";; COMPACT-OUTPUT")?(I=!0,n=!0,b=""):j.push(J);if(te("header"),!n)for(var H in oe("; Generated by Kiri:Moto "+xe.version),oe("; "+(new Date).toString()),ne(["; Bed left:{left} right:{right} top:{top} bottom:{bottom}"],Y),oe(`; Stock X:${c.x.round(2)} Y:${c.y.round(2)} Z:`+c.z.round(2)),oe("; Target: "+q.filter[q.mode]),oe("; --- process ---"),A)"ops"!==H&&"op2"!==H&&oe("; "+H+" = "+A[H]);let R={},B;const re=(N,N.x||N.y);L.output.forEach(e=>{Array.isArray(e)&&e.forEach(e=>{e.gcode||(e.tool&&e.tool!==B&&(B=e.tool,R[e.tool]=B),x=e.point,x&&!x.mod&&(x.mod=1,re&&(x.x+=N.x,x.y+=N.y),X&&(x.x*=X.x,x.y*=X.y,x.z*=X.z),A.outputInvertX&&(x.x=-x.x),A.outputInvertY&&(x.y=-x.y),A.camOriginTop&&(x.z=x.z-$)))})}),n||(oe("; --- tools ---"),Object.keys(R).sort().forEach(e=>{var t=R[e];oe(`; tool=${e} flute=${t.flute_diam} len=${t.flute_len} metric=`+t.metric)})),ne(j,Y);for(K of L.output){var Q=K.mode;Q&&("laser on"===Q.type?Z=Q:"laser off"===Q.type&&(Z=void 0,k.t=void 0));var ee=K[0];const se=Q&&!Q.silent&&l!==Q;se&&(l&&!n&&oe("; ending "+l.type+" op after "+Math.round(g/60)+" seconds"),l=Q,l&&te(`op-${e++}-`+l.type),!n&&l&&oe("; starting "+l.type+" op")),h=K.spindle,K.forEach((e,t)=>{e.gcode&&Array.isArray(e.gcode)?ne(e.gcode,Y):ae(e,{newOp:0===t&&se})}),P&&Z&&(ne(Z.off,Y),P=!1)}function te(e){oe(),U({section:e})}function oe(e){if(e){if(i++,a+=e.length,m){var t=e.indexOf(";");if(0<=t){const o=e.substring(0,t),n="("+e.substring(t).replace(/; /g,"").replace(/;/g,"")+")";e=[o,n].join("")}}d.append(e)}(!e||1e3<d.length)&&(U(d.join("\r\n")),d=[])}function ne(e,t){if(e)for("string"==typeof e&&(e=e.split("\n")),o=0;o<e.length;o++)r=L.constReplace(e[o],t),!O&&n&&0<=(s=r.indexOf(";"))&&(r=r.substring(0,s).trim(),0===r.length)||(0===r.indexOf("G20")?(u=1/25.4,t.top=(N,p.bedDepth*u),t.left=(N,0*u),t.right=(N,p.bedWidth*u),t.bottom=(N,0*u)):0===r.indexOf("G21")&&(u=1),oe(r))}function ie(e,t){let o=e.toString(),n=o.indexOf(".");return n<0&&0<F?t?o:o+".0":e.toFixed(F)}function ae(e,t={}){var o="laser"===e.type;let n=e.point;if(!n)return g+=e.speed/60,Y.time_sec=e.speed/1e3,Y.time_ms=e.speed,Y.time=Y.time_sec,void ne(E,Y);n.x=me.round(n.x,F),n.y=me.round(n.y,F),n.z=me.round(n.z,F);var i=e.tool!=k.t,i;if(i&&(k.t=e.tool,Y.tool=k.t.getNumber(),Y.tool_name=k.t.getName(),!Z&&(A.camToolInit||0<v)&&ne(S,{...Y,spindle:h}),v++),M&&h&&(i||h!==z||t.newOp)&&(z=h,Z||(0<z?(i=Math.abs(z),ne(_,{speed:i,spindle:i,rpm:i})):oe("M4"))),0===w)return k.x=k.y=k.z=0,w++,A.camFirstZMax?(ae({tool:e.tool,point:{x:k.x,y:k.y,z:n.z,a:n.a}},{dx:0,dy:0,dz:1,time:0}),ae({tool:e.tool,point:{x:n.x,y:n.y,z:n.z,a:k.a}},{dx:1,dy:1,dz:0,time:0})):(ae({tool:e.tool,point:{x:n.x,y:n.y,z:k.z,a:k.a}},{dx:1,dy:1,dz:0,time:0}),ae({tool:e.tool,point:{x:n.x,y:n.y,z:n.z,a:n.a}},{dx:0,dy:0,dz:1,time:0})),void w--;let a=e.speed,d=a?"G1":"G0",p=I&&D===d?[]:[d],r=t.dx||n.x-k.x,s=t.dy||n.y-k.y,l=t.dz||n.z-k.z,x=n.a!=k.a,m=l?C:T,c=Math.min(a||m,m),y=Math.sqrt(r*r+s*s+l*l),f=c&&c!==k.f;(r||s||l||x)&&(D=d,!r&&n.x===k.x||(k.x=n.x,G.min.x=Math.min(G.min.x,k.x),G.max.x=Math.max(G.max.x,k.x),p.append(b).append("X").append(ie(Y.pos_x=k.x*u))),!s&&n.y===k.y||(k.y=n.y,G.min.y=Math.min(G.min.y,k.y),G.max.y=Math.max(G.max.y,k.y),p.append(b).append("Y").append(ie(Y.pos_y=k.y*u))),!l&&n.z===k.z||(k.z=n.z,G.min.z=Math.min(G.min.z,k.z),G.max.z=Math.max(G.max.z,k.z),p.append(b).append("Z").append(ie(Y.pos_z=k.z*u))),x&&(k.a=n.a,p.append(b).append("A").append(ie(Y.pos_a=k.a*u))),f&&(k.f=c,p.append(b).append("F").append(ie(Y.feed=c*u,!0))),O&&(p=a?(f&&oe(`VS${c};`),["Z",ie(k.x*u),",",ie(k.y*u),",",ie(k.z*u),";"]):["PU",ie(k.x*u),",",ie(k.y*u),";"]),!P&&o&&ne(Z.on,Y),o&&p.append(b).append("S"+ie(e.emit)),o&&(k.emit=e.emit),P&&!o&&ne(Z.off,Y),P=o,g+=0<=t.time?t.time:y/(k.f||1e3)*60,oe(p.join("")),w++)}l&&!n&&oe("; ending "+l.type+" op after "+Math.round(g/60)+" seconds"),te("footer"),ne(de.gcodePost,Y),oe(),L.time=g,L.lines=i,L.bytes=a+i-1,L.bounds=G}}});"use strict";gapp.register("kiri.slice",[],(t,s)=>{const{base:i,kiri:l}=t;var{key:t,polygons:e}=i,{util:n}=i;const r=i.polygons;var o=t.NONE;let p;function h(t){return p=t}class a{constructor(t,s){this.z=t,this.index=0,this.lines=null,this.groups=null,this.up=null,this.down=null,this.tops=[],this.view=s,this.finger=null,this.layers=null}output(){if(this.layers)return this.layers;let t=this.layers=new l.Layers;return p&&t.setRotation(-p.rotation||0),t}clone(s){const t=this,i=c(t.z,t.view);return t.tops.forEach(function(t){i.addTop(t.poly.clone(s))}),i}topPolys(){return this.tops.map(t=>t.poly)}topSimples(){return this.tops.map(t=>t.simple)}topPolysFlat(){return this.topFlatPolys||(this.topFlatPolys=r.flatten(this.topPolys().clone(!0),[],!0))}topRouteFlat(){if(this.topFlatRoutes)return this.topFlatRoutes;let t=this.tops.map(t=>t.shells[0]).filter(t=>t);return this.topFlatRoutes=r.flatten(t.clone(!0),[],!0)}topPolyInners(){return this.tops.map(t=>t.poly.inner).flat().filter(t=>t)}topInners(){return this.tops.map(t=>t.last).flat().filter(t=>t)}topFillOff(){return this.tops.map(t=>t.fill_off).flat().filter(t=>t)}topFill(){return this.tops.map(t=>t.fill_lines).flat().filter(t=>t)}topShells(){return this.tops.map(t=>t.shells).flat().filter(t=>t)}fingerprint(){return this.finger||(this.finger=r.fingerprint(this.topPolys()))}fingerprintSame(t){return!!t&&r.fingerprintCompare(this.fingerprint(),t.fingerprint())}addTops(t){return t.forEach(t=>{this.addTop(t)}),this}addTop(s){if(s.length){let t=new f(s);return this.tops.push(t),t.simple=s,t}{let t=new f(s.poly);return t.thin_fill=s.thin_fill?s.thin_fill.map(t=>i.newPoint(t.x,t.y,t.z)):void 0,t.fill_lines=s.fill_lines,t.fill_off=s.fill_off,t.last=s.last,t.shells=s.shells,t.simple=s.simple,this.tops.push(t),t}}findClosestPointTo(s){let i,l;return this.tops&&this.tops.length?this.tops.forEach(function(t){l=t.poly.findClosestPointTo(s),(!i||l.distance<i.distance)&&(i=l)}):this.supports&&this.supports.forEach(function(t){l=t.findClosestPointTo(s),(!i||l.distance<i.distance)&&(i=l)}),i}setFields(t={}){return Object.assign(this,t),this}}class f{constructor(t){this.poly=t}clone(t){var s;return new f(this.poly.clone(t))}innerShells(){let t=this.shells,s=[];return t&&t.forEach(function(t){t.inner&&s.appendAll(t.inner)}),s}shellsAtDepth(s){return this.shells?this.shells.filter(t=>t.depth===s):[]}}function u(t){return new f(t)}function c(t,s){return new a(t,s)}gapp.overlay(l,{Top:f,Slice:a,newTop:u,newSlice:c,setSliceTracker:h})});"use strict";gapp.register("kiri-mode.cam.ops",[],(root,exports)=>{const{base,kiri}=root,{paths,polygons,newPoint,newPolygon,sliceConnect}=base,{poly2polyEmit,tip2tipEmit,segmentNormal,vertexNormal}=paths,{driver,newSlice}=kiri,{CAM}=driver,POLY=polygons;class CamOp{constructor(e,t){this.state=e,this.op=t}type(){return this.op.type}weight(){return 1}async slice(){}prepare(){}}class OpIndex extends CamOp{constructor(e,t){super(e,t)}slice(){let{op:e,state:t}=this;if(!t.isIndexed)throw"index op requires indexed stock";this.degrees=t.setAxisIndex(e.degrees,e.absolute)}prepare(e,t){const{lastPoint:o,zmax:s,zclear:n,camOut:a,stock:i}=e;let l=o();var e,e;l&&(e=Math.max(i.y,i.z)*Math.sqrt(2)/2+n,e=Math.max(e,s),a(l=l.clone().setZ(e),0),a(l=l.clone().setY(0).setA(this.degrees),0))}}class OpGCode extends CamOp{constructor(e,t){super(e,t)}prepare(e,t){e.addGCode(this.op.gcode)}}class OpLaserOn extends CamOp{constructor(e,t){super(e,t)}prepare(e,t){const{printPoint:o,setPrintPoint:s,setTool:n,zmax:a,camOut:i}=e;this.op.silent=!0,n(0),e.addGCode(this.op.enable),e.setLasering(!0,this.op.power)}}class OpLaserOff extends CamOp{constructor(e,t){super(e,t)}prepare(e,t){const{printPoint:o,zmax:s,camOut:n}=e;this.op.silent=!0,e.addGCode(this.op.disable),e.setLasering(!1),n(o.clone().setZ(s),0)}}class OpLevel extends CamOp{constructor(e,t){super(e,t)}async slice(e){var{op:t,state:o}=this;let{settings:s,widget:n,addSlices:a}=o,{updateToolDiams:i,tabs:l,cutTabs:r}=o;var{bounds:c,zMax:p,ztOff:f,color:d,tshadow:u}=o,{stock:h}=s,m=new CAM.Tool(s,t.tool).fluteDiameter(),o=this.stepOver=m*t.step,O=p+f-t.down;i(m);var w=[],t=POLY.outer(POLY.offset(u,m*(t.over||0)));POLY.fillArea(t,90,o,w);let P=this.lines=[];for(let t=0;t<w.length;t+=2){let e=newSlice(O);P.push(newPolygon().setOpen().addPoints([w[t],w[t+1]]).setZ(O)),e.output().setLayer("level",{face:d,line:d}).addPolys(this.lines),a(e)}}prepare(e,t){let{op:o,state:s,lines:n,stepOver:a}=this,{setTool:i,setSpindle:l,printPoint:r,setPrintPoint:c}=e,{polyEmit:p,newLayer:f,tip2tipEmit:d,camOut:u}=e;i(o.tool,o.rate),l(o.spindle),n=n.map(e=>({first:e.first(),last:e.last(),poly:e})),r=d(n,r,(e,t,o)=>{let s=e.poly;s.last()===t&&s.reverse(),s.forEachPoint((e,t)=>{u(e.clone(),0<t,a)},!1)}),c(r),f()}}class OpRough extends CamOp{constructor(e,t){super(e,t)}async slice(a){let{op:i,state:e}=this,{settings:t,widget:o,slicer:s,addSlices:n,unsafe:l,color:r}=e,{updateToolDiams:c,thruHoles:p,tabs:f,cutTabs:d,cutPolys:u}=e,{tshadow:h,shadowTop:m,ztOff:O,zBottom:w,zMax:P,shadowAt:g,isIndexed:v}=e,{process:y,stock:L}=t;if(i.down<=0)throw`invalid step down "${i.down}"`;let x=i.inside;var z=i.top,T=i.down;let Y=i.leave,E=i.all&&v,C=new CAM.Tool(t,i.tool).fluteDiameter(),b=!0===y.camTrueShadow;if(z){var A=h.clone(),z=C*i.step,A=E?POLY.offset([newPolygon().centerRectangle(L.center,L.x,L.y)],z):POLY.offset(A,x?z:z+Y+C/2);let o=POLY.offset(A,-z,{count:999,flat:!0});v&&(O=L.z/2-P);var z=O/T,M=0<z%1?O/(Math.floor(z)+1):T,k;0===O&&(O=M);let e=Math.round(O/M),s=this.camFaces=[];for(let t=P+O-M;0<e;e--){let e=m.slice.clone(!1);e.z=t,e.camLines=POLY.setZ(o.clone(!0),e.z),e.output().setLayer("face",{face:r,line:r}).addPolys(e.camLines),n(e),s.push(e),t-=M}}c(C);let D=[],S=[],Z=[],F=s.interval(T,{down:!0,min:0,fit:!0,off:.01});if(F.shift(),i.flats){let t=Math.PI*(C/2)*(C/2)/2,o=Object.entries(s.zFlat).filter(e=>e[1]>t).map(e=>e[0]).map(e=>parseFloat(e).round(5)).filter(e=>e>=w);o.forEach(e=>{F.contains(e)||F.push(e)}),F=F.sort((e,t)=>t-e);for(let e=1;e<F.length-1;e++){var R=F[e-1],I=F[e],j=F[e+1];!o.contains(I)&&o.contains(j)&&(F[e]=j+(R-j)/2)}}else D=Object.keys(s.zFlat).map(e=>(parseFloat(e)-.01).round(5)).filter(e=>0<e&&F.indexOf(e)<0),F=F.appendAll(D).sort((e,t)=>t-e);let G=0,W=0;if(await s.slice(F,{each:e=>{S=l?e.tops:POLY.union(S.slice().appendAll(e.tops),.01,!0),0<=D.indexOf(e.z)||(e.shadow=b?g(e.z):S.clone(!0),e.slice.shadow=e.shadow,Z.push(e.slice),a(++G/W*.25+.25))},progress:(e,t)=>{W=t,a(e/t*.25)}}),S=b?h.clone(!0):POLY.union(S.appendAll(m.tops),.01,!0),S=POLY.flatten(S.clone(!0),[],!0),p.forEach(o=>{S=S.map(e=>{if(e.isEquivalent(o)){var t=POLY.offset([e],-(C/2+Y+.01));return t?t[0]:void 0}return e}).filter(e=>e)}),S=POLY.nest(S),i.voids)for(var H of S)H.inner=void 0;var T=(x,C/2);const q=E?POLY.offset([newPolygon().centerRectangle(L.center,L.x,L.y)],T):POLY.offset(S,T+Y);Z.forEach((e,t)=>{let o=[q.clone(!0),e.shadow.clone(!0)].flat();var s=POLY.flatten(o,[],!0),s=POLY.setZ(POLY.nest(s),e.z),s;if(o=POLY.offset(s,[-(C/2+Y),-C*i.step],{minArea:Math.min(.01,C*i.step/4),z:e.z,count:999,flat:!0,call:(e,t,o)=>{e.forEach(e=>{e.depth=o,e.inner&&e.inner.forEach(e=>e.depth=o)})}})||[],!x&&!E){const n=POLY.offset(S.clone(),C/2+Y,{z:e.z});n&&(n.forEach(e=>e.depth=-e.depth),o.appendAll(n))}f&&(f.forEach(e=>{e.off=POLY.expand([e.poly],C/2).flat()}),o=d(f,o,e.z)),o&&(y.camStockClipTo&&L.x&&L.y&&L.center&&(s=newPolygon().centerRectangle(L.center,L.x,L.y),o=u([s],o,e.z,!0)),o.forEach(e=>{if(e.inner){let s=e.perimeter(),n=[];e.inner.forEach(e=>{var t=e.perimeter(),o;(s>t?t/s:s/t)<.98&&n.push(e)}),e.inner=n}}),e.camLines=o,e.output().setLayer("roughing",{face:r,line:r}).addPolys(o),a(.5+t/Z.length*.5))}),this.sliceOut=Z.filter(e=>e.camLines),n(this.sliceOut)}prepare(o,e){var{op:s,state:t,sliceOut:a,camFaces:n}=this;let{setTool:i,setSpindle:l,setPrintPoint:r}=o,{polyEmit:c,depthRoughPath:p}=o,{camOut:f,newLayer:d,printPoint:u}=o;var{settings:h,widget:m}=t,{process:O,controller:o}=h,h=o.danger,o=O.camEaseDown,w=O.camConventional,P,g;let v=O.camDepthFirst&&!t.isIndexed,y=[];i(s.tool,s.rate,s.plunge),l(s.spindle);for(P of n||[]){const T=[];for(var L of P.camLines)T.push(L),L.inner&&L.inner.forEach(function(e){T.push(e)});POLY.setWinding(T,w,!1),u=poly2polyEmit(T,u,function(e,t,o){const n=1===o?.5:1;e.forEachPoint(function(e,t,o,s){f(e.clone(),0!==s,void 0,n)},!0,t)}),d()}let x=0;for(g of a){let o=[],s=[],n=[];POLY.flatten(g.camLines).forEach(function(e){var t=e.parent;v&&((e=e.clone()).parent=t?1:0),(t?n:s).push(e),e.layer=y.layer,o.push(e)}),POLY.setWinding(s,w),POLY.setWinding(n,!w),v?y.push(o):(u=poly2polyEmit(o,u,function(e,t,n){e.forEachPoint(function(e,t,o,s){f(e.clone(),0!==s,void 0,1===n?.5:1)},e.isClosed(),t)},{swapdir:!1}),d()),e(++x/a.length,"routing")}function z(e){return e<0||0===e&&1/e==-1/0}if(v){var h=h&&s.down&&o?s.down:0;let e=y.map(e=>e.filter(e=>!z(e.depth)));var o=e.map(e=>POLY.nest(e.filter(e=>0===e.depth).clone()));let t=y.map(e=>e.filter(e=>z(e.depth)));var s=t.map(e=>POLY.nest(e.filter(e=>0===e.depth).clone()));u=p(u,0,e,o,c,!1,h),u=p(u,0,t,s,c,!1,h)}r(u)}}class OpOutline extends CamOp{constructor(e,t){super(e,t)}async slice(o){let{op:i,state:e}=this,{settings:t,widget:s,slicer:n,addSlices:a,tshadow:l,thruHoles:r,unsafe:c,color:p}=e,{updateToolDiams:f,zThru:d,zBottom:u,shadowTop:h,tabs:m,cutTabs:O,cutPolys:w}=e,{zMax:P,ztOff:g}=e,{process:v,stock:y}=t;if(i.down<=0)throw`invalid step down "${i.down}"`;let L=this.toolDiam=new CAM.Tool(t,i.tool).fluteDiameter();f(L);let x=[],z=[];var T={down:!0,min:0,fit:!0,off:.01,max:i.top?P+g:void 0},Y;let E=n.interval(i.down,T),C=!0===v.camTrueShadow;E.shift();const b=Object.keys(n.zFlat).map(e=>(parseFloat(e)-.01).round(5)).filter(e=>0<e&&E.indexOf(e)<0);E=E.appendAll(b).sort((e,t)=>t-e);let A=0,M=0;if(i.outside&&!i.inside?E.forEach((t,e)=>{if(!(0<=b.indexOf(t))){let e=newSlice(t);e.shadow=x.clone(!0),z.push(e)}}):await n.slice(E,{each:e=>{x=c?e.tops:POLY.union(x.slice().appendAll(e.tops),.01,!0),0<=b.indexOf(e.z)||(e.shadow=C?CAM.shadowAt(s,e.z):x.clone(!0),e.slice.shadow=e.shadow,z.push(e.slice),o(++A/M*.5+.5))},progress:(e,t)=>{M=t,o(e/t*.5)}}),x=POLY.union(x.appendAll(h.tops),.01,!0),i.top){let e=z[0],t=z.map(e=>e.z);for(var k of E.filter(e=>e>=P).reverse())if(!t.contains(k)){let t=e.clone(!0);t.tops.forEach(e=>e.poly.setZ(t.z)),t.shadow=e.shadow.clone(!0),t.z=k,z.splice(0,0,t)}}if(d){let e=z[z.length-1];for(var D of base.util.lerp(0,d,i.down))if(e){let t=e.clone(!0);t.tops.forEach(e=>e.poly.setZ(t.z)),t.shadow=e.shadow.clone(!0),t.z-=D,z.push(t)}}z.forEach(o=>{let e=o.shadow;if(i.outside&&(e=l),i.omitthru)for(let t of r)for(var s of e)s.inner&&(s.inner=s.inner.filter(e=>!e.isEquivalent(t,!1,.1)));if(i.omitvoid)for(var t of e)delete t.inner;let n=POLY.expand(e,L/2,o.z);if(n&&n.length){if(i.inside){let o=POLY.expand(e.clone(),L/2);n=POLY.filter(n,[],function(t){if(t.area()<1)return null;for(let e=0;e<o.length;e++)if(t.isEquivalent(o[e]))return t.inner||null;return t})}else if(i.wide){let t=L*i.step;n.slice().forEach(e=>{POLY.expand([e.clone(!0)],t,o.z,n,1)})}var a;i.dogbones&&!i.wide&&CAM.addDogbones(n,L/5),m&&(m.forEach(e=>{e.off=POLY.expand([e.poly],L/2).flat()}),n=O(m,n,o.z)),v.camStockClipTo&&y.x&&y.y&&y.center&&(a=newPolygon().centerRectangle(y.center,y.x,y.y),n=w([a],n,o.z,!0)),o.camLines=n}}),z=z.filter(e=>e.camLines);for(Y of z)Y.output().setLayer("outline",{face:p,line:p}).addPolys(Y.camLines);a(z),this.sliceOut=z}prepare(t,e){var{op:o,state:s,sliceOut:n}=this;let{setTool:a,setSpindle:i,setPrintPoint:l}=t,{polyEmit:r,depthOutlinePath:c}=t,{camOut:p,newLayer:f,printPoint:d}=t;var{settings:u,widget:h}=s,{process:m,controller:t}=u,s=t.danger,u=m.camEaseDown,t=this.toolDiam,O,o;let w=m.camConventional,P=m.camDepthFirst,g=[];a(o.tool,o.rate,o.plunge),i(o.spindle),m.camOutlinePocket||(w=!w);for(O of n){let o=[],s=[],n=[];POLY.flatten(O.camLines).forEach(function(e){var t=e.parent;P&&((e=e.clone()).parent=t?1:0),(t?n:s).push(e),e.layer=g.layer,o.push(e)}),POLY.setWinding(s,w),POLY.setWinding(n,!w),P?g.push(o):(d=poly2polyEmit(o,d,function(e,t,o){e.forEachPoint(function(e,t,o,s){p(e.clone(),0!==s)},e.isClosed(),t)},{swapdir:!1}),f())}if(P){let e=g.map(e=>POLY.flatten(e.clone(!0),[],!0).filter(e=>!(e.depth=0))).filter(e=>0<e.length);e.length&&e[0].length&&(d=e[0].sort((e,t)=>e.area()-t.area())[0].average(),o=s&&o.down&&u?o.down:0,d=c(d,0,e,t,r,!1,o),d=c(d,0,e,t,r,!0,o))}l(d)}}function createFilter(op){let filter=e=>e;if(op.filter)try{const obj=eval(`( ${op.filter.join("\n")} )`);let idx=0;if(obj&&obj.slices){const nadd=[];filter=function(e){for(var t of e)obj.slices(t,idx++)&&nadd.push(t);return nadd}}}catch(e){console.log("filter parse error",e,op.filter)}return filter}class OpContour extends CamOp{constructor(e,t){super(e,t)}async slice(s){var{op:e,state:t}=this;let{addSlices:o}=t,n=createFilter(e);var t=await CAM.Topo({onupdate:(e,t,o)=>{s(e/t,o)},ondone:e=>{e=n(e),this.sliceOut=e,o(e)},contour:e,state:t});this.tolerance=t.tolerance}prepare(e,t){var{op:o,state:s,sliceOut:n}=this,{settings:a,widget:i}=s,{process:l}=a;let{setTolerance:r,setTool:c,setSpindle:p,setPrintPoint:f}=e,{camOut:d,polyEmit:u,newLayer:h,printPoint:m,lastPoint:O}=e;var{bounds:s,zmax:e}=e,w,P;let g=(this.toolDiam=new CAM.Tool(a,o.tool).fluteDiameter())*o.step*2,v=l.camDepthFirst,y=[];c(o.tool,o.rate,l.camFastFeedZ),p(o.spindle),r(this.tolerance),m=newPoint(s.min.x,s.min.y,e);for(P of n)if(P.camLines){let t=[],s,e;P.camLines.forEach(function(e){v&&(e=e.clone(!0)),t.push({first:e.first(),last:e.last(),poly:e})}),v?y.appendAll(t):(m=tip2tipEmit(t,m,function(e,t,o){s=e.poly,s.last()===t&&s.reverse(),s.forEachPoint(function(e,t){d(e.clone(),0<t,g)},!1)}),h())}v&&(m=tip2tipEmit(y,m,function(e,t,o){let s=e.poly;return s.last()===t&&s.reverse(),s.forEachPoint(function(e,t){d(e.clone(),0<t,g)},!1),h(),O()})),f(m)}}class OpLathe extends CamOp{constructor(e,t){super(e,t)}async slice(o){var{op:e,state:t}=this;let{addSlices:s}=t,n=createFilter(e);this.topo=await CAM.Topo4({op:e,state:t,onupdate:(e,t)=>{o(e,t)},ondone:e=>{e=n(e),this.slices=e,s(e,!1)}})}prepare(e,t){var{op:o,state:s,slices:n,topo:a}=this,{settings:s}=s,i,l;let{setTool:r,setSpindle:c,setPrintPoint:p}=e,{camOut:f,newLayer:d,printPoint:u}=e,{zmax:h}=e,m=new CAM.Tool(s,o.tool).fluteDiameter()*o.step*2,O=a.resolution;r(o.tool,o.rate,o.plunge),c(o.spindle),u=newPoint(0,0,h);for(l of n)if(l.camLines){let n;for(var w of l.camLines){let s;w.forEachPoint((e,t)=>{if(n){var o;if(Math.abs(n.z-e.z)<O)return void(s=e.clone());s&&(f(s,!0,m),s=void 0)}f(n=e.clone(),0<t,m)},!1),s&&f(s,!0,m)}d()}var o=e.lastPoint(),n=(360*Math.round(o.a/360)).round(2);d(),e.addGCode(["G0 Z"+h.round(2),"G0 A"+n,"G92 A0"]),p(o)}}class OpTrace extends CamOp{constructor(e,t){super(e,t)}async slice(e){let{op:s,state:t}=this,{tool:l,rate:r,down:o,plunge:c,offset:a,offover:i,thru:p}=s,{settings:n,widget:f,addSlices:d,zMax:u,zTop:h,zThru:m,tabs:O}=t,{updateToolDiams:w,cutTabs:P,cutPolys:g,healPolys:v,color:y}=t;var{process:L,stock:x}=n;let{camStockClipTo:z,camZBottom:T}=L;if(t.isIndexed)throw"trace op not supported with indexed stock";let Y=this.sliceOut=[];var E=s.areas[f.id]||[];let C=new CAM.Tool(n,l),b=C.fluteDiameter(),A=b*s.step;var M=C.traceOffset(),k;let D=L.camConventional,S=[],Z=x.center&&x.x&&x.y?newPolygon().centerRectangle(x.center,x.x,x.y):void 0;w(b),O&&O.forEach(e=>{e.off=POLY.expand([e.poly],b/2).flat()});for(k of E){var F=newPolygon().fromArray(k);POLY.setWinding([F],D,!1),S.push(F)}function R(e){var e=newSlice(e);return d(e),Y.push(e),e}function I(e){s.dogbone&&CAM.addDogbones(e,b/5,!s.revbone);var t=e.getZ();let o=R(t);o.camTrace={tool:l,rate:r,plunge:c},O?o.camLines=P(O,[e],t):o.camLines=[e],z&&Z&&(o.camLines=g([Z],o.camLines,t,!0)),o.output().setLayer("follow",{line:y},!1).addPolys(o.camLines)}function j(e,t,o){var s=o?base.util.lerp(h,t,o):[t],n,a;for(a of POLY.nest(e))for(var i of s){let e=R(i);e.camTrace={tool:l,rate:r,plunge:c},POLY.offset([a],[-b/2,-A],{count:999,outs:e.camLines=[],flat:!0,z:i}),O?e.camLines=P(O,POLY.flatten(e.camLines,null,!0),i):e.camLines=POLY.flatten(e.camLines,null,!0),POLY.setWinding(e.camLines,D,!1),e.output().setLayer("clear",{line:y},!1).addPolys(e.camLines)}}function G(e,t,o=.01){return Math.abs(e-t)<=o}function W(e,t){var o,s;t.length>e.length&&(o=e,e=t,t=o);let n=newPolygon().setOpen(!0);for(s of e.points){var a=t.findClosestPointTo(s);n.push(s.midPointTo3D(a.point))}return n}function H(e){let n=e.filter(e=>e.isOpen()).sort((e,t)=>t.perimeter()-e.perimeter());if(n.length<2)return e;let t=newPoint(0,0,0);n.forEach(e=>{e.last().distTo2D(t)<e.first().distTo2D(t)&&e.reverse()});let a=e.filter(e=>e.isClosed());e:for(let s=0,e=n.length;s<e-1;s++){let o=n[s];if(o)for(let t=s+1;t<e;t++){let e=n[t];if(e&&(G(o.perimeter(),e.perimeter(),.1)&&G(o.first().distTo2D(e.first()),b)&&G(o.last().distTo2D(e.last()),b))){a.push(W(o,e)),n[s]=void 0,n[t]=void 0;continue e}}}return a.appendAll(n.filter(e=>e)),a}switch(0,S=v(S),S=H(S),s.mode){case"follow":let n=[];poly2polyEmit(S,newPoint(0,0,0),(e,t,o,s)=>{n.push(e)});for(var q of POLY.nest(n)){let e=i;if(!e)switch(a){case"outside":e=M;break;case"inside":e=-M}if(e){var B=POLY.offset([q],e,{minArea:0,open:!0});if(!B)continue;q=POLY.setZ(B,q.getZ())}else q=[q];for(var N of POLY.flatten(q,[],!0))if(o){let e=N.getZ()-p;m&&G(e,0)&&(e-=m);for(var X of base.util.lerp(h,e,o))I(N.clone().setZ(X))}else p&&N.setZ(N.getZ()-p),I(N)}break;case"clear":var V=f.track.top-f.track.box.d,$,_,U;let t={};for($ of S){let e=$.getZ()-p;s.bottom&&T&&(e=Math.max(e,T)-V),(t[e]=t[e]||[]).push($)}for([_,U]of Object.entries(t))j(U,parseFloat(_),o)}}prepare(e,t){var{op:o,state:s}=this,{settings:n}=s,a;let{setTool:i,setSpindle:l}=e;i(o.tool,o.rate),l(o.spindle);for(a of this.sliceOut)e.emitTrace(a)}}class OpPocket extends CamOp{constructor(e,t){super(e,t)}async slice(p){const f=this,d=!1;let{op:u,state:e}=this,{tool:h,rate:m,down:t,plunge:O,expand:w,contour:P,smooth:g,tolerance:o}=u,{settings:s,widget:n,addSlices:v,zTop:y,zBottom:a,zThru:i,tabs:L,color:x}=e,{updateToolDiams:l,cutTabs:z,cutPolys:r,healPolys:c,shadowAt:T}=e;var{process:Y,stock:E}=s;let C=this.sliceOut=[],b=new CAM.Tool(s,h),A=b.fluteDiameter(),M=A*u.step,k=Y.camConventional,D=P&&u.engrave;function S(e){var e=newSlice(e);return C.push(e),e}function Z(e,t,o){var s,n=(o=o?(s=y-t)/Math.ceil(s/o):o)?base.util.lerp(y,t,o):[t],a;D&&(A=M),P&&(w=D?0:2*M),w&&(e=POLY.offset(e,w));let i=0,l=1/(e.length*n.length);for(a of e)for(var r of n){let t=[],o;if(P?t=g?POLY.offset(POLY.offset([a],g),-g):[a]:(o=T(r),g&&(o=POLY.setZ(POLY.offset(POLY.offset(o,g),-g),r)),POLY.subtract([a],o,t)),0!==t.length){let e=S(r);var c=D?1:999;e.camTrace={tool:h,rate:m,plunge:O},A?POLY.offset(t,[-A/2,-M],{count:c,outs:e.camLines=[],flat:!0,z:r}):e.camLines=t,L?e.camLines=z(L,POLY.flatten(e.camLines,null,!0),r):e.camLines=POLY.flatten(e.camLines,null,!0),POLY.setWinding(e.camLines,k,!1),P&&(e.camLines=f.conform(e.camLines,u.refine,D,e=>{p(.9+.1*(i+l*e),"conform")})),e.output().setLayer("pocket",{line:x},!1).addPolys(e.camLines),d&&o&&e.output().setLayer("pocket shadow",{line:16746513},!1).addPolys(o),P||p(i,"pocket"),i+=l,v(e)}}}P&&(t=0,this.topo=await CAM.Topo({onupdate:(e,t,o)=>{p(e/t*.9,o)},ondone:e=>{},contour:{tool:h,tolerance:o,inside:!0,axis:"-"},state:e})),l(A),L&&L.forEach(e=>{e.off=POLY.expand([e.poly],A/2).flat()});var Y=u.surfaces[n.id]||[],F=n.getGeoVertices({unroll:!0,translate:!0}).map(e=>e.round(4));let R=[];var Y=CAM.surface_find(n,Y,.1);let I=1/0;var j=0,G=Y.length,W;for(W of Y){var H=9*W;R.push(newPolygon().add(F[H++],F[H++],I=Math.min(I,F[H++])).add(F[H++],F[H++],I=Math.min(I,F[H++])).add(F[H++],F[H++],I=Math.min(I,F[H++])))}if(I=Math.max(a,I),R=POLY.union(R,1e-4,!0),R=POLY.setWinding(R,k,!1),R=c(R),g&&(R=POLY.offset(POLY.offset(R,g),-g)),R.length){if(!P&&u.outline)for(var q of R)q.inner=void 0;d&&S(I).output().setLayer("pocket area",{line:1149183},!1).addPolys(R),Z(R,I+1e-4,t),p(1,"pocket")}}conform(e,t,o,s){const n=this.topo;var a=e.map(e=>e.segment(2*n.tolerance)),i;let l=a.length,r=0;for(i of a){for(var c of i.points)c.z=o?n.zAtXY(c.x,c.y):n.toolAtXY(c.x,c.y);s(r++/l*.8)}l*=t;for(let e=r=0;e<t;e++)for(var p of a){var f=p.points,d=f.length;let o=[];for(let e=0;e<d;e++){var u=f[e],h=f[(e+1)%d];o.push(segmentNormal(u,h))}let e=[];for(let t=0;t<d;t++){var m=o[(t+d-1)%d],O=o[t],m=vertexNormal(m,O,1),w;if(e.push(m),0===Math.abs(1-m.vl).round(2)){var O=f[(t+d-1)%d];let e=f[t];var m=f[(t+1)%d];e.z=(O.z+m.z+e.z)/3}}s(r++/l*.2+.8)}return a}prepare(e,t){let{op:o,state:s,sliceOut:n}=this,{setTool:a,setSpindle:i}=e;a(o.tool,o.rate),i(o.spindle);let l=0,r=n.length;for(var c of n.filter(e=>e.camLines))e.emitTrace(c),t(++l/r,"pocket")}}class OpDrill extends CamOp{constructor(e,t){super(e,t)}async slice(e){let{op:s,state:t}=this,{settings:o,addSlices:n,tslices:a,updateToolDiams:i}=t,{zBottom:l,zThru:r,thruHoles:c,color:p}=t,f=[],d=new CAM.Tool(o,s.tool),u=d.fluteDiameter(),h=.1*u,m=u/2*(u/2)*Math.PI,O=s.mark?1/0:.05*m,w=this.sliceOut=[];i(u),a.forEach(function(a){if(!(a.z<l)){let e=a.topPolyInners([]);e.forEach(function(e){if(.985<=e.circularity()&&Math.abs(e.area()-m)<=O){let t=e.circleCenter(),o=!1,s=1/0,n;t.isInPolygon(a.shadow)||(f.forEach(function(e){o||((n=e.last().distTo2D(t))<=h&&(o=!0,e.push(t)),s=Math.min(s,n))}),o||f.push(newPolygon().append(t)))}})}}),f.forEach(function(t){let o=t.center(!0),e=newSlice(0,null);if(s.mark){let e=t.points;e=[e[0],e[0].clone().sub({x:0,y:0,z:s.down})],t.points=e}t.points.forEach(function(e){e.x=o.x,e.y=o.y}),r&&o.isInPolygon(c)&&t.points.push(t.points.last().sub({x:0,y:0,z:r})),e.camLines=[t],e.output().setLayer("drill",{face:p,line:p}).addPolys(t),n(e),w.push(e)})}prepare(e,t){var{op:o,state:s}=this,{settings:n,widget:a,addSlices:i,updateToolDiams:l}=s;let{setTool:r,setSpindle:c,setDrill:p,emitDrills:f}=e;r(o.tool,void 0,o.rate),p(o.down,o.lift,o.dwell),c(o.spindle),f(this.sliceOut.map(e=>e.camLines).flat())}}class OpRegister extends CamOp{constructor(e,t){super(e,t)}async slice(e){var{op:p,state:t}=this;let{settings:o,widget:s,bounds:n,addSlices:f,zMax:a,zThru:i,color:d}=t,{updateToolDiams:l}=t,u=new CAM.Tool(o,p.tool),h=this.sliceOut=[];l(u.fluteDiameter());let{stock:r}=o,c=s.track.pos.z,m=n.min.x,O=n.max.x,w=n.min.y,P=n.max.y,g=2*u.fluteDiameter(),v=(m+O)/2,y=(w+P)/2,L=p.thru||i||0,x=(r.x-(O-m))/4,z=(r.y-(P-w))/4,T=r.z,Y=[],E=r.z-n.max.z,C=n.max.z+E+c,b=c-L;if(r.x&&r.y&&r.z){switch(p.axis){case"X":case"x":3==p.points?(Y.push(newPoint(m-x,y,0)),Y.push(newPoint(O+x,y-g,0)),Y.push(newPoint(O+x,y+g,0))):(Y.push(newPoint(m-x,y,0)),Y.push(newPoint(O+x,y,0)));break;case"Y":case"y":3==p.points?(Y.push(newPoint(v,w-z,0)),Y.push(newPoint(v-g,P+z,0)),Y.push(newPoint(v+g,P+z,0))):(Y.push(newPoint(v,w-z,0)),Y.push(newPoint(v,P+z,0)));break;case"-":let t=g/2,o=m-x,e=O+x,s=w-z-t,n=P+z+t,a=(e-o-t)/4,i=(n-s-3*t)/4,l,r,c;function A(e){c=e,r={x:o+.5*t,y:s+1.5*t},l=newPolygon().add(r.x,r.y,e)}function M(e,t){r.x+=e,r.y+=t,l.add(r.x,r.y,c)}function k(e,t,o){for(;0<e--;)o(t,0===e),t=-t}for(var D of base.util.lerp(C,b,p.down)){let e=newSlice(D);f(e),h.push(e),A(D),k(4,t,e=>{M(0,-e),M(a,0)}),k(4,t,e=>{M(e,0),M(0,i)}),k(4,t,e=>{M(0,e),M(-a,0)}),k(4,t,e=>{M(-e,0),M(0,-i)}),l.points.pop(),e.camTrace={tool:u.getID(),rate:p.feed,plunge:p.rate},e.camLines=[l],e.output().setLayer("register",{line:d},!1).addPolys(e.camLines)}}if(Y.length){let e=newSlice(0,null),t=[];Y.forEach(e=>{t.push(newPolygon().append(e.clone().setZ(C)).append(e.clone().setZ(b)))}),e.camLines=t,e.output().setLayer("register",{face:d,line:d}).addPolys(t),f(e),h.push(e)}}}prepare(e,t){var{op:o,state:s}=this,{settings:n,widget:a,addSlices:i,updateToolDiams:l}=s;let{setTool:r,setSpindle:c,setDrill:p,emitDrills:f}=e;if("-"===o.axis){r(o.tool,o.feed,o.rate),c(o.spindle);for(var d of this.sliceOut)e.emitTrace(d)}else r(o.tool,void 0,o.rate),p(o.down,o.lift,o.dwell),c(o.spindle),f(this.sliceOut.map(e=>e.camLines).flat())}}class OpXRay extends CamOp{constructor(e,t){super(e,t)}async slice(e){let{widget:t,addSlices:o}=this.state,s=new kiri.cam_slicer(t);var n=Object.keys(s.zLine).map(e=>parseFloat(e).round(5)).sort((e,t)=>e-t),a;await s.slice(n,{each:e=>{let t=newSlice(e.z);t.addTops(e.tops),t.lines=e.lines,t.xray(),o(t)},over:!1,flatoff:0,edges:!0,openok:!0})}}class OpShadow extends CamOp{constructor(e,t){super(e,t)}async slice(s){let e=this.state,{ops:t,slicer:o,widget:n,unsafe:a,addSlices:i,shadowAt:l}=e,r=t.map(e=>e.op).filter(e=>e),c=!0===e.settings.process.camTrueShadow;var p=r.map(e=>(e.down||3)/(c?1:3)).reduce((e,t)=>Math.min(e,t,1));let f=[],d=[],u=o.interval(p,{fit:!0,off:.01,down:!0,flats:!0});var h=a;h&&(console.log("skipping terrain generation"),u=[u.pop()]);let m,O=0,w=0;var p=await o.slice(u,{each:e=>{var t=c?l(e.z,m):[];d=POLY.union(d.slice().appendAll(e.tops).appendAll(t),.01,!0),f.push(e.slice),e.slice.shadow=d;{const o=void 0}m=e.z,s(++O/w*.5+.5)},progress:(e,t)=>{w=t,s(e/t*.5)}});if(0===p.length)throw"invalid widget shadow";e.shadowTop=p[p.length-1],e.center=d[0].bounds.center(),e.tshadow=d,e.terrain=p,e.tslices=f,e.skipTerrain=h,e.thruHoles=d.map(e=>e.inner||[]).flat()}}CAM.shadowAt=function(e,t,o){var s=e.cache.geo,n=s.length;if(!e.cache.shadow){const p=[];for(let e=0,t=0;e<n;e+=3){var a=new THREE.Vector3(s[t++],s[t++],s[t++]),i=new THREE.Vector3(s[t++],s[t++],s[t++]),l=new THREE.Vector3(s[t++],s[t++],s[t++]),r;.001<THREE.computeFaceNormal(a,i,l).z&&p.push(a,i,l)}e.cache.shadow=p}const c=[],p=e.cache.shadow,{checkOverUnderOn:f,intersectPoints:d}=self.kiri.cam_slicer;for(let e=0;e<p.length;){var u=p[e++],h=p[e++],m=p[e++],O=void 0,w,m;o&&u.z>o&&h.z>o&&m.z>o||u.z<t&&h.z<t&&m.z<t||(u.z>t&&h.z>t&&m.z>t?c.push([u,h,m]):(w={under:[],over:[],on:[]},f(newPoint(u.x,u.y,u.z),t,w),f(newPoint(h.x,h.y,h.z),t,w),f(newPoint(m.x,m.y,m.z),t,w),0!==w.on.length||2!==w.over.length&&2!==w.under.length||(2===(m=d(w.over,w.under,t)).length?2===w.over.length?(c.push([w.over[1],m[0],m[1]]),c.push([w.over[0],w.over[1],m[0]])):c.push([w.over[0],m[0],m[1]]):console.log({msg:"invalid ips",line:m,where:w}))))}var e=c.map(e=>newPolygon().add(e[0].x,e[0].y,e[0].z).add(e[1].x,e[1].y,e[1].z).add(e[2].x,e[2].y,e[2].z)),e;return e=POLY.union(e,.001,!0)},CAM.OPS=CamOp.MAP={xray:OpXRay,shadow:OpShadow,level:OpLevel,rough:OpRough,outline:OpOutline,contour:OpContour,pocket:OpPocket,lathe:OpLathe,trace:OpTrace,drill:OpDrill,register:OpRegister,"laser on":OpLaserOn,"laser off":OpLaserOff,gcode:OpGCode,index:OpIndex,flip:CamOp}});"use strict";gapp.register("kiri.render",[],(e,r)=>{const{base:B,kiri:D}=e,{config:t,util:o,newPolygon:G}=B,a=.9,J=new THREE.Vector3(1,0,0),K=Math.PI/180;function n(){return"CAM"===e.worker.print.settings.mode}function c(){return!!e.worker.print.settings.controller.dark}function Q(e,r){return(n()?c()?g:p:c()?l:i)(e/r,1,a)}async function s(w,z,L={}){if(0===(w=w.filter(e=>e.length)).length)return self.worker.print.maxSpeed=0,[];const x=c(),A=L.tools||{},O=L.flat,C=L.thin&&!O,P=!1!==L.speed,S=8947848;var e=0<=L.move?L.move:x?6710886:11184810,r=0<=L.print?L.print:7829248,t;const o=!0,_=.2,E=[],a=L.toolMode,M=L.lineWidth,Z={face:e,line:O?1:e,opacity:O?.5:1},j={face:r,line:O?1:r,opacity:O?.5:1};let n=1/0,s=L.maxspeed||0,i=[];for(t of w)for(var l of t)l.speed&&(n=Math.min(n,l.speed),s=Math.max(s,l.speed)),a&&void 0!==l.tool&&i.indexOf(l.tool)<0&&i.push(l.tool);self.worker.print.minSpeed=n,self.worker.print.maxSpeed=s,self.worker.print.thinColor=C,self.worker.print.flatColor=O;let T=null,F=null,H=null,R=null,V=null,I=null,N=!1,W=0;function q(e){return a?Q(i.indexOf(e.tool),i.length):Q(e.speed,s)}return w.forEach((e,r)=>{const o={},n=[],s=[],i=[],l=[],c=[],p=[];var t=[];const a=new D.Layers;E.push(a);const g=(e,r)=>{e=e||0;const t=o[e]=o[e]||[];var e=A[e]||{};t.width=(M||e.extNozzle||1)/2,t.push(r),d++};var h=e.height/2,f=1,b,t;let d=0;if(e.forEach(r=>{if(!r.gcode){N&&r.emit&&(N=!1,c.push(R));let e=r.point;var t,t,o,a;e&&e.a&&({point:t}=r,t=new THREE.Vector3(t.x,t.y,t.z).applyAxisAngle(J,t.a*K),e=B.newPoint(t.x,t.y,t.z)),r.tool!==T&&(T=r.tool,i.push(e)),r.retract&&(l.push(e),N=!0,W++),e&&(H?(s.push({p1:R,p2:e}),o=e,a=R,r.emit?(!H.emit||P&&r.speed!==H.speed||F)&&(V=G().setOpen(),V.push(R),V.color=q(r),g(r.tool,V)):(H.emit||F)&&(V=G().setOpen(),V.push(R),n.push(V)),V.push(e),"laser"===r.type&&(V.isLaser=!0,r.emit&&(H.emit&&r.emit===H.emit||(I=G().setOpen(),I.push(R),I.color=Q(r.emit,1),p.push(I)),I.push(e))),F=null):(V=G().setOpen(),V.push(e),r.emit?(V.color=q(r),g(r.tool,V)):n.push(V)),H=r,R=e)}}),H){if(F=H,H.emit&&!d&&g(H.tool,V),p.length)for(var u of p)a.setLayer("power",{line:85,face:255,opacity:.5},!0).addPolys([u],{thin:!0,z:L.z,color:u.color});i.length&&a.setLayer("tool",{line:85,face:255,opacity:.5},!0).addAreas(i.map(e=>G().centerCircle(e,.2,4).setZ(e.z+.03)),{outline:!0}),l.length&&a.setLayer("retract",{line:5570560,face:16711680,opacity:.5},!0).addAreas(l.map(e=>G().centerCircle(e,.2,5).setZ(e.z+.01)),{outline:!0}),c.length&&a.setLayer("engage",{line:21760,face:65280,opacity:.5},!0).addAreas(c.map(e=>G().centerCircle(e,.2,7).setZ(e.z+.02)),{outline:!0}),C&&t.length&&(b=x?16777215:1122867,a.setLayer("sparks",{face:S,line:b,opacity:.75},!0).addLines(t,{thin:!0})),C&&s.length&&(t=x?16777215:1122867,a.setLayer("arrows",{face:S,line:t,opacity:.75},!0).addAreas(s.map(e=>{const{p1:r,p2:t}=e;var o=t.slopeTo(r),a=B.newSlopeFromAngle(o.angle+20),o=B.newSlopeFromAngle(o.angle-20),a=e.p2.projectOnSlope(a,_),o=e.p2.projectOnSlope(o,_);return G().addPoints([t,a,o]).setZ(t.z+.01)}),{thin:!0,outline:!0})),a.setLayer(L.other||"move",Z,!0!==L.moves).addPolys(n,{thin:!0,z:L.z});var k=e.z?e.z-h:L.z,m;for(m of Object.values(o))for(var y of m){O&&y.appearsClosed()&&(y.setClosed(),y.points.pop());var v=y.isLaser?"speed":L.action||"print";a.setLayer(v,j).addPolys([y],C?{thin:C,z:L.z,color:y.color}:O?{flat:O,z:k,color:y.color,outline:!0,offset:m.width,open:y.open}:{offset:m.width,height:h,z:k,color:{face:y.color,line:y.color}})}z(r/w.length,a)}}),E}r({path:s,is_dark:c,rate_to_color:Q});var r={simple:h.bind({seg:3,fn:k}),light:h.bind({seg:4,fn:b}),light2:h.bind({seg:4,fn:d}),light_cam:h.bind({seg:2,fn:b}),dark:h.bind({seg:4,fn:u}),dark_cam:h.bind({seg:2,fn:u})};let i=r.light2,l=r.dark,p=r.light_cam,g=r.dark_cam;function h(e,r,t){var o,a=1/this.seg,n=Math.floor(e/a),s,a=(e-n*a)/a,i=1-a;const l={r:0,g:0,b:0};return this.fn(l,a,n),l.r=(255*l.r*t&255)<<16,l.g=(255*l.g*t&255)<<8,l.b=255*l.b*t&255,l.r|l.g|l.b}function f(e,r,t){var o=1-r;switch(t){case 0:e.r=1,e.g=r,e.b=0;break;case 1:e.r=o,e.g=1,e.b=0;break;case 2:e.r=0,e.g=o,e.b=r;break;case 3:e.r=r,e.g=0,e.b=1;break;case 4:e.r=o,e.g=0,e.b=o}}function b(e,r,t){var o=1-r;switch(t){case 0:e.r=.8,e.g=.75*r,e.b=0;break;case 1:e.r=.8*o,e.g=.75,e.b=0;break;case 2:e.r=0,e.g=.75*o,e.b=r;break;case 3:e.r=.75*r,e.g=0,e.b=1;break;case 4:e.r=.85,e.g=0,e.b=1}}function d(e,r,t){var o=1-r;switch(t){case 0:e.r=.9,e.g=.9*r,e.b=0;break;case 1:e.r=.9*o,e.g=.8,e.b=0;break;case 2:e.r=0,e.g=.8*o,e.b=r;break;case 3:e.r=.9*r,e.g=0,e.b=1;break;case 4:e.r=.9,e.g=0,e.b=1}}function u(e,r,t){var o=1-r;switch(t){case 0:e.r=1,e.g=r,e.b=0;break;case 1:e.r=o,e.g=1,e.b=0;break;case 2:e.r=0,e.g=.85*o+.25,e.b=r;break;case 3:e.r=.85*r,e.g=.25,e.b=1;break;case 4:e.r=.85,e.g=.25,e.b=1}}function k(e,r,t){var o=1-r;switch(t){case 0:e.r=0,e.g=r,e.b=1;break;case 1:e.r=r,e.g=1,e.b=0;break;case 2:e.r=1,e.g=o,e.b=0;break;case 3:e.r=o,e.g=0,e.b=0}}});"use strict";gapp.register("kiri-mode.cam.prepare",[],(e,t)=>{const{base:n,kiri:a}=e,{paths:r,polygons:i,newPoint:Pe}=n,{tip2tipEmit:Ee,poly2polyEmit:be}=r,{driver:o,render:s}=a,{CAM:Ae}=o,Ce=i;function p(e,l,u,t,i){if(0===e.camops.length||e.meta.disabled)return;let n=l.device,r=l.process,m=r.camStockIndexed,o=r.camOriginCenter,a=l.controller.alignTop,f=l.stock||{},d=f.z*(m?.5:1),s=l.bounds||e.getPositionBox(),p=s.max.z,c=e.slices,h=r.camZClearance||1,z=r.camForceZMax||!1,g=d+h,v=e.track.top,y=d-v,x=e.getBoundingBox(),k=m?f.z/2:x.max.z+y,w=m?a?p-k:0:f.z-k,O=p+h+r.camOriginOffZ,Z=e.track.pos,M=Z.x,T=Z.y,D=(o?0:-f.x/2)+r.camOriginOffX,P=(o?0:-f.y/2)+r.camOriginOffY,E=Pe(D+M,P+T,O),b=u.output,A=r.camEaseDown,C=r.camDepthFirst,F=0,S=0,_=0,j=0,B=!1,I=0,L=u.output||[],U=[],G,N,R,X,Y,q,H,J,K=r.camFastFeedZ,Q,V,W,$,ee,te=!0,ne=!1,re=0,ie=n.spindleMax,oe=e.maxToolDiam,le=e.terrain?e.terrain.map(e=>({z:e.z,tops:e.tops})):O;function ae(e){(U.length||U.mode)&&L.push(U),U=[],U.mode=e||ee,U.spindle=re}function se(e){e&&e.length&&(Array.isArray(e)||(e=e.trim().split("\n")),L.push([{gcode:e}]),U.length&&(U=[],U.mode=ee,U.spindle=re))}function pe(e){F=e}function ce(e){ke.printPoint=G=e}function ue(e){re=Math.min(e,ie)}function fe(e,t,n){e!==V&&(Y=new Ae.Tool(l,e),q=Y.getType(),H=Y.fluteDiameter(),J="endmill"===q?H:2*F,V=e),Q=t||Q||n,K=Math.min(Q||n,n||K||Q)}function me(e,t=0){B=e?ee:void 0,I=t}function de(e,t,n){S=e,_=t,j=n}function he(o){for(o=o.slice();;){let t=1/0,n,r=null,i;for(let e=0;e<o.length;e++)o[e]&&(i=o[e].first().distTo2D(G))<t&&(t=i,r=o[e],n=e);if(!r)return;o[n]=null,G=r.first(),ze(r,S,_,j)}}function ze(e,t,n,r){let i=e.first().z-e.last().z,o=[],l=e.first();for(t<=0&&(t=i);;){if(!(i>2*t)){if(i<t){o.push(l.clone()),l.z-=i,o.push(l.clone());break}o.push(l.clone()),l.z-=i/2,o.push(l.clone()),l.z-=i/2,o.push(l.clone());break}o.push(l.clone()),l.z-=t,i-=t}ye(l.clone().setZ(O)),o.forEach(function(e,t){ye(e,1),0<t&&t<o.length-1&&(r&&ve(r),n&&ye(e.clone().setZ(e.z+n),0))}),ye(l.clone().setZ(O)),ae()}function ge(n,e,r,i){var t;if((n&&W&&W.point?n.z-W.point.z:0)<0&&r>K&&(r=K),U.mode=ee,B){let t=e?I:0;if(e&&B.adapt){var{minz:o,maxz:l,minp:a,maxp:s,adaptrp:p}=B,l,c=(l=l||v)-o;let{z:e}=n;if(p){for(;e>l;)e-=c;for(;e<o;)e+=c}else if(e<o||e>l)return n;e-=o,t=a<s?a+e/c*(s-a):a-e/c*(a-s)}B.flat&&(n.z=(f&&f.z?f.z:v)+B.flatz),u.addOutput(U,n,t,r,i,"laser")}else u.addOutput(U,n,e,r,i);return W={point:n,emit:e,speed:r,tool:i},n}function ve(e){ge(null,0,e,Y)}function ye(o,e,t=J,n=1){(o=o.clone()).x+=M,o.y+=T,o.z+=w,void 0===o.a&&$&&(o.a=$.a),te&&(e=0,te=!1);let r=Q*n;var n,i,l;$||(n=o.clone().setZ(d+h),$=ge(n,0,0,Y));let a=$.distTo2D(o),s=o.z-$.z,p=Math.abs(s),c=!e;if(X||!(a<.001)||o.z!==$.z){if(!R&&c&&a<=t&&s<=0&&!B){var u=0<F,f;p<.001||u&&p<=F?(e=1,c=!1):s<=-F&&(ge(o.clone().setZ($.z),0,0,Y),a=0)}else if(c&&X)o.z>$.z?ge($.clone().setZ(o.z),0,0,Y):o.z<$.z&&ge(o.clone().setZ($.z),0,0,Y);else if(c){var u=a>t&&!B,t=s>H/2&&a>F,i=F&&p>=F,l;if(u||t||i){let e=Fe(le,$.x-M,$.y-T,o.x-M,o.y-T,Math.max(o.z,$.z),w,oe/2,h),t=Math.max(e-o.z,e-$.z),n=t>=F,r=e,i=o.z<=e;z&&(r=e=O+w,i=!0),(n||i)&&(l=r+(m?0:y),i&&ge($.clone().setZ(l),0,0,Y),ge(o.clone().setZ(l),0,0,Y),a=0)}else R&&s<0&&ge(o.clone().setZ($.z),0,0,Y)}!B&&s<-F&&!X&&(l=(i=Math.min(a/2,p))/p,ne&&i&&l&&a>F?(r=Math.round(K+(Q-K)*l),e=1):r=Math.min(Q,K)),U.mode=ee,U.spindle=re,$=ge(o,e?1:0,r,Y)}}$=t,G=t||E;var xe={rough:[],outline:[],roughDiam:0,outlineDiam:0,contourx:[],contoury:[],trace:[],drill:[],layer:0},e;let ke={stock:f,setTool:fe,setDrill:de,setSpindle:ue,setTolerance:pe,setPrintPoint:ce,setLasering:me,printPoint:G,newLayer:ae,addGCode:se,camOut:ye,polyEmit:Me,poly2polyEmit:be,tip2tipEmit:Ee,depthRoughPath:Te,depthOutlinePath:De,emitDrills:he,emitTrace:Ze,bounds:x,zclear:h,zmax:O,lastPoint:()=>$},we=0,Oe=e.camops.map(e=>e.weight()).reduce((e,t)=>e+t);for(let r of e.camops){pe(0),te=!0,ee=r.op,X="lathe"===ee.type,R="rough"===ee.type;let n=r.weight();ae(r.op),r.prepare(ke,(e,t)=>{i((we+e*n)/Oe,t||r.type(),t)}),we+=n,Y&&$&&(ae(),ge(G=$.clone().setZ(O+w),0,0,Y),ae())}function Ze(e){var{tool:t,rate:n,plunge:r}=e.camTrace;fe(t,n,r);let i=new Ae.Tool(l,t);var o=i.fluteDiameter();G=be(e.camLines,G,Me,{swapdir:!1}),ae()}function Me(e,t,i,n){let o=null;return A&&e.isClosed()?o=e.forEachPointEaseDown(function(e,t){ye(e.clone(),0<t,void 0,R&&1===i?.5:1)},n):e.forEachPoint(function(e,t,n,r){ye((o=e).clone(),0!==r,void 0,R&&1===i?.5:1)},e.isClosed(),t),ae(),o}function Te(e,o,l,a,s,t,p){let c=l[o];if(!c||!c.length)return e;let n=a[o],r=t?n.filter(e=>e.isInside(t,.01)):n,i=r.filter(e=>!e.level_emit);function u(t,e,n,r){t.level_emit=!0;var i=c.filter(e=>e.isInside(t));return p&&(r.z+=p),r=be(i,r,s,{mark:"emark",perm:!0,swapdir:!1}),p&&(r.z+=p),r=Te(r,o+1,l,a,s,t,p)}1<i.length&&(i=Ce.route(i,e));var f=i.filter(e=>e.open),m=i.filter(e=>!e.open);return be(m,e,u,{mark:"emark",swapdir:!1}),be(f,e,u,{mark:"emark",swapdir:!1}),e}function De(e,i,o,l,a,s,p){var t=i<o.length-1?o[o.length-1]:null;let n=o[i-1],r=o[i];return r?(n&&(r=r.filter(t=>{var e;return 0===n.filter(e=>!e.level_emit&&t.isNear(e,l,!0)).length})),r=r.filter(e=>!e.level_emit),r=r.filter(e=>e.isClockwise()===s),e=be(r,e,(e,t,n,r)=>(e.level_emit=!0,p&&(r.z+=p),r=Me(e,t,n,r),p&&(r.z+=p),r=De(r,i+1,o,l,a,s,p),r=De(r,i+1,o,l,a,!s,p)),{weight:!1,swapdir:!1})):e}return $&&L.length&&(e=L.filter(e=>Array.isArray(e)).peek(),Array.isArray(e)&&u.addOutput(e,G=$.clone().setZ(g),0,0,Y)),u.output=L,G}function Fe(t,n,o,l,a,r,s,p,c){if(0<t)return t;let u=r,f=[];for(let e=0;e<t.length;e++){var i=t[e];if(f.push(i),i.z+s<r)break}f.reverse();for(let t=0;t<f.length;t++){let e=f[t],r=Pe(n,o),i=Pe(l,a);var m;if((m=e.tops.map(e=>e.intersections(r,i,!0)).flat()).length)u=Math.max(u,e.z+s+c);else{var d=r.slopeTo(i).toUnit().normal(),h=i.slopeTo(r).toUnit().normal();let t=r.projectOnSlope(d,p),n=i.projectOnSlope(d,p);(m=e.tops.map(e=>e.intersections(t,n,!0)).flat()).length?u=Math.max(u,e.z+s+c):(t=r.projectOnSlope(h,p),n=i.projectOnSlope(h,p),(m=e.tops.map(e=>e.intersections(t,n,!0)).flat()).length&&(u=Math.max(u,e.z+s+c)))}}return u}Ae.prepare=async function(e,t,r){var n;const i=1/(e=e.filter(e=>!e.track.ignore&&!e.meta.disabled)).length,o=self.worker.print=a.newPrint(t,e);o.output=[];let l;e.forEach((e,n)=>{l=p(e,t,o,l,(e,t)=>{r(.75*(n*i+e*i),t||"prepare")})});var e=o.output.filter(e=>Array.isArray(e));if(s)return s.path(e,(e,t)=>{r(.75+.25*e,"render",t)},{thin:!0,print:0,move:5601177,speed:!1,moves:!0,other:"moving",action:"milling",maxspeed:t.process.camFastFeed||6e3})}});"use strict";gapp.register("kiri-mode.cam.slice",[],(e,t)=>{const{base:h,kiri:V}=e,{driver:o,newSlice:X,setSliceTracker:Y}=V,{polygons:n,newPoint:$,newPolygon:G}=h,{CAM:J}=o,{OPS:K}=J;var r=J.process;const N=n;function W(e,t,o,n){return ee(e=e.filter(e=>o<e.pos.z+e.dim.z/2).map(e=>e.off).flat(),t,o,!1)}function ee(t,e,o,n){let r=[];return e.forEach(e=>r.appendAll(e.cut(N.union(t,0,!0),n))),te(r)}function te(t){if(1<t.length){let e=0;e:for(;;e++){let r=t,e=r.length;for(let n=0;n<e;n++){let o=r[n];if(o)for(let t=n+1;t<e;t++){let e=r[t];if(e&&(!(.01<Math.abs(o.getZ()-e.getZ()))&&o.open&&e.open)){if(o.last().isMergable2D(e.first())){o.addPoints(e.points.slice(1)),r[t]=null;continue e}if(e.last().isMergable2D(o.first())){e.addPoints(o.points.slice(1)),r[n]=null;continue e}if(o.first().isMergable2D(e.first())){o.reverse(),o.addPoints(e.points.slice(1)),r[t]=null;continue e}if(o.last().isMergable2D(e.last())){e.reverse(),o.addPoints(e.points.slice(1)),r[t]=null;continue e}}}}break}for(var o of t=0<e?t.filter(e=>e):t)o.open&&o.first().isMergable2D(o.last())&&(o.points.pop(),o.open=!1)}return t}J.slice=async function(e,a,r,t){let o=a.mesh,n=e.process,s=e.stock||{},i=n.camStockIndexed,l=a.camops=[],p=a.slices=[],c=a.getBoundingBox(),f=a.track,u=f.top,d=i?0:s.z-u,m=i?0:u-f.box.d,h=i?n.camZBottom:n.camZBottom-m,g=i?c.min.z:Math.max(c.min.z,h),w=c.max.z,y=!n.camZBottom&&n.camZThru||0,x=w+d,v=1/0,z=-1/0,b=!!e.controller.dark,k=b?12303291:0,A=a.anno.tab,T=n.camExpertFast,E="in"===e.controller.units?25.4:1,M,D;function P(e){t(e)}if(A&&A.forEach(e=>{var t=$(0,0,0),o=$(e.pos.x,e.pos.y,e.pos.z);let n=G().centerRectangle(t,e.dim.x,e.dim.y);var r=X(0);let s=(new THREE.Matrix4).makeRotationFromQuaternion(new THREE.Quaternion(e.rot._x,e.rot._y,e.rot._z,e.rot._w));n.points=n.points.map(e=>new THREE.Vector3(e.x,e.y,e.z).applyMatrix4(s)).map(e=>$(e.x,e.y,e.z)),n.move(o),e.poly=n}),T&&console.log("disabling overhang safeties"),!n.ops||0===n.ops.length)return P("no processes specified");if(s.x&&s.y&&s.z){if(s.x+1e-5<c.max.x-c.min.x)return P("stock X too small for part. resize stock or use offset stock");if(s.y+1e-5<c.max.y-c.min.y)return P("stock Y too small for part. resize stock or use offset stock");if(s.z+1e-5<c.max.z-c.min.z)return P("stock Z too small for part. resize stock or use offset stock")}if(g>=c.max.z)return P(`invalid z bottom ${(g/E).round(3)} >= bounds z max `+(w/E).round(3));var S=Date.now(),O=new V.cam_slicer(a),Z;function _(e){v=Math.min(v,e),z=Math.max(z,e)}let F={};function j(t){var e=F[t],o,n;if(e)return e;let r;for(n of Object.keys(F).map(e=>parseFloat(e)).filter(e=>t<e))r=(r&&(n,r),n);let s=J.shadowAt(a,t,r);return r&&(s=N.union([...s,...F[r]],.001,!0)),F[t]=N.setZ(s,t)}function B(e=0,t=!0){return D=t?e:D+e,M=Math.PI/180*D,a.setAxisIndex(i?-D:0),i?-D:0}function I(e,t){if(e)if(Array.isArray(e))for(var o of e)I(o,t);else{for(var n of e.points)n.a=t;I(e.inner,t)}}function R(e,t=i){if(Array.isArray(e)||(e=[e]),p.appendAll(e),t&&void 0!==D)for(var o of e.filter(e=>e.camLines))I(o.camLines,-D)}let L={settings:e,widget:a,bounds:c,tabs:A,cutTabs:W,cutPolys:ee,healPolys:te,shadowAt:j,slicer:O,addSlices:R,isIndexed:i,setAxisIndex:B,updateToolDiams:_,zBottom:h,zThru:y,ztOff:d,zMax:w,zTop:x,unsafe:T,color:k,dark:b},H=[new J.OPS.shadow(L,{type:"shadow",silent:!0})];let C=0,Q=H.length?H.map(e=>e.weight()).reduce((e,t)=>e+t):0;for(Z of n.ops.filter(e=>!e.disabled)){if("|"===Z.type)break;let t=K[Z.type];if(t){let e=new t(L,Z);H.push(e),Q+=e.weight()}}L.ops=H;let U=Y({rotation:0});B();for(let n of H){let o=n.weight();await n.slice((e,t)=>{r((C+e*o)/Q,t||n.type())}),U.rotation=i?M:0,"index"===n.op.type&&(a.topo=void 0,L.slicer=new V.cam_slicer(a),F={},await new J.OPS.shadow(L,{type:"shadow",silent:!0}).slice(e=>{})),l.push(n),C+=o}Y(),p.forEach((e,t)=>e.index=t),A&&L.terrain.forEach(t=>{A.forEach(e=>{var e;e.pos.z+e.dim.z/2>=t.z&&(e=[...t.tops,e.poly],t.tops=N.union(e,0,!0))})});var O=A?A.map(e=>e.poly):[],O=N.union([...L.shadowTop.tops,...O,...L.shadowTop.slice.shadow],0,!0);let q=z<0?O:N.offset(O,[v/2,z/2],{count:2,flat:!0});L.terrain.forEach(e=>e.tops.appendAll(q)),a.terrain=L.skipTerrain?null:L.terrain,a.minToolDiam=v,a.maxToolDiam=z,t()},J.addDogbones=function(e,t,o){if(Array.isArray(e))return e.forEach(e=>J.addDogbones(e,t));var n=e.open;let r=e.isClockwise();(o||e.parent)&&(r=!r);var s=e.points.slice();let a=s[s.length-1],i=a.slopeTo(s[0]).toUnit();var l=s.length+(n?0:1);let p=[];for(let e=0;e<l;e++){var c=s[e%s.length],f=a.slopeTo(c).toUnit(),u=i.angleDiff(f,!0),d=(u<0?180-u:180+u)/2+180,m,d;(!n||1<e&&e<l)&&(r&&45<u?(m=h.newSlopeFromAngle(i.angle+d),p.push(a.projectOnSlope(m,t)),p.push(a.clone())):!r&&u<-45&&(d=h.newSlopeFromAngle(i.angle-d),p.push(a.projectOnSlope(d,t)),p.push(a.clone()))),i=f,a=c,e<s.length&&p.push(c)}e.points=p,e.inner&&J.addDogbones(e.inner,t,!0)},J.traces=async function(e,t,o){if(t.traces&&t.trace_single===o)return!1;let n=new V.cam_slicer(t);var r=Object.assign({},n.zFlat,n.zLine),r=[...new Set(Object.keys(r).map(e=>parseFloat(e).round(5)).appendAll(Object.entries(o?n.zLine:{}).map(e=>{var[t,e]=e;return 1<e?parseFloat(t).round(5):null}).filter(e=>null!==e)))].sort((e,t)=>t-e),s;let a=[],i={each:e=>{if(o)for(var t of e.lines)1<t.p1.distTo2D(t.p2)&&a.push(G().append(t.p1).append(t.p2).setOpen());else h.polygons.flatten(e.tops).forEach(o=>{o.inner=null,o.parent=null;var n=o.getZ();for(let t=0,e=a.length;t<e;t++){let e=a[t];var r=Math.abs(n-e.getZ());if(!(r<.01)&&(a[t].isEquivalent(o)&&r<.1))return}a.push(o)})},over:!1,flatoff:0,edges:!0,openok:!0,lines:!0};return await n.slice(r,i),i.over=!0,await n.slice(r,i),t.traces=a,t.trace_single=o,!0}});"use strict";gapp.register("moto.broker",[],(t,i)=>{class s{constructor(){this.topics={},this.used={},this.send={}}topics(){return Object.keys(this.topics)}listeners(t,i){for(var[s,e]of Object.entries(t))"function"==typeof e&&(s=i?i+"_"+s:s,this.subscribe(s,e))}subscribe(s,e){if(Array.isArray(s)){for(var t of s)this.subscribe(t,e);return this}if("string"==typeof s){let t=this.topics,i=t[s];if(i=i||(t[s]=[]),i.indexOf(e)<0){let t=this.send;var r=s.replace(/[\\ \.-]/g,"_");t[r]=t[r]=this.bind(s),i.push(e),this.publish(".topic.add",s)}return this}console.trace({invalid_topic:s})}unsubscribe(t,i){let s=this.topics[t];var i;s&&((i=s.indexOf(i))<0||(s.splice(i,1),0===s.length&&(delete this.topics[t],this.publish(".topic.remove",t))))}publish(t,i,s={}){if(!Array.isArray(t)){".topic.publish"!==t&&this.publish(".topic.publish",{topic:t,message:i,options:s}),this.used[t]=i;var e=this.topics[t];if(e&&e.length)for(var r of e)try{r(i,t,s)}catch(t){setTimeout(()=>{throw t},1)}else t.indexOf(".topic.")<0&&(self.dbug?self.dbug.debug(`undelivered '${t}'`,i):console.log(`undelivered '${t}'`,i));return i}for(var o of t)this.publish(o,i,s)}bind(s,e,r){let o=this;return function(t,i){o.publish(s,e||t,r||i)}}wrap(t,i){let s=this;return function(){return s.publish(t,i(...arguments))}}wrapObject(t,i){for(var[s,e]of Object.entries(t))"function"==typeof e&&(t[s]=this.wrap(i+"_"+s,e))}}const{moto:e}=t;gapp.broker=e.broker=new s});"use strict";gapp.register("kiri-mode.cam.slicer",[],(e,t)=>{const{base:s,kiri:_,moto:n}=e,{config:i,util:O,polygons:o,newOrderedLine:r,newPoint:P,newLine:l}=s,{sliceConnect:f,sliceDedup:z}=s,{newSlice:B}=_,m=o,c=!1,L=function(){0},A=function(){0};class a{constructor(e,t={zlist:!0,zline:!0,lines:!1}){this.options={},this.setOptions(t),e&&(this.setPoints(e.getGeoVertices({unroll:!0,translate:!0})),this.computeFeatures())}get threaded(){return this.options.threaded}setOptions(e){return Object.assign(this.options,e||{}),this.options}setPoints(e){return this.bounds=null,this.points=e,this.zFlat={},this.zLine={},this.zList={},this}computeFeatures(e){L("compute features");var s=this.setOptions(e);const n=this.bounds=new THREE.Box3;var i=this.points,o,r,o,r,l,c,l,c;const a=this.zFlat,h=this.zLine,t=this.zList;function u(e){e=e.round(5),t[e]=(t[e]||0)+1}let p=P(0,0,0),d=P(0,0,0),f=P(0,0,0);for(let e=0,t=i.length;e<t;){p.set(i[e++],i[e++],i[e++]),d.set(i[e++],i[e++],i[e++]),f.set(i[e++],i[e++],i[e++]),n.expandByPoint(p),n.expandByPoint(d),n.expandByPoint(f),s.zlist&&(u(p.z),u(d.z),u(f.z)),p.z===d.z&&d.z===f.z?(o=p.z.toFixed(5),r=Math.abs(O.area2(p,d,f))/2,a[o]?a[o]+=r:a[o]=r):s.zline&&(p.z===d.z&&(o=p.z.toFixed(5),r=h[o],h[o]=(r||0)+1),d.z===f.z&&(l=d.z.toFixed(5),c=h[l],h[l]=(c||0)+1),f.z===p.z&&(l=f.z.toFixed(5),c=h[l],h[l]=(c||0)+1))}return A("compute features"),this}async slice(s,e){const n=this.setOptions(e);if(!Array.isArray(s))throw"slice zs parameter must be ab array";const i=O.numOrDefault(n.flatoff,.01);s=s.sort((e,t)=>e-t).map(e=>{if(!i)return e;var t=e.toFixed(5);return this.zFlat[t]?e+i:e});var{points:o}=this,e=o.length,r=s.length,t=e/r,l=25,c=Math.ceil(r/25);const a=[];for(let e=0,t=0;e<25&&!(t>=r);e++)a.push({zs:s.slice(t,t+c),index:[]}),t+=c;let h=P(0,0,0),u=P(0,0,0),p=P(0,0,0),d=.001;L("create buckets");for(let e=0,t=o.length;e<t;){h.set(o[e++],o[e++],o[e++]),u.set(o[e++],o[e++],o[e++]),p.set(o[e++],o[e++],o[e++]);var f=Math.min(h.z,u.z,p.z),z=Math.max(h.z,u.z,p.z),m;for(m of a){const{zs:s,index:M}=m;var g=Math.min(...s),b=Math.max(...s);f<g&&z<g&&Math.abs(f-g)>d&&Math.abs(z-g)>d||b<f&&b<z&&Math.abs(f-b)>d&&Math.abs(z-b)>d||M.push(h.x,h.y,h.z,u.x,u.y,u.z,p.x,p.y,p.z)}}A("create buckets"),L("slicing");const{minions:v}=_;var e=v&&v.running,y;const x=(e?this.sliceBucketMinion:this.sliceBucket).bind(this),k={count:0,total:s.length};e&&v.broadcast("cam_slice_init",{});const w=[];for(y of a)w.push(x(y,{...n,minZ:this.bounds.min.z},e=>{k.count++,n.progress&&n.progress(k.count,k.total)}));const F=(await Promise.all(w)).flat();return F.sort((e,t)=>t.z-e.z).forEach((e,t)=>{e.tops=e.polys,e.slice=B(e.z).addTops(e.tops),n.each&&n.each(e,t,F.length)}),e&&v.broadcast("cam_slice_cleanup"),A("slicing"),F}async sliceBucketMinion(t,s,e){const{decode:n,decodePointArray:i}=_.codec;var o=(await new Promise(e=>{_.minions.queue({cmd:"cam_slice",opt:Object.clone(s),bucket:t},e)})).slices,r;for(r of o)r.polys=n(r.polys),r.lines&&(r.lines=i(r.lines).group(2).map(e=>l(e[0],e[1]))),e(r);return o}async sliceBucket(e,t,s){var{zs:e,index:n}=e,i;const o=[];for(i of e){var r=this.sliceZ(i,n,t);r&&o.push(r),s(r)}return o}sliceZ(s,e,t){let n=!1!==t.links,i=!1!==t.dedup,o=t.edges||!1,r=t.over||s<=t.minZ,l=t.debug,c={},a=[];const h=e,u=P(0,0,0),p=P(0,0,0),d=P(0,0,0);for(let e=0;e<h.length;){u.set(h[e++],h[e++],h[e++]),p.set(h[e++],h[e++],h[e++]),d.set(h[e++],h[e++],h[e++]);let t={under:[],over:[],on:[]};if(g(u,s,t),g(p,s,t),g(d,s,t),3!==t.under.length&&3!==t.over.length)if(2===t.on.length)(r&&1===t.over.length||!r&&1===t.under.length)&&a.push(v(c,t.on[0],t.on[1],!1,!0));else if(3!==t.on.length&&0!==t.under.length&&0!==t.over.length&&!o){let e=b(t.over,t.under,s);e.length<2&&1===t.on.length&&e.push(t.on[0].clone()),2===e.length?a.push(v(c,e[0],e[1])):console.log({msg:"invalid ips",line:e,where:t})}}return i&&(a=z(a,l)),a.length?{z:s,lines:!1!==t.lines?a:void 0,polys:n?m.nest(f(a,t,l)):void 0}:null}interval(t,e){let s=e||{},n=this.bounds,i=s.boff||s.off||0,o=s.toff||s.off||0,r=void 0!==s.min?s.min:n.min.z+i,l=(s.max||n.max.z)-o,c=(l-r)/t,a=c%1!=0?0:1,h=Math.floor(c)+a,u=[];if(s.fit&&(h++,t=(l-r)/h),s.down)for(let e=0;e<h;e++)u.push(l),l-=t;else for(let e=0;e<h;e++)u.push(r),r+=t;if(s.fit&&u.push(s.down?l:r),s.flats&&s.off){let t=[];Object.keys(this.zFlat).forEach(e=>{e=parseFloat(e),t.push(e+s.off),e>r&&t.push(e-s.off)}),u.appendAll(t).sort((e,t)=>s.down?t-e:e-t)}return u=u.map(e=>e.round(5)).filter((e,t,s)=>t<1||s[t-1]!==s[t]),u.map(e=>parseFloat(e.toFixed(5)))}}function g(e,t,s){var t=e.z-t;(Math.abs(t)<i.precision_slice_z?s.on:t<0?s.under:s.over).push(e)}function b(s,n,i){let o=[];for(let t=0;t<s.length;t++)for(let e=0;e<n.length;e++)o.push(s[t].intersectZ(n[e],i));return o}function h(e,t){var s=e[t.key];return s||(e[t.key]=t)}function v(e,t,s,n,i){t=h(e,t.clone()),s=h(e,s.clone());let o=r(t,s);return o.coplanar=n||!1,o.edge=i||!1,o}a.checkOverUnderOn=g,a.intersectPoints=b,_.cam_slicer=a,n.broker.subscribe("minion.started",e=>{const{funcs:t,cache:o,reply:r,log:s}=e;t.cam_slice_init=()=>{o.slicer=new a},t.cam_slice_cleanup=()=>{delete o.slicer},t.cam_slice=(e,t)=>{var{bucket:s,opt:e}=e;const{encode:n,encodePointArray:i}=_.codec;o.slicer.sliceBucket(s,e,e=>{}).then(e=>{e.forEach(e=>{var t;e.polys=n(e.polys),e.lines&&(t=e.lines.map(e=>[e.p1,e.p2]).flat(),e.lines=i(t))}),r({seq:t,slices:e})})}})});"use strict";gapp.register("kiri-mode.cam.slicer2",[],(e,n)=>{const{base:u,kiri:t}=e,{config:r,newOrderedLine:s,newPoint:x}=u;class i{static intersectPoints=f;static checkOverUnderOn=d;static removeDuplicateLines=k;constructor(e=0){this.min=1/0,this.max=-1/0,this.index=e}setFromArray(n,t={}){var r=t.min||-1/0,i=t.max||1/0,o=n.length;const s=this.points=[];for(let e=0;e<o;){var h=n[e++],u=n[e++],l=n[e++],p=n[e++],a=n[e++],g=n[e++],c=n[e++],m=n[e++],d=n[e++],f=Math.min(l,g,d),v=Math.max(l,g,d);v<r||i<f||(s.push(x(h,u,l),x(p,a,g),x(c,m,d)),this.min=t.min||Math.min(this.min,f),this.max=t.max||Math.max(this.max,v))}return this}setFromPoints(n,t={}){const r=this.points=[];var i=n.length,o=t.min||-1/0,s=t.max||1/0;for(let e=0;e<i;){var h=n[e++],u=n[e++],l=n[e++],p=Math.min(h.z,u.z,l.z),a=Math.max(h.z,u.z,l.z);a<o||s<p||(r.push(h,u,l),this.min=t.min||Math.min(this.min,p),this.max=t.max||Math.max(this.max,a))}return this}slice(n=1){const t=[];for(let e=this.min;e<this.max;e+=n)t.push({z:e,index:this.index++,lines:this.sliceZ(e)});return t}sliceZ(n,e={}){var t=this.points,r=this.min,i=this.max,o={},s,h,u;const l=[];let{under:p,over:a,both:g}=e;p||g||(a=!0);for(let e=0;e<t.length;){var s=t[e++],h=t[e++],u=t[e++],c={under:[],over:[],on:[]},m;if(d(s,n,c),d(h,n,c),d(u,n,c),3!==c.under.length&&3!==c.over.length)if(2===c.on.length){(g||a&&(1===c.over.length||n===i)||p&&(1===c.under.length||n===r))&&l.push(v(o,c.on[0],c.on[1],!1,!0))}else if(3!==c.on.length&&0!==c.under.length&&0!==c.over.length){let e=f(c.over,c.under,n);e.length<2&&1===c.on.length&&e.push(c.on[0]),2===e.length?l.push(v(o,e[0],e[1])):console.log({msg:"invalid ips",line:e,where:c})}}if(0!=l.length||!e.noEmpty)return k(l)}}function d(e,n,t){var n=e.z-n;(Math.abs(n)<r.precision_slice_z?t.on:n<0?t.under:t.over).push(e)}function f(t,r,i){let o=[];for(let n=0;n<t.length;n++)for(let e=0;e<r.length;e++)o.push(t[n].intersectZ(r[e],i));return o}function h(e,n){var t=e[n.key];return t||(e[n.key]=n)}function v(e,n,t,r,i){n=h(e,n),t=h(e,t);let o=s(n,t);return o.coplanar=r||!1,o.edge=i||!1,o}function k(e,t){let n=[],s=[],r=[],i={};function o(e){var n=i[e.key];return n||(r.push(e),i[e.key]=e)}function h(e,n){o(e),e.group?e.group.push(n):e.group=[n]}return e.sort(function(e,n){return e.key===n.key?(e.del=!e.edge,n.del=!n.edge,t&&(e.del||n.del)&&console.log("dup",e,n),0):e.key<n.key?-1:1}),e.forEach(function(e){e.del||(s.push(e),h(e.p1,e),h(e.p2,e))}),r.forEach(function(o){if(2==o.group.length){let r=o.group[0],i=o.group[1];if(r.isCollinear(i)){r.del=!0,i.del=!0;let e=r.p1!=o?r.p1:r.p2,n=i.p1!=o?i.p1:i.p2,t=u.newOrderedLine(e,n);e.group.remove(r),e.group.remove(i),n.group.remove(r),n.group.remove(i),e.group.push(t),n.group.push(t),t.edge=r.edge||i.edge,s.push(t)}}}),s.sort(function(e,n){return e.key===n.key?(e.del=!0,n.del=!n.edge,0):e.key<n.key?-1:1}),s.forEach(function(e){e.del||(n.push(e),e.p1.group=null,e.p2.group=null)}),n}t.topo_slicer=i});"use strict";gapp.register("kiri-mode.cam.tools",[],(t,e)=>{var{kiri:t}=t,{driver:t}=t;const{CAM:i}=t;var r=Math.PI/2;const l=180/Math.PI;class s{constructor(t,e,i){this.tool=(0<=i?t.tools.filter(t=>t.number==i):t.tools.filter(t=>t.id==e))[0],this.tool||(this.tool=Object.assign({},t.tools[0]),this.tool.number=0<=i?i:this.tool.number,this.tool.id=0<=e?e:this.tool.id)}getID(){return this.tool.id}getName(){return this.tool.name}getType(){return this.tool.type}getNumber(){return this.tool.number}isMetric(){return this.tool.metric}unitScale(){return this.isMetric()?1:25.4}fluteLength(){return this.unitScale()*this.tool.flute_len}fluteDiameter(){return this.unitScale()*this.tool.flute_diam}tipDiameter(){return this.unitScale()*this.tool.taper_tip}traceOffset(){return(this.isTaperMill()?this.tipDiameter():this.fluteDiameter())/2}contourOffset(t){var e=Math.min(this.isTaperMill()?this.tipDiameter():this.fluteDiameter());return e?e*t:t}setTaperLengthFromAngle(t){var e=(this.flute_diam-this.taper_tip)/2;return this.flute_len=i.calcTaperLength(e,t)}getTaperAngle(){return i.calcTaperAngle((this.flute_diam-this.taper_tip)/2,this.flute_len)}shaftLength(){return this.unitScale()*this.tool.shaft_len}shaftDiameter(){return this.unitScale()*this.tool.shaft_diam}isBallMill(){return"ballmill"===this.tool.type}isTaperMill(){return"tapermill"===this.tool.type}generateProfile(i){let t=this.getType(),r=this.isBallMill(),l=this.isTaperMill(),e=this.tipDiameter(),s=this.fluteLength(),a=this.fluteDiameter(),o=this.shaftDiameter(),h=Math.max(a,o),n=h/i,u=Math.round(n),f=n/2,m=a/2,p=a/i,c=p/2,g=e/i,M=g/2,T=c-M,D=u+(1-u%2),d=(u-u%2)/2,_=[],b=.001<o-a,y=c*c,A=-1/0;for(let e=0;e<D;e++)for(let t=0;t<D;t++){var S=e-d,v=t-d,L=Math.sqrt(S*S+v*v),x;if(L<=c){A=Math.max(A,S,v);let t=0;r?t=Math.sqrt(y-L*L)*i-m:l&&M<=L&&(t=(L-M)/T*-s),_.push(S,v,t)}}const w=new Float32Array(new SharedArrayBuffer(4*_.length));return w.set(_),this.profile=w,this.profileDim={size:o,pix:D+2,maxo:A},this}}i.Tool=s,i.calcTaperAngle=function(t,e){return Math.atan(t/e)*l},i.calcTaperLength=function(t,e){return t/Math.tan(e)},i.getToolDiameter=function(t,e){return new i.Tool(t,e).fluteDiameter()}});"use strict";gapp.register("kiri-mode.cam.topo",[],(t,e)=>{const{base:o,kiri:R,moto:s}=t,{driver:n,newSlice:dt}=R,{CAM:ut}=n,{polygons:a,newLine:r,newSlope:i,newPoint:H,newPolygon:g}=o;var c=ut.process;const ht=a,v=180/Math.PI;var l=Math.PI/180;class p{constructor(){}async generate(t={}){let{state:e,contour:o,onupdate:s,ondone:n}=t,{widget:a,settings:r,tshadow:i,center:c,tabs:l,color:p}=t.state,{controller:d,process:u}=r,h=2500*parseInt(d.animesh||100),m=o.axis.toLowerCase(),x="x"===m,f="y"===m,y=a.getBoundingBox().clone(),b=o.tolerance,g=o.flatness||b/100,v=i,w=y.min.x,z=y.max.x,M=y.min.y,X=y.max.y,Y=o.bottom?e.zBottom:0,T=Math.max(y.min.z,Y)+1e-4,_=z-w,A=X-M,Z=o.inside,E=1+(o.reduction||0),P=b||1/Math.sqrt(h/(_*A)),H=new ut.Tool(r,o.tool),B=H.generateProfile(P).profile,L=H.fluteDiameter(),q=L*o.step,C=o.leave||0,O=o.angle,S=o.curves,R=o.bridging||0,k=Math.ceil(_/P),V=Math.ceil(A/P),D=a.topo,I=D&&D.resolution===P&&D.diameter===L?D:void 0,j=a.topo=I||{data:new Float32Array(new SharedArrayBuffer(k*V*4)),stepsX:k,stepsY:V,bounds:y,diameter:L,resolution:P,profile:B,widget:a,raster:!0,slices:null},F=j.data,G=[],J=l?Math.max(...l.map(t=>t.dim.z/2+t.pos.z)):0,K=l,N=Math.max(u.camTabsHeight+Y,J),Q=K?[]:null,U=Z?v:ht.expand(v,L/2+3*P),W=Z?0:L/2+P,$=Math.floor(W/P),tt=!1,et=tt&&!0,ot=tt&&!0,st=tt&&!0,nt=tt&&!0,at=Date.now;if(0!==b||I||console.log(a.id,"topo auto tolerance",P.round(4)),this.tolerance=P,l&&Q.appendAll(l.map(e=>{let t=ht.expand([e.poly],L/2);return t.forEach(t=>t.z=e.dim.z/2+e.pos.z),t}).flat()),et){const tt=dt(-1),pt=tt.output();U&&pt.setLayer("clip.to",{line:56576}).addPolys(U),G.push(tt)}var rt=this.probe=new mt({profile:B,data:F,stepsX:k,stepsY:V,boundsX:_,boundsY:A,minX:w,minY:M,zMin:T}),{toolAtZ:it,toolAtXY:ct,zAtXY:t}=rt;this.toolAtZ=it,this.toolAtXY=ct,this.zAtXY=t;var lt=this.trace=new xt(rt,{curvesOnly:S,maxangle:O,flatness:g,bridge:R,contourX:x}),rt,rt;return j.raster&&(rt=j.box=new THREE.Box2,rt={resolution:P,curvesOnly:S,flatness:g,stepsY:V,minY:M,maxY:X,zMin:T,data:F,box:rt},s(0,1,"raster"),await this.raster(a,rt,(t,e,o)=>{s(t/2,e,o)}),j.raster=!1),await this.contour({box:j.box,minX:w,maxX:z,minY:M,maxY:X,stepsX:k,stepsY:V,boundsX:_,boundsY:A,partOff:W,gridDelta:$,resolution:P,toolStep:q,contourX:x,contourY:f,density:E,clipTo:U,clipTab:Q,clipTabZ:Q?Q.map(t=>t.z):void 0,tabHeight:N,newslices:G,leave:C,color:p},(t,e,o)=>{s(e/2+t/2,e,o)}),n(G),this}async raster(o,a,s){var{resolution:e}=a;const{box:r}=a,{worker:t,minions:n}=R,i=o.getGeoVertices({unroll:!0,translate:!0}).toShared(),c={min:1/0,max:-1/0};for(let t=0,e=i.length;t<e;t+=3){var l=i[t],p=i[t+2];i[t]=p,i[t+2]=l,c.min=Math.min(c.min,l),c.max=Math.max(c.max,l)}var d=Math.ceil(Math.min(25,i.length/27e3)),u=(c.max-c.min)/d;let h=[],m=0,x={min:c.min,max:c.min+u,index:m};for(let t=c.min;t<c.max;t+=e)t>x.max&&(h.push(x),x={min:t,max:t+u,index:m}),m++;h.push(x);let f=0;if(1<n.running){t.putCache({key:o.id,data:i},{done:t=>{}});var d=h.map(t=>new Promise(e=>{n.queue({cmd:"topo_raster",id:o.id,params:a,slice:t},t=>{e(t),s(++f,h.length,"raster")})}));(await Promise.all(d)).map(t=>t.box).map(t=>new THREE.Box2(new THREE.Vector2(t.min.x,t.min.y),new THREE.Vector2(t.max.x,t.max.y))).map(t=>(r.union(t),t)),t.clearCache({},{done:t=>{}})}else for(var y of h)new R.topo_slicer(y.index).setFromArray(i,y).slice(e).map(t=>{const e=R.newSlice(t.z);e.index=t.index,e.lines=t.lines;for(var o of t.lines){const{p1:s,p2:n}=o;s.swapped||(s.swapXZ(),s.swapped=!0),n.swapped||(n.swapXZ(),n.swapped=!0)}return b({...a,box:r,lines:t.lines,gridx:t.index}),e}),s(++f,h.length,"raster")}async contour(a,r){const i=this.trace,c=R.minions.running;var{minX:l,maxX:p,minY:d,maxY:u,boundsX:h,boundsY:m,stepsX:x,stepsY:f}=a,{gridDelta:y,resolution:b,density:g,partOff:v,toolStep:w,contourX:z,contourY:M}=a;const{clipTo:X,clipTab:Y,clipTabZ:T,tabHeight:_,newslices:A,color:Z,leave:E}=a;let P=0,H=0;if(z&&(H+=(u-d+2*v)/w|0),M&&(H+=(p-l+2*v)/w|0),0!==H){var B=a.box.clone().expandByVector(new THREE.Vector3(v,v,0));i.init({box:B,leave:E,clipTo:X,clipTab:Y,clipTabZ:T,tabHeight:_,resolution:b,concurrent:c,density:g});let e,t=0,o=[],s=[];var g=new Promise(t=>{e=()=>{o.sort((t,e)=>t.z-e.z),s.sort((t,e)=>t.z-e.z),A.appendAll(o),A.appendAll(s),t()}}),L=()=>{t++},q,C;let n=()=>{0==--t&&c&&e()};if(M){r(0,H,"contour y");for(let t=l-v;t<=p+v;t+=w)if(!(t<B.min.x||t>B.max.x)){const O=Math.round((t-l)/h*x);L(),i.crossY({from:d-v,to:u+v,x:t,gridx:O,gridy:-y},e=>{if(0<e.length){let t=dt(O);t.camLines=e,t.output().setLayer("contour y",{face:Z,line:Z}).addPolys(e),o.push(t)}r(++P,H,"contour y"),n()})}}if(z){r(0,H,"contour x");for(let t=d-v;t<=u+v;t+=w)if(!(t<B.min.y||t>B.max.y)){const S=Math.round((t-d)/m*f);L(),i.crossX({from:l-v,to:p+v,y:t,gridx:-y,gridy:S},e=>{if(0<e.length){let t=dt(S);t.camLines=e,t.output().setLayer("contour x",{face:Z,line:Z}).addPolys(e),s.push(t)}r(++P,H,"contour x"),n()})}}c||e(),await g,i.cleanup()}}}class mt{constructor(t){const{data:u,profile:h}=t,{stepsX:m,stepsY:x,boundsX:e,zMin:f,minX:o,minY:s}=t;this.params=t;const n=this.toolAtZ=function(t,e){var o=m,s=x,n=o-1,a=s-1;let r,i=0,c=-1/0;for(;i<h.length;){var l=h[i++]+t,p=h[i++]+e,d=h[i++];r=!(l<0||n<l||p<0||a<p)&&u[l*s+p]||f,c=Math.max(d+r,c)}return Math.max(c,f)},a=m/e,r=m/e;var i=this.toolAtXY=function(t,e){return t=Math.round(a*(t-o)),e=Math.round(r*(e-s)),n(t,e)},c=this.zAtXY=function(t,e){var t=Math.round(a*(t-o)),e=Math.round(r*(e-s));return u[t*x+e]||f}}}class xt{constructor(t,e){const{curvesOnly:i,maxangle:c,flatness:l,bridge:o,contourX:p,leave:s}=e;this.params=e,this.probe=t;let d,n,u,h,m;var a=this.newslice=()=>{this.slice=n=[]};const r=this.newtrace=function(){d=g().setOpen()},x=this.end_poly=function(t){u&&d.push(u),0<d.length&&(1<d.length&&n.push(d),r()),h=void 0,u=void 0,m=void 0,t&&(d.push(t),h=t)};var f=function(t){for(var e in t){const o=t[e];"number"==typeof o&&(t[e]=o.round(4))}console.log(...arguments)},y=this.push_point=function(t,e,o){var s=H(t,e,o),n=h,a,o,a,e,r;n?(a=t-n.x||e-n.y,o=o-n.z,a=Math.atan2(o,a),i&&Math.abs(o)<l?x(s):void 0!==m&&Math.abs(m-a)<.001?u=s:(u&&(d.push(u),u=void 0),i&&(e=p?Math.abs(n.x-t):Math.abs(n.y-e),Math.atan2(Math.abs(o),e)*v>c&&x()),d.push(s)),m=a):d.push(s),h=s};const b=this.object=this;this.inClip=function(e,o,s){for(let t=0;t<e.length;t++){var n=e[t],a=!o||o<=n.z;if(b.tabZ=n.z,a&&s.isInPolygon(n))return!0}return!1}}init(t){this.cross=t;const{minions:e}=R,{clipTab:o,clipTabZ:s}=t;if(o)for(let t=0,e=o.length;t<e;t++)o[t].z=s[t];if(e&&this.cross.concurrent){const{codec:n}=R;e.broadcast("trace_init",n.encode({probe:this.probe.params,trace:this.params,cross:t}))}}cleanup(){const{minions:t}=R;t&&this.cross.concurrent&&t.broadcast("trace_cleanup")}crossY(t,e){const{minions:o}=R;o&&this.cross.concurrent?o.queue({cmd:"trace_y",params:t},t=>{e(R.codec.decode(t.slice))}):this.crossY_sync(t,e)}crossX(t,e){const{minions:o}=R;o&&this.cross.concurrent?o.queue({cmd:"trace_x",params:t},t=>{e(R.codec.decode(t.slice))}):this.crossX_sync(t,e)}crossY_sync(t,e){const{push_point:o,end_poly:s,newtrace:n,newslice:a,inClip:r}=this.object;var{clipTab:i,tabHeight:c,clipTo:l,box:p,resolution:d,density:u,leave:h}=this.cross;const{toolAtZ:m}=this.probe;let{from:x,to:f,x:y,gridx:b,gridy:g}=t;var v=d*u;const w=H(0,0);a(),n();for(let e=x;e<f;e+=v)if(e<p.min.y||e>p.max.y)g+=u;else{let t=m(b,g);w.x=y,w.y=e,i&&t<c&&r(i,t,w)&&(t=this.tabZ),!l||r(l,void 0,w)?o(y,e,t+h):s(),g+=u}s(),e(this.slice)}crossX_sync(t,e){const{push_point:o,end_poly:s,newtrace:n,newslice:a,inClip:r}=this.object;var{clipTab:i,tabHeight:c,clipTo:l,box:p,resolution:d,density:u,leave:h}=this.cross;const{toolAtZ:m}=this.probe;let{from:x,to:f,y,gridx:b,gridy:g}=t;var v=d*u;const w=H(0,0);a(),n();for(let e=x;e<f;e+=v)if(e<p.min.x||e>p.max.x)b+=u;else{let t=m(b,g);w.x=e,w.y=y,i&&t<c&&r(i,t,w)&&(t=this.tabZ),!l||r(l,void 0,w)?o(e,y,t+h):s(),b+=u}s(),e(this.slice)}}function b(t){const{lines:r,data:e,box:o,resolution:s,curvesOnly:n}=t;var{flatness:i,zMin:c,minY:a,maxY:l,stepsY:p,gridx:d}=t;const{slice:u}=t;let h,m,x,f,y,b,g,v,w,z=[];var M=r.length,X,Y;t:for(let e=0;e<M;e++){let t=r[e],n=t.p1,a=t.p2;if(!(Math.abs(n.y-a.y)<i)&&!(n.z<c&&a.z<c)){n.y>a.y&&(X=n,n=a,a=X);for(let s=0;s<M;s++)if(!(s>=e-1&&s<=e+1)){let t=r[s],e=t.p1,o=t.p2;if(e.y>o.y&&(Y=e,e=o,o=Y),Math.max(n.z,a.z)<Math.min(e.z,o.z)&&n.y>=e.y&&a.y<=o.y)continue t}z.push(n,a),o.expandByPoint(n),o.expandByPoint(a)}}for(h=0,v=a;v<l&&h<p;v+=s){for(m=d*p+h,x=e[m]||c,f=0,y=z.length;f<y;f+=2){var T=z[f],_=z[f+1],A=T.z>x||_.z>x,Z=T.y<=v&&_.y>=v,Z,_,Z,Z;A&&Z&&(Z=T.y-_.y,_=T.z-_.z,Z=(T.y-v)/Z,(Z=T.z-_*Z)>x&&(x=e[m]=Math.max(Z,c),u&&u.output().setLayer("heights",{face:0,line:0}).addLine(H(T.x,v,0),H(T.x,v,x))))}h++}if(n){let s=[];for(let t=0,e=z,o=e.length;t<o;t+=2){var E=e[t],P=e[t+1];Math.abs(E.z-P.z)>=i&&s.push(E,P)}z=s}return z}ut.Topo=async function(t){return(new p).generate(t)},s.broker.subscribe("minion.started",t=>{const{funcs:e,cache:a,reply:c,log:o}=t;e.topo_raster=(t,e)=>{const{id:o,slice:s,params:r}=t;var{resolution:n}=r,t=a[o];const i=new THREE.Box2;new R.topo_slicer(s.index).setFromArray(t,s).slice(n).forEach(t=>{var{z:e,index:o,lines:t}=t,s;for(s of t){const{p1:n,p2:a}=s;n.swapped||(n.swapXZ(),n.swapped=!0),a.swapped||(a.swapXZ(),a.swapped=!0)}b({...r,box:i,lines:t,gridx:o})}),c({seq:e,box:i})},e.trace_init=t=>{const{cache:e}=self,{codec:o}=R;t.cross.clipTo=o.decode(t.cross.clipTo),t.cross.clipTab=o.decode(t.cross.clipTab);var s=new mt(t.probe);const n=new xt(s,t.trace);e.trace={probe:s,trace:n,cross:t.cross},n.init(t.cross)},e.trace_y=(t,e)=>{var{cache:o}=self;const{trace:s}=o.trace;s.crossY_sync(t.params,t=>{t=R.codec.encode(t),c({seq:e,slice:t})})},e.trace_x=(t,e)=>{var{cache:o}=self;const{trace:s}=o.trace;s.crossX_sync(t.params,t=>{t=R.codec.encode(t),c({seq:e,slice:t})})},e.trace_cleanup=()=>{delete a.trace}})});"use strict";gapp.register("kiri-mode.cam.topo",[],(e,t)=>{const{base:s,kiri:g,moto:a}=e,{driver:o,newSlice:L}=g,{CAM:C}=o,{polygons:n,newPoint:T,newPolygon:B,sliceConnect:c}=s;var i=C.process,r=n;const R=180/Math.PI,q=Math.PI/180;function E(s,a=1,o=0){return(e,t)=>{s(o+e*a,t)}}class p{constructor(){}async generate(e={}){let{state:t,op:s,onupdate:a,ondone:o}=e,{widget:n,settings:i,tabs:r}=e.state;var{controller:e,process:l}=i,h,c;let p=s.axis.toLowerCase(),m=new C.Tool(i,s.tool),u=n.getBoundingBox().clone(),d=2500*parseInt(e.animesh||100),{min:f,max:g}=u,v,x=g.x-f.x,w=g.y-f.y,y={x:"x"===p,y:"y"===p},z=f.z+1e-4,M=s.tolerance,P=M||1/Math.sqrt(d/(x*w)),A=this.step=2*m.traceOffset()*s.step,k=this.angle=s.angle||1;m.isTaperMill()&&0===A&&(A=this.step=s.step*m.unitScale()),0===M&&console.log(n.id,"topo4 auto tolerance",P.round(4)),this.zBottom=t.zBottom,this.resolution=P,this.vertices=n.getGeoVertices({unroll:!0,translate:!0}),this.tabverts=n.getTabVertices(),this.tool=m.generateProfile(P).profile,this.maxo=m.profileDim.maxo*P,this.diam=m.fluteDiameter(),this.zoff=n.track.top||0,this.leave=s.leave||0,this.lineColor=t.settings.controller.dark?16776960:5592320,a(0,"lathe");const b=this.range={min:1/0,max:-1/0};for(c of this.sliced=await this.slice(E(a,.25,0)))b.min=Math.min(b.min,c.z),b.max=Math.max(b.max,c.z),c.output().setLayer("lathe",{line:8947848}).addPolys(c.topPolys());var e=await this.lathe(E(a,.75,.25));return a(1,"lathe"),o(e),this}async slice(e){const{vertices:s,resolution:t,tabverts:a,zoff:o}=this,n=this.range={min:1/0,max:-1/0};var i=this.box=new THREE.Box2;for(let e=0,t=s.length;e<t;e+=3){var r=s[e],l=s[e+2]+o;s[e]=l,s[e+2]=r,n.min=Math.min(n.min,r),n.max=Math.max(n.max,r)}n.min-=this.diam/2,n.max+=this.diam/2;for(let e=0,t=a.length;e<t;e+=3){var h=a[e],c=a[e+2]+o;a[e]=c,a[e+2]=h}this.vertices=[].appendAll(s).appendAll(a).toFloat32().toShared();var p=Math.ceil(Math.min(25,s.length/27e3)),m=(n.max-n.min)/p;let u=0,d=this.slices=[],f={min:n.min,max:n.min+m,index:u};for(let e=n.min;e<n.max;e+=t)e>f.max&&(d.push(f),f={min:e,max:e+m,index:u}),u++;return d.push(f),1<g.minions.running?this.sliceMinions(e):this.sliceWorker(e)}async sliceWorker(e){var{vertices:t,slices:s,resolution:a}=this,o;const{codec:i}=g;let n=[],r=0;for(o of s){var l=new g.topo_slicer(o.index).setFromArray(t,o).slice(a).map(e=>{const t=g.newSlice(e.z);for(var s of e.lines){const{p1:o,p2:n}=s;o.swapped||(o.swapXZ(),o.swapped=!0),n.swapped||(n.swapXZ(),n.swapped=!0)}t.index=e.index,t.addTops(c(e.lines));var e=i.encodePointArray(e.lines.map(e=>[e.p1,e.p2]).flat());const a=new Float32Array(new SharedArrayBuffer(4*e.length));return a.set(e),t.shared=a,t});n.appendAll(l),e(++r/s.length)}return n}async sliceMinions(t){const{codec:e}=g,{queue:s,putCache:a,clearCache:o}=this,{vertices:n,slices:i,resolution:r}=this;a("vertices",n);let l=0;var h=i.map(e=>s("topo4_slice",{resolution:r,slice:e}).then(e=>(t(++l/i.length),e))),h=e.decode(await Promise.all(h)).map(e=>e.recs).flat().map(e=>L(e.z).addTops(e.polys).setFields({shared:e.shared})).sort((e,t)=>e.z-t.z);return o(),h}async lathe(e){return 1<g.minions.running?this.latheMinions(e):this.latheWorker(e)}lathePath(e,a){var{resolution:o,step:t,zBottom:n,maxo:s}=this,i=a.length,r=e.length,l=Math.max(1,Math.ceil(t/o)),h;const c=[],p=[];for(h of e){var m=h.lines,u=m.length;const R={z:h.z,lines:[]};for(let e=0;e<u;){++e;var d=m[e++],f=m[e++];++e;var g=m[e++],v=m[e++];d<-s&&g<-s||s<d&&s<g||R.lines.push(0,d,f,0,g,v)}p.push(R)}let x=0;for(let s=0;s<r;s+=l){var w=p[s].z;let t=-1/0;for(let e=0;e<i;){var y=a[e++],z=a[e++]*o,M=a[e++],P=s+y;if(!(P<0||r-1<=P)){var A,k=p[P].lines,b=k.length;for(let e=0;e<b;){++e;var C=k[e++],E=k[e++];++e;var L=k[e++],T=k[e++];if(C<=z&&z<=L||L<=z&&z<=C){var T=T-E,L=Math.abs(L-C),B;if(0!==L){const x=E+T*(Math.abs(z-C)/L)+M;t=Math.max(t,x)}}}if(t===-1/0&&0===y&&0==z)break}}(t===-1/0||n&&t<n)&&(t=n),c.push(w,0,x=t)}return c}async latheWorker(e){const{sliced:t,tool:s,zoff:a,leave:o}=this;var n=this.angle*q,i=2*Math.PI/n,r=new THREE.Vector3(1,0,0),l=(new THREE.Matrix4).makeRotationAxis(r,n),h,c;const p=t.map(e=>({z:e.z,lines:e.shared})),m=[],u=[];let d=0,f=0;for(;f++<i;){var g=this.lathePath(p,s,m),v;u.push({angle:d,heights:g,degrees:d*R}),d-=n;for(v of p.map(e=>e.lines))M(v,l);e(f/i)}for(f=u[0].heights.length/3;0<f--;){let e=L(f);e.camLines=[B().setOpen()],m.push(e)}for(h of u){const{degrees:x,heights:w}=h;[...w].group(3).forEach((e,t)=>{m[t].camLines[0].push(T(e[0],e[1],e[2]+o).setA(-x+-360*t))})}for(c of m){const y=c.camLines[0];if(y.length){const z=y.points[0];c.camLines[0].push(z.clone().setA(z.a-360)),c.output().setLayer("lathe",{line:this.lineColor}).addPoly(y.clone().applyRotations().move({z:-a,x:0,y:0}))}else console.log("empty",c)}return m}async latheMinions(s){const{sliced:e,tool:t,zoff:a,leave:o,maxo:n,zBottom:i,step:r,resolution:l}=this,{putCache:h,clearCache:c,queue:p}=this;var m=this.angle*q;const u=2*Math.PI/m;var d=e.map(e=>({z:e.z,lines:e.shared})),f,g;const v=[],x=[];h("lathe",{maxo:n,tool:t,step:r,slices:d,zBottom:i,resolution:l});let w=0,y=0,z=0,M=[];for(;z++<u;){const A=y;var P=new Promise(t=>{p("topo4_lathe",{angle:A}).then(e=>{x.push({angle:A,heights:e.heights,degrees:A*R}),s(++w/u),t()})});M.push(P),y-=m}for(await Promise.all(M),x.sort((e,t)=>t.angle-e.angle),z=x[0].heights.length/3;0<z--;){let e=L(z);e.camLines=[B().setOpen()],v.push(e)}for(f of x){const{degrees:k,heights:b}=f;[...b].group(3).forEach((e,t)=>{v[t].camLines[0].push(T(e[0],e[1],e[2]+o).setA(-k+-360*t))})}for(g of v){const C=g.camLines[0];if(C.length){const E=C.points[0];g.camLines[0].push(E.clone().setA(E.a-360)),g.output().setLayer("lathe",{line:this.lineColor}).addPoly(C.clone().applyRotations().move({z:-a,x:0,y:0}))}else console.log("empty",g)}return c(),v}putCache(e,t){g.worker.putCache({key:e,data:t},{done:e=>{}})}clearCache(){g.worker.clearCache({},{done:e=>{}})}queue(t,s){return new Promise(e=>{g.minions.queue({cmd:t,...s},e)})}}function M(e,t){new THREE.BufferAttribute(e,3).applyMatrix4(t)}C.Topo4=function(e){return(new p).generate(e)},a.broker.subscribe("minion.started",e=>{const{funcs:t,cache:r,reply:l,log:s}=e,{codec:h}=g;t.topo4_slice=(e,t)=>{var{slice:s,resolution:a}=e,e=r.vertices,a=new g.topo_slicer(s.index).setFromArray(e,s).slice(a).map(e=>{const{z:t,index:s,lines:a}=e;for(var o of a){const{p1:i,p2:r}=o;i.swapped||(i.swapXZ(),i.swapped=!0),r.swapped||(r.swapXZ(),r.swapped=!0)}var e=h.encodePointArray(a.map(e=>[e.p1,e.p2]).flat());const n=new Float32Array(new SharedArrayBuffer(4*e.length));return n.set(e),{z:t,index:s,shared:n,polys:h.encode(c(a))}});l({seq:t,recs:a})},t.topo4_lathe=(e,t)=>{var{angle:s}=e;const{slices:a,tool:o}=r.lathe;var e=new THREE.Vector3(1,0,0);const n=(new THREE.Matrix4).makeRotationAxis(e,s);var s=a.map(e=>{var t=e.lines.slice();return M(t,n),{z:e.z,lines:t}});const i=Object.assign(new p,r.lathe);var s=i.lathePath(s,o);l({seq:t,heights:s})}})});"use strict";gapp.register("kiri-mode.fdm.driver",[],(e,r)=>{const{base:t,kiri:i}=e,{driver:n}=i,{util:o}=t,a=n.FDM={getRangeParameters:s,extrudePerMM:c,extrudeMM:u};function s(e,r){if(null==r||r<0)return e;var t=e.ranges,n;if(!t||!t.length)return e;let o=Object.clone(e);for(n of t)if(r>=n.lo&&r<=n.hi)for(var[s,i]of Object.entries(n.fields))o[s]=i,o._range=!0;return o}function c(e,r,t){return Math.PI*o.sqr(e/2)/(Math.PI*o.sqr(r/2))*(t/e)}function u(e,r,t){return e*r*t}i.load(o=>{const{client:r,worker:s}=i;r&&(a.support_generate=function(t){r.clear(),r.sync();var e=o.conf.get();const n=o.widgets.map();r.send("fdm_support_generate",{settings:e},e=>{if(e&&e.error)return o.show.alert("support generation canceled"),t([]);for(var r of e)r.widget=n[r.id];t(e)})}),s&&(s.fdm_support_generate=function(e,r){const{settings:t}=e,n=Object.values(s.cache),o=n.filter(e=>a.supports(t,e));r.done(i.codec.encode(o.map(e=>({id:e.id,supports:e.supports}))))})})});"use strict";gapp.register("kiri.utils",[],(t,n)=>{function e(n){let e={},t,r;return n.replace(/&/g,",").split(",").forEach(function(n){t=decodeURIComponent(n).split(":"),2===t.length&&(r=e[t[0]]=e[t[0]]||[],r.push(decodeURIComponent(t[1])))}),e}function r(t){let r=[];return Object.keys(t).forEach(n=>{var e;"ver"!==n&&(e=t[n],r.push(encodeURIComponent(n)+":"+encodeURIComponent(e)))}),r.length?"?"+r.join(","):""}function o(n,e,t,r,o){return moto.ajax.new(e,t).request(n,r,o)}function u(n,e){return n?JSON.stringify(n):e||null}function c(e,t){try{return e?JSON.parse(e):t||null}catch(n){return console.log({malformed_json:e}),t||null}}function i(n,e){return c(t.data.local.getItem(n),e)}function a(n){return[n>>16&255,n>>8&255,255&n]}function f(n){return n[0]<<16|n[1]<<8|n[0]}function l(n,e,t=3){var r=a(n),n=a(e),e=t+2;return(r[0]*t+n[0])/e<<16|(r[1]*t+n[1])/e<<8|(r[2]*t+n[2])/e}function s(e,t){if(e==t)return!0;if(Array.isArray(e)&&Array.isArray(t)){if(e.length===t.length){for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}}else if("object"==typeof e&&"object"==typeof t){var n,r;for(r of Object.keys(Object.assign({},e,t)))if(e[r]!==t[r])return!1;return!0}return!1}function p(n,e){return function(){console.log(e,...arguments),n(...arguments)}}n({trackFn:p,areEqual:s,parseOpt:e,encodeOpt:r,ajax:o,o2js:u,js2o:c,ls2o:i,avgc:l,rgb:a,a2c:f})});"use strict";gapp.register("kiri-mode.fdm.export",[],(e,t)=>{const{base:r,kiri:Kt}=e,{util:Qt,config:Ut}=r,{FDM:er}=Kt.driver;var{getRangeParameters:n}=er;const o=!1;er.export=function(n,t,e,r){var{settings:o,belty:i,tools:a}=n;const{bounds:s,controller:p,device:d,process:u,filter:f,mode:l}=o,{danger:c,extruders:x,fwRetract:h}=d;var{bedWidth:m,bedDepth:y,bedRound:g,bedBelt:M,maxHeight:o}=d,{gcodeFan:z,gcodeLayer:b,gcodeTrack:v,gcodePause:S,gcodeFeature:E}=d;let O=n.output,T=d.extras||{},{extrudeAbs:_}=d,{exportThumb:F}=p,P=Object.keys(n.extruders).map(e=>parseInt(e)),L=1.5*(d.gcodeTime||1),R=Ut.gcode_decimals||4,$=d.deviceZMax||0,w=M,G=w?"belt":"fixed",D=0,B=0,I=0,k=[],A=[],H=0,N=0,X=0,Y=0,j=0,Z=0,V={X:" X",Y:" Y",Z:" Z",E:" E"},q={x:0,y:0,z:0,f:0},J={x:0,y:0,z:0},W=null,C=0,K=0,Q=0,U=(u.firstLayerYOffset||0)-(i||0),ee=u.outputLoops||0,te=u.zHopDistance||0,re=u.sliceLineWidth||0,ne=60*u.outputSeekrate,oe=u.outputRetractDist||0,ie=60*u.outputRetractSpeed||1,ae=u.outputRetractDwell||0,se=ae/1e3,pe=!w&&c&&u.arcTolerance||0,de=1,ue=20,fe=.5,le=40,ce=u.outputOriginCenter||g,xe=ce?{x:0,y:0,z:0}:{x:m/2,y:w?0:y/2,z:0},he=0,me=x[he],ye=me.extOffsetX,ge=me.extOffsetY,Me=!1,ze=u.firstLayerNozzleTemp||u.outputTemp,be=u.firstLayerBedTemp||u.outputBedTemp,ve=void 0,Se=void 0,Ee=void 0,Oe=void 0,Te=ze,_e=be,Fe=Ee,Pe={minx:s.min.x+xe.x,maxx:s.max.x+xe.x,miny:s.min.y+xe.y,maxy:s.max.y+xe.y,travel_speed:ne,retract_speed:ie,retract_distance:oe,temp:ze,temp_bed:be,bed_temp:be,fan_speed_base:Se,fan_speed:Ee,speed:Ee,top:xe.y?y:y/2,left:xe.x?0:-m/2,right:xe.x?m:m/2,bottom:xe.y?0:-y/2,z_max:o,layers:O.length,progress:0,nozzle:0,tool:0},Le,Re,$e,we,Ge,De,Be,Ie,ke,Ae=0,He=0,Ne=Math.cos(Math.PI/4),Xe=1/Ne,Ye=0,je=[],Ze={x:1/0,y:1/0,z:1/0},Ve=[],qe="palette3"===d.filamentSource,Je=T.palette||{},We=Math.max(Je.ping,Je.feed,Je.push)||500,Ce=Je.ping||0,Ke,Qe=0,Ue=0,et=er.extrudeMM,tt=er.extrudePerMM;var a=Object.keys(a),rt;for(rt of a)Pe["tool_used_"+rt]=!0;function nt(e){0<e?(ve=0<=ve?ve:Ee,Ee=e,Pe.fan_speed=Ee,Pe.fan_speed_base=e):(Ee=0<=ve?ve:Ee,ve=void 0,Pe.fan_speed=Ee,Pe.fan_speed_base=Se)}function ot(e,t){te=t.zHopDistance||0,oe=t.outputRetractDist||0,ie=60*t.outputRetractSpeed||1,ae=t.outputRetractDwell||0,se=ae/1e3,ze=0===e?t.firstLayerNozzleTemp||t.outputTemp:t.outputTemp||t.firstLayerNozzleTemp,be=0===e?t.firstLayerBedTemp||t.outputBedTemp:t.outputBedTemp||t.firstLayerBedTemp,Se=t.firstLayerFanSpeed||0,Ee=0===e?t.firstLayerFanSpeed||0:t.outputFanSpeed||0,Object.assign(Pe,{temp_bed:be,bed_temp:be,fan_speed:Ee,fan_speed_base:Se,speed:Ee,retract_speed:ie,retract_distance:oe,temp:t.outputTemp,temp_bed:t.outputBedTemp,bed_temp:t.outputBedTemp})}Pe.tool_count=a.length;let it=[];if(0<ee?it.push({start:O[0].slice.index,end:1/0,iter:ee-1}):ee<0&&it.push({start:O[0].slice.index,end:1/0,iter:0}),u.ranges)for(var at of u.ranges)at.fields.outputLoops&&it.push({start:at.lo,end:at.hi,iter:at.fields.outputLoops-1});var st=w&&it.length?it:void 0,pt,dt;function ut(e){e&&(Ae++,He+=e.length,A.append(e)),(!e||1e3<A.length)&&(t(A.join("\n")),A=[])}function ft(e,t){xt(e,!0)}let lt=!0,ct=!1;function xt(e,t){var r,r;0===e.indexOf(";; IF ")?(e=e.substring(6).trim(),r=n.constReplace(e,Pe,0,666),lt=r,ct=lt):0===e.indexOf(";; ELIF ")?(e=e.substring(6).trim(),r=n.constReplace(e,Pe,0,666),lt=!lt&&r,ct=ct||lt):0===e.indexOf(";; ELSE")?lt=!ct&&!lt:0===e.indexOf(";; END")?(lt=!0,ct=!1):lt&&ut(n.constReplace(e,Pe,0,t))}function ht(e){e&&(e=!Array.isArray(e)?[e]:e).forEach(function(e){ut(e)})}function mt(e,t){e&&0!==e.length&&(e=!Array.isArray(e)?[e]:e).forEach(function(e){xt(e,t)})}function yt(){let e=[...arguments].map(e=>"object"==typeof e?JSON.stringify(e):e);ut(e.join(""))}function gt(){if(ut("; Generated by Kiri:Moto "+Kt.version),ut("; "+(new Date).toString()),xt("; Bed left:{left} right:{right} top:{top} bottom:{bottom}"),ut("; Bed type: "+G),ut("; Target: "+f[l]),F&&worker.snap){let{width:e,height:t,url:r}=worker.snap,n=r.substring(r.indexOf(",")+1);ut(`; thumbnail begin ${e} ${t} `+n.length);for(let e=0;e<n.length;e+=78)ut("; "+n.substring(e,e+78));ut("; thumbnail end")}for(var e in ut("; --- process ---"),u)yt("; ",e," = ",u[e]);ut("; --- startup ---")}let Mt=0,zt=[];for(pt of d.gcodePre)if(pt=pt.trim(),0===pt.indexOf(";; PREAMBLE ")&&(";; PREAMBLE OFF"===pt&&(Mt=1),";; PREAMBLE END"===pt&&(Mt=2)),0===pt.indexOf(";; AXISMAP ")){var bt=JSON.parse(pt.substring(11).trim()),vt;for(vt in bt)V[vt]=" "+bt[vt]}else zt.push(pt);0===Mt&&gt();let St=!1,Et=!1;for(dt of zt)if(0===dt.indexOf("T0")?St=!0:0===dt.indexOf("T1")?Et=!0:0===dt.indexOf("M82")?(_=!0,Me=!0):0===dt.indexOf("M83")?(_=!1,Me=!0):0!==dt.indexOf("G90")||Me?0!==dt.indexOf("G91")||Me?0===dt.indexOf("G92")&&dt.split(";")[0].split(" ").forEach(function(e){var t=parseFloat(e.substring(1)||0)||0;switch(e[0]){case"X":q.x=t;break;case"Y":q.y=t;break;case"Z":q.z=t;break;case"E":H=t}}):_=!1:_=!0,0<dt.indexOf("E")&&dt.split(";")[0].split(" ").forEach(function(e){"E"==e[0]&&(_?(H=Math.max(H,parseFloat(e.substring(1))||0),j=H):j+=parseFloat(e.substring(1)||0))}),0<dt.indexOf("{tool}")&&0<P.length){for(var Ot of P)Pe.tool=Ot,ft(dt);Pe.tool=0}else ft(dt);function Tt(e){for(D+=e/1e3;0<e;){var t=Math.min(4e3,e);ut("G4 P"+t),(e-=t)&&ut("G1")}}function _t(e){Z||(Z=oe,h?ut("G10"):Dt({e:-Z},ie,"e-retract "+oe),e&&Dt({z:C+e},ne,"z-hop start"),D+=oe/ie*60*2)}function Ft(){Z&&(Wt(),te&&q.z!=C&&Dt({z:C},ne,"z-hop end"),h?ut("G11"):Dt({e:Z},ie,"e-engage "+Z),Z=0,ae&&Tt(ae),D+=oe/ie*60*2)}2===Mt&&gt();var Pt=new THREE.Vector3(1,0,0),Lt=new THREE.Vector2(0,0),Rt=-Math.PI/4;let $t=q;function wt(e,t,r){$t=Object.clone(q),Dt({x:e.x+xe.x,y:e.y+xe.y,z:e.z+xe.z},t,r)}function Gt(e,t){Dt($t,e,t)}function Dt(e,t,r){kt&&e.e&&(kt,e.e,kt-=e.e);let n=[t||e.e?"G1":"G0"],o={x:!1,y:!1,z:!1};"number"==typeof e.x&&e.x!==q.x&&(q.x=e.x,o.x=!0),"number"==typeof e.y&&e.y!==q.y&&(q.y=e.y,o.y=!0,w&&(o.z=!0)),"number"==typeof e.z&&e.z!==q.z&&(q.z=e.z,o.z=!0,w&&(o.y=!0));let i=w?{x:q.x,y:q.y,z:q.z}:q;var a,r;w&&(a=Re&&Re.height||0,i.x=ce?-q.x:d.bedWidth-q.x,i.z=Q=q.z*Xe,i.y=-q.y+i.z*Ne+U,J=i),o.x&&n.append(V.X).append(i.x.toFixed(R)),o.y&&n.append(V.Y).append(i.y.toFixed(R)),o.z&&n.append(V.Z).append(i.z.toFixed(R)),"number"==typeof e.e&&(H+=e.e,_?n.append(V.E).append(H.toFixed(R)):n.append(V.E).append(e.e.toFixed(R))),(t=$&&o.z?60*Math.min($,t):t)&&t!=q.f&&(n.append(" F").append(Math.round(t)),q.f=t),r&&n.append(" ; "+r),1!==n.length&&(r=n.join(""),W!=r&&(W=r,Pe.pos_x=i.x.round(R),Pe.pos_y=i.y.round(R),Pe.pos_z=i.z.round(R),ut(r)))}let Bt=[],It=0;O.forEach(function(e){Bt.appendAll(e)}),Bt.forEachPair(function(e,t){It+=e.point.distTo2D(t.point)},1);let kt=0;for(_t();B<O.length;){Re=O[B],I=Re.slice.index,0<=Re.layer&&ot(Re.layer,Re.params),De=tt(re||me.extNozzle,me.extFilament,0===Re.layer?u.firstSliceHeight||u.sliceHeight:Re.height),C=Re.z||C,K=Math.max(K,q.z*Xe),Pe.z=Pe.Z=C.round(3),Pe.e=Pe.E=H,Pe.layer=B,Pe.height=Re.height,w&&(q.z=C),S&&0<=k.indexOf(B)&&mt(S);let e=0;if(st)for(var At of st)I!==At.start||At.started||(At.started=!0,ut("M808 L"+At.iter),_?ut(`G92 Z${J.z.round(R)} E`+H.round(R)):ut("G92 Z"+J.z.round(R)),Ye++),I!==At.end||At.ended||(At.ended=!0,e++,Ye--);for(b&&b.length?mt(b):ut(`;; --- layer ${B} (${Pe.height.toFixed(3)} @ ${Pe.z.round(3)}) ---`),Ee!==Fe&&(mt(z),Fe=Ee),be!==_e&&(ut(`M140 S${be} T0`),_e=be),ze!==Te&&(St&&ut(`M104 S${ze} T0`),Et&&ut(`M104 S${ze} T1`),St||Et||ut(`M104 S${ze} T`+he),Te=ze),(0<B||!w)&&Dt({z:C},ne),Le=0;Le<Re.length;Le++)if(we=60*(($e=Re[Le]).speed||u.outputFeedrate),qe&&Ce&&j>=We&&(0===Qe&&$e.point.purgeOn&&j-Ue>=Ce&&(_t(),wt($e.point.purgeOn),Tt(12750),Gt(),Ft(),Qe=j,Ke=$e.point.purgeOn,kt=20),Qe&&kt<=0&&(_t(),wt(Ke),Tt(6750),Gt(),Ft(),n.purges||(n.purges=[]),n.purges.push({length:Qe,extrusion:j-Qe}),Ue=j,Qe=0,kt=0)),W&&$e.type!==W.type&&(Oe=Pe.feature=$e.type,E&&E.length?mt(E):ut("; feature "+$e.type)),void 0!==$e.tool&&$e.tool!=he&&(Ve.push({emitted:j,tool:he}),mt(me.extDeselect),he=$e.tool,Pe.nozzle=Pe.tool=he,me=x[he],ye=me.extOffsetX,ge=me.extOffsetY,De=tt(re||me.extNozzle,me.extFilament,0===Re.layer?u.firstSliceHeight||u.sliceHeight:Re.height),qe||mt(me.extSelect)),$e.point){let e=$e.point.x+ye,t=$e.point.y+ge,r=$e.point.z;if(u.outputInvertX&&(e=-e),u.outputInvertY&&(t=-t),xe&&(e+=xe.x,t+=xe.y),ke=Be?Be.distTo2D($e.point):0,$e.emit&&Z&&Ft(),w&&(nt($e.fan),Ee!==Fe&&(mt(z),Fe=Ee)),Be&&$e.emit)if(pe){var Ht={e:$e.emit,x:e,y:t,z:r,dist:ke,emitPerMM:De,speedMMM:we},Nt;je.push(Ht);let n=!1,o=!1,i=!1;if(1<je.length&&(Nt=je.length,n=je[0].e!==Ht.e,o=je[0].emitPerMM!==Ht.emitPerMM,i=je[0].speedMMM!==Ht.speedMMM),2<je.length){var Xt=je.length,Yt=je[0],jt=je[Math.floor(Xt/2)],Zt=je[Xt-1],Ht=je[Xt-2],Xt=je[Xt-3];let e=Qt.center2d(Yt,jt,Zt,1);var Xt=Qt.center2d(Zt,Ht,Xt,1),Xt,Zt,Vt,Vt,qt,qt;let t=0,r=!1;r=!Xt||(Xt=2*Math.asin(ke/(2*Xt.r)),Math.abs(Xt)>2*Math.PI/20),e?([e.x,e.y,e.z,e.r].hasNaN()&&console.log({cc:e,e1:Yt,e2:jt,e3:Zt}),3===je.length?(je.center=[e],je.xSum=e.x,je.ySum=e.y,je.rSum=e.r):(je.xSum=je.center.reduce(function(e,t){return e+t.x},0),je.ySum=je.center.reduce(function(e,t){return e+t.y},0),je.rSum=je.center.reduce(function(e,t){return e+t.r},0),Zt=e.x-je.xSum/je.center.length,Vt=e.y-je.ySum/je.center.length,t=Math.sqrt(Zt*Zt+Vt*Vt)),n||o||i||t*je.center.length/je.rSum>pe||ke>e.r||40<e.r||r||!Ct()?4===je.length?(Jt(je.shift()),(Vt=Qt.center2d(je[0],je[1],je[2],1))?(je.center=[Vt],qt=2*Math.asin(je[1].dist/(2*Vt.r)),Math.abs(qt)>2*Math.PI/20&&Jt(je.shift())):Jt(je.shift())):(qt=je.pop(),Wt(),je.push(qt)):je.center.push(e)):Wt()}}else Ge=et(ke,De,$e.emit),Dt({x:e,y:t,e:Ge},we),j+=Ge;else Wt(),Dt({x:e,y:t},ne);$e.retract&&(Wt(),_t(te)),D+=ke/we*60*L,Y+=ke,Pe.progress=X=Math.round(Y/It*100),v&&X!=N&&(mt(v),N=X),Be=$e.point,Ie=$e.emit}else Tt($e.speed);for(B++;0<e--;)ut("M808");Wt()}function Jt(e){var{e:t,x:r,y:n,dist:o,emitPerMM:i,speedMMM:e}=e;Ge=et(o,i,t),Dt({x:r,y:n,e:Ge},e),j+=Ge}function Wt(){if(pe){if(4<je.length){let e=new THREE.Vector2(je[1].x-je[0].x,je[1].y-je[0].y);var i=new THREE.Vector2(je.center[0].x-je[0].x,je.center[0].y-je[0].y),a=e.cross(i)<0?"G2":"G3",s=je[0];let t=je.peek();je.xSum=je.center.reduce(function(e,t){return e+t.x},0),je.ySum=je.center.reduce(function(e,t){return e+t.y},0),je.rSum=je.center.reduce(function(e,t){return e+t.r},0);var p=je.center.length;let r;var i=Qt.thetaDiff(Math.atan2(s.y-je.ySum/p,s.x-je.xSum/p),Math.atan2(t.y-je.ySum/p,t.x-je.xSum/p),"G2"==a),d,u;Math.abs(i)<=3*Math.PI/4&&(r=Qt.center2pr(s,t,je.rSum/p,"G3"==a)),r=r||{x:je.xSum/p,y:je.ySum/p,z:je[0].z,r:je.rSum/p},Jt(s);let n=je.slice(1).map(e=>e.dist).reduce((e,t)=>e+t),o=s.e;o=s.emitPerMM*o*n,H+=o,j+=o,_&&(o=H),ut(a+` X${t.x.toFixed(R)} Y${t.y.toFixed(R)} I${(r.x-q.x).toFixed(R)} J${(r.y-q.y).toFixed(R)} E`+o.toFixed(R)+(q.f!==s.speedMMM?" E"+s.speedMMM:"")+` ; merged=${p-1} len=${n.toFixed(R)} cp=${r.x.round(2)},`+r.y.round(2)),q.x=t.x,q.y=t.y,q.z=t.z}else for(var e of je)Jt(e);je.length=0,je.center=void 0}}function Ct(){if(!(je.length<3)){let t=[];for(let e=0;e<je.length-2;e++){var a=Qt.center2d(je[0],je[e+1],je[je.length-1],1);if(!a)return;t.push(a)}let e,r=t.reduce((e,t)=>e+t.x,0)/t.length,n=t.reduce((e,t)=>e+t.y,0)/t.length,o=t.reduce((e,t)=>e+t.z,0)/t.length,i=t.reduce((e,t)=>e+t.r,0)/t.length;for(var s of t){var p;if(Math.sqrt(Math.pow(s.x-r,2)+Math.pow(s.y-n,2))/i>pe)return}for(var d of je){var d=Math.sqrt(Math.pow(d.x-r,2)+Math.pow(d.y-n,2));if(Math.abs(d-i)>i*pe)return}for(let e=1;e<je.length;e++){var u=2*Math.asin(je[e].dist/(2*i));if(Math.abs(u)>2*Math.PI/20)return}for(let e=0;e<je.length-2;e++){var f=Qt.center2d(je[e],je[e+1],je[e+2],1);if(!f||.5<Math.abs((f.r-i)/f.r))return}return 1}}Ye&&ut("M808"),Ve.push({emitted:j,tool:he}),Pe.material=Qt.round(j,2),Pe.time=Qt.round(D,2),Pe.print_time=Pe.time,ut("; --- shutdown ---"),mt(d.gcodePost),ut(`; --- filament used: ${Pe.material} mm ---`),ut(`; --- print time: ${D.toFixed(0)}s ---`),ut(),n.segments=qe?Ve:void 0,n.distance=j,n.lines=Ae,n.bytes=He+Ae-1,n.time=D}});"use strict";gapp.register("kiri-mode.fdm.fill",[],(i,e)=>{const{base:u,kiri:n}=i;var{util:t}=u;const y=Math.PI/180,m=n.fill={hex:o,grid:x,gyroid:a,triangle:d,linear:s,cubic:f},l=n.fill_fixed={hex:o,grid:x,triangle:d};function o(i){r(i,!0)}function r(i,e){var n=i.offset(),t=1/i.density()*i.lineWidth()*.5,m=(Math.cos(30*y)*t).round(7),l=(Math.sin(30*y)*t).round(7),o=i.bounds();let r=!0;var a=i.zIndex()%2==0,x=o.max.y+(t+2*l);let f,s;if(e||a)for(f=o.min.x;!(r&&f>o.max.x)&&(r||!(f>o.max.x+m+n));){for(s=o.min.y,i.newline();s<=x;)i.emit(f,s),s+=t,i.emit(f,s),r?f+=m:f-=m,s+=l,i.emit(f,s),s+=t,i.emit(f,s),r?f-=m:f+=m,s+=l;f+=n,r&&(f+=2*m),r=!r,i.newline()}else for(s=o.min.y+t;!(r&&s>o.max.y)&&(r||!(s>o.max.y+l));){for(f=o.min.x,i.newline();f<o.max.x;)i.emit(f,s),r?s+=l:s-=l,f+=m,i.emit(f,s),f+=n,i.emit(f,s),r?s-=l:s+=l,f+=m,i.emit(f,s),f+=n;s+=t,r&&(s+=2*l),r=!r,i.newline()}}function a(i){let t=i.bounds();var e=i.zHeight(),n=t.max.x-t.min.x,m=t.max.y-t.min.y,l=i.density();let o=1+15*(1-l);var r=n/o,a=m/o,m=1/o,x=u.gyroid.slice(i.zValue()*m,500*(1-l)),f;let s=[];for(let n=0;n<=r;n++)for(let e=0;e<=a;e++)for(var y of x.polys){i.newline();var y=y.map(i=>({x:i.x*o+n*o+t.min.x,y:i.y*o+e*o+t.min.y,z:0}));s.push(u.newPolygon().setOpen(!0).addObj(y))}s=h(s);for(f of s.filter(i=>2<i.perimeter())){i.newline();for(var d of f.points)i.emit(d.x,d.y)}}function h(e,l=.1){if(e.length<=1)return e;let i=0;i:for(;;i++){let m=e,i=m.length;for(let t=0;t<i;t++){let n=m[t];if(n&&n.open)for(let e=t+1;e<i;e++){let i=m[e];if(i&&i.open){if(n.last().distTo2D(i.first())<=l){n.addPoints(i.points),m[e]=null;continue i}if(n.first().distTo2D(i.last())<=l){i.addPoints(n.points),m[t]=null;continue i}if(n.first().distTo2D(i.first())<=l){n.reverse(),n.addPoints(i.points),m[e]=null;continue i}if(n.last().distTo2D(i.last())<=l){n.addPoints(i.points.reverse()),m[e]=null;continue i}}}}break}return e=0<i?e.filter(i=>i):e}function x(n){var t=n.bounds(),i=n.zHeight(),e=t.max.x-t.min.x,m=t.max.y-t.min.y,l=n.offset()/2,o=1/n.density()*n.lineWidth(),r=o+l,a=e/r,x=m/o;for(let e=0;e<=a;e++){n.newline();for(let i=0;i<=x;i++){var f=e*r+t.min.x,s=i*o+t.min.y;(e+i)%2?(n.emit(f,s),n.emit(f+r-l,s+o)):(n.emit(f+r-l,s),n.emit(f,s+o))}}}function f(e){var n=e.bounds(),i=Math.max(n.max.x-n.min.x,n.max.y-n.min.y),t,m=i/Math.floor(i/e.lineWidth()*e.density()),i=Math.floor(e.zIndex()/e.repeat())%3;if(1==i)for(let i=n.min.x;i<=n.max.x;i+=m)e.newline(),e.emit(i,n.min.y),e.emit(i,n.max.y);else if(0==i)for(let i=n.min.y;i<=n.max.y;i+=m)e.newline(),e.emit(n.min.x,i),e.emit(n.max.x,i);else{Math.sqrt(2);for(let i=n.min.x;i<=n.max.x;i+=m)e.newline(),e.emit(i,n.min.y),e.emit(i+1e3,n.max.y+1e3);for(let i=n.min.y;i<=n.max.y;i+=m)e.newline(),e.emit(n.min.x,i),e.emit(n.min.x+1e3,i+1e3)}}function s(e){var n=e.bounds(),i=Math.max(n.max.x-n.min.x,n.max.y-n.min.y),t,m=i/Math.floor(i/e.lineWidth()*e.density()),i=Math.floor(e.zIndex()/e.repeat())%2;if(1==i)for(let i=n.min.x;i<=n.max.x;i+=m)e.newline(),e.emit(i,n.min.y),e.emit(i,n.max.y);else if(0==i)for(let i=n.min.y;i<=n.max.y;i+=m)e.newline(),e.emit(n.min.x,i),e.emit(n.max.x,i)}function d(n){var t=n.bounds(),i=t.max.x-t.min.x,e=t.max.y-t.min.y,m=n.offset(),l=n.lineWidth()/2,o=1/n.density()*(1.25*n.lineWidth()),r=o+2*m+l,a=i/r,x=e/o;for(let e=0;e<=a;e++){n.newline();for(let i=0;i<=x;i++){var f=e*r+t.min.x,s=i*o+t.min.y;(e+i)%2?(n.emit(f,s),n.emit(f+r-m-l,s+o)):(n.emit(f+r-m-l,s),n.emit(f,s+o))}}for(let i=0;i<=a;i++){var y,d=i*r+t.min.x+r-l/2-m/2;n.newline(),n.emit(d,t.min.y),n.emit(d,t.max.y)}}});"use strict";gapp.register("kiri-mode.fdm.post",[],(e,l)=>{const{base:f,kiri:t}=e;var{driver:s}=t,{polygons:e}=f;const{fillArea:m}=e,{FDM:D}=s,k=e;function y(){function e(t){let s=[];for(let e=0,l=t.length;e<l;e+=2)s.push({a:t[e],b:t[e+1],l:t[e].distTo2D(t[e+1])});return s}let l=[...arguments].filter(e=>e);if(!(l.length<1)){let o=e(l.shift());for(;l.length;){let s=e(l.shift());e:for(let e=0,l=o.length;e<l;e++){let t=o[e];if(!t.del)for(let l=0,e=s.length;l<e;l++){let e=s[l];e.del||f.util.intersect(t.a,t.b,e.a,e.b,f.key.SEGINT)&&(t.l<e.l?e.del=!0:t.del=!0)}}o=o.filter(e=>!e.del).concat(s.filter(e=>!e.del))}let t=[];for(let e=0,l=o.length;e<l;e++){var s=o[e];t.push(s.a),t.push(s.b)}return 2<t.length?t:[]}}f.slicePost.FDM=function(e,l){var{z:t,lines:s,groups:o}=e;const{useAssembly:f,post_args:i,zIndexes:r}=l,{process:a,isSynth:n,isDanger:p,vaseMode:h}=i;var{shellOffset:c,fillOffset:d,clipOffset:u}=i;if(e.tops=k.nest(o),n){const a=i.process;return 0<a.sliceSupportGrow&&(e.tops=k.expand(e.tops,a.sliceSupportGrow,e.z,[])),void delete e.groups}var g=r.indexOf(t),l=D.getRangeParameters(a,g),o=l.sliceShells-(0|l.sliceShells),l,v,l,m,y;let _=0|l.sliceShells;o&&(l=.5<o?1-o:o,l=Math.round((1-l)/l)+1,_+=(.5<o?1:l-1)<=g%l?1:0);var b,S=a.sliceHeight,g=0===g&&a.firstLayerLineMult||1,A=n?1:_,E=c*g,T=d*g,z=n?void 0:a.sliceDetectThin,M;const w=[];for(M of e.tops)w.push(D.doTopShells(t,M,A,E/2,E,T,{thinType:z,vaseMode:h,useAssembly:f}));e.clip=u?k.offset(w.map(e=>e.simple),u):void 0,e.tops=w,delete e.groups},D.doTopShells=function(t,s,o,f,i,l,r={}){(s=!s.poly?{poly:s}:s).simple=s.poly.simple();let a=r.useAssembly,n=[s.poly];r.vaseMode&&(s.poly=s.poly.clone(!1)),s.shells=[],s.fill_off=[],s.fill_lines=[];let p=[],h=[];if(o)if(0===f&&1===o)p=n.clone(!0),s.shells=p;else switch(n.forEach(e=>{var l;e.open&&e.first().distTo2D(e.last())<1&&(e.open=!1)}),r.thinType){case"type 1":s.thin_fill=[],s.fill_sparse=[];let e=k.inset(n,i,o,t,!0);p=e.last().mid,s.shells=e.map(e=>e.mid).flat(),s.gaps=e.map(e=>e.gap).flat();var c=i,d=.75*c,u=4*c,g;for(g of e.map(e=>e.gap).flat()){var v=g.centers(c/2,t,d,u,{lines:!1});s.fill_sparse.appendAll(v)}break;case"type 2":s.thin_fill=[];let l={z:t,count:o,gaps:[],outs:[],minArea:.05,wasm:a};k.offset(n,[-f,-i],l),l.outs.forEach((e,t)=>{e.forEach(e=>{if(e.depth=t,e.fill_off&&e.fill_off.forEach(e=>e.depth=t),e.inner)for(var l of e.inner)l.depth=e.depth;s.shells.push(e)}),p=e}),l.gaps.forEach((e,l)=>{var l=0==l?f:i;e=k.offset(e,.8*-l,{z:t,minArea:0,wasm:a}),s.thin_fill.appendAll(y(m(e,45,l/2,[],.01,2*l),m(e,135,l/2,[],.01,2*l))),h=e});break;default:k.offset(n,[-f,-i],{z:t,wasm:a,count:o,outs:s.shells,flat:!0,call:(e,l)=>{for(var t of p=e)if(t.depth=o-l,t.fill_off&&t.fill_off.forEach(function(e){e.depth=-(o-l)}),t.inner)for(var s of t.inner)s.depth=t.depth}})}else p=[s.poly];var r;return l&&0<p.length&&(h.length&&(r=[],k.subtract(p,h,r,null,t),p=r),p.forEach(function(e){k.offset([e],-l,{outs:s.fill_off,flat:!0,z:t})})),s.last=p,s}});"use strict";gapp.register("kiri.consts",[],(e,a)=>{var n,m,i,t,r,c;a({PMODES:{SPEED:1,TOOLS:2},COLOR:{wireframe:4473924,wireframe_opacity:.25,selected:[12320512,12316160,12311808,12294400],deselected:[16776960,16768256,16759552,16750848],model_opacity:1,preview_opacity:0,slicing:16755370,slicing_opacity:.5,sliced_opacity:0,cam_preview:8947848,cam_preview_opacity_dark:.2,cam_preview_opacity:.1,cam_sliced_opacity:.2},LISTS:{shell:[{name:"in-out"},{name:"out-in"}],start:[{name:"last"},{name:"center"},{name:"origin"},{name:"random"}],infill:[{name:"hex"},{name:"grid"},{name:"linear"},{name:"triangle"},{name:"gyroid"},{name:"vase"}],units:[{name:"mm"},{name:"in"}],antialias:[{name:"1",id:1},{name:"2",id:2},{name:"4",id:4},{name:"8",id:8}],detail:[{name:"100"},{name:"75"},{name:"50"},{name:"25"}],linetype:[{name:"path"},{name:"flat"},{name:"line"}],filasrc:[{name:"direct"},{name:"palette3"}],animesh:[{name:"100"},{name:"200"},{name:"300"},{name:"400"},{name:"500"},{name:"600"},{name:"700"},{name:"800"},{name:"900"},{name:"1000"},{name:"1500"},{name:"2000"},{name:"2500"},{name:"3000"},{name:"4000"}],select:[{name:"loops"},{name:"lines"}],trace:[{name:"follow"},{name:"clear"}],traceoff:[{name:"none"},{name:"inside"},{name:"outside"}],zanchor:[{name:"top"},{name:"middle"},{name:"bottom"}],xyaxis:[{name:"X"},{name:"Y"}],regaxis:[{name:"X"},{name:"Y"},{name:"-"}],regpoints:[{name:"2"},{name:"3"}],thin:[{name:"off"},{name:"type 1"},{name:"type 2"}]},MODES:{FDM:1,LASER:2,CAM:3,SLA:4},VIEWS:{ARRANGE:1,SLICE:2,PREVIEW:3},SEED:"kiri-seed",beltfact:Math.cos(Math.PI/4)})});"use strict";gapp.register("kiri-mode.fdm.prepare",[],(t,e)=>{const{base:ne,kiri:se,noop:r}=t,{consts:l,driver:o,newSlice:n,utils:s,render:ae}=se,{config:a,polygons:p,paths:u,util:et,newPoint:pe,newPolygon:ue,Polygon:rt}=ne,{poly2polyEmit:de,tip2tipEmit:it}=u,{numOrDefault:lt}=et;var{fillArea:d}=p;const{beltfact:fe}=l,{FDM:f}=o,{getRangeParameters:ce}=f,he=p;function xe(M,z,w,e,t,p={}){var{settings:r}=M,{device:l}=r,{bedWidth:o,bedDepth:n,bedRound:s}=l,o,n;let D=[],u=p.params||r.process,a=u.outputOriginCenter||s,k=z.extruder||0,d=u.sliceLineWidth||l.extruders[k].extNozzle,f=!!p.first&&!p.support,L=d*(p.thinWall||1.75),R=p.retractOver||2,E=p.mult||u.outputFillMult,c=p.mult||u.outputShellMult||(0<=u.laserSliceHeight?1:0),h={"out-in":-1,"in-out":1}[u.sliceShellOrder]||-1,x=u.outputSparseMult,y=u.outputCoastDist||0,m=p.speed||u.outputFinishrate,g=u.firstLayerRate,v=u.firstLayerFillRate,b=u.firstLayerPrintMult,T=p.speed||(f?g:u.outputFeedrate),B=p.speed||p.fillSpeed||(f?v||g:u.outputFeedrate),P=u.sliceFillRate||p.infillSpeed||B||T,A=u.outputSeekrate,O=w.add(e),F=u.zHopDistance||0,_=u.antiBacklash,S=u.outputRetractWipe||0,C=l.bedBelt,W=a?{x:0,y:0,z:0}:{x:o/2,y:C?0:n/2,z:0},N=u.outputBeltFirst||!1,I=w.clone(),Z=p.seedPoint||w,q=M.lastPoly&&M.lastPoly.perimeter()<u.outputShortPoly,H=z.z,G;function j(){let r=D.length?D:t;if(r.length){let e=r.last();if(e.retract=!0,S&&G&&e.point){var i=G.center(!0),l=e.point.distTo2D(i),l=Math.min(S,l);let t=e.point.followTo(i,l);t.inPolygon(G)&&M.addOutput(r,t,null,null,e.tool)}}else p.pretract?p.pretract(S):console.log("unable to retract. no preout or output")}function X(r,i){if(z.index<0)return!1;let l=!1;return z.topPolysFlat().forEach(t=>{l||t.forEachSegment((t,e)=>{if(et.intersect(r,i,t,e,ne.key.SEGINT))return l=!0})}),l&&p.routeAround?!Y(r,i):l}function Y(a,p){var t=!1,e;!1===z.index&&console.log(z.index,{p1:a,p2:p,d:a.distTo2D(p)});let u=[];for(let r of z.topRouteFlat())r.forEachSegment((t,e)=>{var e=et.intersect(a,p,t,e,ne.key.SEGINT);e&&u.push({ip:e,poly:r})});if(0!==u.length)if(u.length&&u.length%2!=0)!1===z.index&&console.log(z.index,{odd_intersects:u});else{u.sort((t,e)=>t.ip.dist-e.ip.dist),!1===z.index&&console.log(z.index,{ints:u});for(let e=0;e<u.length;e+=2){let t=u[e];var r=u[e+1];if(t.poly!==r.poly)return void(!1===z.index&&console.log(z.index,{int_diff_poly:u,i:e}));t.ip.distTo2D(r.ip)<R&&(!1===z.index&&console.log(z.index,{int_dist_too_small:t.ip.distTo2D(r.ip),retractDist:R}),u[e]=void 0,u[e+1]=void 0)}if(u=u.filter(t=>t),2<u.length)!1===z.index&&console.log(z.index,{complex_route:u.length});else if(2===u.length){for(let t=0;t<u.length;t+=2){var d=u[0],f=u[1];M.addOutput(D,d.ip,0,A,k);let t=d.poly;var c=t.isClockwise();let e=t.points,r=c?e:e.slice().reverse(),i=c?e.slice().reverse():e;var h=r.indexOf(c?d.ip.p2:d.ip.p1),x=r.indexOf(c?f.ip.p1:f.ip.p2);let l=h===x?[r[h]]:h<x?[...r.slice(h,x+1)]:[...r.slice(h),...r.slice(0,x+1)],o=0;for(let t=1;t<l.length;t++)o+=l[t-1].distTo2D(l[t]);var y=i.indexOf(c?d.ip.p1:d.ip.p2),m=i.indexOf(c?f.ip.p2:f.ip.p1);let n=y===m?[i[y]]:y<m?[...i.slice(y,m+1)]:[...i.slice(y),...i.slice(0,m+1)],s=0;for(let t=1;t<n.length;t++)s+=n[t-1].distTo2D(n[t]);var g=o<=s?l:n,v;!1===z.index&&console.log(z.index,{ints:u.map(t=>t.ip.dist),i1:d,i2:f,same:d.poly===f.poly,route:g,p1:a,p2:p,dist:a.distTo2D(p),r1:l,r1d:o,r1s:h,r1e:x,r2:n,r2d:s,r2s:y,r2e:m,isCW:c});for(v of g)M.addOutput(D,v,0,A,k);M.addOutput(D,f.ip,0,A,k)}return 1}}else!1===z.index&&console.log(z.index,"no ints")}function J(t,i={}){if(t)if(Array.isArray(t))if(i.sort){let e=t.slice().sort((t,e)=>(t.perimeter()-e.perimeter())*i.sort);var l=3<e.length;let r;for(;e.length;){let t;for(var o of e){if(!r){t=o;break}if(0<i.sort){if(r.isInside(o)){t=o;break}}else if(o.isInside(r)){t=o;break}}t?(r=t,e.remove(t),J(t,i)):r=null}}else V(t,function(t){J(t,i)},null);else{var e=0===t.depth&&!f;w=M.polyPrintPath(t,w,D,{ccw:i.shell&&u.outputAlternating&&z.index%2,tool:k,rate:e?m:T,accel:e,wipe:u.outputWipeDistance||0,coast:f?0:y,extrude:lt(i.extrude,c),onfirst:function(t){let e=Z||w;e.distTo2D(t)>R&&X(e,t)&&j(),Z=null}}),G=z.lastPoly=t}}function K(t,a,p){if(t){var t=t.map(t=>({poly:t,first:t.first(),last:t.last()}));let s=w;w=it(t,w,(t,e,r)=>{let n=t.poly;return n.last()===e&&n.reverse(),n.forEachPoint((t,e)=>{var r=s.distTo2D(t),i,l=r>R&&X(s,t);let o=a;0===e&&(l?(j(),o=0):r>d&&(o=0)),void 0!==n.z&&(t=t.clone().setZ(n.z)),M.addOutput(D,t,o,p||T,k),s=t},!n.open),s})}}function Q(e){if(e){var r=e.group(2).map(t=>{var[e,t]=t;return pe((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2)}),e=et.orderClosest(r,(t,e)=>t.distTo2D(e));if(0!==e.length){var r=r[0],i,l;let t=r;w&&w.distTo2D(r)>L&&X(w,r)&&j(),M.addOutput(D,r,0,A,k);for(i of e){(t?t.distTo2D(i):0)>L&&(j(),M.addOutput(D,i,0,A,k)),M.addOutput(D,i,1,B,k),w=t=i}t&&t.distTo2D(r)<=L&&(M.addOutput(D,r,1,B,k),w=r)}}}function U(b,T={}){if(b&&0!==b.length){let e,r,l,o,t,n,s,a,p,u,d=0,f=0,c=!1,h=-1,x=T.raft||!1,y=T.flow||1,m=T.near||!1,g=T.fast||!1,v=(0<=T.fill?T.fill:E)*y,z=L;for(;b&&d<b.length;){if(s=null,n=!1,a=1/0,m)for(let t=0;t<b.length;t+=2){var P,O;p=b[t],p.del||(u=b[t+1],P=p.distToSq2D(w),O=u.distToSq2D(w),(P<a||O<a)&&(O<P?(l=p,r=u):(r=p,l=u),a=Math.min(P,O),h=t))}if(!m)for(let t=f;t<b.length;t+=2)if(!(e=b[t]).del&&(null===s&&e.index>h&&(s=e.index),null!==s)){if(e.index!==s)break;e.index%2==0?(p=b[t],u=b[t+1]):(u=b[t],p=b[t+1]),o=Math.min(p.distTo2D(w),u.distTo2D(w)),o<a&&(r=p,l=u,a=o),f=t,n=!0}if(m||n){var S;o=w.distToSq2D(r),t=r.distToSq2D(l),m||g||c||!(o>R)?(c=!1,S=h<0,r.del=!0,l.del=!0,d+=2,h=r.index,o<=z&&t<=z?l=r.midPointTo(l):(!g&&o>R&&(F||X(w,r))&&j(),!g&&_&&o>R&&M.addOutput(D,r.add({x:_,y:-_,z:0}),0,A,k),o<z||x&&!S?M.addOutput(D,r,v,B,k):M.addOutput(D,r,0,A,k)),M.addOutput(D,l,v,B,k),w=l):(c=!0,f=0,h=-1)}else{if(0===f&&-1===h){console.log("infinite loop",b,{marked:d,i:i,group:s,start:f,lastIndex:h,points:b.map(t=>t.index).join(", ")});break}f=0,h=-1}}b&&b.forEach(t=>{t.del=!1})}}function V(e,t,r){if(1===e.length)return t(e[0]);e=e.slice();let i,l,o,n,s,a=0;for(;;){n=[],i=null;for(let t=0;t<e.length;t++)(o=e[t])&&(s=r?r(o):o,l=s.findClosestPointTo(w),n.push({i:t,n:o,d:l.distance-s.depth*L}));if(0===n.length)return;q?(q=!1,n.sort((t,e)=>e.d-t.d)):n.sort((t,e)=>t.d-e.d),e[n[0].i]=null,t(n[0].n)}}z.finishSolids&&(B=u.sliceSolidRate||m),f&&(E*=b,c*=b,x*=b);let $=[];z.tops&&$.appendAll(z.tops),p.support&&z.supports&&$.appendAll(z.supports);let tt=null;V($,function(e){if(e instanceof rt)M.setType("support"),e.setZ(H),!1!==u.sliceSupportOutline&&J([e].appendAll(e.inner||[])),e.fill&&(e.fill.forEach(t=>{t.z=H}),U(e.fill,{fast:!0,near:!0}));else{var r=e,t=r.isRaft;switch(M.setType("shells"),tt&&tt!==e&&j(),u.sliceLayerStart){case"last":break;case"random":let t=r.poly.bounds;var i=t.center(),l=Math.max(t.width(),t.height()),o=Math.random()*Math.PI*2,n=i.x+Math.cos(o)*l,l=i.y+Math.sin(o)*l;w=pe(n,l,w.z);break;case"center":w=pe(0,0,w.z);break;case"origin":w=pe(-W.x,-W.y,w.z);break;case"position":w=pe(-W.x+u.sliceLayerStartX,-W.y+u.sliceLayerStartY,w.z)}C&&p.onBelt&&(w=I,N&&(h=-1)),r.traces&&J(r.traces);var s=e.innerShells()||[],a=e.shells||[];1===h&&J(s,{sort:h,shell:!0}),J(a,{sort:h,shell:!0}),-1===h&&J(s,{sort:h,shell:!0}),M.setType("thin fill"),Q(e.thin_fill),M.setType("solid fill"),U(e.fill_lines,{flow:E,raft:t}),M.setType("sparse infill"),K(e.fill_sparse,x,P),tt=e}},function(t){return t instanceof rt?t:t.poly}),z.tops&&z.tops.length&&z.tops[0].polish&&({x:o,y:n}=z.tops[0].polish,o&&K(o,0,u.polishSpeed),n&&K(n,0,u.polishSpeed));for(let t=0;t<D.length;t++)D[t].point=D[t].point.add(e);return M.addPrintPoints(D,t,O,k),w.add(e)}f.prepare=async function(r,t,l){r=r.filter(t=>!t.track.ignore&&!t.meta.disabled);let{device:u,process:h,controller:e,bounds:x,mode:i}=t,{sliceHeight:o,firstSliceHeight:n,firstLayerRate:d,sliceSupportOutline:s}=h,{outputSeekrate:f,outputDraftShield:a,outputPurgeTower:y}=h,{bedWidth:p,bedDepth:c,filamentSource:m}=u,{lineType:g,danger:v}=e,z=pe(0,0,0),b=self.worker.print=se.newPrint(t,r),T=h.sliceLineWidth||u.extruders[0].extNozzle,P=u.bedBelt,O="line"===g,S="flat"===g,M=v||!1,w="palette3"===m,D=h.outputRaft||!1,k=!P&&n||o,L=0,R=0,E=0,B=0,A,F=[],_=[];var C=null,W,N,I,Z,q,H,G,j;if(!x){x=new THREE.Box3;for(var X of r){var Y=X.track.pos;let t=X.bounds.clone();t.min.x+=Y.x,t.max.x+=Y.x,t.min.y+=Y.y,t.max.y+=Y.y,x.union(t)}t.bounds=x}if(!P&&(h.outputBrimCount||D)){let o=[],n=h.outputBrimOffset||(D?4:0);if(r.filter(t=>t.slices.length).forEach(function(r){let e=[],t=[];a?t.appendAll(r.slices):t.push(r.slices[0]);for(var i of t)i.tops&&i.tops.forEach(function(t){e.push(t.poly.clone())}),i.supports&&i.supports.forEach(function(t){e.push(t.clone())});a&&(e=he.union(e,1,!0)),he.nest(e).forEach(function(t){let e=t.offset(-n+T/2);e&&e.forEach(function(t){t.move(r.track.pos),o.push(t)})})}),o=he.union(o,void 0,!0),1<o.length&&n>=T&&(W=h.sliceSupportExtra+2,N=o[0].getZ(),o=he.expand(o,W,N,null,1),o=he.expand(o,-W,N,null,1)),D){let a=pe(0,0,0),t=T,e=h.sliceFillAngle,r=d/3,i=h.outputFeedrate,p=h.outputBrimCount?he.expand(o,4*T,0,null,1):o;function J(t,e,r,i,l,o){let n=se.newSlice(E+t/2);for(var s of p){null===z&&(z=s.first());let t=n.addTop(s);o&&(t.traces=[s]),t.inner=he.expand([s],-.8*T,0,null,1),t.fill_lines=he.fillArea(t.inner,e,r,[]),t.isRaft=!0}a.z=n.z,z=xe(b,n,z,a,_,{speed:i,mult:l}),_.z=E+t,_.height=t,F.append(_),_=[],E+=t,R=t/2}z=null,J(1.5*T,e+0,6*T,r,2.5,!0),J(.5*T,e+90,2*T,i,1.5,!0),J(.5*T,e+0,+T,i,1),J(.5*T,e+90,.75*T,i,.75),k+=h.outputRaftSpacing||0,E+=h.outputRaftSpacing||0,F.last().last().retract=!0}if(h.outputBrimCount){let t=[],l=[];he.offset(o,T,{outs:t,flat:!0,count:h.outputBrimCount,z:k/2+E-R}),b.setType("brim"),A=he.nest(t.clone(),!0).clone();var N=n<2*T?pe(-p,-c,0):z;z=de(t,N,(t,e,r,i)=>b.polyPrintPath(t,i,l,{rate:d,onfirst:function(t){l.length&&2<t.distTo2D(i)&&(l.last().retract=!0)}})),b.addPrintPoints(l,_,null),l.length&&(l.last().retract=!0)}let e=ne.newBounds();o.forEach(t=>{e.merge(t.bounds)}),x.min.x=Math.min(x.min.x,e.minx),x.min.y=Math.min(x.min.y,e.miny),x.max.x=Math.max(x.max.x,e.maxx),x.max.y=Math.max(x.max.y,e.maxy)}for(I of r.slice()){let e=[];if(I.slices){for(var K of I.slices)if(B=Math.min(B,K.z),K.supports){let t=se.newSlice(K.z);t.extruder=h.sliceSupportNozzle,t.supports=K.supports.slice(),t.height=K.height,e.push(t)}if(e.length){let t=se.newWidget(null,I.group);t.slices=e,t.support=!0,t.belt=I.belt,t.track=Object.clone(I.track),t.mesh={widget:t,position:t.track.pos},I.anno.extruder=h.sliceSupportNozzle,r.push(t)}}else console.log("invalid widget",I)}let Q,U,V,$=b.extruders=[],tt=0;for(Z of r){var et=Z.anno.extruder||0;$[et]||($[et]={},tt++)}let rt=Math.sqrt(y||0),it=rt,lt,ot,nt;function st(t,e){var r=tt-1,i=T,l,o,n,s,a,p,u,d,f,u,u,p,c,h,r;nt=P?(l=t+i,o=(x.max.y+x.min.y)/2,n=x.max.y-x.min.y,a=t/2-(t*r+i*(r-1))-i/2,lt={y:a,x:x.max.x+2+e/2},ot={y:l,x:0},{x:e,y:t}):(ot=x.min.x<x.min.y?(p=e+i,u=(x.max.x+x.min.x)/2,d=x.max.x-x.min.x,u=u-(e*r+i*(r-1))/2+p/2,lt={x:u,y:x.max.y+2+t/2},{x:p,y:0}):(u=t+i,p=(x.max.y+x.min.y)/2,c=x.max.y-x.min.y,r=p-(t*r+i*(r-1))/2+u/2,lt={y:r,x:x.max.x+2+e/2},{y:u,x:0}),{x:t,y:e})}function at(t,e=45,r=6){let i=u.extruders[t],l=i.extNozzle,o={x:lt.x+ot.x*t,y:lt.y+ot.y*t,z:0},n=ue().centerRectangle(o,nt.x,nt.y),s=ut(he.fillArea([ue().centerRectangle(o,nt.x-l,nt.y-l)],e,l)),a=10<n.area()?ut(he.fillArea([ue().centerRectangle(o,nt.x-l,nt.y-l)],e+90,l*r)):ue(),p={extruder:t,diameter:i.extNozzle,rect:n,full:s,sparse:a,pause:pe(o.x+ot.y,o.y+ot.x,o.z)};return p}st(rt,it);let pt=$.slice(1).map((t,e)=>t&&at(e));function ut(e){let r=ue().setOpen(),i=0;for(let t=0;t<e.length;t+=2){var l=e[t],o=e[t+1];i++%2==0?(r.push(l),r.push(o)):(r.push(o),r.push(l))}return r}let dt=!1,ft;function ct(t,e,l,o,n,r,s){if(!y||tt<2)return o;let a=e.shift();var p=0<=r||ft===t,u=0<=r?r:t,d=P?!dt&&0<=l.slice.index:0===l.slice.index,p,n,s;let f=d?h.firstLayerRate:h.outputFeedrate,c=!0;if(ft=u,a){b.setType("purge tower"),l.last()&&(l.last().retract=!0),dt=dt||d;let e=d||!p;P&&n<0&&(p=1-n/B,st(rt*p,it),a=at(a.extruder,0,10),f=(h.outputFeedrate-h.firstLayerRate)*p+h.firstLayerRate,c=!1);let t=a.rect.clone().setZ(n),r=a.pause.clone().setZ(n),i=(0<=n&&e?a.full:a.sparse).clone().setZ(n);return P&&(n={x:0,y:n,z:0},t.move(n),r.move(n),i&&i.move(n),s&&(s={x:0,y:s.y,z:s.z},t.move(s),r.move(s),i&&i.move(s))),o=b.polyPrintPath(t,o,l,{tool:u,rate:f,simple:!0,open:!1,onfirstout:t=>t.overate=P?f:0}),i&&i.length&&(o=b.polyPrintPath(i,o,l,{tool:u,rate:f,simple:!0,open:!0,onfirst:t=>{t.purgeOn=e?r:void 0}})),l.last().retract=!0,c&&(o=b.polyPrintPath(t,o,l,{tool:u,rate:f,simple:!0,open:!1,extrude:0})),l.last().overate=0,o}return console.log({no_purge_tower_for:t,using:r,track:e,layer:l}),o}for(q of r){var{belt:ht}=q,xt;let t=Object.clone(q.track.pos);P?(xt=ht.ypos*fe,t={x:ht.xpos,y:xt,z:xt}):t.z=E,q.offset=t}let yt=[],mt={};for(H of r)if(H.mesh)for(var gt of H.slices){gt.widget=H;var vt=(gt.z+H.offset.z).round(2);let t=mt[vt]=mt[vt]||{z:vt,slices:[]};0===t.slices.length&&yt.push(t),t.slices.push(gt)}yt.sort((t,e)=>t.z-e.z);let zt,bt,Tt,Pt;for(G of yt){let i=pt.slice();for(;;){let e=[];for(var Ot of G.slices)if(!Ot.prep){var St=V=Ot.widget.offset,Mt=Ot.findClosestPointTo(z.sub(St));if(Mt){var wt=Ot.extruder,Dt=Tt;let t=Math.abs(Mt.distance);wt!==Dt&&(t*=1e4),void 0===Tt&&0<wt&&(t*=1e4),e.push({dst:t,slice:Ot,offset:St,z:G.z})}}if(0===e.length)break;e.sort((t,e)=>t.dst-e.dst);let{z:t,slice:r,offset:o}=e[0];void 0===zt&&(zt=r.extruder),Pt&&Pt.widget!==r.widget&&F.length&&(F.last().last().retract=!0);var kt=ce(h,r.index);r.prep=!0,_.length&&r.widget!==bt&&(_.last().retract=!0),bt=r.widget,_.z=t+r.height/2,_.height=_.height||r.height,_.slice=r,_.params=kt,_.anchor=r.belt&&r.belt.anchor,Pt&&Pt.extruder===r.extruder||0<=r.extruder&&(z=ct(r.extruder,i,_,z,r.z,void 0,o));var Lt=r.widget.track.box,Rt=r.belt&&r.belt.touch;b.setType("layer"),z=xe(b,r,Rt?pe(-5e3,5e3,0):z.sub(o),o,_,{routeAround:h.outputAvoidGaps,seedPoint:z.sub(o),danger:M,params:kt,first:0===r.index,support:r.widget.support,onBelt:Rt,pretract:r=>{if(U&&U.length){let e=U.last().set_retract();if(r&&Q&&e.point){var i=Q.center(!0).add(o),l=e.point.distTo2D(i),l=Math.min(r,l);let t=e.point.followTo(i,l);t.inPolygon(Q)&&b.addOutput(U,t,null,null,e.tool)}}}}),Pt=r,Tt=Pt.extruder,Q=r.lastPoly,U=_,kt.outputLayerRetract&&_.length&&(_.last().retract=!0)}for(var Et of r)if(Et.mesh)for(var Bt of Et.slices)Bt.prep=!1;if(0<L&&A&&a){b.setType("shield"),A=he.setZ(A.clone(),z.z);let l=[];z=de(A,z,(t,e,r,i)=>b.polyPrintPath(t,i,l,{onfirst:function(t){l.length&&2<t.distTo2D(i)&&(l.last().retract=!0)}})),l.last().retract=!0,_.appendAll(l)}Pt&&i.slice().forEach(t=>{z=ct(t.extruder,i,_,z,Pt.z,Tt,V)}),_.length&&F.append(_),L===yt.length-1&&_.length&&(_.last().retract=!0),_.layer=L++,l(L/yt.length*.5,"prepare"),_=[]}if(b.output=F,P){let u=1/0;for(var At of F)for(var Ft of At){var Ft=Ft.point;u=Math.min(u,Ft.z-Ft.y)}b.belty=u,u+=.25*k;for(var _t of F){var Ct=ce(h,_t.layer||0),Wt=Ct.firstLayerBrim<0,Nt=Math.abs(Ct.firstLayerBrim),It=Ct.firstLayerBrimIn||0,Zt=Ct.firstLayerBrimTrig||0,qt=Ct.firstLayerBrimGap||0,Ht;let t,e=!1,r=1/0,i=-1/0,l=1/0,o=-1/0,n=1/0,s=1/0,a=[],p=0;for(Ht of _t){p=0<=Ht.overate?Ht.overate:p;var Gt=Ct.firstLayerRate||d,jt=Ct.firstLayerPrintMult||Ct.firstLayerPrintMult,Xt=Ht.point,Yt=Ht.belty=-Xt.y+Xt.z,Gt=!(Yt<=u)&&p||Gt;s=Math.min(s,Yt),_t.anchor&&(Ht.speed=Math.min(Ht.speed,Gt)),Ht.emit&&Yt<=u&&t&&Math.abs(t.belty-Yt)<.005&&(Ht.speed=Ct.firstLayerRate||Math.min(Ht.speed,Gt),Ht.emit*=jt,Ht.fan=Ct.firstLayerFanSpeed,l=Math.min(l,Xt.x,t.point.x),o=Math.max(o,Xt.x,t.point.x),i=Math.max(i,Xt.y),r=Math.min(r,Xt.z),e=Ht,n=Math.min(n,t.point.distTo2D(Ht.point)),1<Xt.x-t.point.x&&a.push([t.point.x,Xt.x])),t=Ht}if(e&&!_t.anchor){var Jt=[],Zt=0===Zt||Zt&&n<=Zt,Kt;if(Math.max(Nt,It)&&Zt){var{emit:Qt,tool:Ut}=e,Vt=i,$t=r,te=qt||0,qt=Math.max(Nt,1)+te,ee=Math.max(It,1)+te;if(_t.last().retract=!0,Nt&&!Wt&&(b.addOutput(Jt,pe(o+qt,Vt,$t),0,f,Ut),b.addOutput(Jt,pe(o+te,Vt,$t),Qt,d,Ut).retract=!0),It&&1<a.length){var re=[],ie;let t=a[0];for(ie of a.slice(1)){var le=t[1],oe=ie[0];t=ie,2*ee<oe-le?(b.addOutput(Jt,pe(oe-te,Vt,$t),0,f,Ut),b.addOutput(Jt,pe(oe-ee,Vt,$t),Qt,d,Ut).retract=!0,b.addOutput(Jt,pe(le+ee,Vt,$t),0,f,Ut),b.addOutput(Jt,pe(le+te,Vt,$t),Qt,d,Ut).retract=!0):ee/3<oe-le&&(b.addOutput(Jt,pe(oe-te,Vt,$t),0,f,Ut),b.addOutput(Jt,pe(le+te,Vt,$t),Qt,d,Ut).retract=!0)}}Nt&&(b.addOutput(Jt,pe(l-qt,Vt,$t),0,f,Ut),b.addOutput(Jt,pe(l-te,Vt,$t),Qt,d,Ut).retract=!1)}_t.splice(0,0,...Jt)}}}!1!==t.render&&await ae.path(F,(t,e)=>{l(.5+.5*t,"render",e)},{lineWidth:t.process.sliceLineWidth,toolMode:2===t.pmode,tools:u.extruders,thin:O,flat:S,fdm:!0})}});"use strict";gapp.register("kiri-mode.fdm.slice",[],(e,t)=>{const{base:_e,kiri:O,noop:l}=e,{consts:i,driver:s,fill:F,fill_fixed:R,newSlice:Te,utils:o}=O,{config:Pe,polygons:n,util:Le,newPoint:H}=_e,{fillArea:r}=n,{beltfact:Ae}=i,{FDM:a}=s,{doTopShells:f,getRangeParameters:ke}=a,Oe=n,Fe=Le.pwait,p=.6,c=1,g={anchor:{check:10066227,face:10066227,line:10066227,opacity:1,lopacity:p},shell:{check:30651,face:30651,line:30651,opacity:1,lopacity:p},fill:{check:47991,face:47991,line:47991,opacity:1,lopacity:p},infill:{check:3351227,face:3351227,line:3351227,opacity:1,lopacity:p},support:{check:11162931,face:11162931,line:11162931,opacity:1,lopacity:p},gaps:{check:11154278,face:11154278,line:11154278,opacity:1,lopacity:p}},y=Object.clone(g),d=!1,Re=l,He=l,u=!1;let v=!1,w=!1,z=0;function h(e){if(e){if(w)return e.flat=!0,e.outline=!0,e;if(v)return null}return e}function m(i,s=1/0){const o=[];let n,r=0;for(let l=0;l<i.length;l+=2){let e=i[l],t=i[l+1];var a,a;r++%2==1&&(a=e,e=t,t=a),n&&e.distTo2D(n)<=s&&(a=e.clone(),o.push(n),o.push(a)),o.push(e),o.push(t),n=t.clone()}let e=0;for(var t of o)t.index=e++/2|0;return o}function b(e,t,l){return Math.max(t,Math.min(l,e))}function Be(i,t,e,l){const s=i.output(),o=i.height/2,n=e.sliceFillWidth||1;if(i.tops&&i.tops.forEach(e=>{v&&s.setLayer("part",{line:3355443,check:3355443}).addPolys([e.poly]),s.setLayer(t?"support":"shells",t?g.support:g.shell).addPolys(e.shells||[],h({offset:z,height:o,clean:!0})),s.setLayer("solid fill",t?g.support:g.fill).addLines(e.fill_lines||[],h({offset:z*n,height:o,z:i.z})),i.belt&&i.belt.anchor||s.setLayer("sparse fill",g.infill).addPolys(e.fill_sparse||[],h({offset:z,height:o,outline:!0,trace:!0})),i.belt&&i.belt.anchor&&s.setLayer("anchor",g.anchor).addPolys(e.fill_sparse||[],h({offset:z,height:o,outline:!0,trace:!0})),e.thin_fill&&s.setLayer("thin fill",g.fill).addLines(e.thin_fill,h({offset:z,height:o})),e.gaps&&s.setLayer("gaps",g.gaps).addPolys(e.gaps,h({offset:z,height:o,thin:!0})),v&&l&&e.fill_off&&e.fill_off.length&&i.output().setLayer("fill inset",{face:0,line:11184810,check:11184810}).addPolys(e.fill_off)}),v&&l&&(i.solids&&i.solids.length&&s.setLayer("solids",{face:12303104,check:12303104}).addAreas(i.solids),i.bridges&&i.bridges.length&&s.setLayer("bridges",{face:52428,line:52428,check:52428}).addAreas(i.bridges),i.flats&&i.flats.length&&s.setLayer("flats",{face:11141290,line:11141290,check:11141290}).addAreas(i.flats)),i.supports&&e.sliceSupportOutline&&s.setLayer("support",g.support).addPolys(i.supports,h({offset:z,height:o})),i.supports&&i.supports.forEach(e=>{e.fill&&s.setLayer("support",g.support).addLines(e.fill,h({offset:z,height:o}))}),i.xray){const r=[16711680,43520,255,11184640,16711935,0];i.lines&&i.lines.forEach((e,t)=>{var t=t%5;i.output().setLayer("l"+t,r[t]).addLine(e.p1,e.p2)}),i.groups&&Oe.nest(i.groups).forEach((e,t)=>{var l=t%5;i.addTop(e),i.output().setLayer("g"+t,r[l]).addPoly(e)})}}function De(e,t,l,i,s,o={}){for(var n of e.tops)f(e.z,n,t,l,i,s,o)}function We(e,l,i){e.xray||(0!==e.tops.length&&"number"==typeof i?(e.tops.forEach(function(e){var t=r(e.fill_off,i,l,null);e.fill_lines.appendAll(t)}),e.isSolidLayer=!0):e.isSolidLayer=!1)}function Ce(z,b={}){if(!z.xray){let g=b.process,t=b.spacing,y=b.density,v=b.bounds,m=b.height,x=!(!1===b.cache),w=b.type||"hex";if(0===z.tops.length||0===y||z.isSolidLayer||z.index<0)z.isSparseFill=!1;else{let l=z.tops,i=z.down,e=self.ClipperLib,s=e.ClipType,o=e.PolyType,n=e.PolyFillType,r=new e.Clipper,a=new e.PolyTree,f,p=[],c=[],d=[],u=[],h={slice:function(){return z},zIndex:function(){return z.index},zValue:function(){return z.z},options:function(){return b},lineWidth:function(){return b.lineWidth},bounds:function(){return v},zHeight:function(){return m},offset:function(){return t},density:function(){return y},repeat:function(){return g.sliceFillRepeat},emit:function(e,t){isNaN(e)?u.push(e):(d.push(H(e,t,z.z)),z.isSparseFill=!0)},newline:function(){0<d.length&&(c.push(d),d=[])}};if(w&&F[w]){F[w](h),h.newline();for(var S of l)S.fill_sparse=S.fill_sparse||[],p.appendAll(S.fill_off),p.appendAll(S.solids);z._fill_finger=Oe.fingerprint(p);var E=!(!x||!R[w]);let t=!1;if(E&&z.fingerprintSame(i)&&i._fill_finger&&Oe.fingerprintCompare(z._fill_finger,i._fill_finger)){for(let e=0;e<l.length;e++)i.tops[e].fill_sparse||(t=!0);if(!t)return void(z._clone_sparse=!0)}var E=z.isSparseFill;if(u.length)for(let i of l){if(!i.fill_off)return;let l=i.fill_off.slice();i.solids&&(l=Oe.subtract(l,i.solids,[],null,z.z));var M=g.sliceFillAngle*(z.index%2+1),_,T;for(_ of u){let e=[],t=[];for(var P of l){var P=_.mask(P);P&&P.length&&e.appendAll(P)}if(e.length&&Oe.expand(e,-b.lineWidth/2,z.z,t),e.length){z.isSparseFill=!0;for(var L of e)L.forEachSegment((e,t)=>{i.fill_lines.push(e,t)})}t.length&&(T=Oe.fillArea(t,M,b.lineWidth),i.fill_lines.appendAll(T))}}if(E)if(b.promises)b.promises.push(O.minions.clip(z,p,c));else if(c=c.map(e=>e.map(e=>e.toClipper())),r.AddPaths(c,o.ptSubject,!1),r.AddPaths(Oe.toClipper(p),o.ptClip,!0),r.Execute(s.ctIntersection,a,n.pftNonZero,n.pftEvenOdd))for(var A of a.m_AllPolys){f=Oe.fromClipperNode(A,z.z);for(var k of l)f.isInside(k.poly)&&k.fill_sparse.push(f)}}else console.log({missing_infill:w})}}}function Ve(l,e={}){const{sla:i,fakedown:s,grow:o,min:n}=e;if(!(l.index<=0&&!s||l.xray)){const r=l,a=l.down||(s?Te(-1):null),f=i?r.topPolys():r.topInners(),p=i?a.topPolys():a.topInners(),c=r.bridges=[],d=a.flats=[];if(l.fingerprintSame(a))return r.bridges=c,void(a.flats=d);let e=[],t=[];Oe.subtract(f,p,e,t,l.z,n,{wasm:!0}),e=e.filter(e=>e.areaDeep()>=n),t=t.filter(e=>e.areaDeep()>=n),0<o&&e.length&&(e=Oe.offset(e,o)),0<o&&t.length&&(t=Oe.offset(t,o)),c.appendAll(e),d.appendAll(t)}}function x(e,t){e.solids?e.solids.appendAll(t):t&&t.length&&console.log({no_solids_in:e,for:t})}function je(e,t,l){var i;e.down&&e.flats&&(e.flats.length&&(e.finishSolids=!0),e&&e.flats&&e.flats.length&&S(e,l?Oe.expand(e.flats,l):e.flats,t,!1,!0))}function Ie(e,t){e.up&&e.bridges&&(e.bridges.length&&(e.finishSolids=!0),S(e,e.bridges,t,!0,!0))}function Ze(i,s,o,n,r){let a=n||1,f=i.tops,p=i.solids;if(f&&p&&!i.isSolidLayer&&!i.xray){var c=Oe.union(p,void 0,!0,{wasm:!0}).flat(),n=void 0===s&&void 0===o;if(0!==p.length&&0!==c.length){let e=[],t=n?i.topPolys():i.topFillOff();for(var d of c){d.setZ(i.z);for(var u of t){var u=d.mask(u);u&&0<u.length&&e.appendAll(u)}}f.forEach(e=>{e.solids=[]}),i.solids=p=e;let l=!1;var h=f.length?f.map(e=>e.poly.areaDeep()).reduce((e,t)=>e+t):0,g,y,v;for(g of p)for(var m of f){let e=[];if(m.poly.overlaps(g)&&(!g.parent||g.parent.area()>m.poly.area())){if(g.areaDeep()<a)continue;g.parent=m.poly,m.solids.push(g),e.push(g)}}if(l){for(var x of f)x.solids=[];We(i,s,o)}else{if(n)return 1;for(var w of f)if(w.fill_lines){const E=[],M=[];var z=w.fill_lines=[],b;for(b of p)b.parent===w.poly&&(b.fillang?M:E).push(b);if(0<E.length&&_(r,E,o,s,z),0<M.length){w.fill_lines_ang={spacing:s,list:[],poly:[]};for(var S of M)_(r,[S],S.fillang.angle+45,s,z)}}}}}}function _(e,t,l,i,s,o,n){e?e.push(O.minions.fill(t,l,i,s,o,n)):Oe.fillArea(t,l,i,s,o,n)}async function Ne(i,e,t,l={}){let a=e.sliceSupportSpan||5,s=e.supportMinArea||.1,o=e.sliceSupportSize,n=e.sliceSupportOffset||0,r=e.sliceSupportGap,f=o||1,p=i.topPolys(),c=p,d=Oe.flatten(i.topShells().clone(!0)),u=i.topFill(),h=[],g=i.down,y=g?g.topPolys():null,v=g?Oe.flatten(g.topShells().clone(!0)):null;var m;l.exp&&y&&200<y.map(e=>e.deepLength).reduce((e,t)=>e+t)&&(y=g.topSimples(),v=v.map(e=>e.clean(!0,void 0,Pe.clipper/10)));let x=!1,w=x?[]:void 0,z=x?[]:void 0,b=x?[]:void 0;function S(l){x&&w.push(l);for(let e=0;e<h.length;e++)if(l.distTo2D(h[e])<f/4)return;let i=l.isInPolygonOnly(y);x&&i&&z.push(l);let s=!1;i||v.forEach(function(e){return e.forEachSegment(function(e,t){if(l.distToLine(e,t)<n)return s=!0,i=!0}),i}),x&&s&&b.push(l),i||h.push(l)}function E(e,t,l){let i,s=1;if((i=e.distTo2D(t))>=a)for(var o=e.slopeTo(t).factor(1/i),n=Math.floor(i/a)+1,r=i/n;s<n;)S(e.projectOnSlope(o,s++*r));l&&S(t)}let M=[];if(i.down&&function(){if(d.forEach(function(e){e.forEachSegment(function(e,t){E(e,t,!0)})}),u.forEachPair(function(e,t){E(e,t,!1)}),h.length||M.length){let t=[];h.forEach(function(e){t.push(_e.newPolygon().centerRectangle(e,f/2,f/2))}),M.appendAll(Oe.union(t,null,!0,{wasm:!1})),t=Oe.union(t,null,!0,{wasm:!1}).forEach(function(e){M.push(_e.newPolygon().createConvexHull(e.points))})}}(),x&&v&&i.output().setLayer("cks",{line:15619379,check:15619379}).addPolys(w.map(e=>_e.newPolygon().centerRectangle(e,.25,.25))).setLayer("pip",{line:14500898,check:14500898}).addPolys(z.map(e=>_e.newPolygon().centerRectangle(e,.4,.4))).setLayer("pcl",{line:13382417,check:13382417}).addPolys(b.map(e=>_e.newPolygon().centerRectangle(e,.3,.3))).setLayer("pts",{line:14496733,check:14496733}).addPolys(h.map(e=>_e.newPolygon().centerRectangle(e,.8,.8))).setLayer("dtr",{line:0,check:0}).addPolys(Oe.setZ(v.clone(!0),i.z)),0!==M.length){M=10<M.length?await O.minions.union(M):Oe.union(M,null,!0,{wasm:!1}),M=Oe.trimTo(M,t);let l=0;for(;g&&0<M.length;){g.supports=g.supports||[];let e=[],t=[];if(Oe.subtract(M,g.topSimples(),e,null,i.z,s,{wasm:!1}),e.forEach(function(e){e.area()<s||t.push(e.setZ(g.z))}),0===t.length)break;l>=r&&g.supports.appendAll(t),M=t,g=g.down,l++}}}function Ge(e){const{promises:t,slice:l,lineWidth:i,density:s,minArea:o,isBelt:n,angle:r,outline:a}=e;let f=l.supports,p=[],c=[],d=o||.1;f&&(f=Oe.setZ(Oe.union(f,void 0,!0,{wasm:!1}),l.z),Oe.subtract(f,l.clips,p,null,l.z,d,{wasm:!1}),f=p,l.down&&l.down.clips&&(Oe.subtract(p,l.down.clips,c,null,l.z,d,{wasm:!1}),f=c),f&&qe({promises:t,polys:f,lineWidth:i,density:s,z:l.z,isBelt:n,angle:r,outline:a}),l.supportOutline=f,l.supports=f)}function qe(e){const{promises:i,polys:t,lineWidth:s,density:l,z:o,isBelt:n,angle:r,outline:a}=e;let f=s*(1/l);t.forEach(function(e){var t=n||1<e.bounds.width()/e.bounds.height()?1090:1e3,l=Oe.offset([e],-s/3,{flat:!0,z:o,wasm:!0});return l&&0<l.length&&(_(i,l,r||t,f,e.fill=[]),!a&&e.fill.length&&(e.fill=m(e.fill,2*f))),!0})}function S(t,l,i,s,o){if(t&&!(i<=0)){let e=l.clone(!0);o&&e.forEach(function(e){e.hintFillAngle()}),x(t,e),0<i&&(s?S(t.up,l,i-1,!0,!1):S(t.down,l,i-1,!1,!1))}}a.sliceAll=function(e,t){let l=Object.values(O.worker.cache).filter(e=>!e.meta.disabled).sort((e,t)=>e.slices[0].z-t.slices[0].z),i=[];for(var s of l){var s;s.anno&&0<=s.anno.extruder&&(s=s.anno.extruder,i.indexOf(s)<0&&i.push(s))}if(l.sort((e,t)=>e.slices[0].z-t.slices[0].z),l.shift(),1<i.length)for(var o of l)o.slices=o.slices.filter(e=>0<=e.index)},a.slice=function(te,le,ie,e){let se=!1!==te.render,{process:oe,device:ne,controller:re}=te,ae=ne.bedBelt,fe=le.track.synth,pe=le.track.support,ce=re.danger,t=re.assembly,de=re.threaded&&O.minions.concurrent,ue=oe.sliceTopLayers||0,he=oe.sliceBottomLayers||0,ge="vase"===oe.sliceFillType&&!fe,l=le.anno,i=Math.max(0,ne.extruders.length-1),ye=Math.min(i,parseInt(fe?oe.sliceSupportNozzle:l.extruder||0)),ve=oe.sliceHeight,n=(ae?ve:oe.firstSliceHeight)||ve,me=oe.sliceLineWidth||ne.extruders[ye].extNozzle,s=1-b(oe.sliceFillOverlap,0,.8),xe=me,we=me,ze=me*s,o=oe.sliceSupportOffset,be=oe.sliceFillAngle,Se=oe.sliceSupportDensity;if(w="flat"===re.lineType,v=!w&&"line"===re.lineType,z=me/2,0<=oe.sliceSupportFill&&(oe.sliceSupportFill+=1e3),w?Object.values(g).forEach(e=>{e.flat=!0,e.line=1,e.opacity=1}):Object.keys(g).forEach(e=>{const t=g[e];var e=y[e];t.flat=e.flat,t.line=e.line,t.opacity=e.opacity}),!(0<ve&&ve<100))return e("invalid slice height");if(!(.01<=me&&me<100))return e("invalid nozzle size");const r=oe.sliceAdaptive&&0<oe.sliceMinHeight?Math.min(oe.sliceMinHeight,ve):0;n<=0&&(console.log("invalid first layer height < slice height"),console.log("reverting to min valid slice height"),n=r||ve);var a=le.getBoundingBox(),f=le.getPoints();let m=[],x=[],Ee=!1;var p=ae&&oe.firstLayerFlatten||0,c=le.track.zcut||0,d;if(c||p)for(var u of f){u._z||(u._z=u.z,p&&(ae?0<(d=(u.z-u.y)*Ae)&&d<=p&&(u.y+=d*Ae,u.z-=d*Ae):u.z<=p&&(u.z=0)),c&&!ae&&(u.z-=c))}async function Me(e){if(!le.shadow){let t=le.group[0];if(t.shadow)le.shadow=t.shadow;else{var l=le.group.filter(e=>!e.track.synth).map(e=>e.slices).flat().map(e=>e.tops).flat().map(e=>e.simple);let e=de?await O.minions.union(l,.1):Oe.union(l,.1,!0);oe.sliceSupportExtra&&(e=Oe.offset(e,oe.sliceSupportExtra)),le.shadow=t.shadow=Oe.setZ(e,0)}}}async function h(c){Ee&&ie(null,null,"part may not be manifold");let t=!1;c=c.reverse().filter(e=>e.tops.length?t=!0:t).reverse();for(let e=1;e<c.length;e++)c[e-1].up=c[e],c[e].down=c[e-1];if((le.slices=c)&&0!==c.length){for(var e of c)e.params=ke(oe,e.index);if(!ae&&(fe||!fe&&Se&&oe.sliceSupportEnable)&&await Me(c),fe)for(var l of c){var i=ve*oe.sliceSupportGap,s,o;let t=l.topPolys();for(s of le.group)if(s!==le&&s.slices){for(var n of s.slices)if(!(.1<Math.abs(Math.abs(n.z-l.z)-i))){let e=n.clips;n.supportOutline&&e.appendAll(n.supportOutline);var n=[];Oe.subtract(t,e,n,null,l.z,0),t=n}ae||(t=Oe.setZ(Oe.trimTo(t,le.shadow),l.z))}l.tops=[];for(o of t)l.addTop(o);De(l,1,xe/2)}if(Pe.hint_len_max=Le.sqr(oe.sliceBridgeMax),c.forEach(e=>{e.widget=le,e.extruder=ye,e.solids=[]}),ee(.15,.2,e=>{var t=e.params,l=0===e.index&&oe.firstLayerLineMult||1,i=e.index<he,s=ue&&e.index>c.length-ue-1,o=.995<t.sliceFillSparse,n,t=(i||(s||o)&&!ge)&&!fe?t.sliceFillWidth||1:0,r;t&&We(e,we*l*t,be),be=(be+90)%360},"solid layers"),ae&&!fe){let p=1/0;for(var r of c){let e=1/0;for(var a of r.topPolys()){var a=a.bounds.maxy,f,a=r.z-a;a<e&&(e=a),a<p&&(p=a)}r.belt={miny:e,touch:!1}}let l,i=1/0,s=-1/0,e=0;for(var d of c){if(d.tops.length&&e++<5)for(var u of d.topPolys())i=Math.min(i,u.bounds.minx),s=Math.max(s,u.bounds.maxx);Math.abs(d.belt.miny)<.01&&(d.belt.touch=!0,l=l||d)}for(;l&&l.up&&0===l.topShells().length;)l=l.up;var h=ke(oe,0).firstLayerBrim||0;h&&(i-=h,s+=h);let o=[],t=(oe.beltAnchor||oe.firstLayerBeltLead)*Ae;for(;t&&l&&t>=ve;){let e=l.down;e?e.belt||(console.log({addto_missing_belt:e}),e.belt={}):(e=Te(l.z-ve),e.extruder=ye,e.belt={},e.height=l.height,e.up=l,l.down=e,c.splice(0,0,e)),e.index=-1,e.belt.anchor=!0,e.belt.touch=!1;var g=e.z,y=g-p-me/2,g=_e.newPolygon().add(i,y,g).add(s,y,g).setOpen(),g=e.addTop(g).fill_sparse=[g];o.push(g),l=e,t-=ve}var v=oe.firstLayerBeltBump;if(v){o=o.reverse().slice(1,o.length-1);let t=1;for(var m of o){let e=m[0];var x=t++*-l.height*2;v<-x&&t--;var w=e.first();if(e.push(e.last().add({x:0,y:x,z:0})),e.push(e.first().add({x:0,y:x,z:0})),e.setClosed(),2<t&&10<s-i){var z=(s+i)/2,b=s-i-2,b=3*Math.floor(b/3)/2,S=w.y,E=w.z,M=me/2;for(let e=z-b;e<=z+b;e+=3)m.push(_e.newPolygon().add(e,S-M,E).add(e,S+x+M,E).setOpen())}}}if(oe.pooch&&self.OffscreenCanvas){var{length:_,width:T,height:P,text:h}=oe.pooch,L;let i,r,s,o,a=0,n=0,f=0;for(L of c){var{belt:A}=L;if(A.touch){var k=L.index,O=L.z;e:for(var F of L.topPolys())for(let e=0,t=F.points,l=t.length;e<l;e++){var R=t[e],H=t[(e+1)%l],B=O-R.y,D=O-H.y,W=!o||k-o==1,C=0<B&&B<3&&Math.abs(B-D)<.01,D=Math.abs(T-Math.abs(H.x-R.x))<1;if(C&&D){if(W){i=i||O,r=r||k,s=O,o=k,a=Math.min(R.x,H.x),n=Math.max(R.x,H.x),f=B;break e}i=o=0}}}}var P=Math.abs(P-f*(1/Math.sqrt(2))),_=Math.abs(_-(s-i)*Math.sqrt(2));if(P<.1&&_<1){var V=o-r-2,j=2*T;let e=new self.OffscreenCanvas(V,j),t=e.getContext("2d");t.scale(1.2,1),t.font="24px sans-serif",t.textBaseline="bottom",t.fillText(h,1,j-1);var I=t.getImageData(0,0,V,j).data.buffer,Z=new Uint32Array(I);for(let n=0;n<V;n++){let t="",l=0,i=[],s,o;for(let e=j-1;0<=e;e--){var N,N=(((N=Z[e*V+n])>>24&255)+(N>>16&255)+(N>>8&255))/3;t+=30<N?"*":"-",l=Math.max(l,N),30<N?0<=s?o=j-e:s=j-e:(0<=s&&o>s&&i.push({start:s,end:o}),s=o=void 0)}if(console.log(n.toString().padStart(2,0),t,0|l,i),i.length){let e=c[r+n+1],t=e.supports=e.supports||[];var G=e.z,q=G-p-me/2,U;for(U of i)t.push(_e.newPolygon().add(a+U.start/2,q,G).add(a+U.end/2,q,G).setOpen())}}}}}if(!ge&&!fe){Re("delta"),ee(.2,.34,e=>{var t=e.params||oe,l,i;Ve(e,{min:t.sliceSolidMinArea,grow:t.sliceFillGrow})},"layer deltas"),He(),Re("delta-project"),ee(.34,.35,e=>{var t=e.params||oe;ue=t.sliceTopLayers||0,he=t.sliceBottomLayers||0,ue&&je(e,ue),he&&Ie(e,he)},"layer deltas"),He(),Re("solid-fill");let s=de?[]:void 0;ee(.35,s?.4:.5,e=>{var t=e.params||oe,l=0===e.index,i=t.sliceFillWidth||1,l=l&&t.firstLayerLineMult||1,i=we*l*i,t=t.sliceSolidMinArea;Ze(e,i,be,t,s),be=(be+90)%360},"fill solids"),c.last().finishSolids=!0,s&&await Fe(s,(e,t)=>{Y(e/t,.4,.5)}),He()}if(fe||ge){if(fe&&pe){let o=oe.sliceSupportOutline||!1,n=de?[]:void 0,r=[];ee(.5,n?.6:.7,e=>{var t,l=(e.params||oe).sliceSupportDensity,i=e.topShells();e.supports=i,e.tops=void 0;var s=[];l&&(o?Oe.expand(i,-me/4,e.z,s):Oe.expand(i,me,e.z,s)),qe({promises:n,polys:s,lineWidth:me,density:l,z:e.z,isBelt:ae,angle:oe.sliceSupportFill}),r.push({slice:e,polys:s})},"infill"),n&&await Fe(n,(e,t)=>{Y(e/t,.6,.7)});for(var p of r){var{slice:$,polys:J}=p;p.supports=J}}}else{let i,s=de?[]:void 0;ee(.5,s?.55:.7,e=>{var t=e.params||oe,l;t.sliceFillSparse&&(l=t.sliceFillType,Ce(e,{settings:te,process:oe,device:ne,lineWidth:me,spacing:ze,density:t.sliceFillSparse,bounds:le.getBoundingBox(),height:ve,type:l,cache:!0!==t._range&&i===l,promises:s}),i=l)},"infill"),s&&await Fe(s,(e,t)=>{Y(e/t,.55,.7)});for(let i of c)if(i._clone_sparse){let t=i.tops,l=i.down.tops;for(let e=0;e<t.length;e++)t[e].fill_sparse=l[e].fill_sparse.map(e=>e.cloneZ(i.z))}}if(!ae&&!fe&&Se&&oe.sliceSupportEnable){Me(c),Re("support");let t=[];ee(.7,.75,e=>{t.push(Ne(e,oe,le.shadow,{exp:ce}))},"support"),await Fe(t,(e,t)=>{Y(e/t,.75,.8)}),He()}if(Se){Re("support-fill");let t=void 0;ee(.8,(t,.9),e=>{Ge({promises:t,slice:e,lineWidth:me,density:Se,minArea:oe.sliceSupportArea,isBelt:ae,angle:oe.sliceSupportFill,outline:!1!==oe.sliceSupportOutline})},"support"),t,He()}if(se&&ee(.9,1,e=>{var t=e.params||oe;Be(e,fe,t,re.devel)},"render"),ae){let e=_e.newBounds();var I=c[0];if(I.tops)for(var K of I.tops)e.merge(K.poly.bounds);else if(I.supports)for(var Q of I.supports)e.merge(Q);le.belt.miny=-e.miny,le.belt.midy=(e.miny+e.maxy)/2}}function X(e,t,l,i){Y(e/c.length,t,l,i)}function Y(e,t,l,i){ie(.5+.5*(t+e*(l-t)),i)}function ee(t,l,i,s){c.forEach(e=>{i(e),X(e.index,t,l,s)})}}_e.slice(f,{debug:oe.xray,xray:oe.xray,zMin:a.min.z,zMax:a.max.z-c,union:re.healMesh||fe,indices:oe.indices||oe.xray,useAssembly:t,post:"FDM",post_args:{shellOffset:xe,fillOffset:ze,clipOffset:o,lineWidth:me,vaseMode:ge,isSynth:fe,process:oe,isDanger:ce},zGen(p){if(oe.xray)return p.zIndexes;var{zMin:e,zMax:c}=p,d=ve,u=n||d,h=r||0;let t=u,l=u,i=m,s=x;if(h){var u=u,g=d,y=h;let e=x,t=m;var v=Object.values(p.zIndexes).map(e=>parseFloat(e));let l=u,i=0,s,o,n,r,a,f=l;for(e.push(u),t.push(u);l<c&&i<v.length;)if(a=v[i++],!(l>=a||(s=a-l)<y))for(o=Math.floor(s/y),n=Math.floor(s/g),r=n&&n<=o?(.01<s%g&&n++,s/n):s;l<a;)e.push(r),t.push(l+r),l+=r}else for(;;){var o=(l-t/2).round(3);if(c<o)break;s.push(t),i.push(o),t=d,l+=t}return i},slicer(e,t,l){return(de?O.minions:_e).sliceZ(e,t,l)},onupdate(e){return ie(0+.5*e)}}).then(e=>e.slices.map(e=>{var{z:t,clip:l,lines:i,groups:s,changes:o}=e;if(!e.tops)return null;let n=Te(t).addTops(e.tops);return n.index=m.indexOf(t),n.height=x[n.index],n.clips=l,o&&!fe&&(Ee=!0,n.changes=o,self.debug&&console.log("slice healed",n.index,n.z)),oe.xray&&(n.index=oe.xrayi.shift(),n.lines=i,n.groups=s,n.xray=oe.xray),n}).filter(e=>e)).then(e=>h(e)).then(e)},a.share={doShells:De,doTopShells:f,doDiff:Ve,projectFlats:je,projectBridges:Ie},a.supports=function(e,t){var l=e.device.bedBelt,i;let a=e.process.sliceSupportSize,f=a/9,n=a/4,r=.45*a;var s=.01;let o=new THREE.BufferGeometry;o.setAttribute("position",new THREE.BufferAttribute(t.vertices,3));var p=Math.PI/180,c=180/Math.PI,e=p*e.process.sliceSupportAngle;let d=-Math.sin(e),u=new THREE.Vector3(0,0,-1),h=[];var e=new THREE.MeshBasicMaterial;let g=new THREE.Mesh(o,e),y=new THREE.Mesh(new THREE.PlaneGeometry(1e4,1e4,1),e);var e=Date.now();function v(t){if(!t.added){for(var l of h){let e=new THREE.Vector2(t.x,t.y);var i=new THREE.Vector2(l.mid.x,l.mid.y);if(Math.abs(t.z-l.from.z)<r&&e.distanceTo(i)<n)return}let e=new THREE.Raycaster(t,u);var s=e.intersectObjects([g,y],!1),o;s&&s.length&&.5<s[0].distance&&(o=(new THREE.Vector3).add(t).add(s[0].point).divideScalar(2),h.push({from:t,to:s[0].point,mid:o}),t.added=!0)}}function m(e,t,l){var i=e.distanceTo(t),s=t.distanceTo(l),o=l.distanceTo(e),n=Math.max(i,s,o),r,i,n,e;if(n<a)return!(Math.min(i,s,o)<f&&Math.random()<.5)&&(v((new THREE.Vector3).add(e).add(t).add(l).divideScalar(3)),0);i===n?(m(i=(new THREE.Vector3).add(e).add(t).divideScalar(2),t,l),m(e,i,l)):s===n?(m(e,n=(new THREE.Vector3).add(t).add(l).divideScalar(2),l),m(e,t,n)):(m(e,t,e=(new THREE.Vector3).add(l).add(e).divideScalar(2)),m(e,t,l))}let x=l?e=>e.z<=d&&e.y<0:e=>e.z<d;var{position:l}=o.attributes,{itemSize:w,count:z,array:b}=l;for(let e=0;e<z;e+=3){var S=e*w,E=new THREE.Vector3(b[S++],b[S++],b[S++]),M=new THREE.Vector3(b[S++],b[S++],b[S++]),_=new THREE.Vector3(b[S++],b[S++],b[S++]),S=THREE.computeFaceNormal(E,M,_);x(S)&&(Math.max(E.z,M.z,_.z)<.1||m(E,M,_))}return console.log(`support generated in ${Date.now()-e} ms`),t.supports=h,0<h.length};class E{constructor(){this.cache={}}get(e,t,l){var i=[e.round(4),t.round(4),l.round(4)].join(",");let s=this.cache[i];return s||(s=new THREE.Vector3(e,t,l),this.cache[i]=s),s}}class M{constructor(){this.cache={}}put(e,t,l,i){var i=i.round(7).toString();let s=this.cache[i];s||(s=[],this.cache[i]=s),s.push([e,t,l])}group(e){let l={};for(var i in this.cache){var s,o;let t=[];for(o of this.cache[i]){let e=void 0;e:for(var n of t)for(var r of n)if(0<=r.indexOf(o[0])||0<=r.indexOf(o[1])||0<=r.indexOf(o[2])){e=n;break e}e?e.push(o):t.push([o])}e&&(t=t.map(e=>{var t=e.map(e=>_e.newPolygon().add(e[0].x,e[0].y,e[0].z).add(e[1].x,e[1].y,e[1].z).add(e[2].x,e[2].y,e[2].z));let l=1===t.length?t:Oe.union(t,0,!0,{wasm:!1});return l.merged=t.length,l.face=e[0],l})),l[i]=t}return l}}});"use strict";gapp.register("kiri-mode.laser.driver",[],(e,t)=>{const{base:z,kiri:M}=e,{driver:n,newSlice:c}=M;var{FDM:o,CAM:i}=n;const{polygons:r,newPoint:D}=z,f=r;var l=n.LASER={init:a,slice:s,prepare:u,export:h,exportGCode:d,exportSVG:x,exportDXF:g};function a(n,e){e.event.on("settings.saved",e=>{let t=n.api.ui;t.knife.marker.style.display=t.knifeOn.checked?"":"none"})}function s(e,n,t,o){var i=e.process;let r=i.laserOffset||0,l=e.controller.dark?12303291:0;if(i.laserSliceHeight<0)return o("invalid slice height");let{laserSliceSingle:a,laserSliceHeight:s,laserSliceHeightMin:p}=i;var e=n.getBoundingBox(),i=n.getPoints();let u=[];z.slice(i,{zMin:e.min.z,zMax:e.max.z,zGen(t){var{zMin:t,zMax:n,zIndexes:o}=t;if(a)u=[s];else if(s){for(let e=t+s/2;e<n;e+=s)u.push(e);u}else{for(let e=1;e<o.length;e++)u.push((o[e-1]+o[e])/2);if(p){let n;u=u.filter(e=>{let t=!0;return void 0!==n&&Math.abs(e-n)<p?t=!1:n=e,t})}}return u},onupdate(e){t(e)}}).then(e=>{var t=n.slices=e.slices.map(e=>{var{z:t,lines:n,groups:e}=e,e=f.nest(e);let o=c(t).addTops(e);o.index=u.indexOf(t);var t=o.offset=r?f.offset(e,r,{z:o.z,miter:2/r}):e;return o.output().setLayer("layer",{line:8947712}).addPolys(e),o.output().setLayer("cut",{line:l}).addPolys(t),o});o()})}function p(e,t){console.log("label",t)}function L(l,a,e,t={}){let s=D(0,0,0);var n=l.settings.process,o=n.outputLaserGroup,i;let p=n.outputLaserStack,r=!1,u=t.simple||!1,c=[],f={in:[],out:[],mark:[]},h=t.lastEmit,d=l.settings.process.outputLaserZColor;function x(t,n,o,e){if(t)if(Array.isArray(t))t.forEach((e,t)=>{x(e,n,o,1<g.length?t:void 0)});else{let e=d?{extrude:a.z,rate:a.z}:{extrude:1,rate:1};var i;if("mark"===o&&(e.rate=.001,e.extrude=2),u&&(e.simple=!0),t.open&&(e.open=!0),f[o].push(t),l.polyPrintPath(t,s,n,e),p&&"out"===o&&h)for(var r of h.out)r.isInside(t)&&x(r,n,"mark")}}c.thick=a.thick;let g=a.offset;return x(g.map(e=>e.inner||[]).flat(),c,"in"),x(g,c,"out"),o||(e.push(c),c=[],c.thick=a.thick),o&&e.push(c),f}async function u(e,t,r){let n=t.device,i=t.process,l=self.worker.print=M.newPrint(t,e),a=i.knifeOn,o=i.outputKnifeDepth,s=i.outputKnifePasses,c=i.outputKnifeTip,p=l.output=[],u=0,f=0;function h(e,t,n,o){let i=t.angle;var r=n.angle,l=t.angleDiff(n,!0),a=5;let s=Math.abs(Math.floor(l/5));var p=Math.sign(l),u=l%5/2;for(0==u?s++:o.push(e.projectOnSlope(t,c));0<s--;)o.push(e.projectOnSlope(z.newSlopeFromAngle(i+u),c)),i+=5*p;o.push(e.projectOnSlope(n,c))}function d(e){e.setClockwise();let t=e.points.slice(),n=t[0],o=0;for(let e=1;e<t.length;e++){var i=t[e];(i.x<n.x||i.y>n.y)&&(n=i,o=e)}0<o&&(t=t.slice(o,t.length).appendAll(t.slice(0,o)));let r=t[0].clone().move({x:-c,y:0,z:0}),l=r.slopeTo(t[0]).toUnit(),a=[r,r=t[0]],s;for(let e=1;e<t.length+1;e++){var p=t[e%t.length],u=r.slopeTo(p).toUnit();10<=l.angleDiff(u)&&r.distTo2D(p)>=c&&h(r,l,u,a),a.push(p),l=u,r=p}a.push(s=r.projectOnSlope(l,c)),a.push(s.clone().move({x:c,y:0,z:0})),e.open=!0,e.points=a}(e=e.filter(e=>!e.track.ignore&&!e.meta.disabled)).forEach(function(e){u+=e.slices.length}),e.forEach(function(o){if(i.outputLaserMerged){let i=[];o.slices.forEach(function(e){let t=[];e.offset.clone(!0).forEach(e=>e.flattenTo(t)),t.forEach(n=>{let o=!1;for(let t=0;t<i.length;t++){let e=i[t];n.isEquivalent(e)&&(o=!0,e.depth++)}o||(n.depth=1,i.push(n))}),r(f++/u*.5,"prepare")});let t=D(0,0,0),n=[];i.forEach(e=>{a&&d(e),l.polyPrintPath(e,t,n,{extrude:e.depth,rate:10*e.depth})}),p.push(n)}else{a&&o.slices.forEach(e=>{e.offset.forEach(e=>{d(e),e.inner&&e.inner.forEach(e=>{d(e)})})});let e;for(var t of o.slices.reverse())e=L(l,t,p,{simple:a,lastEmit:e}),r(f++/u*.5,"prepare")}});let x=!0;p.forEach(function(e){let t={w:1/0,h:1/0},n={w:-1/0,h:-1/0},o;e.forEach(function(e){o=e.point,e.point=o.clone(),t.w=Math.min(t.w,o.x),n.w=Math.max(n.w,o.x),t.h=Math.min(t.h,o.y),n.h=Math.max(n.h,o.y)}),e.w=n.w-t.w,e.h=n.h-t.h,e.forEach(function(e){o=e.point,o.x-=t.w,o.y-=t.h})});let g,y,v,E=n.bedWidth/2,m=n.bedDepth/2,w=!i.outputLaserLayer,k=w?p.sort(M.Sort):p,S=new M.Pack(E,m,i.outputTileSpacing).fit(k,!w);for(;!S.packed;)E*=1.1,m*=1.1,S=new M.Pack(E,m,i.outputTileSpacing).fit(k,!w);for(1,g=0;g<k.length;g++)y=k[g],y.fit.x+=y.w+S.pad,y.fit.y+=y.h+S.pad,y.forEach(function(e,t){v=e.point,v.x+=S.max.w/2-y.fit.x,v.y+=S.max.h/2-y.fit.y,v.z=0});return M.render.path(p,(e,t)=>{r(.5+.5*e,"render",t)},{thin:!0,z:0,action:"cut",moves:i.knifeOn})}function h(e,t,n){n(e.output)}function v(e,r,t,l,n,a,s){let o=e.process,i=o.outputLaserZColor,p,u,c=[],f={x:0,y:0},h={x:0,y:0};if(r.forEach(function(e){e.forEach(function(e){u=e.point,o.outputInvertX&&(u.x=-u.x),o.outputInvertY&&(u.y=-u.y),f.x=Math.min(f.x,u.x),h.x=Math.max(h.x,u.x),f.y=Math.min(f.y,u.y),h.y=Math.max(h.y,u.y)})}),o.outputOriginCenter){let t=e.device.bedWidth,n=e.device.bedDepth;r.forEach(function(e){e.forEach(function(e){u=e.point,u.x+=t/2,u.y+=n/2})}),h.x=t,h.y=n,f.x=0,f.y=0}else r.forEach(function(e){e.forEach(function(e){u=e.point,u.x-=f.x,u.y-=f.y})}),h.x=h.x-f.x,h.y=h.y-f.y,f.x=0,f.y=0;t(f,h,o.outputLaserPower,o.outputLaserSpeed),r.forEach(function(e,n){let o=0,i=0;e.forEach(function(e,t){o=e.thick,u=e.point,s&&s(n,u.z,e.thick,r.length),e.emit?(i=e.emit,p&&0===c.length&&c.push(a(p)),c.push(a(u))):0<c.length&&(l(c,i,o),c=[]),p=u}),0<c.length&&(l(c,i,o),c=[])}),n()}function d(e,t){let l=[],a=0,s=0,r=0,p,u=e.device;var n=e.process;let c=u.gcodeSpace?" ":"",f=255,h=u.gcodeLaserOn||[],d=u.gcodeLaserOff||[],x=n.knifeOn,g=n.outputKnifeDepth,y=x?n.outputKnifePasses:1;return v(e,t,function(e,t,n,o){var i=t.x-e.x,r=t.y-e.y;a=e.x,s=e.y,p=c+"F"+o,n=(n/100*256).toFixed(3),(u.gcodePre||[]).forEach(e=>{l.push(e)})},function(e,o,i){x&&l.push(`; start new poly id=${e.id} len=`+e.length);for(let n=1;n<y+1;n++)e.forEach(function(e,t){0===t?(x&&l.appendAll(["; drag-knife lift",`G0${c}Z5`]),l.push("G0"+c+e),x&&l.appendAll(["; drag-knife down",`G0${c}Z`+-n*g])):1===t?(h.forEach(e=>{e=(e=(e=(e=e.replace("{power}",f)).replace("{color}",o)).replace("{thick}",i)).replace("{z}",r),l.push(e)}),l.push("G1"+c+e+p)):l.push("G1"+c+e)}),d.forEach(e=>{l.push(e)});x&&l.appendAll([`G0${c}Z5`])},function(){(u.gcodePost||[]).forEach(e=>{l.push(e)})},function(e){return r=e.z,`X${(e.x-a).toFixed(3)}${c}Y`+(e.y-s).toFixed(3)},function(e,t,n,o){}),l.join("\n")}function x(e,t,n){var{process:o}=e;let i=o.outputLaserZColor?1:0;var r=o.outputLaserStack;let l=[],a=0,s=0,p,u=0,c=["black","purple","blue","red","orange","yellow","green","brown","gray"];return v(e,t,function(e,t){var n=t.x-e.x,o=t.y-e.y;a=e.x,s=e.y,p=t.y,l.push('<?xml version="1.0" standalone="no"?>'),l.push('<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">'),l.push(`<svg width="${n}mm" height="${o}mm" viewBox="0 0 ${n} ${o}" xmlns="http://www.w3.org/2000/svg" version="1.1">`)},function(e,t,n){var t=i||c[(t-1)%c.length];let o=["polyline"];void 0!==u&&o.push(`z="${u}"`),void 0!==n&&o.push(`h="${n}"`),l.push(`<${o.join(" ")} points="${e.join(" ")}" fill="none" stroke="${t}" stroke-width="0.1mm" />`)},function(){l.push("</svg>")},function(e){return u=e.z,z.util.round(e.x-a,3)+","+z.util.round(p-e.y-s,3)},function(e,t,n,o){i&&(i=Math.round((e+1)/o*16777215).toString(16),i="#"+i.padStart(6,0))}),l.join("\n")}function g(e,t){let n=[];return v(e,t,function(e,t){n.appendAll(["  0","SECTION","  2","HEADER","  9","$ACADVER","1","AC1014","  0","ENDSEC","  0","SECTION","  2","ENTITIES"])},function(e){n.appendAll(["  0","LWPOLYLINE","100","AcDbPolyline"," 90",e.length," 70","0"," 43","0.0"]),e.forEach(function(e){n.appendAll([" 10",e.x," 20",e.y])}),n.appendAll(["  0","SEQEND"])},function(){n.appendAll(["  0","ENDSEC","  0","EOF"])},function(e){return{x:e.x,y:e.y}}),n.join("\n")}});"use strict";gapp.register("kiri-mode.sla.driver",[],(o,e)=>{const{kiri:i}=o,{driver:r}=i,a=r.SLA={prepare:n,legacy:!1};async function n(e,r,n){o.worker.print=i.newPrint(r,e),a.wasm||fetch("/wasm/kiri-sla.wasm").then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,{env:{reportf:(e,r)=>{console.log("[f]",e,r)},reporti:(e,r)=>{console.log("[i]",e,r)}}})).then(e=>{var{module:r,instance:n}=e,{exports:e}=n,n=new Uint8Array(e.memory.buffer);a.wasm={heap:n,memory:e.memory,render:e.render,rle_encode:e.rle_encode}}),n(1)}a.legacy&&console.log("SLA Driver in Legacy Mode")});"use strict";gapp.register("kiri-mode.sla.x_cxdlp",[],(root,exports)=>{const default_values={magic1:"CXSW3DV2",magic2:"CXSW3DV2",model:"CL-89",version:1,layer_count:0,res_x:3840,res_y:2400,height:0,thumb:void 0,preview1:void 0,preview2:void 0,dim_x:"192.000000",dim_y:"120.000000",layer:"0.050000",light_on:6,light_off:2,light_pwm:255,lift_dist:6,lift_speed:60,down_speed:150,base_layers:8,base_light_on:60,base_light_pwm:255,base_lift_dist:5,base_lift_speed:60},data_term=3338;class CXDLP{constructor(){Object.assign(this,default_values)}read(t){let r=new DataReader(t,0);function e(e){let t=r.readU32(),i="";for(;0<--t;)e&&(r.readU8(),t--),i+=String.fromCharCode(r.readU8());return e||r.skip(1),i}let i={view:t,magic1:e(),version:r.readU16(),model:e(),layer_count:r.readU16(),res_x:r.readU16(),res_y:r.readU16(),height:r.readU32(),skip:r.skip(60),thumb:r.readBytes(26912),skip:r.skip(2),preview1:r.readBytes(168200),skip:r.skip(2),preview2:r.readBytes(168200),skip:r.skip(2),dim_x:e(!0),dim_y:e(!0),layer:e(!0),light_on:r.readU16(),light_off:r.readU16(),base_light_on:r.readU16(),base_layers:r.readU16(),base_lift_dist:r.readU16(),base_lift_speed:r.readU16(),lift_dist:r.readU16(),lift_speed:r.readU16(),down_speed:r.readU16(),base_light_pwm:r.readU16(),light_pwm:r.readU16()},s=this.layers=[];for(let e=0;e<i.layer_count;e++)s.push({length:r.readU32()});if(r.readU16()!==data_term)throw"invalid data term @ "+(r.pos-2);for(let e=0;e<i.layer_count;e++){var a=r.readU32();if(a!==s[e].length)throw`layer length mismatch: ${a} != ${s[e].length} @ i=`+e;var a=r.readU32();if(s[e].lines=a,s[e].pos=r.pos,r.skip(6*a),r.readU16()!==data_term)throw"invalid data term @ "+(r.pos-2)}i.magic2=e();let l=0;for(let e=0;e<r.pos;e++)l^=t.getUint8(e);if(i.checksum=l,l!==r.readU32())throw"checksum mismatch";return delete i.skip,Object.assign(this,i),this}get_layer_lines(e){if(this.view){if(e>this.layers.length)throw"layer out of range 0-"+this.layers.length;let t=[];var s;let{lines:i,pos:r}=this.layers[e];for(let e=0;e<i;e++){var a=this.view.getUint16(r);r+=2;var l=this.view.getUint16(r);r+=2;var n=this.view.getUint16(r),o,d,h,_;r+=2,t.push({y_start:a>>3,y_end:(7&a)<<10|l>>6,x_end:(63&l)<<8|n>>8,color:255&n})}return t}throw"missing data view"}write(){let a=new ArrayWriter;a.write_string=function e(t,i=!1){var r=t.length;a.writeU32(i?2*r:r+1);let s=0;for(;s<r;)i&&a.writeU8(0),a.writeU8(t.charCodeAt(s++));i||a.writeU8(0)},a.write_bytes=function(i,e){if(i)if(i.byteLength){if(e!==i.byteLength)throw`invalid array length: ${i.byteLength} != `+e;let t=new DataReader(i);for(let e=0;e<i.byteLength;e++)a.writeU8(t.readU8())}else{if(!i.length)throw"invalid byte array";if(e!==i.length)throw`invalid array length: ${i.length} != `+e;a.writeBytes(i)}else a.skip(e)};var e=this.layers,t,i;this.layer_count=e.length,a.write_string(this.magic1),a.writeU16(this.version),a.write_string(this.model),a.writeU16(this.layer_count),a.writeU16(this.res_x),a.writeU16(this.res_y),a.writeU32(this.height),a.skip(60),a.write_bytes(this.thumb,26912),a.writeU16(data_term),a.write_bytes(this.preview1,168200),a.writeU16(data_term),a.write_bytes(this.preview2,168200),a.writeU16(data_term),a.write_string(this.dim_x,!0),a.write_string(this.dim_y,!0),a.write_string(this.layer,!0),a.writeU16(this.light_on),a.writeU16(this.light_off),a.writeU16(this.base_light_on),a.writeU16(this.base_layers),a.writeU16(this.base_lift_dist),a.writeU16(this.base_lift_speed),a.writeU16(this.lift_dist),a.writeU16(this.lift_speed),a.writeU16(this.down_speed),a.writeU16(this.base_light_pwm),a.writeU16(this.light_pwm);for(t of e)t.l1=a.pos,a.writeU32(0);a.writeU16(data_term);for(i of e){i.l2=a.pos,a.writeU32(0),a.writeU32(i.lines.length);var r=a.pos,s;for(s of i.lines){var l=s.y_start>>5,n=255&(s.y_start<<3|s.y_end>>10),o=s.y_end>>2&255,d=255&(s.y_end<<6|s.x_end>>8),h=255&s.x_end;a.writeU8(l),a.writeU8(n),a.writeU8(o),a.writeU8(d),a.writeU8(h),a.writeU8(s.color)}i.length=a.pos-r,a.writeU16(data_term)}a.write_string(this.magic2);var _=a.pos,w;for(w of e)a.seek(w.l1),a.writeU32(w.length),a.seek(w.l2),a.writeU32(w.length);a.seek(_);let f=0;var g=a.array;for(let e=0;e<g.length;e++)f^=g[e]||0;return a.writeU32(f),a.toBuffer()}}if(CXDLP.export=function(e){let{settings:t,width:i,height:r,slices:s}=e;var{thumb:a,preview1:l,preview2:e}=e;let{device:n,process:o}=t,d=new CXDLP;if(1620===i&&2560===r)d.model="CL-60";else if(3840===i&&2400===r)d.model="CL-89";else{if(3840!==i||2160!==r)throw`invalid printer dimensions ${i} x `+r;d.model="CL-133"}return d.layers=s.map(e=>({lines:e})),d.res_x=n.resolutionX,d.res_y=n.resolutionY,d.dim_x=n.bedWidth.toFixed(5),d.dim_y=n.bedDepth.toFixed(5),d.layer=o.slaSlice.toFixed(5),d.thumb=a,d.preview1=l,d.preview2=e,d.light_on=o.slaLayerOn,d.light_off=o.slaLayerOff,d.lift_dist=o.slaPeelDist,d.lift_speed=60*o.slaPeelLiftRate,d.base_layers=o.slaBaseLayers,d.base_light_on=o.slaBaseOn,d.base_lift_dist=o.slaBasePeelDist,d.base_lift_speed=60*o.slaBasePeelLiftRate,d.write()},CXDLP.render=function(e){let{width:t,height:s,index:r,widgets:i,scaleX:a,scaleY:l}=e,n=t/2,o=s/2,d=[],h=0,_=0;function w(r){var i=r.points;r._bounds=void 0;for(let t=0,e=i.length;t<e;t++){let e=i[t];e.y=s-(e.y*l+o),e.x=e.x*a+n}if(r.inner)for(let e=0,t=r.inner,i=r.inner.length;e<i;e++)w(t[e])}function f(i,e){var t=i.skip(2),r=e.inner;i.writeU16(r?r.length:0,!0);var s=e.points,e=e.bounds;i.writeU16(s.length,!0),i.writeU16(e.minx,!0),i.writeU16(e.maxx,!0),i.writeU16(e.miny,!0),i.writeU16(e.maxy,!0);for(let e=0,t=s.length;e<t;e++){var a=s[e];i.writeF32(a.x,!0),i.writeF32(a.y,!0)}if(r&&r.length)for(let e=0,t=r.length;e<t;e++)f(i,r[e]);i.view.setUint16(t,i.pos-t,!0)}i.forEach(t=>{let i=t.slices[r];if(i){i.synth&&h++;let e=i.unioned;e=e||i.tops.map(e=>e.poly),i.supports&&e.appendAll(i.supports),d.appendAll(e.map(e=>e.clone(!0).move(t.track.pos))),h+=e.length}});let g=kiri.driver.SLA.wasm;var e=t*s;let p=new self.DataWriter(new DataView(g.memory.buffer),e);p.writeU16(t,!0),p.writeU16(s,!0),p.writeU16(d.length,!0);for(let t=0,e=d.length;t<e;t++){let e=d[t];_+=e.areaDeep(),w(e),f(p,e)}g.render(0,e,0);var U=g.heap;let y=[];for(let r=0;r<t;r++){let t=0,i=0;for(let e=0;e<s;e++){var v=U[r*s+e];v!==i&&(i&&y.push({y_start:t,y_end:e,x_end:r,color:i}),v&&(t=e)),i=v}}return{lines:y,area:_}},!self.navigator&&self.process&&self.process.env){let fs=require("fs");eval(fs.readFileSync("src/add/class.js").toString());let args=process.argv.slice(2),file=args.shift(),view=new DataView(fs.readFileSync(file).buffer),read=new DataReader(view,0),cxdlp=(new CXDLP).read(view);console.log({cxdlp:cxdlp,layers5:cxdlp.layers.slice(0,5),lines1:cxdlp.get_layer_lines(1)})}else self.navigator&&(self.CXDLP=CXDLP)});"use strict";gapp.register("kiri-mode.sla.x_photons",[],(e,t)=>{var{base:r,kiri:e}=e,{driver:e}=e,{util:s}=r;const{SLA:P}=e;function a(e,t,f){let r=e.settings,s=r.process,a=r.device,l=t.width,i=t.height,n=t.lines.length,o=l*i,h=t.small,w=t.large,p=t.slices,g=s.slaAntiAlias||1,u=[],c;if(P.legacy||1<g){var U=8/g;for(let e=0;e<g;e++)u.push((1<<8-e*U)-1);let h=0,w=t.lines.length*g;var y=t.lines.map((e,t)=>{var r=e.length;let s=new DataView(e.buffer),a=new Uint8Array(e.length);var l=new DataView(a.buffer);let i=[{data:a,view:l}];for(let e=1;e<g;e++)a=a.slice(),l=new DataView(a.buffer),i.push({data:a,view:l});for(let e=0;e<g;e++){let t=i[e].view;var n=u[e];for(let e=0;e<r;e++){var o=s.getUint8(e);t.setUint8(e,o/g&n?1:0)}f(h++/w*.4,"layer_convert")}return{subs:i}});c=A(y,"photon",e=>{f(.4*e+.4,"layer_encode")})}else{var v=p.reduce((e,t)=>e+t.reduce((e,t)=>e+t.length,0),0);c={layers:p.map(e=>({sublayers:e})),length:v}}var d=c.layers.length,F=3e3+c.length+d*g*28+h.byteLength+w.byteLength,m=new ArrayBuffer(F);let b=new self.DataWriter(new DataView(m));var L=s.slaBaseLayers*s.slaBaseOn+(c.layers.length-s.slaBaseLayers)*s.slaLayerOn;b.writeU32(419495186),b.writeU32(2,!0),b.writeF32(68.04,!0),b.writeF32(120.96,!0),b.writeF32(150,!0),b.skip(12),b.writeF32(s.slaSlice,!0),b.writeF32(s.slaLayerOn,!0),b.writeF32(s.slaBaseOn,!0),b.writeF32(s.slaLayerOff,!0),b.writeU32(s.slaBaseLayers,!0),b.writeU32(1440,!0),b.writeU32(2560,!0);var e=b.skip(4),y=b.skip(4);b.writeU32(d,!0);var v=b.skip(4);b.writeU32(L,!0),b.writeU32(1,!0);var F=b.skip(4),d=b.skip(4);b.writeU32(g,!0),b.writeU16(255,!0),b.writeU16(255,!0);var L=b.pos;b.view.setUint32(F,b.pos,!0),b.writeF32(s.slaBasePeelDist,!0),b.writeF32(60*s.slaBasePeelLiftRate,!0),b.writeF32(s.slaPeelDist,!0),b.writeF32(60*s.slaPeelLiftRate,!0),b.writeF32(60*s.slaPeelDropRate,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeU32(s.slaBaseLayers,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.writeF32(0,!0),b.view.setUint32(d,b.pos-L,!0),b.view.setUint32(y,b.pos,!0);var k=c.layers;let D=[];for(let r=0;r<g;r++)for(let t=0;t<k.length;t++){let e=k[t].sublayers[r];b.writeF32(s.slaFirstOffset+s.slaSlice*t,!0),b.writeF32(t<s.slaBaseLayers?s.slaBaseOn:s.slaLayerOn,!0),b.writeF32(t<s.slaBaseLayers?s.slaBaseOff:s.slaLayerOff,!0),D.push(e.repos=b.skip(4)),b.writeU32(e.length,!0),b.skip(16)}let B=0;var O=k.length*g;for(let t=0;t<g;t++)for(let e=0;e<k.length;e++){var x=k[e].sublayers[t];b.view.setUint32(x.repos,b.pos,!0);for(let e=0;e<x.length;e++)b.writeU8(x[e],!1);f(B++/O*.1+.9,"layer_write")}return b.view.setUint32(e,b.pos,!0),V({width:400,height:300,data:t.large},b),b.view.setUint32(v,b.pos,!0),V({width:200,height:125,data:t.small},b),m}function l(e,i,n){let t=e.settings,o=t.process,r=t.device,s=i.width,a=i.height,l=i.slices,h=i.lines.length,w=s*a,f;var p,g;f=P.legacy?A(p=i.lines.map((e,t)=>{var r=e.length/4,s=new Uint8Array(e.length/4);let a=new DataView(s.buffer),l=new DataView(e.buffer);for(let e=0;e<r;e++)a.setUint8(e,0<l.getUint8(4*e)?1:0);return n(t/i.lines.length),{subs:[{exposureTime:o.slaLayerOn,data:s}]}}),"photons"):(g=l.reduce((e,t)=>e+t.reduce((e,t)=>e+t.length,0),0),{layers:l.map(e=>({sublayers:e})),length:g});var g=new ArrayBuffer(75366+f.length+28*h);let u=new DataView(g),c=0;u.setUint32(0,2,!1),u.setUint32(4,3227560,!1),u.setUint32(8,824633720,!1),u.setUint16(12,10,!1),u.setFloat64(14,o.slaSlice,!1),u.setFloat64(22,o.slaLayerOn,!1),u.setFloat64(30,o.slaLayerOff,!1),u.setFloat64(38,o.slaBaseOn,!1),u.setUint32(46,o.slaBaseLayers,!1),u.setFloat64(50,o.slaPeelDist,!1),u.setFloat64(58,o.slaPeelLift,!1),u.setFloat64(66,o.slaPeelDrop,!1),u.setFloat64(74,69420,!1),u.setUint32(82,224,!1),u.setUint32(86,42,!1),u.setUint32(90,168,!1),u.setUint32(94,10,!1),u.setUint32(75362,h,!1),c=75366;for(let e=0;e<h;e++){var U,y=f.layers[e].sublayers[0],v=y.length;u.setUint32(c+0,69420,!1),u.setFloat64(c+4,0),u.setUint32(c+12,a,!1),u.setUint32(c+16,s,!1),u.setUint32(c+20,8*v+32,!1),u.setUint32(c+24,2684702720,!1),c+=28;for(let e=0;e<v;e++)u.setUint8(c+e,y[e],!1);c+=v,n(e/h/2+.5)}return g}function A(a,l,i){let n=[],o=0,h=0,w=0;a.forEach(e=>{e.subs.forEach(e=>h++)});for(let e=0;e<a.length;e++){let t=a[e].subs,r=[],s=0;for(let e=0;e<t.length;e++){var f,p=g(t[e].data,l);if(s+=p.length,r.push(p),i&&i(w++/h),"photons"==l)break}o+=s,n.push({sublength:s,sublayers:r})}return{length:o,layers:n}}function g(t,r){let s="photons"===r?128:125,a=t[0],l=1,i=[];for(let e=1;e<t.length;e++){var n=t[e];n!==a?(i.push(o(a,l,r)),a=n,l=1):l===s?(i.push(o(a,l,r)),l=1):l++}return 0<l&&i.push(o(a,l,r)),i}function o(e,t,r){switch(r){case"photon":return 127&t|e<<7&128;case"photons":return(1&--t?128:0)|(2&t?64:0)|(4&t?32:0)|(8&t?16:0)|(16&t?8:0)|(32&t?4:0)|(64&t?2:0)|e}}function i(t,e){let r=[];if("photon"===e)for(let e=0;e<t.length;e++){var s=t[e],a=s>>7,l=127&s;for(let e=0;e<l;e++)r.push(a)}else for(let e=0;e<t.length;e++){var i=t[e],n=1&i,o=1+((128&i?1:0)|(64&i?2:0)|(32&i?4:0)|(16&i?8:0)|(8&i?16:0)|(4&i?32:0)|(2&i?64:0));for(let e=0;e<o;e++)r.push(n)}return r}function V(e,t){var r=new Uint8Array(e.data),s=r.byteLength;t.writeU32(e.width,!0),t.writeU32(e.height,!0);var e=t.skip(4);t.writeU32(s/2,!0),t.view.setUint32(e,t.pos,!0);let a=0;for(;a<s;){var l=r[a++],i=r[a++],n=r[a++],o=r[a++],h;t.writeU16((l/4&31)<<11|(i/4&31)<<6|(n/4&31)<<0,!0)}}function n(e){let{width:t,height:a,index:s,widgets:r,scaleX:l,scaleY:i,masks:n}=e,o=t/2,h=a/2,w=[],f=0,p=0;function g(s){var r=s.points;s._bounds=void 0;for(let t=0,e=r.length;t<e;t++){let e=r[t];e.y=a-(e.y*i+h),e.x=e.x*l+o}if(s.inner)for(let e=0,t=s.inner,r=s.inner.length;e<r;e++)g(t[e])}function u(r,e){var t=r.skip(2),s=e.inner;r.writeU16(s?s.length:0,!0);var a=e.points,e=e.bounds;r.writeU16(a.length,!0),r.writeU16(e.minx,!0),r.writeU16(e.maxx,!0),r.writeU16(e.miny,!0),r.writeU16(e.maxy,!0);for(let e=0,t=a.length;e<t;e++){var l=a[e];r.writeF32(l.x,!0),r.writeF32(l.y,!0)}if(s&&s.length)for(let e=0,t=s.length;e<t;e++)u(r,s[e]);r.view.setUint16(t,r.pos-t,!0)}r.forEach(t=>{let r=t.slices[s];if(r){r.synth&&f++;let e=r.unioned;e=e||r.tops.map(e=>e.poly),r.supports&&e.appendAll(r.supports),w.appendAll(e.map(e=>e.clone(!0).move(t.track.pos))),f+=e.length}});let c=P.wasm;var U=t*a;let y=new self.DataWriter(new DataView(c.memory.buffer),U);y.writeU16(t,!0),y.writeU16(a,!0),y.writeU16(w.length,!0);for(let t=0,e=w.length;t<e;t++){let e=w[t];p+=e.areaDeep(),g(e),u(y,e)}c.render(0,U,0);let v=c.heap.slice(0,U),d=[];for(let e=0;e<n.length;e++){var F=c.rle_encode(0,0,U,n[e],U,0);d.push(c.heap.slice(U,U+F))}return{image:v,layers:d,end:0===f,area:p}}function h(e){let{width:t,height:r,index:s,widgets:a,scaleX:l,scaleY:i}=e,n=new OffscreenCanvas(r,t),o={scaleX:l,scaleY:i,width:t,height:r,width2:t/2,height2:r/2},h=n.getContext("2d");h.fillStyle="rgb(200, 0, 0)";let w=0,f=0;a.forEach(t=>{let r=t.slices[s];if(r){r.synth&&w++;let e=r.unioned;e=e||r.tops.map(e=>e.poly),r.supports&&e.appendAll(r.supports),e.forEach(e=>{f+=e.areaDeep(),e.move(t.track.pos),h.beginPath(),u(e.setClockwise(),h,o),e.inner&&e.inner.forEach(e=>{u(e.setCounterClockwise(),h,o)}),h.fill(),w++})}});var p=h.getImageData(0,0,r,t).data;let g=new Uint8ClampedArray(p.length/4);for(let e=0;e<g.length;e++)g[e]=p[4*e];return{image:g,end:0===w,area:f}}function u(e,r,t){let{scaleX:s,scaleY:a,width:l,height:i,width2:n,height2:o}=t;e.forEachPoint((e,t)=>{0===t?r.moveTo(i-(e.y*a+o),e.x*s+n):r.lineTo(i-(e.y*a+o),e.x*s+n)},!0),r.closePath()}self.photon={generatePhoton:a,generatePhotons:l,renderLayer:h,renderLayerWasm:n}});"use strict";gapp.register("kiri-mode.sla.export",[],(e,t)=>{var{base:r,kiri:e}=e,{driver:e}=e,{util:a}=r;const{SLA:q}=e;function s(e,t,r){console.log({generateCXDLP:e,conf:t,progress:r})}q.export=function(n,h,g){let c=n.widgets,e=n.settings,p=e.device,t=e.process,d=p.resolutionX,v=p.resolutionY,u=d/p.bedWidth,m=v/p.bedDepth,w=t.slaSlice,f=t.slaAntiAlias||1,r=Date.now(),b=0,y=0;c=c.filter(e=>!e.track.ignore&&!e.meta.disabled),c.forEach(e=>{b=Math.max(e.slices.length)});let a=!1;switch(p.deviceName){case"Anycubic.Photon":case"Anycubic.Photon.S":a=!0}if(a){let e=q.legacy||1<f,r=e?.25:.85,a=1-r,t=[],s=[];var P=8/f;let i=[];for(let e=0;e<f;e++)i.push((1<<8-e*P)-1);let o=e?photon.renderLayer:photon.renderLayerWasm;for(let e=0;e<b;e++){var L={index:e,width:d,height:v,widgets:c,scaleX:u,scaleY:m,masks:i},{image:x,layers:A,end:k,area:L}=o(L);if(y+=L*w,t.push(x),s.push(A),h({progress:e/b*r,message:"image_gen"}),k)break}let l={"Anycubic.Photon":photon.generatePhoton,"Anycubic.Photon.S":photon.generatePhotons}[p.deviceName]||photon.generatePhoton;var D=l(n,{width:d,height:v,small:q.previewSmall.data,large:q.previewLarge.data,lines:t,slices:s},(e,t)=>{h({progress:e*a+r,message:t})});g({width:d,height:v,file:D,layers:t.length,volume:y},[D])}else{var s=.95,i=1-s;let t=[];for(let e=0;e<b;e++){var o={index:e,width:d,height:v,widgets:c,scaleX:u,scaleY:m},{lines:l,area:o}=CXDLP.render(o);if(y+=o*w,t.push(l),h({progress:e/b*s,message:"image_gen"}),0===l.length)break}let r=[];var S=q.previewSmall.data;for(let t=0;t<116;t++)for(let e=0;e<116;e++){var X=4*(116*t+e),C,Y,N,X=65535&(S[0+X]>>3<<11|S[1+X]>>2<<5|S[2+X]>>3);r.push(X>>8&255),r.push(255&X)}let a=[];var W=q.previewLarge.data;for(let t=0;t<290;t++)for(let e=0;e<290;e++){var _=4*(290*t+e),E,M,j,_=65535&(W[0+_]>>3<<11|W[1+_]>>2<<5|W[2+_]>>3);a.push(_>>8&255),a.push(255&_)}var D=a,D=CXDLP.export({settings:e,width:d,height:v,slices:t,thumb:r,preview1:a,preview2:D});g({width:d,height:v,file:D,layers:t.length,volume:y},[D])}console.log("print.export",Date.now()-r)}});"use strict";gapp.register("kiri-mode.sla.slice",[],(e,t)=>{const{base:z,kiri:b}=e,{driver:n,newSlice:w,newTop:E}=b,{util:l,newPoint:s,newPolygon:d,polygons:a}=z,{SLA:v}=n,M=a,_=n.FDM.share,D=l.pwait;let P;function A(e){e.slices.forEach(e=>{const t=e.output(),n=.6,l=65793;e.unioned?e.unioned.forEach(e=>{e=e.clone(!0),t.setLayer("layers",{line:l,face:39372,lopacity:.6}).addAreas([e],{outline:!0})}):e.tops&&e.tops.forEach(e=>{var e=e.poly;t.setLayer("layers",{line:l,face:16562691,lopacity:.6}).addAreas([e],{outline:!0})}),e.supports&&e.supports.forEach(e=>{t.setLayer("support",{line:l,face:16562691,lopacity:.6}).addAreas([e],{outline:!0})})})}function L(e,n,l){let t=e.union.reduce((e,t)=>e+t.areaDeep(),0),s=e.union.reduce((e,t)=>e+t.perimeter(),0),a=e.slices,r=a.length,o=0,i=0,p=a.filter(e=>!e.synth);p.forEach(e=>{e.mass=e.unioned.reduce((e,t)=>e+t.areaDeep(),0),e.up&&e.up.bridges?(e.bear=e.up.bridges.reduce((e,t)=>e+t.areaDeep(),0),e.bear_up=e.up.bridges,i+=e.bear):e.bear=0,o+=e.mass});let c=o/i*(1/n.slaSupportDensity),h;p.slice().map((e,t)=>(!h&&e.bear&&(e.ord_first=h=!0),e.ord_weight=Math.pow(30,(p.length-t)/p.length),e)).sort((e,t)=>e.ord_first?-1:t.ord_first?1:t.bear*t.ord_weight-e.bear*e.ord_weight).forEach((e,t)=>{e.ord_bear=t});let u=o,f=i;var d,y,g=0,m=[];p.forEach(e=>{e.rem_mass=u,e.rem_bear=f,e.can_bear=e.bear*c,u-=e.mass,f-=e.bear});var x=p.sort((e,t)=>e.ord_bear-t.ord_bear);u=o,f=i;for(let e=0;e<x.length;e++){let t=x[e],n=Math.min(t.can_bear,t.rem_mass);for(let e=t.index-1;e>p[0].index;e--)a[e].rem_mass-=n;if(u-=n,t.can_emit=!0,u<=0)break}let S=0,b=0,w=10*(1-n.slaSupportDensity),E=Math.bound(n.slaSupportSize/2,.25,1);a.forEach((t,e)=>{t.can_emit&&(0===S||5<t.index-b?(t.bear_up.map(e=>e.clone(!0).setZ(t.z)).forEach(e=>{T(n,t,e,E,w)}),S++):5<S?S=0:S++,b=t.index),l(1/a.length)}),a.forEach(e=>{e.supports&&(e.supports=M.union(e.supports,0,!0))})}function T(l,s,a,i,p){let c=.1<a.circularityDeep(),h=[a];for(;h.length;){a=h.shift();let r=[],n=[],e=a.perimeter(),o=0,t=a.clone(!0).flattenTo([]);for(t.forEach(e=>e.forEachSegment((e,t)=>{var t={dist:e.distTo2D(t),p1:e,p2:t};(p<=t.dist||s.ord_first)&&o++,n.push(t)})),n.sort((e,t)=>t.dist-e.dist);n.length&&(0<o||r.length<3);){let{dist:l,p1:s,p2:a}=n.shift();if(p<=l){let e=Math.ceil(l/p)+1,t=l/e,n=s;for(;0<=e--;)r.push(n),n=n.offsetPointTo(a,t);o--}else r.push(s.offsetPointTo(a,l/2))}if(!s.ord_first)e:for(let t=0;t<r.length;t++){for(let e=t+1;e<r.length;e++)if(r[t].distTo2D(r[e])<=i){r[t]=null;continue e}s.pillars&&s.pillars.forEach(e=>{r[t]&&r[t].distTo2D(e.point)<=i&&(r[t]=null)})}r.filter(e=>null!==e).forEach(e=>{let t=y(l,s,e,i,[]);t.length&&!(t.max||t.synth||t.merged)&&t.forEach(e=>{let t=e.slice.supports;var e=t.indexOf(e.pillar);0<=e&&t.splice(e,1)})}),c&&a.offset(Math.max(.2,1-l.slaSupportDensity),h)}}function y(e,l,s,t,a){l.supports||(l.supports=[]),l.pillars||(l.pillars=[]);let r=e.slaSupportPoints,o=d().centerCircle(s,t/2,r,!0).setZ(l.z),n=e.slaSupportSize,i=e.slaSlice/2,p=!1,c=[],h=[],u=l.index<e.slaSupportGap+e.slaSupportLayers;if(a.min=a.min?Math.min(a.min,t):t,a.max=!!a.max||t>=n,a.synth=a.synth||l.synth,l.tops.forEach(n=>{3<a.length&&s.isInPolygon(n.poly)&&(p=!0),o.points.forEach(e=>{var t;(e.isInPolygon(n.poly)?c:h).push(e)})}),p){if(!l.synth&&a.max){let l=a.min;for(;a.length;){let e=a.pop(),t=d().centerCircle(e.point,l/2,r,!0).setZ(e.slice.z),n=e.slice.supports.indexOf(e.pillar);if(0<=n&&(e.slice.supports[n]=t,l+=i),l>e.size)break}}return a}let f=s;if(c.length){if(h.length){let t=0,n=0;h.forEach(e=>{t+=e.x,n+=e.y}),t/=h.length,n/=h.length,f=s.offsetPointTo({x:t,y:n,z:l.z},i)}a.max&&(t-=i)}else a.max&&!u||(t+=i,u&&(n+=e.slaSupportGap*e.slaSlice*2));return t<a.min||(l.supports.push(o),l.pillars.push({point:s,pillar:o,size:t}),a.push({slice:l,point:s,pillar:o,size:t}),l.down&&y(e,l.down,f,Math.min(t,n),a)),a}function k(t,e){let n=e.process,l=e.device,s=t.unioned,a=e.bounds,r=a.max.x-a.min.x,o=a.max.y-a.min.y,i=Math.max(r,o),p=Math.round(n.slaFillLine/n.slaSlice),c=n.slaFillLine,h=r/c*n.slaFillDensity,u=o/c*n.slaFillDensity,f=r/h,d=o/u,y=-r/2,g=-o/2,m=r/2,x=o/2,S=[],b=Math.floor(t.index/p),w=b%4,E=P[w];if(!E&&1!=w)for(let e=y;e<m;e+=f)S.push(z.newPolygon().centerRectangle({x:e+f/2,y:0,z:t.z},c,o));if(!E&&3!=w)for(let e=g;e<x;e+=d)S.push(z.newPolygon().centerRectangle({x:0,y:e+d/2,z:t.z},r,c));E?S=E.slice().map(e=>e.clone(!0).setZ(t.z)):(S=M.union(S,0,!0),P[w]=S),S=M.trimTo(S,t.tops.map(e=>e.poly)),S=M.union(t.unioned.appendAll(S),0,!0),t.unioned=S}function h(e,t,n){var n=4*(t+e.width*n),e=e.data;return[e[n++],e[n++],e[n++],e[n++]]}function m(e,t,n,l,s){let a=[0,0,0,0],r=0,o,i,p,c;for(o=t;o<l;o++)for(i=n;i<s;i++){for(c=h(e,o,i),p=0;p<4;p++)a[p]+=c[p];r++}for(p=0;p<4;p++)a[p]=Math.abs(a[p]/r);return a}function C(n,e,t){let l=e,s=t,a=e/t,r=n.width/n.height,o=new Uint8Array(l*s*4),i,p,c,h,u,f,d,y,g;c=a<=r?(i=n.height/s,p=Math.round((n.width-l*i)/2),0):(i=n.width/l,p=0,Math.round((n.height-s*i)/2));for(let t=0;t<s;t++)if(!((f=Math.round(t*i+c))<0||f>n.height)){d=Math.round((t+1)*i+c);for(let e=0;e<l;e++)(h=Math.round(e*i+p))<0||h>n.width||(u=Math.round((e+1)*i+p),y=4*(t*l+e),g=m(n,h,f,u,d),o[0+y]=g[0],o[1+y]=g[1],o[2+y]=g[2],o[3+y]=g[3])}return{width:e,height:t,data:o,png:n}}v.slice=function(n,u,l,s){let{process:f,device:e,controller:t}=n,a=t.threaded&&b.minions.concurrent,r,o;if(v.legacy&&!self.OffscreenCanvas)return s("browser lacks support for OffscreenCanvas",!0);function i(e,t){l(.25+(r-o)/r*.75,t),o-=e}function d(n,l,s,a){n.forEach(function(e,t){s(e,t),i(l/n.length,a)})}let p={x:200,y:125},c={x:400,y:300};switch(e.deviceName){case"Anycubic.Photon":case"Anycubic.Photon.S":break;case"Creality.Halot.One":case"Creality.Halot.Max":case"Creality.Halot.Sky":p={x:116,y:116},c={x:290,y:290}}let h=self.worker.snap.url;var y=atob(h.substring(h.indexOf(",")+1)),y=Uint8Array.from(y,e=>e.charCodeAt(0));let g=new png.PNG;g.parse(y,(e,t)=>{v.preview=g,v.previewSmall=C(g,p.x,p.y),v.previewLarge=C(g,c.x,c.y)});let m=f.slaSlice||.05;async function x(p){if(p=u.slices=p.filter(e=>e.tops.length),!f.slaOpenTop&&!f.xray){let e=w(S.max.z+m);e.index=p.last().index+1,p.push(e)}if(f.slaSupportEnable&&f.slaSupportLayers){let n=f.slaSupportLayers,l=m/2,s=[],t=[],a=f.slaSupportGap,r=m,e=1-n*r;var c=p.forEach(e=>{t.appendAll(e.tops.map(e=>e.poly.clone()))}),h=M.union(t,void 0,!0).map(e=>e.clone());let o=M.expand(h,e,l,[],1),i;for(let e=0;e<n+a;e++){let t=w(l);t.height=m,t.index=s.length,e<n&&(t.synth=!0,o.forEach(e=>{t.tops.push(E(e.clone(!0).setZ(l)))}),o=M.expand(o,r,l,[],1),i=t),s.push(t),l+=m}l-=m/2,p=u.slices=s.concat(p.map(t=>(t.tops.forEach(e=>e.poly.setZ(t.z+l)),t.index+=s.length,t.z+=l,t))),u.union=h,u.lastraft=i}for(let e=1;e<p.length;e++)p[e-1].up=p[e],p[e].down=p[e-1];let t=Math.round(f.slaShell/f.slaSlice);if(p.forEach(function(e){e.solids=[]}),r=[5,10,t?10:0,t?10:0,t?0:10,f.slaFillDensity&&f.slaShell?60:0,f.slaSupportEnable&&f.slaSupportLayers&&f.slaSupportDensity?100:0].reduce((e,t)=>e+t),o=r,d(p,5,(e,t)=>{f.slaShell?_.doShells(e,2,0,f.slaShell):_.doShells(e,1,0)},"shells"),d(p,10,e=>{e.synth||_.doDiff(e,1e-6,{sla:!0,fakedown:!f.slaOpenBase})},"delta"),t){async function l(t){if(!t.synth){let e=M.nest(M.flatten(t.topShells()));var n;t.solids?(n=t.solids||[],e.appendAll(n),t.unioned=M.setZ(await b.minions.union(e),t.z)):t.unioned=e}}d(p,10,e=>{e.synth||(_.projectFlats(e,t),_.projectBridges(e,t))},"project");let n=p.map(e=>l(e));await D(n,(e,t)=>{i(10/n.length,"solid")})}else d(p,10,e=>{e.synth||(e.unioned=e.topPolys())},"solid");f.slaFillDensity&&f.slaShell&&(P=[],d(p,60,e=>{e.synth||k(e,n)},"infill")),f.slaSupportEnable&&f.slaSupportLayers&&f.slaSupportDensity&&L(u,f,e=>{i(100*e,"support")}),A(u)}let S=u.getBoundingBox();var y=u.getPoints();z.slice(y,{indices:f.indices||f.xray,union:t.healMesh,debug:f.xray,xray:f.xray,zMin:S.min.z+m/2,zMax:S.max.z,zInc:m,slicer(e,t,n){return(a?b.minions:z).sliceZ(e,t,n)},onupdate(e){return l(0+.25*e)}}).then(e=>{var t;x(u.slices=e.slices.map(e=>{var{z:t,lines:n,groups:e}=e,e=M.nest(e);return w(t).addTops(e)})).then(s)})}});"use strict";gapp.register("kiri.widget",[],(e,t)=>{const{base:i,kiri:h}=e,{api:o,driver:l,utils:s}=h;var{util:e,polygons:r}=i;const{Mesh:a,newPoint:n,verticesToPoints:c}=i,{inRange:d,time:u}=e,{avgc:m,trackFn:p}=s,f=1,g=[],v=self.SharedArrayBuffer||void 0,x=!!v;let y=0;function w(e,t){return new M(e,t)}function E(){return h.catalog}function b(){return E().index}class M{constructor(e,t){this.id=e||(new Date).getTime().toString(36)+y++,this.grouped=!!t,this.group=t||[],this.group.push(this),this.group.id||(this.group.id=this.id),g.indexOf(this.group)<0&&g.push(this.group),this.roto=[],this.adds=[],this.anno={},this.mesh=null,this.points=null,this.bounds=null,this.wire=null,this.slices=null,this.settings=null,this.modified=!0,this.track={box:{w:0,h:0,d:0},scale:{x:1,y:1,z:1},rot:{x:0,y:0,z:0},pos:{x:0,y:0,z:0},top:0,mirror:!1,indexed:!1},this.cache={},this.stats={slice_time:0,load_time:0,progress:0},this.meta={url:null,file:null,saved:!1},this.support=!1}saveToCatalog(e){if(this.grouped)return this;var t=this;const i=u(),s=t.getGeoVertices({unroll:!0}).slice();return t.meta.file=e,t.meta.save=i,E().putFile(e,s,()=>{console.log("saved mesh ["+s.length/3+"] time ["+(u()-i)+"]")}),this}saveState(t){if(!t)return clearTimeout(this._save_timer),void(this._save_timer=setTimeout(()=>{this._save_timer=void 0,this.saveState(()=>{})},1500));const i=this;b().put("ws-save-"+this.id,{geo:i.getGeoVertices({unroll:!1}).slice(),track:i.track,group:this.group.id,meta:this.meta,anno:this.annotations()},e=>{i.meta.saved=u(),t&&t()})}annotations(){var e=Object.clone(this.anno);if(e.support)for(var t of e.support)delete t.box;return e}#newBuffer(e){return new(x?SharedArrayBuffer:ArrayBuffer)(e)}loadVertices(e,t={index:!1}){let i,s=!1;if(!ArrayBuffer.isView(e)&&"object"==typeof e)throw i=e.vertices,"deprecated vertex data format";if(i=e,i.buffer&&x&&i.buffer instanceof v){let e=new Float32Array(this.#newBuffer(i.buffer.byteLength));e.set(i),i=e}switch(typeof s){case"boolean":s=t;break;case"object":s=t.autoscale}if(i){if(!0===s){let t=0;for(let e=0;e<i.length;e++)t=Math.max(t,Math.abs(i[e]));if(t<1)for(let e=0;e<i.length;e++)i[e]*=1e3}if(this.mesh){let e=this.mesh.geometry;return e.setAttribute("position",new THREE.BufferAttribute(i,3)),e.attributes.position.needsUpdate=!0,this.meta.vertices=i.length/3,this.points=null,this}{let e=new THREE.BufferGeometry;return e.setAttribute("position",new THREE.BufferAttribute(i,3)),this.meta.vertices=i.length/3,this.points=null,this.loadGeometry(e)}}console.log("missing vertices",{data:e,options:t})}loadData(){return this.loadVertices(...arguments)}setModified(){this.modified=!0,this.mesh&&this.mesh.geometry&&(this.mesh.geometry.boundingSphere=null)}getVertices(){return this.mesh.geometry.attributes.position}loadGeometry(e){const t=new THREE.Mesh(e,[new THREE.MeshPhongMaterial({side:THREE.DoubleSide,color:16776960,specular:2105376,shininess:120,transparent:!0,opacity:1,clipIntersection:!1,flatShading:!0}),new THREE.MeshPhongMaterial({side:THREE.DoubleSide,color:35054,specular:2105376,shininess:100,transparent:!0,opacity:1,flatShading:!0})]);return t.renderOrder=1,e.addGroup(0,1/0,0),(t.widget=this).mesh=t,this.center(!0),this}groupBounds(){return k.bounds(this.group)}setPoints(e){return this.points=e||null,this}clearSlices(){let e=this.slices,t=this.mesh;e&&t&&t.remove&&e.forEach(function(e){t.remove(e.view)}),this.slices=null}setColor(e,t,i=!0){t&&console.trace("legacy call with settings"),Array.isArray(e)&&(e=e[this.getExtruder()%e.length]),i&&(this.color=e);let s=this.getMaterial();s.color.set(this.meta.disabled?m(8947848,e,3):e)}getColor(){return this.color}getMaterial(){return this.mesh.material[0]}setZClip(e,t){let i=this.getMaterial();i.clippingPlanes=0<=e&&0<=t?[new THREE.Plane(new THREE.Vector3(0,1,0),-e),new THREE.Plane(new THREE.Vector3(0,-1,0),t)]:null,moto.space.refresh()}isVisible(){return this.getMaterial().visible}selectFaces(e){var e=mesh.util.facesToGroups(e||[]),t;let i=this.mesh.geometry;i.clearGroups();for(t of e)i.addGroup(3*t.start,3*t.count,t.mat||0)}setOpacity(e){var t=this.mesh;const i=this.getMaterial();e<=0?(i.transparent=!1,i.opacity=1,i.visible=!1):d(e,0,1)&&(i.transparent=e<1,i.opacity=e,i.visible=!0)}center(e){let t=e?this.mesh.getBoundingBox(!0):this.groupBounds(),i=t.min.clone(),s=t.max.clone(),r=s.sub(i).multiplyScalar(.5),o=i.x+r.x,a=i.y+r.y,n=i.z;return this.track.indexed&&(n+=r.z),this.track.center={dx:o,dy:a,dz:n},e||this.group.forEach(e=>{e.moveMesh(o,a,n)}),this}moveMesh(t,i,s){let e=this.mesh.geometry.attributes.position,r=e.array;if(t||i||s){for(let e=0;e<r.length;e+=3)r[e]-=t,r[e+1]-=i,r[e+2]-=s;e.needsUpdate=!0}var o=this.groupBounds();this.track.box={w:o.max.x-o.min.x,h:o.max.y-o.min.y,d:o.max.z-o.min.z},(t||i||s)&&(this.points=null,this.setModified())}get isIndexed(){return!!this.track.indexed}setIndexed(e){e!==this.track.indexed&&(this.track.indexed=e,this.center(!1),this._updateMeshPosition())}setAxisIndex(e){var e=e*(Math.PI/180);e!==this.track.indexRad&&(this.track.indexRad=e,this._updateMeshPosition())}setTopZ(e){let t=this.mesh,i=this.track,s=t.getBoundingBox(),r=s.max.z,o=this.isIndexed;i.top=o&&null!=e||!o&&e?e:r,i.tzoff=r-e,this._updateMeshPosition()}move(t,i,s,r){this.group.forEach(e=>{e._move(t,i,s,r)}),(t||i||s)&&o&&o.event&&o.event.emit("widget.move",{widget:this,pos:{x:t,y:i,z:s},abs:r})}_move(e,t,i,s){let r=this.mesh,o=this.getMaterial(),a=this.track.pos;o.visible&&(s?(a.x=e||0,a.y=t||0,a.z=i||0):(a.x+=e||0,a.y+=t||0,a.z+=i||0),(e||t||i)&&(this.setModified(),this._updateMeshPosition()))}_updateMeshPosition(){let e=this.mesh,t=this.track,i=t.tzoff,s=t.top,r=i!==s?-i:0,{x:o,y:a,z:n}=t.pos;var h,l,c,d;t.indexed?(h=t.indexRad,l=t.box.d/2,c=Math.sin(h)*l,d=l-Math.cos(h)*l,this.mesh.rotation.x=-h,n=s):(this.mesh.rotation.x=0,n+=r),e.position.set(o,a,n)}scale(t,i,s){this.group.forEach(e=>{e._scale(t,i,s)}),this.center(!1),o&&o.event&&o.event.emit("widget.scale",{widget:this,x:t,y:i,z:s})}_scale(e,t,i){let s=this.mesh,r=this.track.scale;this.bounds=null,this.setWireframe(!1),this.clearSlices(),s.geometry.applyMatrix4((new THREE.Matrix4).makeScale(e,t,i)),r.x*=e||1,r.y*=t||1,r.z*=i||1,this.setModified()}rotate(t,i,s,r,e=!0){this.group.forEach(e=>{e._rotate(t,i,s,r)}),e&&this.center(!1),(t||i||s)&&o&&o.event&&o.event.emit("widget.rotate",{widget:this,x:t,y:i,z:s})}_rotate(t,i,s,e){e||(this.bounds=null,this.setWireframe(!1),this.clearSlices());let r=new THREE.Matrix4;var o="number"==typeof t;if(r=o?r.makeRotationFromEuler(new THREE.Euler(t||0,i||0,s||0)):r.makeRotationFromQuaternion(t),this.roto.push(r),this.mesh.geometry.applyMatrix4(r),!e&&o){let e=this.track.rot;e.x+=t||0,e.y+=i||0,e.z+=s||0}this.setModified()}unrotate(){this.roto.reverse().forEach(e=>{this.mesh.geometry.applyMatrix4(e.clone().invert())}),this.roto=[],this.center(),this.setModified()}mirror(){this.group.forEach(e=>{e._mirror()}),this.center(),o&&o.event&&o.event.emit("widget.mirror",{widget:this})}_mirror(){this.clearSlices(),this.setWireframe(!1);let e=this.mesh.geometry,t=this.track,i=e.attributes.position,s=i.array;var r=i.count;for(let e=0;e<r;e++)s[3*e]=-s[3*e];for(let e=0;e<r;e+=3){var o=s[3*e+0],a=s[3*e+1],n=s[3*e+2];s[3*e+0]=s[3*e+6],s[3*e+1]=s[3*e+7],s[3*e+2]=s[3*e+8],s[3*e+6]=o,s[3*e+7]=a,s[3*e+8]=n}i.needsUpdate=!0,t.mirror=!t.mirror,this.setModified(),this.points=null}getTabVertices(){const e=[];if(this.anno&&this.anno.tab)for(var t of this.anno.tab){var{pos:i,dim:s,rot:t}=t;const r=new THREE.BoxGeometry(s.x,s.y,s.z).toNonIndexed();r.applyMatrix4((new THREE.Matrix4).makeRotationFromQuaternion(t)),r.translate(i.x,i.y,i.z),e.appendAll(r.attributes.position.array)}return e}getGeoVertices(e={}){var{unroll:t,translate:i}=e;let s=this.mesh.geometry,r=s.getAttribute("position");var e=this.track;if(i&&e.indexed&&(r=r.clone().applyMatrix4((new THREE.Matrix4).makeRotationX(-e.indexRad))),r=r.array,s.index&&!1!==t){var o=s.index.array,a=o.length;let t=new Float32Array(3*a),i=0;for(let e=0;e<a;e++){var n,h=3*o[e];t[i++]=r[h++],t[i++]=r[h++],t[i++]=r[h]}r=t}else i&&(r=r.slice());return this.cache.geo=r,this.cache.shadow=void 0,r}getPoints(){return this.points||(this.points=c(this.getGeoVertices(),{maxpass:0})),this.points}getBoundingBox(e){return this.bounds&&!e&&!this.modified||(this.bounds=(new THREE.Box3).setFromArray(this.getGeoVertices()),this.modified=!1),this.bounds}getPositionBox(){let e=this.getBoundingBox().clone();var t=this.track.pos;return e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y,e}getExtruder(e){return e&&console.trace("legacy call with settings"),this.anno.extruder||0}setInWorker(){return this.inWorker=!0,this}slice(t,i,s){let r=this,o=u();if(r.settings=t,r.clearSlices(),s(1e-4,"slicing"),h.client&&!r.inWorker&&(r.slices=[],h.client.slice(t,this,function(e){e.alert&&s(null,null,e.alert),e.update&&s(e.update,e.updateStatus),e.send_start&&(r.xfer={start:e.send_start}),e.stats&&(r.stats=e.stats),e.send_end&&(r.stats.load_time=r.xfer.start-e.send_end),e.slice&&r.slices.push(h.codec.decode(e.slice,{mesh:r.mesh})),e.done&&i(!0),e.error&&i(!1,e.error)})),h.server){var a=function(e){if(e)return i(e);s(1,"transfer"),r.stats.slice_time=u()-o,i()},n=function(e,t,i){s(e,t,i)};let e=l[t.mode.toUpperCase()];e?e.slice(t,r,n,a):(console.log("invalid mode: "+t.mode),i("invalid mode: "+t.mode))}r.points=void 0}render(t){var e=Date.now();return this.slices&&this.slices.forEach(e=>{e.layers&&t.add(e.layers)}),Date.now()-e}setWireframe(i,e,s){if(o&&o.conf){let e=this.mesh,t=this;var i,i,i;this.wire&&(this.setOpacity(1),e.remove(this.wire),this.wire=null),i&&(i=o.space.is_dark(),i=new THREE.MeshBasicMaterial({wireframe:!0,color:i?11184810:0,opacity:.5,transparent:!0}),i=t.wire=new THREE.Mesh(e.geometry.shallowClone(),i),e.add(i)),o.view.is_arrange()?this.setColor(this.color):this.setColor(8947848,void 0,!1),void 0!==s&&t.setOpacity(s)}}show(){this.mesh.visible=!0}hide(){this.mesh.visible=!1}}const k=M.Groups={list(){return g.slice()},merge(e){let t=e.map(e=>e.group).uniq();if(1<t.length){let e=t.shift();var i=e[0].track.pos,s;for(s of t){for(var r of s){var o=r.track.pos;r.group=e,r.moveMesh(i.x-o.x,i.y-o.y,i.z-o.z),r._move(i.x,i.y,i.z,!0),e.push(r)}g.splice(g.indexOf(s),1)}}},split(e){for(var t of e.map(e=>e.group).uniq()){g.splice(g.indexOf(t),1);for(var i of t){let e=k.forid(i.id);e.push(i),i.group=e}}},forid(t){for(let e=0;e<g.length;e++)if(g[e].id===t)return g[e];let e=[];return e.id=t,g.push(e),e},remove(i){g.slice().forEach(e=>{let t=e.indexOf(i);0<=t&&e.splice(t,1),0===e.length&&(t=g.indexOf(e),g.splice(t,1))})},blocks(){return g.map(e=>({w:e[0].track.box.w,h:e[0].track.box.h,move:(t,i,s,r)=>{e.forEach(e=>{e.getMaterial().visible=!0,e._move(t,i,s,r)})}}))},loadDone(){g.forEach(e=>{e.centered||(e[0].center(),e.centered=!0)})},bounds(e){let t=null;return e.forEach(e=>{var e=e.mesh.getBoundingBox(!0);t=t?t.union(e):e}),t},clear(){g.length=0}};M.loadFromCatalog=function(i,s){E().getFile(i,function(e){let t=w().loadVertices(e);t.meta.file=i,s(t)})},M.loadFromState=function(h,l,c){b().get("ws-save-"+h,function(n){if(n){let e=n.geo||n,t=n.track||void 0,i=n.group||h,s=n.anno||void 0,r=w(h,k.forid(i)),o=n.meta||r.meta,a=r.loadVertices(e);r.meta=o,r.anno=s||r.anno,c&&t&&t.pos&&(r.track=t,r.move(t.pos.x,t.pos.y,t.pos.z,!0)),l(a)}else l(null)})},M.deleteFromState=function(e,t){b().remove("ws-save-"+e,t)},h.Widget=M,h.newWidget=w});"use strict";gapp.register("kiri.layers",[],(t,e)=>{const{base:o,kiri:s}=t,{polygons:a,newPolygon:y}=o,r=o.polygons;class n{constructor(){this.init()}init(){this.layers={},this.profiles={},this.stats={contour:0,flat_line:0,flat_poly:0,line_poly:0,line:0}}getLayer(t){return this.layers[t]}setRotation(t=0,e=0,s=0){return this.rotation={x:t,y:e,z:s},this}setPosition(t=0,e=0,s=0){return this.position={x:t,y:e,z:s},this}setLayer(t,e,s){let o=this.layers;return"number"==typeof e&&(e={line:e,face:e,opacity:1}),this.current=o[t]=o[t]||{rotation:this.rotation,position:this.position,off:!0===s,lines:[],polys:[],faces:[],norms:void 0,cface:void 0,paths:void 0,cpath:void 0,color:e||{check:0,line:0,face:0,opacity:1}},this}addLine(t,e){return this.current.lines.push(t,e),this}addLines(e,t){if(t){t.open=!0;const s=[];for(let t=0;t<e.length-1;t+=2)s.push((new o.Polygon).append(e[t]).append(e[t+1]).setOpen());return this.addPolys(s,t)}for(let t=0;t<e.length-1;t+=2)this.addLine(e[t],e[t+1]),this.stats.line++;return this}addPoly(t,e){return this.addPolys([t],e)}addPolys(t,e){if(0===t.length)return this;if(e&&e.clean&&(t=t.map(t=>t.clean(!0))),e&&e.flat)return this.addFlats(t,e);if(e&&!e.thin)return this.addPaths(t,e);if(t=g(t),e)for(var s of t)switch(void 0!==e.z&&s.setZ(e.z),typeof e.color){case"number":s.color=e.color;break;case"object":s.color=e.color.line}return this.current.polys.appendAll(t),this.stats.line_poly+=t.length,this}addAreas(t,e){const s=this.current.faces;for(var o of t=Array.isArray(t)?t:[t])for(var a of o.earcut())for(var r of a.points)s.push(r.x,r.y,r.z);e&&e.outline&&this.addPolys(t.clone(!0))}addFlats(t,e){var s=e||{},o=s.offset||1;if((t=g(t)).length){const f=this.current,p=f.faces,u=[];for(var a of t){var r=p.length/3,n=a.toPath2D(.95*o),{left:i,right:c,normals:l}=n,h;for(h of n.faces)p.push(h.x,h.y,h.z);if(u.push(l),s.outline){let t=y().addPoints(i).setOpenValue(a.open),e=y().addPoints(c).setOpenValue(a.open);a.z&&(t.setZ(a.z),e.setZ(a.z)),this.addPolys(t),this.addPolys(e)}var a=s.color?"number"==typeof s.color?{line:s.color,face:s.color}:s.color:f.color;if(f.cface){const d=f.cface[f.cface.length-1];d.face===a.face&&d.opacity===a.opacity||(d.count=r,f.cface.push(Object.assign({start:r,count:1/0},a)))}else f.cface=[Object.assign({start:r,count:1/0},a)]}return f.norms?f.norms.appendAll(u.flat()):f.norms=u.flat(),this}}addPaths(t,e){var s=e||{},o=s.height||1,a=s.offset||1;if((t=g(t)).length){for(var r of t)if(!(r.length<(r.open?2:3))){var n=s.z||r.getZ(),{faces:i,normals:c}=r.toPath3D(a,o,0);const h=this.current,f=h.paths;if(i&&c){if(f){var l=f.faces.length/3;const p=new Float32Array(f.faces.length+i.length);var r=f.faces.length/3;if(p.set(f.faces),p.set(i,f.faces.length),f.faces=p,s.color){h.cpath||(h.cpath=[Object.assign({start:0,count:r-1},h.color)]);const u=h.cpath[h.cpath.length-1];u.face===s.color.face&&u.opacity===s.color.opacity||(u.count=r,h.cpath.push(Object.assign({start:r,count:1/0},s.color)))}c&&f.norms.appendAll(c)}else h.paths={faces:i,z:n,norms:c},s.color&&(h.cpath=[Object.assign({start:0,count:1/0},s.color)]);this.stats.contour++}}return this}}}function g(t){return Array.isArray(t)?r.flatten(t.clone(!0),[],!0):r.flatten([t.clone(!0)],[],!0)}s.Layers=n});"use strict";gapp.register("kiri.codec",[],(r,e)=>{const{base:a,kiri:s}=r,o={},t=!0,c=e({undef:void 0,encode:f,decode:u,registerDecoder:p,allocFloat32Array:l,encodePointArray:d,decodePointArray:v,encodePointArray2D:A,decodePointArray2D:g,toCodable:i}),n={WIDGET:100,SLICE:200,TOP:300,POLY:400,LAYERS:500};function i(r){switch(typeof r){case"function":return;case"string":case"number":return r;case"object":if(Array.isArray(r))return r.map(r=>i(r))}let e={};for(var[t,o]of Object.entries(r))switch(typeof o){case"function":break;case"object":o=Array.isArray(o)?o.map(r=>i(r)):i(o);default:e[t]=o}return e}function l(e,t){if(void 0!==e){if(0===e.length)return[];let r;return r=e.byteLength?e:(Array.isArray(e),new Float32Array(e)),t&&0<r.byteLength&&t.push(r.buffer),r}}function f(t,o){if(o=o||{},null===t)return null;if(void 0!==t){if(Array.isArray(t)){let r=new Array(t.length),e=0;for(;e<t.length;)r[e]=f(t[e++],o);return r}switch(typeof t){case"boolean":case"string":case"number":return t;case"object":return t.encode?t.encode(o):y(t,o)}return null}}function u(e,t){if(t=t||{},null===e)return null;if(void 0!==e){if(Array.isArray(e)){for(let r=0;r<e.length;r++)e[r]=u(e[r],t);return e}switch(typeof e){case"boolean":case"string":case"number":return e;case"object":return e.type&&o[e.type]?o[e.type](e,t):h(e,t)}return null}}function p(r,e){o[r]=e}function y(r,e){if(r instanceof Float32Array)return r;let t={};for(var o in r)r.hasOwnProperty(o)&&(t[o]=f(r[o],e));return t}function h(r,e){if(r instanceof Float32Array)return r;let t={};for(var o in r)r.hasOwnProperty(o)&&(t[o]=u(r[o],e));return t}function d(o,r,n){if(!o)return null;var i=o.length;if(0===i)return o;var r=r?r.zeros:void 0;const l=c.allocFloat32Array(3*i,r);for(let r=0,e=0,t;r<i;r++)t=o[r],l[e++]=t.x,l[e++]=t.y,l[e++]=n||t.z;return l}function A(o,r){if(!o)return null;var n=o.length;if(0===n)return o;var r=r?r.zeros:void 0;const i=c.allocFloat32Array(2*n,r);for(let r=0,e=0,t;r<n;r++)t=o[r],i[e++]=t.x,i[e++]=t.y;return i}function v(t){if(!t)return null;var o=t.length;const n=new Array(o/3);for(let r=0,e=0;r<o;)n[e++]=a.newPoint(t[r++],t[r++],t[r++]);return n}function g(t,o,n){if(!t)return null;var i=t.length;const l=new Array(i/2);for(let r=0,e=0;r<i;)l[e++]=n?n(t[r++],t[r++]):a.newPoint(t[r++],t[r++],o);return l}function w(r,e){return r.map(r=>({open:r.open,color:r.color,points:c.encodePointArray(r.points,e.zeros)}))}s.Widget.prototype.encode=function(r){var e=r._json_,r=this.getGeoVertices(),t;return{type:n.WIDGET,id:this.id,ver:1,json:e,group:this.group.id,track:this.track,geo:e?Array.from(r):r}},p(n.WIDGET,function(r,e){const t=r.id,o=r.group||t,n=r.track||void 0,i=s.newWidget(t,s.Widget.Groups.forid(o));return i.loadVertices(r.json?r.geo.toFloat32():r.geo),i.saved=Date.now(),n&&n.pos&&(i.track=n,i.move(n.pos.x,n.pos.y,n.pos.z,!0)),i}),s.Slice.prototype.encode=function(r){var r={type:n.SLICE,z:this.z,index:this.index,layers:f(this.layers,r)};return this.layers=void 0,r},p(n.SLICE,function(r,e){let t=s.newSlice(r.z,e.mesh?e.mesh.newGroup():null);return t.index=r.index,t.layers=u(r.layers,e),t}),s.Top.prototype.encode=function(r){let e={type:n.TOP,poly:f(this.poly,r)};return r.full&&(e.last=f(this.last,r),e.shells=f(this.shells,r),e.fill_off=f(this.fill_off,r),e.fill_lines=f(this.fill_lines,r)),e},p(n.TOP,function(r,e){let t=s.newTop(u(r.poly,e));return e.full&&(t.last=u(r.last,e),t.shells=u(r.shells,e),t.fill_off=u(r.fill_off,e),t.fill_lines=u(r.fill_lines,e)),t}),a.Polygon.prototype.encode=function(r){var e;return r.poly||(r.poly={}),r.poly[this.id]?{type:n.POLY,ref:this.id}:(r.poly[this.id]=this,{type:n.POLY,id:this.id,array:d(this.points,r,this.z),inner:f(this.inner,r),parent:f(this.parent,r),depth:this.depth,color:this.color,open:this.open})},p(n.POLY,function(r,e){if(e.poly||(e.poly={}),r.ref)return e.poly[r.ref];var t=r.array,o=t.length;const n=a.newPolygon();for(let r=0;r<o;)n.push(a.newPoint(t[r++],t[r++],t[r++]));return e.poly[r.id]=n,n.id=r.id,n.open=r.open,n.inner=u(r.inner,e),n.parent=u(r.parent,e),n.depth=r.depth,n.color=r.color,n}),s.Layers.prototype.encode=function(t){let o=t.zeros;var r={type:n.LAYERS,layers:Object.keys(this.layers),data:Object.values(this.layers).map(r=>{var e=r.paths;return{off:r.off,color:r.color,polys:w(r.polys,t),lines:d(r.lines,t),faces:c.allocFloat32Array(r.faces,o),norms:c.allocFloat32Array(r.norms,o),cface:r.cface||c.undef,paths:e?{z:e.z,index:e.index,faces:c.allocFloat32Array(e.faces,o),norms:c.allocFloat32Array(e.norms,o)}:void 0,cpath:r.cpath||c.undef,rotation:r.rotation,position:r.position}})};return this.init(),r},p(n.LAYERS,function(e,r){const t=new s.Layers;var{layers:o}=e;for(let r=0;r<o.length;r++){var n=e.data[r],i=n.paths;const l=t.layers[o[r]]={off:n.off,color:n.color,polys:n.polys,lines:n.lines,faces:c.allocFloat32Array(n.faces),norms:c.allocFloat32Array(n.norms),cface:n.cface,paths:i?{z:i.z,index:i.index,faces:c.allocFloat32Array(i.faces),norms:c.allocFloat32Array(i.norms)}:void 0,cpath:n.cpath,rotation:n.rotation,position:n.position};l.cface&&l.cface.forEach(r=>{null===r.count&&(r.count=1/0)}),l.cpath&&l.cpath.forEach(r=>{null===r.count&&(r.count=1/0)})}return t})});!function(){var e="undefined"!=typeof self,s={COPYRIGHT:"Copyright (C) Stewart Allen <sa@grid.space> - All Rights Reserved",LICENSE:"See the license.md file included with the source distribution",VERSION:(e?self:this).debug_version||"3.9.4"};if("object"==typeof module&&(module.exports=s),e&&self.gapp){let e=self.gapp;e.license=s.LICENSE,e.version=s.VERSION,e.copyright=s.COPYRIGHT,gapp.register("moto.license"),(self.module=self.module||{}).exports=s}}();"use strict";gapp.register("kiri-run.worker",[],(e,t)=>{const{base:d,kiri:u,moto:n}=e,{util:r,polygons:o,wasm_ctrl:a}=d,{codec:g}=u,{time:c}=r,p=o;let s=!0===self.debug,i=this.navigator&&navigator.hardwareConcurrency||0,f=self.Worker&&3<i?i-1:0,v=self.worker={print:null,snap:null},m={},h={},l={},b=[],y=[],k={},w=0;function x(e){var t=e.data,e=t.seq;let n=k[e];if(!n)throw"missing dispatch "+e;delete k[e],n(t)}u.version=gapp.version,self.alert=function(e){console.log(e)},self.uuid=(Math.random()*Date.now()|0).toString(36);const _=u.minions={get concurrent(){return f},get running(){return b.length},start(){if(!b.length&&f){for(let t=0;t<f;t++){var n=s?"_":"";let e=new Worker("/code/kiri_pool.js?"+n+self.kiri.version);e.onmessage=x,e.postMessage({cmd:"label",name:"#"+t}),b.push(e)}console.log(`kiri | init pool | ${gapp.version||"rogue"} | `+(1+f))}},stop(){for(var e of b)e.terminate();b.length=0},union(i,l){return new Promise((r,e)=>{if(f<2||i.length<2*f||p.points(i)<50*f)r(p.union(i,l,!0));else{var o=Math.ceil(i.length/f);let t=0,n=[];var a=function(e){var e=g.decode(e.union);n.appendAll(e),0==--t&&r(p.union(n,l,!0))};for(let e=0;e<i.length;e+=o){var s={zeros:[]};t++,_.queue({cmd:"union",minarea:l,polys:g.encode(i.slice(e,e+o),s)},a,s.zeros)}}})},fill(r,o,a,s,i,l){return new Promise((t,e)=>{var n;f<2?t(p.fillArea(r,o,a,[],i,l)):(n={zeros:[]},_.queue({cmd:"fill",polys:g.encode(r,n),angle:o,spacing:a,minLen:i,maxLen:l},e=>{var n=e.fill;let r=[];for(let t=0;t<n.length;){let e=d.newPoint(n[t++],n[t++],n[t++]);e.index=n[t++],r.push(e)}s.appendAll(r),t(r)},n.zeros))})},clip(a,n,r){return new Promise((o,e)=>{f<2&&e("concurrent clip unavailable");const t={zeros:[]};_.queue({cmd:"clip",polys:g.encode(p.flatten(n).map(e=>g.encodePointArray2D(e.points,t)),t),lines:g.encode(r.map(e=>g.encodePointArray2D(e,t)),t),z:a.z},e=>{var t=g.decode(e.clips),n;for(n of a.tops)for(var r of t)r.isInside(n.poly)&&n.fill_sparse.push(r);o(t)},t.zeros)})},sliceZ(s,i,l){return new Promise((n,e)=>{f<2&&e("concurrent slice unavaiable");let{each:r}=l,t=0,o=new Float32Array(3*i.length);for(var a of i)o[t++]=a.x,o[t++]=a.y,o[t++]=a.z;_.queue({cmd:"sliceZ",z:s,points:o,options:g.toCodable(l)},e=>{var e=g.decode(e.output);if(r)for(var t of e)r(t);n(e)},[o.buffer])})},queue(e,t,n){y.push({work:e,ondone:t,direct:n}),_.kick()},queueAsync(t,n){return new Promise(e=>{_.queue(t,e,n)})},kick(){if(b.length&&y.length){let t=y.shift(),n=b.shift();var e=w++;t.work.seq=e,k[e]=e=>{t.ondone(e),b.push(n),_.kick()},n.postMessage(t.work,t.direct)}},broadcast(e,t,n){for(var r of b)r.postMessage({cmd:e,...t},n)}};console.log("kiri | init work | "+(gapp.version||"rogue"));const z=u.server=u.worker={pool_start(e,t){_.start(),t.done({})},pool_stop(e,t){_.stop(),t.done({})},group:m,cache:h,decimate(e,t){var{vertices:n,options:e}=e,n=new Float32Array(n);n=d.pointsToVertices(d.verticesToPoints(n,e)),t.done(n)},snap(e,t){v.snap=e,t.done()},png(e,r){if(v.snap){let e=v.snap.url;var o=atob(e.substring(e.indexOf(",")+1));let n=Uint8Array.from(o,e=>e.charCodeAt(0)),t=new png.PNG;t.parse(n,(e,t)=>{r.done({png:n},[n])})}else r.done({error:"missing snapshot"})},clear(e,t){v.print=null,z.group=m={},z.cache=h={},u.Widget.Groups.clear(),t.done({clear:!0})},sync(r,o){if(r.valid){for(let t in h)if(r.valid.indexOf(t)<0){delete h[t];for(var[e,n]of Object.entries(m))m[e]=n=n.filter(e=>e.id!==t),n.id=e}o.done(r.id)}else{let e=m[r.group];e||(e=[],e.id=r.group,m[r.group]=e);let t=r.vertices,n=u.newWidget(r.id,e).setInWorker().loadVertices(t);h[r.id]=n,n.vertices=t,n.meta=r.meta,n.track=r.track,o.done(r.id)}},rotate(e,t){var{settings:n}=e,r;if(!n.device.bedBelt)return t.done({});function o(n,e={}){let r=e.miny||1/0,o=e.maxy||-1/0;for(let e=0,t=n.length;e<t;){var a=n[e++],s=n[e++],i=n[e++];r=Math.min(r,s),o=Math.max(o,s)}return{miny:r,maxy:o}}function a(e){let t={};for(var n of e)t=o(n.vertices,t);return t}for(r of Object.values(m)){var{miny:s,maxy:i}=a(r);let e=r[0];var l=n.process,d=e.track,c=d.pos.x,p=l.beltAnchor||l.firstLayerBeltLead||0,l=n.device.bedDepth/2+d.pos.y+s+p,d=Math.PI/180*45,u;for(u of r)u.moveMesh(0,s,0);e.rotate(d,0,0,!0,!1);var d=a(r),g;e.belt={angle:45,xpos:c,ypos:l,yadd:d.maxy-d.miny,dy:-s-p,dz:0};for(g of r.slice(1))g.belt=e.belt;t.data({group:r.id,belt:e.belt})}t.done({})},slice(e,r){r.data({update:.001,updateStatus:"slicing"}),v.print=null;let t=e.settings,n=h[e.id],o=c(),a;n.anno=e.anno||n.anno,n.slice(t,function(e){if(e)r.data({error:e});else{const t=n.slices||[];r.data({send_start:c()}),r.data({stats:n.stats,slices:t.length}),t.forEach((e,t)=>{var n={zeros:[]};r.data({index:t,slice:e.encode(n)},n.zeros)}),r.data({send_end:c()})}r.done({done:!0})},function(e,t,n){a=c(),n&&r.data({alert:n}),a-o<10&&e<.99||((e||t)&&r.data({update:.05+.95*e,updateStatus:t}),o=a)})},sliceAll(e,t){var{settings:n}=e,{mode:e}=n;const r=u.driver[e];r.sliceAll&&r.sliceAll(n,t.data),t.done({done:!0})},prepare(e,o){var t=Object.values(h);o.data({update:.05,updateStatus:"preview"});const{settings:r}=e;var{mode:e}=r;const n=u.driver[e];if(!n||!n.prepare)return console.log({invalid_print_driver:e,driver:n});n.prepare(t,r,(e,t,n)=>{var r={zeros:[]},n={progress:e,message:t,layer:n?n.encode(r):void 0};o.data(n,r.zeros)}).then(()=>{var e="in"===r.controller.units?1/25.4:1,t=v.print||{},n=(t.minSpeed||0)*e,e=(t.maxSpeed||0)*e;o.data({progress:1,message:"transfer"}),o.done({done:!0,minSpeed:n,maxSpeed:e})})},export(e,n){var t=e.settings.mode;const r=u.driver[t];if(!r||!r.export)return console.log({missing_export_driver:t}),n.done();let o;r.export(v.print,function(e,t){n.data({line:e},t)},function(e){o=e},function(e){n.data({debug:e})});var{bounds:a,time:s,lines:i,bytes:l,distance:d,settings:c,segments:e,purges:t}=v.print;n.done({done:!0,output:o||{bounds:a,time:s,lines:i,bytes:l,distance:d,settings:c,segments:e,purges:t}})},colors(e,t){const{colors:n,max:r}=e,o={};n.forEach(e=>{o[e]=u.render.rate_to_color(e,r)}),t.done(o)},parse(e,r){var{settings:t,code:n,type:o}=e,a=t.origin,s={x:a.x,y:-a.y,z:a.z},e=t.device;const i=v.print=u.newPrint(t,Object.values(h)),l=e.extruders;var a=t.mode;const d="line"===t.controller.lineType||"FDM"!==a,c="flat"===t.controller.lineType&&"FDM"===a;var p=i.parseGCode(n,s,e=>{r.data({progress:.25*e})},e=>{const t=i.minSpeed,n=i.maxSpeed;u.render.path(e.output,e=>{r.data({progress:.25+.75*e})},{thin:d||i.belt,flat:c,tools:l}).then(e=>{r.done({parsed:g.encode(e),maxSpeed:n,minSpeed:t})})},{fdm:"FDM"===a,cam:"CAM"===a,belt:e.bedBelt})},parse_svg(e,t){e.forEach(e=>{e.forEach(e=>{var{x:t,y:n,z:r}=e.point;e.point=d.newPoint(t,n,r||0)})});var n=v.print=u.newPrint(null,Object.values(h));u.render.path(e,e=>{t.data({progress:e})},{thin:!0}).then(e=>{t.done({parsed:g.encode(e)})})},config(e,t){const n={};e.base?(n.base=e.base,Object.assign(d.config,e.base)):console.log({invalid:e});for(var r of b)r.postMessage({cmd:"config",base:e.base});t.done({config:n})},image2mesh(e,t){var{device:n}=e.settings;load.PNG.parse(e.png,{outWidth:n.bedDepth,outHeight:n.bedWidth,inv_image:e.inv_image,inv_alpha:e.inv_alpha,border:e.border,blur:e.blur,base:e.base,progress(e){t.data({progress:e})},done(e){t.done({vertices:e},[e.buffer])}})},zip(e,t){var{files:e}=e,n;let r=new JSZip;for(n of e)r.file(n.name,n.data);r.generateAsync({type:"uint8array",compression:"DEFLATE",compressionOptions:{level:6},streamFiles:!0},e=>{t.data(e)}).then(e=>{t.done(e)})},wasm(e,t){e.enable?a.enable():a.disable(),_.broadcast("wasm",{enable:!!e.enable}),t.done({wasm:e})},putCache(e,t){var{key:n,data:r}=e;r?l[n]=r:delete l[n],_.broadcast("putCache",e),t.done({ok:!0})},clearCache(e,t){l={},_.broadcast("clearCache",e),t.done({ok:!0})}};function A(e){return"AsyncFunction"===e.constructor.name}z.send=(e,t)=>{self.postMessage(e,t)},z.onmessage=self.onmessage=async function(e){let t=c(),n=e.data||{},r=z[n.task],o={data:function(e,t){z.send({seq:n.seq,task:n.task,done:!1,data:e},t)},done:function(e,t){z.send({seq:n.seq,task:n.task,done:!0,data:e},t)}};if(r)try{var a=t-n.time,s=A(r)?await r(n.data,o):r(n.data,o),i,l=c()-t;s&&z.send({seq:n.seq,task:n.task,time_send:a,time_proc:l,time_recv:c(),data:s})}catch(e){console.trace(e.stack),o.done({error:e.toString()})}else console.log({worker_unhandled:e,msg:n,fn:z[n.task]})},n.broker.publish("worker.started",{dispatch:z,minions:_})});"use strict";gapp.register("kiri.pack",[],(t,i)=>{const{kiri:h}=t;class s{constructor(t,i,h){this.root={x:0,y:0,w:t,h:i},this.max={w:0,h:0},this.packed=!1,this.spacing="number"==typeof h?h:1,this.pad=this.spacing/2}simple(t){let i=0,h,s=0,a=0,r=0;for(;i<t.length;)if(h=t[i++],h.fit={x:s,y:a},this.max.w=Math.max(this.max.w,s+h.w),this.max.h=Math.max(this.max.h,a+h.h),r=Math.max(r,h.h),s+=h.w+this.spacing,s>this.root.w&&(s=0,a+=r+this.spacing,r=0),a>this.root.h)return this;return this.packed=!0,this}fit(t,i){if(i)return this.simple(t);let h=0,s,a,r,e;for(;h<t.length;){if(a=t[h++],r=a.w+this.spacing,e=a.h+this.spacing,!(s=this.findNode(this.root,r,e)))return this;a.fit=this.splitNode(s,r,e)}return this.packed=!0,this}findNode(t,i,h){return t.used?this.findNode(t.right,i,h)||this.findNode(t.down,i,h):i<=t.w&&h<=t.h?t:null}splitNode(t,i,h){return t.used=!0,t.down={x:t.x,y:t.y+h,w:t.w,h:t.h-h},t.right={x:t.x+i,y:t.y,w:t.w-i,h:h},this.max.w=Math.max(this.max.w,t.x+i),this.max.h=Math.max(this.max.h,t.y+h),t}}h.Pack=s});"use strict";gapp.register("kiri.print",[],(root,evets)=>{const{base,kiri}=self,{paths,util,newPoint,Polygon}=base,{tip2tipEmit}=paths,{numOrDefault}=util,{beltfact}=kiri.consts,XAXIS=new THREE.Vector3(1,0,0),DEG2RAD=Math.PI/180;class Print{constructor(t,e,a){this.id=a||(new Date).getTime().toString(36),this.settings=t,this.widgets=e,this.lastPoint=null,this.lastPoly=null,this.lastEmit=null,this.lastOut=null,this.lastPos=null,this.tools={},this.debugE=t&&t.controller.devel?1:0}setType(t){this.nextType=t}addOutput(t,e,a,s,r,i){let{lastPoint:n,lastEmit:o,lastOut:l}=this;if(n&&e){var{x:h,y:c,z:u}=n;if(e.x==h&&e.y==c&&e.z==u&&o==a)return l}return this.lastPoint=e,this.lastEmit=a,this.lastOut=l=new Output(e,a,s,r,i||this.nextType),void 0!==r&&(this.tools[r]=!0),t.push(l),this.nextType=void 0,l}addPrintPoints(t,e,a,s){this.startPoint&&0<t.length&&(this.lastPoint=this.startPoint),e.appendAll(t)}polyPrintPath(t,e,o,l={}){l.ccw?t.setCounterClockwise():t.setClockwise();const h=this;var{settings:a}=h,{process:a}=a;let s=a.outputShortDistance,c=numOrDefault(l.extrude,a.outputShellMult),u=l.rate||a.outputFeedrate,p=a.outputSeekrate,r=a.outputMinSpeed,x=l.coast||0,i=l.simple?t.first():t.findClosestPointTo(e),m=t.perimeter(),n=!l.open,d=l.tool,f=e,y=!0;return m<a.outputShortPoly&&(u=r+(u-r)*(m/a.outputShortPoly)),t.forEachPoint((t,e,a,s)=>{var r,i,n,r,r;y?(l.onfirst&&l.onfirst(t),r=h.addOutput(o,t,0,p,d),l.onfirstout&&l.onfirstout(r),y=!1):(i=f.distTo2D(t),x&&c&&m-i<=x&&(r=i-(m-x),r=f.offsetPointFrom(t,r),h.addOutput(o,r,c,u,d),c=0),m-=i,h.addOutput(o,t,c,u,d)),f=t},n,i.index),this.lastPoly=t,o.last().point}constReplace(str,consts,start,pad,short){let cs=str.indexOf("{",start||0),ce=str.indexOf("}",cs),tok,nutok,nustr;if(0<=cs&&ce>cs){tok=str.substring(cs+1,ce);let eva=[];for(var[k,v]of Object.entries(consts))switch(typeof v){case"number":case"boolean":eva.push(`let ${k} = ${v};`);break;default:void 0===v&&(v=""),eva.push(`let ${k} = "${v.replace(/\"/g,'\\"')}";`)}eva.push("function range(a,b) { return (a + (layer / layers) * (b-a)).round(4) }"),eva.push(`try {( ${tok} )} catch (e) {console.log(e);0}`);let scr=eva.join(""),evl=eval(`{ ${scr} }`);if(nutok=evl,666===pad)return evl;if(pad){nutok=nutok.toString();let oldln=ce-cs+1,tokln=nutok.length;tokln<oldln&&(short=(short||1)+(oldln-tokln))}return nustr=str.replace("{"+tok+"}",nutok),this.constReplace(nustr,consts,ce+1+(nustr.length-str.length),pad,short)}if(short){let si=str.indexOf(";");0<si&&(str=str.replace(";",";".padStart(short," ")))}return str}parseSVG(t,r){let i=this,e=(new DOMParser).parseFromString(t,"text/xml"),a=[...e.getElementsByTagName("polyline")],n=i.output=[],o=i.bounds={max:{x:-1/0,y:-1/0,z:-1/0},min:{x:1/0,y:1/0,z:1/0}};return a.forEach(t=>{let s=[],e=[...t.points];e.forEach(t=>{r&&(t.x+=r.x,t.y+=r.y),t.x&&(o.min.x=Math.min(o.min.x,t.x)),t.x&&(o.max.x=Math.max(o.max.x,t.x)),t.y&&(o.min.y=Math.min(o.min.y,t.y)),t.y&&(o.max.y=Math.max(o.max.y,t.y)),t.z&&(o.min.z=Math.min(o.min.z,t.z)),t.z&&(o.max.z=Math.max(o.max.z,t.z));var{x:e,y:a,z:t}=t;i.addOutput(s,{x:e,y:a,z:t},0<s.length)}),n.push(s)}),i.imported=t,i.lines=a.length,i.bytes=t.length,i.output}parseGCode(t,e,a,s,r={}){const h=r.fdm;var i=r.cam,n;const c=r.belt,o=t.toUpperCase().replaceAll("X"," X").replaceAll("Y"," Y").replaceAll("Z"," Z").replaceAll("A"," A").replaceAll("E"," E").replaceAll("F"," F").replaceAll("G"," G").replaceAll("I"," I").replaceAll("J"," J").replaceAll("  "," ").split("\n"),u=this,p=!0,x=u.bounds={max:{x:-1/0,y:-1/0,z:-1/0},min:{x:1/0,y:1/0,z:1/0}},m={X:0,Y:0,Z:0,A:0,F:0,E:0},l=0,d=e&&e.x||0,f=e&&e.y||0,y=e&&e.z||0,v={X:0,Y:0,Z:0};let b=0,g=!0,M=!0,X=0,E=0,P=1,Y=0,k=1/0,A=0,z=[],O=!0,Z=!1,w=Math.PI/24,G=!1,F="G1";const I=u.output=[z],S={X:"X",Y:"Z",Z:"Y",E:"E",F:"F"};function R(){console.log(...[...arguments].map(t=>Object.clone(t)))}function D(r,t,e){const i={};t.forEach(t=>{i[t.charAt(0)]=parseFloat(t.substring(1))});let n={x:0,y:0,r:0};if(void 0!==i.X||i.X!==i.Y){if(void 0!==i.I&&void 0!==i.J)n.x=m.X+i.I,n.y=m.Y+i.J,n.r=Math.sqrt(i.I*i.I+i.J*i.J);else if(void 0!==i.R){let t,e=i.X-m.X,a=i.Y-m.Y;var o=Math.sqrt(e*e+a*a)/2;let s;s=Math.abs(o-i.R)<.001?{x:(i.X+m.X)/2,y:(i.Y+m.Y)/2}:base.util.center2pr({x:m.X,y:m.Y},{x:i.X,y:i.Y},i.R,r),n.x=s.x,n.y=s.y,n.r=i.R}else console.log({malfomed_arc:t});var o=Math.atan2(n.y-m.Y,n.x-m.X)+Math.PI,t=Math.atan2(n.y-i.Y,n.x-i.X)+Math.PI,r=base.util.thetaDiff(o,t,r),a=Math.max(Math.floor(Math.abs(r)/w),3),l=(.001<Math.abs(r)?r:2*Math.PI)/a;let s=o+l;var r=Math.abs(o-t),o=m.X-i.X,t=m.Y-i.Y,t=Math.sqrt(o*o+t*t);if(r<.005&&t<5)T(!1,["X"+i.X,"Y"+i.Y,"E1"]);else{var h={X:m.X,Y:m.Y};for(let t=0;t<=a-2;t++){let t,e=n.x+Math.cos(s)*n.r,a=n.y+Math.sin(s)*n.r;s+=l,T(!1,["X"+e,"Y"+a,"E1"])}T(!1,["X"+i.X,"Y"+i.Y,"E1"]),m.X=i.X,m.Y=i.Y}}}function T(t,e){const a={},s={};F=t?"G0":"G1",e.forEach(t=>{let e=t.charAt(0);p&&c&&(e=S[e]);var t=parseFloat(t.substring(1));s[e]=t,g?m[e]=t:(a[e]=t,m[e]+=t)});const r=newPoint(P*m.X+v.X,P*m.Y+v.Y,P*m.Z+v.Z+b);var i;p&&c&&(r.y-=r.z*beltfact,r.z*=beltfact),m.A&&(i=new THREE.Vector3(m.X,m.Y,m.Z).applyAxisAngle(XAXIS,m.A*DEG2RAD),r.x=i.x,r.y=i.y,r.z=i.z);var i=h&&m.E<0||void 0,t=t||h&&(m.E<=0||!(s.X||s.Y||s.Z));if(!t&&r.x&&(x.min.x=Math.min(x.min.x,r.x)),!t&&r.x&&(x.max.x=Math.max(x.max.x,r.x)),!t&&r.y&&(x.min.y=Math.min(x.min.y,r.y)),!t&&r.y&&(x.max.y=Math.max(x.max.y,r.y)),!t&&r.z&&(x.min.z=Math.min(x.min.z,r.z)),!t&&r.z&&(x.max.z=Math.max(x.max.z,r.z)),m.F&&(k=Math.min(k,m.F)),A=Math.max(A,m.F),t)return u.addOutput(z,r,!1,m.F,Y).retract=i,void(u.lastPos=Object.assign({},m));if(void 0===z.Z&&(z.Z=m.Z),h&&0===E&&(z.height=X=E=m.Z),Z||O&&z.Z!=m.Z){Z=!1;let t=m.Z-z.Z;var n=0<t?t:X;z=[],z.height=E=n,h&&(t=-E/2),I.push(z)}G||t||(z.height=z.Z=m.Z,G=!0);var n=u.lastPos,t,n,o,l;u.debugE&&h&&n&&m.E&&(o=(t=M?m.E-u.lastPosE:m.E)/(n=Math.sqrt(Math.pow(m.X-n.X,2)+Math.pow(m.Y-n.Y,2))),2<n&&.001<t&&(l=(M?"aA":"rR")[u.debugE++%2])),u.addOutput(z,r,!0,m.F,Y).retract=i,u.lastPos=Object.assign({},m),u.lastPosE=m.E}const C=i?Math.ceil(o.length/2500):0;o.forEach((e,a)=>{var s;if(C&&a%C==0&&(Z=!0,O=!1),0===e.indexOf(";LAYER:")&&(Z=!0,O=!1),0<e.indexOf("- LAYER ")&&(z.height=X,s=e.replace("(","").replace(")","").split(" "),X=parseFloat(s[4]),h&&(b=-X/2),Z=!0,O=!1),(e=e.trim().split(";")[0].split(" ").filter(t=>t)).length){var r=e[0].charAt(0),s,r;let t=0<=["X","Y","Z"].indexOf(r)?F:e.shift();if(t)switch("T"===t.charAt(0)&&(s=u.settings.device.extruders,r=parseInt(t.charAt(1)),s&&s[r]&&(v.X=-s[r].extOffsetX,v.Y=-s[r].extOffsetY)),m.E=0,t){case"M82":M=!0;break;case"M83":M=!1;break;case"G20":P=25.4;break;case"G21":P=1;break;case"G90":g=!0;break;case"G91":g=!1;break;case"G92":e.forEach(t=>{m[t.charAt(0)]=parseFloat(t.substring(1))});break;case"G10":z.last().retract=!0;break;case"G11":break;case"G0":T(!0,e);break;case"G1":T(!1,e);break;case"G2":D(!0,e,a);break;case"G3":D(!1,e,a);break;case"M6":Y=parseInt(e[0].substring(1))}}});for(n of I)for(var J of n){let t=J.point;t.x+=d,t.y+=f,t.z+=y}u.imported=t,u.lines=o.length,u.bytes=t.length,u.minSpeed=Math.floor(k/60),u.maxSpeed=Math.floor(A/60),u.belt=c,s({output:u.output})}}class Output{constructor(t,e,a,s,r){this.point=t,this.emit=e,this.speed=a,this.tool=s,this.type=r}clone(t){let e=new Output(this.point.clone(),this.emit,this.speed,this.tool,this.type);return void 0!==t&&e.point.setZ(t),e}set_retract(){return this.retract=!0,this}}function newPrint(t,e,a){return new Print(t,e,a)}gapp.overlay(kiri,{Print:Print,newPrint:newPrint})});gapp.register("load.png",(r,a)=>{const{load:e}=r;function t(e,t){return new Promise((a,r)=>{n(e,{...t,done(r){a(r)}})})}function n(r,vr={}){let a=new png.PNG,ir=vr.progress||noop,fr=vr.done||noop;a.parse(r,(r,a)=>{var{width:n,height:o,data:l}=a,e=vr.outHeight||o,t=vr.outWidth||n,v,i;let f=1;f=o/n<e/t?n/t:o/e;var p=n*o+2*o+2*n,a=(o-1)*(n-1)+2*(o-1)+2*(n-1)+1;let s=new Uint8Array(n*o),h=new Uint8Array(n*o),w=0;var d=!!vr.inv_image,g=!!vr.inv_alpha,y=vr.border||0;for(let t=0;t<o;t++)for(let e=0;e<n;e++){var A=4*(e+n*t),m=l[A],u=l[1+A],c=l[2+A];let r=l[3+A],a=(m+u+c)/3;g&&(r=255-r),d&&(a=255-a),y&&(e<y||t<y||e>n-y-1||t>o-y-1)&&(a=255),h[w]=r,s[w++]=a*(r/255)}let M=parseInt(vr.blur||0);for(;0<M--;){let e=new Uint8Array(n*o);for(let a=0;a<o;a++)for(let r=0;r<n;r++){var U=Math.max(r-1,0),b=Math.min(r+1,n-1),P=Math.max(a-1,0),x=Math.min(a+1,o-1),F=r+n*a;e[F]=(s[U+n*P]+s[r+n*P]+s[b+n*P]+s[U+n*a]+8*s[r+n*a]+s[b+n*a]+s[U+n*x]+s[r+n*x]+s[b+n*x])/16}s=e}var G=parseInt(vr.base||0);let I=new Float32Array(3*p),N=new Uint32Array(6*a);var _=n/2,H=o/2;let W=0,j=0,k=0,q=0;for(let a=0;a<n;a++){for(let r=0;r<o;r++){var z=a+n*r,B=s[z],C,D,B,z;I[W++]=(-_+a)/f,I[W++]=(H-r)/f,I[W++]=B/50+G*h[z]/255,k++,0<a&&0<r&&(C=(a-1)*o+ +r,D=+a*o+(r-1),B=+a*o+ +r,z=(a-1)*o+(r-1),N[j++]=C,N[j++]=B,N[j++]=D,N[j++]=C,N[j++]=D,N[j++]=z)}ir(a/n)}q=k;var t=k;for(let r=0;r<n;r++){var E=0,J,K,L,O;I[W++]=(-_+r)/f,I[W++]=H/f,I[W++]=0,k++,0<r&&(J=q+(r-1),K=q+ +r,L=r*o,O=(r-1)*o,N[j++]=J,N[j++]=L,N[j++]=K,N[j++]=J,N[j++]=O,N[j++]=L)}q=k;var e=k;for(let r=0;r<n;r++){var Q=o-1,R,S,T,Q;I[W++]=(-_+r)/f,I[W++]=(H-Q)/f,I[W++]=0,k++,0<r&&(R=q+(r-1),S=q+ +r,T=r*o+Q,Q=(r-1)*o+Q,N[j++]=R,N[j++]=S,N[j++]=T,N[j++]=R,N[j++]=T,N[j++]=Q)}q=k;for(let r=0;r<o;r++){var V=0,X,Y,Z,$;I[W++]=(0-_)/f,I[W++]=(H-r)/f,I[W++]=0,k++,0<r&&(X=q+(r+0),Y=q+(r-1),Z=r-1,$=+r+0,N[j++]=X,N[j++]=Z,N[j++]=Y,N[j++]=X,N[j++]=$,N[j++]=Z)}q=k;var p=k;for(let r=0;r<o;r++){var rr=n-1,ar,er,tr,rr;I[W++]=(rr-_)/f,I[W++]=(H-r)/f,I[W++]=0,k++,0<r&&(ar=q+(r+0),er=q+(r-1),tr=rr*o+(r-1),rr=rr*o+ +r,N[j++]=ar,N[j++]=er,N[j++]=tr,N[j++]=ar,N[j++]=tr,N[j++]=rr)}var a=k-1;N[j++]=t,N[j++]=p,N[j++]=a,N[j++]=t,N[j++]=a,N[j++]=e;let nr=new Float32Array(3*j),or=0;for(let r=0;r<j;r++){var lr=3*N[r];nr[or++]=I[lr],nr[or++]=I[1+lr],nr[or++]=I[2+lr]}fr(nr)})}e.PNG={parseAsync:t,parse:n}});"use strict";gapp.register("mesh.geom",[],(e,r)=>{const{Matrix4:a,Matrix3:t,Vector3:i,Box3:l}=THREE,s=r({areaSigned(t,n=3){let s=0;var o=t.length;for(let e,r,a=0;a<o;)e=t.slice(a,a+n),a+=n,r=a<o-n?t.slice(a,a+n):t.slice(0,n),s+=(r[0]-e[0])*(r[1]+e[1]);return s/2},area(e){return Math.abs(s.areaSigned(e))},bounds(t,n=3){let s=new l,o=new i;for(let e,r=0,a=t.length;r<a;r+=n)s.expandByPoint(o.fromArray(t,r));return s},isInside(e,r){return e.bounds.containsBox(r.bounds)},nest(e){let t=e.map(e=>({points:e,area:0,depth:0,inner:[],bounds:s.bounds(e)}));t=t.sort((e,r)=>(e.area=e.area||s.areaSigned(e.points),r.area=r.area||s.areaSigned(r.points),Math.abs(e.area)-Math.abs(r.area)));var n=t.length,a;e:for(let e=0;e<n-1;e++){let a=t[e];for(let r=e+1;r<n;r++){let e=t[r];if(s.isInside(e,a)){a.parent=e,e.inner.push(a);break e}}}for(a of t)for(let e=a.parent,r=0;e;e=e.parent)a.depth++;return t}})});"use strict";gapp.register("mesh.tool",[],(e,t)=>{const{mesh:s}=e,{geom:E}=s,{Vector3:n}=THREE,z=4294967295;s.tool=class r{constructor(e={}){this.precision=Math.pow(10,e.precision||6)}checkVertices(e,t){if(!e)throw"missing vertices";if(t&&e.length%t!=0)throw"invalid vertices";return e}getIndex(){if(!this.indexed)throw"missing index";return this.indexed}generateFaces(s,e={}){this.checkVertices(s,3);var r=!1!==e.clean,i=!1!==e.dedup;let n=[],a={},h=[],o=[],l={};var c=this.precision;let f=0,v=0;for(let t=0,e=s.length;t<e;t+=3){var p=s[t],u=s[t+1],d=s[t+2],g=[p*c|0,u*c|0,d*c|0].join(""),d;let e=l[g];void 0===e&&(l[g]=e=o.length,o.push(p),o.push(u),o.push(d)),r?(h.push(e),3===h.length&&(h[0]!==h[1]&&h[0]!==h[2]&&h[1]!==h[2]?(i?(d=h.slice().sort().join("-"),a[d]?f++:(n.appendAll(h),a[d]=d)):n.appendAll(h),h=[]):(h=[],v++))):n.push(e)}return this.stats={cull:v,dups:f,faces:n.length/3},this.uvert=o,this.faces=n,this}index(e){this.vertices=this.checkVertices(e,3);const t=this.precision;var s,r=e.length/3/3,c=e.map(e=>e*t|0);const f=new Uint32Array(4*r*3).fill(z),v={},p={},u=new Float32Array(6*r),d={};var i={};const g={},x=[0,0,0],m=[0,0,0],w=[new n,new n,new n];for(let t=0,e=c.length,n=0,s=0,a=0,r=0,i=0,h,o,l;t<e;){var j=t;w[i].set(h=c[t++],o=c[t++],l=c[t++]);var M=h+","+o+","+l;let e=d[M];if(void 0===e&&(e=d[M]=s++),m[i]=j,x[i++]=e,3===i){var V=THREE.computeFaceNormal(...w),[A,M,j]=x;const k=A<M?A+","+M:M+","+A,E=M<j?M+","+j:j+","+M,U=j<A?j+","+A:A+","+j;var[y,F,b]=m,j=[k,E,U].map((e,t)=>{let s=g[e],r,i;return void 0===s?(s=g[e]=a++,i=v[s]=1,r=4*s,f[r]=m[t],f[r+1]=m[(t+1)%3]):(r=4*s,i=++v[s]),2<i?(p[s]=p[s]||[f[r],f[r+1],f[r+2],f[r+3]]).push(n):f[r+i+1]=n,s});u[r++]=V.x,u[r++]=V.y,u[r++]=V.z,u[r++]=j[0],u[r++]=j[1],u[r++]=j[2],i=0,n++}}this.indexed={faces:u,sides:f,sideExt:p}}getAdjacentFaces(t){const{faces:e,sides:s}=this.getIndex();var r=6*t,i=e[3+r],n=e[4+r],r=e[5+r],r=[s[4*i+2],s[4*i+3],s[4*n+2],s[4*n+3],s[4*r+2],s[4*r+3]].filter(e=>e!==z&&e!==t);return r.length?r:(console.log("no adjacent faces to "+t),[])}findConnectedSurface(e,s,t,r={}){const i=this.getIndex().faces,n={},a=(e=void 0!==t?e.filter(e=>i[6*e+2]>=t):e).slice();for(var h of e)r[h]=1;for(;a.length;){var o=a.shift(),l=6*o,c,f;if(!(void 0!==t&&i[2+l]<t))for(f of this.getAdjacentFaces(o))if(!r[f]&&!n[f]){var v=6*f,p;let t=0;for(let e=0;e<3;e++)t+=Math.pow(i[l+e]-i[v+e],2);Math.sqrt(t)<=s&&(e.push(f),a.push(f),n[f]=1,r[f]=1)}}return e}generateOutlines(e){const{faces:t,sides:i}=this.getIndex(),n=this.precision,a=this.vertices,h={},o={},l={};let c=0;function f(e){var t=a[e],s=a[e+1],r=a[e+2],i=(t*n|0)+","+(s*n|0)+","+(r*n|0),e=o[i];return void 0===e?(l[c]={x:t,y:s,z:r,to:[]},o[i]=c++):e}function s(e){if(e!==z){var t=f(i[4*e]),s=f(i[4*e+1]),e=t<s?t+","+s:s+","+t;const r=h[e];r?r.del=!0:h[e]={v0:t,v1:s}}}for(var r of e){var r=6*r;s(t[3+r]),s(t[4+r]),s(t[5+r])}var v,p,u;for(p of Object.values(h).filter(e=>!e.del)){var{v0:d,v1:g}=p;const A=l[d],y=l[g];A.to.push(g),y.to.push(d)}let x,m=[];for(u of Object.values(l))if(!u.used&&0!==u.to.length)for(m.push(x=[]);u;){var{to:w,x:j,y:M,z:V}=u;if(w.length<2)throw`invalid to ${w.length} @ ${j},${M},`+V;u.used=!0,x.push({x:j,y:M,z:V});var V=l[w[0]],w=l[w[1]];u=V.used?w.used?void 0:w:V}return m}isolateBodies(){const s=this.checkVertices(this.vertices),r=[];var i={};for(let e=0,t=s.length/9;e<t;e++)if(!i[e]){var n=this.findConnectedSurface([e],1/0,void 0,i);if(n.length){const h=[];for(var a of n)h.push(...s.slice(9*a,9*a+9));r.push(h)}}return r}patch(e={merge:!0}){let v=this.checkVertices(this.uvert);var s=this.faces;let a={},h={},o=[];class l{constructor(e,t){this.v1=e,this.v2=t,this.faces=[]}addFace(e){return this.faces.indexOf(e)<0&&this.faces.push(e),this}adjacentUnused(){return h[this.v1].concat(h[this.v2]).filter(e=>e!==this&&!e.used&&1===e.faces.length)}adjacentUsed(){return h[this.v1].concat(h[this.v2]).filter(e=>e!==this&&e.used&&1===e.faces.length)}touches(e){return this.v1===e.v1||this.v1===e.v2||this.v2===e.v1||this.v2===e.v2}unitVector(){if(void 0!==this.unit)return this.unit;var e=this.v1,t=this.v2;let s=[v[e]-v[t],v[e+1]-v[t+1],v[e+2]-v[t+2]],r=Math.max(...s.map(e=>Math.abs(e)));return this.unit=s.map(e=>e/r)}}function t(t,s){let r=0;for(let e=0;e<3;e++)r+=Math.abs(t[e]-s[e]);return r}function r(s,r){var e,t,i=(v[s]+1e3*v[s+1]+1e5*v[s+2]<=v[r]+1e3*v[r+1]+1e5*v[r+2]?[s,r]:[r,s]).join("-");let n=a[i];if(!n){n=a[i]=new l(s,r),n.key=i,o.push(n);let e=h[s]=h[s]||[],t=h[r]=h[r]||[];e.push(n),t.push(n)}return n}function i(e){return v[e],v[e+1],v[e+2],1}for(let e=0,t=this.faces.length;e<t;e+=3)var n=s[e],c=s[e+1],f=s[e+2],p=r(n,c).addFace(e),u=r(c,f).addFace(e),d=r(f,n).addFace(e);this.lines=o;var g=this.edges=o.filter(e=>1===e.faces.length),x,m,w;let j=this.loops=[];for(let e=0,t=g.length;e<t;e++){let s=g[e];if(!s.used&&!(2<s.adjacentUnused().length)){let t=[];for(;;){let e=s.adjacentUnused();if(0===e.length){var M=t[0],x=t.last();t.open=t.length<3||M.v1!==x.v1&&M.v2!==x.v2&&M.v1!==x.v2&&M.v2!==x.v1;break}s=1===e.length?(s.v2!==e[0].v1&&(x=e[0].v1,e[0].v1=e[0].v2,e[0].v2=x),e[0]):2===e.length?e[0].v1===s.v2?e[0]:e[1]:(s.split=e,e[0]),t.push(s),s.used=!0}t.length&&j.push(t)}}if(1<j.length)e:for(let i=0;i<j.length-1;i++){let r=j[i];if(r&&r.open)for(let s=i+1;s<j.length;s++){let t=j[s];if(t&&t.open){let e;if(r[0].touches(t[0])?e=[...t.reverse(),...r]:r[0].touches(t.last())?e=[...t,...r]:r.last().touches(t[0])?e=[...r,...t]:r.last().touches(t.last())&&(e=[...r,...t.reverse()]),e){e.open=!0,j.push(e),j[i]=j[s]=void 0;continue e}}}}function V(e){let s,r=[],i=[],n=0,a=0,h=0,o=e.slice();o.push(e[0]);for(let t=0;t<o.length;t++){var l=o[t];let e;e=l.v1===s?l.v2:l.v1,t<o.length-1&&(r.push(e),i.push([v[e],v[e+1],v[e+2]])),0<=s&&(n=Math.max(n,Math.abs(v[s]-v[e])),a=Math.max(a,Math.abs(v[s+1]-v[e+1])),h=Math.max(h,Math.abs(v[s+2]-v[e+2]))),s=e}let t=2;if(a<n&&a<h?t=1:n<a&&n<h&&(t=0),t<2)for(var c of i){var f=c[2];c[2]=c[t],c[t]=f}return{index:r,points:i.flat(),swap:t}}function A(e){let{index:t,points:s}=e,r=earcut(s,void 0,3);return r.map(e=>t[e])}function y(e){let t=e.loop.points.slice(),s=e.loop.index.slice(),r=[];for(var i of e.inner)r.push(t.length/3),t.appendAll(i.loop.points),s.appendAll(i.loop.index);let n=earcut(t,r,3);return n.map(e=>s[e])}this.shorts=j.filter(e=>e&&e.length<=2),this.loops=j=j.filter(e=>e&&2<e.length);let F=this.areas=[];if(e.compound){let e=j.map(e=>V(e)),s=E.nest(e.map(e=>e.points));for(let t of s)t.loop=e.filter(e=>e.points===t.points)[0];for(w of s.filter(e=>e.depth%2==0))F.push(y(w))}else for(var b of j){var k,b=A(V(b));F.push(b)}return e.merge&&this.merge(),e.mapped&&(this.mapped={edges:this.expandLoop(this.edges),areas:this.areas.map(e=>this.expandArray(e))}),this}appendVertex(e,t=[]){var s=this.uvert;return t.push(s[e++]),t.push(s[e++]),t.push(s[e]),t}expandArray(e,t=[]){for(var s of e)this.appendVertex(s,t);return t}expandLoop(e,t=[]){for(var s of e)this.appendVertex(s.v1,t),this.appendVertex(s.v2,t);return t}merge(){for(var e of this.areas||[])this.faces.appendAll(e)}unrolled(){var e=[],t;for(t of this.faces)this.appendVertex(t,e);return e}}});"use strict";gapp.register("mesh.util",[],(t,e)=>{const{Matrix4:l,Matrix3:r,Vector3:c,Box3:d}=THREE,{mesh:p}=t,a=[],m={},x=e({uuid(t=1){let e=[];for(;0<t--;)e.push(Math.round(4294967295*Math.random()).toString(36));return e.join("-")},toHexRGB(t){return[(t>>16&255).toString(16).padStart(2,0),(t>>8&255).toString(16).padStart(2,0),(t>>0&255).toString(16).padStart(2,0)].join("")},fromHexRGB(t){return 0+parseInt(t.substring(0,2),16)<<16|parseInt(t.substring(2,4),16)<<8|parseInt(t.substring(4,6),16)},comma(t){let e=t.toString().split(".");return e[0]=e[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")},defer(t,e=50){for(var r of a)if(r.fn===t){clearTimeout(r.timer),a.remove(r);break}let o={fn:t};o.timer=setTimeout(()=>{a.remove(o),t()},e),a.push(o)},deferWrap(t,e){return function(){x.defer(t,e)}},bounds(t){var e=new d;if(Array.isArray(t))for(var r of t)x.box3expand(e,r instanceof p.object?r.object:r);else{if(!t)return e;x.box3expand(e,t instanceof p.object?t.object:t)}let o={min:{x:e.min.x,y:e.min.z,z:e.min.y},max:{x:e.max.x,y:e.max.z,z:e.max.y}};return o.size=o.dim={x:o.max.x-o.min.x,y:o.max.y-o.min.y,z:o.max.z-o.min.z},o.center=o.mid={x:(o.max.x+o.min.x)/2,y:-(o.max.y+o.min.y)/2,z:(o.max.z+o.min.z)/2},o},box3expand(n,i){if(!i._no_bounds){let a=i.geometry;if(i.updateWorldMatrix(!!a,!1),a){let e=i.matrixWorld;var s=[e.elements.map(t=>t.round(5))].join(",");let r=m[i.id];if(!r||r.bkey!==s||a._model_invalid){let t=a.attributes.position.clone();t.applyMatrix4((new l).extractRotation(e));var u=(new d).setFromBufferAttribute(t);r=m[i.id]={bkey:s,bounds:u},a._model_invalid=void 0}let t=r.bounds.clone(),o=new l;o.setPosition((new c).setFromMatrixPosition(i.matrixWorld)),t.applyMatrix4(o),n.union(t)}var r=i.children;for(let t=0,e=r.length;t<e;t++)x.box3expand(n,r[t])}},extract(e,r={}){var t,o;let a=[];for(o of r.fields||["x","y","z"]){let t=e[o]||0;void 0!==r.round&&(t=t.round(r.round)),void 0!==r.fixed&&(t=t.toFixed(r.fixed)),a.push(t)}return a},average(t,e={}){var r=e.fields||["x","y","z"],o,a;let n={};for(o of t)for(var i of r)n[i]=(n[i]||0)+o[i];for(a of r)n[a]=(n[a]||0)/t.length;return n},faceNormals(t,i={}){const s=new THREE.Vector3,u=new THREE.Vector3,l=new THREE.Vector3;var e=new THREE.Vector3;const c=new THREE.Vector3;var r=new THREE.Matrix3,o=p.api.prefs.map,a=o.normals;const d=o.space.dark?a.color_dark:a.color_lite,m=a.length||1;class n extends THREE.LineSegments{constructor(t,e=i.size||m,r=i.color||d){var o,a=t.geometry.attributes.position.count/3;const n=new THREE.BufferGeometry;var a=new THREE.Float32BufferAttribute(3*a*2,3);n.setAttribute("position",a),super(n,new THREE.LineBasicMaterial({color:r,toneMapped:!1})),this.object=t,this.size=e,this.type="FaceNormalsHelper",this.matrixAutoUpdate=!1,this._no_bounds=!0,this.update()}update(){this.object.updateMatrixWorld(!0);const o=this.geometry.attributes.position;var t,a=this.object.geometry.attributes.position.array;let n=0;for(let e=0,t=0,r=a.length;n<r;){s.set(a[n++],a[n++],a[n++]),u.set(a[n++],a[n++],a[n++]),l.set(a[n++],a[n++],a[n++]);let t=THREE.computeFaceNormal(s,u,l);var i=s.add(u).add(l).divideScalar(3);c.copy(i).add(t.multiplyScalar(this.size)),o.setXYZ(e++,i.x,i.y,i.z),o.setXYZ(e++,c.x,c.y,c.z)}o.needsUpdate=!0}}return new n(t)},vertexNormals(t){const i=new c,s=new c,u=new r;class e extends THREE.LineSegments{constructor(t,e=1,r=16711680){var o,a=t.geometry.attributes.normal.count;const n=new THREE.BufferGeometry;var a=new THREE.Float32BufferAttribute(2*a*3,3);n.setAttribute("position",a),super(n,new THREE.LineBasicMaterial({color:r,toneMapped:!1})),this.object=t,this.size=e,this.type="VertexNormalsHelper",this.matrixAutoUpdate=!1,this.update()}update(){this.object.updateMatrixWorld(!0);const o=this.geometry.attributes.position;var t=this.object.geometry;const a=t.attributes.position,n=t.attributes.normal;for(let t=0,e=0,r=a.count;e<r;e++)i.set(a.getX(e),a.getY(e),a.getZ(e)),s.set(n.getX(e),n.getY(e),n.getZ(e)),s.applyMatrix3(u).normalize().multiplyScalar(this.size).add(i),o.setXYZ(t++,i.x,i.y,i.z),o.setXYZ(t++,s.x,s.y,s.z);o.needsUpdate=!0}}return new e(t)},facesToGroups(e){let r=[];if(e&&e.length){var o=(e=e.sort((t,e)=>t-e).slice()).shift(),a;0<o&&r.push({start:0,count:o,mat:0});let t={start:o,count:1,mat:1};r.push(t);for(a of e)a===t.start+t.count?t.count++:(r.push(t={start:t.start+t.count,count:a-t.start-t.count}),r.push(t={start:a,count:1,mat:1}));r.push({start:t.start+t.count,count:1/0})}else r.push({start:0,count:1/0});return r}})});"use strict";gapp.main("main.kiri",[],i=>{const{kiri:a}=i;var{api:r}=a;a.load_exec()},i=>{const r=i.kirimod=i.kirimod||[],o=i.kiri={beta:0,driver:{},load(i){r.push(i)},load_exec(a){r.forEach(i=>{i(a||o.api)}),o.load=i=>{i(a||o.api)}}}});